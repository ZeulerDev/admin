import{y as ds,r as a,A as n,j as e,h as F,m as z}from"./index-CJ-e1XdK.js";import{a as g}from"./axios-Cm0UX6qg.js";import{B as x}from"./config-HOLfLxHr.js";import{b as us,a as d}from"./CContainer-BPPY1Q9a.js";import{C as he}from"./CNavbar-DPyXGWVC.js";import{C as hs}from"./CFormInput-DBMCobyK.js";import{C as m,a as C,b as u,c as o,d as k,e as r}from"./CTable-CkE6FbZW.js";import{e as Y,C as gs,a as ge,b as xe,c as fe,d as M}from"./DefaultLayout-DWwaUX_t.js";import{c as xs}from"./cil-view-module-CSS15w8m.js";import{C as fs,a as O}from"./CPaginationItem-DoU_pNV3.js";import{C as b,a as S,b as w,c as P}from"./CModalTitle-DYJ0rQad.js";import{C as L}from"./CModalFooter-D_v9FH3H.js";import{C as js}from"./CCardImage-Kiou5l5I.js";import"./CFormLabel-BEtRyV2p.js";const Hs=()=>{const[{user:f,token:c},i]=ds(),[je,j]=a.useState(!1),[Q,I]=a.useState(0),[N,ys]=a.useState(0),[ye,A]=a.useState(!0),[B,pe]=a.useState(""),[me,Ce]=a.useState(0),[v,T]=a.useState(1),[E,ps]=a.useState(),[ke,Me]=a.useState([]),[be,$]=a.useState(!1);a.useState(!1);const[Se,y]=a.useState(!1);a.useState("");const[ms,we]=a.useState("");a.useState("");const[Pe,Ae]=a.useState([]),[_,ve]=a.useState([]),[De,U]=a.useState(!1),[Fe,R]=a.useState(!1),[ze,D]=a.useState(!1),[q,G]=a.useState(!1),[J,K]=a.useState(""),[Le,W]=a.useState("All Cities"),[Ie,X]=a.useState("All Chains"),[Cs,Z]=a.useState(""),[ks,ee]=a.useState("All Cities"),[se,te]=a.useState(""),[ae,le]=a.useState(""),[Ms,oe]=a.useState("All Chains"),[bs,re]=a.useState("");a.useState([]);const[Ss,Ne]=a.useState([]),[Be,Te]=a.useState([]),[Ee,ie]=a.useState(!1),[$e,_e]=a.useState([]),[Re,Ve]=a.useState(""),[ws,He]=a.useState(""),[ne,Ye]=a.useState({flayerId:""}),[Oe,ce]=a.useState(!1),[Ps,Qe]=a.useState(""),[Ue,qe]=a.useState([]),[Ge,V]=a.useState(!1);a.useEffect(()=>{const s=setTimeout(()=>{i({type:n,payload:{status:!0,title:"Data Loading",message:"Data loading error: Timeout exceeded",color:"warning"}}),$(!1)},2e4);return f&&c&&p(0,s),()=>{clearTimeout(s)}},[f,c,B]);const p=(s,t)=>{$(!0),g.get(x+`flayers/all/${s}?search=${B}`,{headers:{Authorization:`Bearer ${c}`}}).then(l=>{l.status===200?(Me(l.data.list),Ce(l.data.count),console.log(l.data.list.length),$(!1),clearTimeout(t),l.data.list.length<20?(A(!0),console.log("ok")):l.data.list.length>19&&A(!1),console.log(l.data.list.length)):l.status===500&&i({type:n,payload:{status:!0,title:"Category loading error",message:l.data.message}})}).catch(l=>{console.error("Error:",l)})},Je=()=>{T(v+1);const s=N+20;I(s),p(s,E)},Ke=()=>{T(v-1);const s=N-20;console.log(s),I(s),p(s,E)},We=s=>{T(s);const t=(s-1)*20;I(t),p(t,E)},Xe=()=>{const s=Math.ceil(me/20),t=[];for(let h=1;h<=s;h++)t.push(h);const l=Math.max(v-2,1),cs=Math.min(l+4,s);return t.slice(l-1,cs).map(h=>e.jsx(O,{active:v===h,onClick:()=>We(h),children:h},h))},Ze=(s,t)=>{y(!0),Ae(s),He(t)},es=s=>{s?(U(!0),ss(s)):i({type:n,payload:{status:!0,title:"Error!",message:"Flayers Product Loading error, Please Check the input fields",color:"warning"}})},ss=s=>{s?(console.log("id",s),c&&(j(!0),g.get(x+"flayer/products/"+s,{headers:{Authorization:`Bearer ${c}`}}).then(t=>{t.status===200?(ve(t.data),j(!1)):t.status===204?(i({type:n,payload:{status:!0,title:"Flayers Product Loading error",message:"Flayers Product Loading error",color:"warning"}}),j(!1)):t.status===404?(i({type:n,payload:{status:!0,title:"Flayers Product Loading error",message:"Flayers Product Loading error",color:"warning"}}),j(!1)):t.status===500&&(i({type:n,payload:{status:!0,title:"Flayers Product Loading error",message:"Flayers Product Loading error",color:"warning"}}),j(!1))}).catch(t=>{console.error("Error:",t),j(!1)}))):i({type:n,payload:{status:!0,title:"Missing!",message:"Flayers Product Loading error",color:"warning"}})},de=(s,t)=>{D(!0),G(t),K(s)},ts=()=>{const s={status:q};console.log(J,s),f&&c&&g.patch(x+"assistant/flayer/status/"+J,s,{headers:{Authorization:`Bearer ${c}`}}).then(t=>{t.status===200?(console.log("updated"),D(!1),G(""),K(""),p(0,null),i({type:n,payload:{status:!0,title:"Flayer status update",message:"Flayer status updated successfully",color:"success"}})):t.status===203?i({type:n,payload:{status:!0,title:"Flayer status update error",message:t.data.message}}):t.status===204?i({type:n,payload:{status:!0,title:"Flayer status update error",message:t.data.message}}):t.status===500&&i({type:n,payload:{status:!0,title:"Flayer status update error",message:t.data.message}})}).catch(t=>{console.error(t)})},ue=(s,t,l)=>{l==="view"?s==="all"?(re(""),oe("All Chains")):(re(s),oe(t)):l==="modal"&&(s==="all"?(le(""),X("All Chains")):(le(s),X(t)))},H=(s,t)=>{t==="view"?s==="all"?(Z(""),ee("All Cities")):(Z(s),ee(s)):t==="modal"&&(s==="all"?(te(""),W("All Cities")):(te(s),W(s)))},as=()=>{c&&g.get(x+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${c}`}}).then(s=>{s.status===200?(Ne(s.data),Te(s.data)):s.status===500&&i({type:n,payload:{status:!0,title:"Chain Loading error",message:s.data.message}})}).catch(s=>{console.error("Error: ",s)})};a.useEffect(()=>{f&&c&&ls(0)},[ae,se,f]);const ls=(s,t)=>{ie(!0),g.get(x+`assistant/market/locations/${s}?brand=${ae}&city=${se}`,{headers:{Authorization:`Bearer ${c}`}}).then(l=>{l.status===200?(_e(l.data.data),console.log("data market"),ie(!1),l.data.data.length<20?(A(!0),console.log("ok")):l.data.data.length>19&&A(!1)):l.status===500&&i({type:n,payload:{status:!0,title:"Market Loading error",message:l.data.message}})}).catch(l=>{console.error("Error: ",l)})},os=(s,t)=>{y(!1),R(!0),Ve(t),as(),console.log(s),Ye({flayerId:s})},rs=s=>{const t=ne;s&&ne!==null?f&&c&&(console.log("data",t),g.patch(x+"flayer/market/update/"+s,t,{headers:{Authorization:`Bearer ${c}`}}).then(l=>{l.status===200?(console.log("updated"),i({type:n,payload:{status:!0,title:"Flayer market update",message:"Flayer market updated successfully",color:"success"}}),R(!1),y(!0)):l.status===203?i({type:n,payload:{status:!0,title:"Flayer market update error",message:l.data.message}}):l.status===204?i({type:n,payload:{status:!0,title:"Flayer market update error",message:l.data.message}}):l.status===500&&i({type:n,payload:{status:!0,title:"Flayer market update error",message:l.data.message}})}).catch(l=>{console.error(l)})):i({type:n,payload:{status:!0,title:"Missing!",message:"Flayers Loading error",color:"warning"}})},is=s=>{console.log("id",s),ce(!0),Qe(s),ns(s)},ns=s=>{V(!0),g.get(x+`flayer/market/assign/${s}`,{headers:{Authorization:`Bearer ${c}`}}).then(t=>{t.status===200?t.data.length!==0?(qe(t.data),console.log("data market"),V(!1)):(V(!1),i({type:n,payload:{status:!0,title:"Market Loading",message:"No market assigned to this flayer",color:"info"}})):t.status===500&&i({type:n,payload:{status:!0,title:"Market Loading error",message:t.data.message}})}).catch(t=>{console.error("Error: ",t)})};return e.jsxs(us,{children:[e.jsx(he,{style:{marginTop:"1%"},className:"bg-body-tertiary",children:e.jsx(hs,{type:"text",placeholder:"Search here",style:{width:450,marginRight:"30%"},value:B,onChange:s=>pe(s.target.value)})}),be?e.jsx(F,{}):e.jsxs(m,{children:[e.jsx(C,{children:e.jsxs(u,{children:[e.jsx(o,{scope:"col",children:"#"}),e.jsx(o,{scope:"col",children:"Id"}),e.jsx(o,{scope:"col",children:"End Date"}),e.jsx(o,{scope:"col",children:"Retailer"}),e.jsx(o,{scope:"col",children:"Status"}),e.jsx(o,{scope:"col",children:"Markets"}),e.jsx(o,{scope:"col",children:"Disabled"}),e.jsx(o,{scope:"col",children:"Products"}),e.jsx(o,{scope:"col",children:"Assigned Market"})]})}),e.jsx(k,{children:ke.map((s,t)=>e.jsxs(u,{children:[e.jsx(r,{children:Q+t+1}),e.jsx(r,{children:s.flayer_id}),e.jsx(r,{children:s.endDate}),e.jsx(r,{children:s.retailer}),e.jsx(r,{children:s.status===!0?e.jsx(d,{size:"sm",onClick:()=>{de(s._id,!1)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Deactivate"}):e.jsx(d,{size:"sm",onClick:()=>{de(s._id,!0)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Activate"})}),e.jsx(r,{children:e.jsx(d,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>{Ze(s.stores,s._id)},children:e.jsx(z,{icon:Y,size:"lg",style:{color:"white"}})})}),e.jsx(r,{children:s.disabled===!1?"No":"Yes"}),e.jsx(r,{children:e.jsx(d,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>{es(s._id)},children:e.jsx(z,{icon:xs,size:"lg",style:{color:"white"}})})}),e.jsx(r,{children:e.jsx(d,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>{is(s._id)},children:e.jsx(z,{icon:Y,size:"lg",style:{color:"white"}})})})]},t))})]}),e.jsxs(fs,{"aria-label":"Page navigation example",children:[e.jsx(O,{disabled:Q<=0,onClick:Ke,children:"Previous"}),Xe(),e.jsx(O,{disabled:ye===!0,onClick:Je,children:"Next"})]}),e.jsxs(b,{alignment:"center",visible:Oe,scrollable:!0,size:"lg",onClose:()=>ce(!1),children:[e.jsx(S,{closeButton:!0,children:e.jsx(w,{children:"All Assign Markets details"})}),e.jsx(P,{children:Ge?e.jsx(F,{}):e.jsxs(m,{children:[e.jsx(C,{children:e.jsxs(u,{children:[e.jsx(o,{scope:"col",children:"#"}),e.jsx(o,{scope:"col",children:"Chain Name"}),e.jsx(o,{scope:"col",children:"Address"}),e.jsx(o,{scope:"col",children:"City"})]})}),e.jsx(k,{children:Ue.map((s,t)=>e.jsxs(u,{children:[e.jsx(r,{children:t+1}),e.jsx(r,{children:s.chain.name}),e.jsx(r,{children:s.address}),e.jsx(r,{children:s.city})]},t))})]})}),e.jsx(L,{})]}),e.jsxs(b,{alignment:"center",visible:Se,scrollable:!0,size:"lg",onClose:()=>{y(!1),we("")},children:[e.jsx(S,{closeButton:!0,children:e.jsx(w,{children:"Markets"})}),e.jsx(P,{children:e.jsxs(m,{children:[e.jsx(C,{children:e.jsxs(u,{children:[e.jsx(o,{scope:"col",children:"#"}),e.jsx(o,{scope:"col",children:"Name"}),e.jsx(o,{scope:"col",children:"Market"})]})}),e.jsx(k,{children:Pe.map((s,t)=>e.jsxs(u,{children:[e.jsx(r,{children:t+1}),e.jsx(r,{children:s.address}),e.jsx(r,{children:e.jsx(d,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>{os(s._id,s.market)},children:e.jsx(z,{icon:Y,size:"lg",style:{color:"white"}})})})]},t))})]})}),e.jsx(L,{})]}),e.jsxs(b,{visible:De,scrollable:!0,size:"xl",onClose:()=>U(!1),children:[e.jsx(S,{closeButton:!0,children:e.jsx(w,{children:"Flayers Products Information"})}),e.jsx(P,{style:{overflowY:"auto",maxHeight:"70vh",display:"flex",justifyContent:"center"},children:je?e.jsx(F,{}):e.jsxs(m,{children:[e.jsx(C,{children:e.jsxs(u,{children:[e.jsx(o,{scope:"col",children:"#"}),e.jsx(o,{scope:"col",children:"Photo"}),e.jsx(o,{scope:"col",children:"Name"}),e.jsx(o,{scope:"col",children:"Price"}),e.jsx(o,{scope:"col",children:"Description"})]})}),e.jsx(k,{children:_==null?void 0:_.map((s,t)=>e.jsxs(u,{children:[e.jsx(r,{children:t+1}),e.jsx(r,{children:e.jsx(js,{style:{width:50,height:50,borderRadius:10},src:"https://api.zeuler.com/image/"+s.image})}),e.jsx(r,{children:s.name}),e.jsx(r,{children:s.price}),e.jsx(r,{children:s.description})]},t))})]})}),e.jsx(L,{})]}),e.jsxs(b,{alignment:"center",visible:ze,scrollable:!0,size:"sm",onClose:()=>D(!1),children:[e.jsx(S,{closeButton:!1,children:e.jsx(w,{children:"Confirmation"})}),e.jsxs(P,{children:[e.jsxs("a",{children:["Are you sure you want to ",q?"activate":"deactivate"," this flayer?"]}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[e.jsx(d,{onClick:()=>{ts()},style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),e.jsx(d,{onClick:()=>{D(!1)},style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]}),e.jsxs(b,{visible:Fe,scrollable:!0,size:"xl",onClose:()=>{R(!1),y(!0)},children:[e.jsx(S,{closeButton:!0,children:e.jsx(w,{children:"Market assign view"})}),e.jsxs(P,{children:[e.jsx(gs,{style:{marginLeft:"54%"},color:"secondary",children:"Filter by"}),e.jsxs(ge,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(xe,{style:{color:"white"},children:Le}),e.jsxs(fe,{children:[e.jsx(M,{onClick:()=>H("all","modal"),children:"All"}),e.jsx(M,{onClick:()=>H("Milano","modal"),children:"Milano"}),e.jsx(M,{onClick:()=>H("Napoli","modal"),children:"Napoli"})]})]}),e.jsxs(ge,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(xe,{style:{color:"white"},children:Ie}),e.jsxs(fe,{children:[e.jsx(M,{onClick:()=>ue("all",null,"modal"),children:"All"}),Be.map((s,t)=>e.jsx(M,{onClick:()=>ue(s.id,s.name,"modal"),children:s.name},t))]})]}),e.jsx(he,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),Ee?e.jsx(F,{}):e.jsxs(m,{children:[e.jsx(C,{children:e.jsxs(u,{children:[e.jsx(o,{scope:"col",children:"#"}),e.jsx(o,{scope:"col",children:"Name"}),e.jsx(o,{scope:"col",children:"Address"}),e.jsx(o,{scope:"col",children:"City"}),e.jsx(o,{scope:"col",children:"Assign Market"})]})}),e.jsx(k,{children:$e.map((s,t)=>e.jsxs(u,{children:[e.jsx(r,{children:N+t+1}),e.jsx(r,{children:s.chain.name}),e.jsx(r,{children:s.address}),e.jsx(r,{children:s.city}),e.jsx(r,{children:Re===s._id?e.jsx(d,{size:"sm",onClick:()=>{},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Assigned"}):e.jsx(d,{size:"sm",onClick:()=>{rs(s._id)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Add"})})]},t))})]}),e.jsx(L,{})]})]})]})};export{Hs as default};
