import{r as t,y as Se,l as ve,A as d,j as a,h as Y}from"./index-CShjmuOF.js";import{a as p}from"./axios-Cm0UX6qg.js";import{B as g}from"./config-HOLfLxHr.js";import{b as Ee,a as j}from"./CContainer-CVoz0lw8.js";import{C as G,a as C,b as y,c as k,d as u}from"./DefaultLayout-fJjJN1jI.js";import{C as Z}from"./CNavbar-DcUJdaz_.js";import{C as ee,a as ae,b as w,c as i,d as se,e as n}from"./CTable-CODcAIUx.js";import{C as Te,a as Le,b as Pe,c as Ne}from"./CModalTitle-BOOtbGl6.js";import{C as Be}from"./CModalFooter-GJGNinqB.js";import{C as ze,a as te}from"./CPaginationItem-CBp1JQ3-.js";const Ke=()=>{const[S,m]=t.useState(!1),[{user:f,token:l},c]=Se(),[v,E]=t.useState([]),[oe,D]=t.useState(!1),[T,L]=t.useState(""),[P,N]=t.useState(""),[B,z]=t.useState("");t.useState(!1),t.useState(""),ve();const[re,le]=t.useState(!1),[ie,$]=t.useState("All Cities"),[ne,_]=t.useState("All Market Groups"),[ce,R]=t.useState("All Chains"),[de,ue]=t.useState([]),[he,pe]=t.useState([]),[I,M]=t.useState(""),[ge,b]=t.useState([]),[fe,F]=t.useState("All Cities"),[H,U]=t.useState(""),[me,xe]=t.useState([]),[je,V]=t.useState(!1),[Ce,q]=t.useState(!0),[x,J]=t.useState(0);t.useEffect(()=>{A(),ye()},[]);const A=()=>{l&&p.get(g+"market/groups/dropdown/fetch",{headers:{Authorization:`Bearer ${l}`}}).then(e=>{e.status===200?ue(e.data):e.status===500&&c({type:d,payload:{status:!0,title:"Market Group Loading error",message:e.data.message}})}).catch(e=>{console.error("Error: ",e)})},ye=()=>{l&&p.get(g+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${l}`}}).then(e=>{e.status===200?(pe(e.data),le(!1)):e.status===500&&c({type:d,payload:{status:!0,title:"Chain Loading error",message:e.data.message}})}).catch(e=>{console.error("Error: ",e)})};t.useEffect(()=>{const e=setTimeout(()=>{c({type:d,payload:{status:!0,title:"Data Loading",message:"Data loading error: Timeout exceeded",color:"warning"}}),D(!1)},2e4);return ke(e),()=>{clearTimeout(e)}},[T,P,B,re]);const ke=e=>{f&&l&&(D(!0),p.get(g+`assistant/riders/:skip?city=${T}&group=${P}&chain=${B}`,{headers:{Authorization:`Bearer ${l}`}}).then(s=>{s.status===200?(E(s.data),D(!1),clearTimeout(e)):s.status===500&&c({type:d,payload:{status:!0,title:"Error",message:s.data.message,color:"warning"}})}).catch(s=>{console.error("Error:",s)}))},h=(e,s)=>{s==="view"?e==="all"?(L(""),$("All Cities")):(L(e),$(e)):s==="modal"&&(e==="all"?(U(""),F("All Cities")):(U(e),F(e)))},K=(e,s)=>{e==="all"?(N(""),_("All Market Groups")):(N(e),_(s))},O=(e,s)=>{e==="all"?(z(""),R("All Chains")):(z(e),R(s))},Q=(e,s)=>{m(!S),console.log("group",e,"driver ID",s),M(s),b(e)};t.useEffect(()=>{f&&l&&we(0)},[f,H]);const we=(e,s)=>{V(!0),p.get(g+`market/groups/fetch/${e}?city=${H}`,{headers:{Authorization:`Bearer ${l}`}}).then(r=>{r.status===200?(xe(r.data),V(!1),r.data.length<20?(q(!0),console.log("ok")):r.data.length>19&&q(!1)):r.status===500&&c({type:d,payload:{status:!0,title:"Makrket Group loading error",message:r.data.message}})}).catch(r=>{console.error("Error:",r)})},De=()=>{const e=x+20;J(e),loadData(e,!0)},Me=()=>{const e=x-20;console.log(e),J(e),loadData(e,!1)},be=(e,s)=>{if(console.log("driver id",e),console.log("group id",s),s&&e){const r={id:s,rider:e};l&&f&&l&&p.put(g+"assistant/groups/rider/assign",r,{headers:{Authorization:`Bearer ${l}`}}).then(o=>{if(o.status===200){m(!1),M(""),b([]),console.log(o.data),A();const W=o.data,Ge=v.map(X=>X.id===W._id?W:X);E([...Ge]),c({type:d,payload:{status:!0,title:"Market Group Assign",message:"successfully Market Group assigned to the picker ",color:"success"}})}else o.status===204?c({type:d,payload:{status:!0,title:"Group Assign error",message:o.data.message,color:"warning"}}):o.status===500&&c({type:d,payload:{status:!0,title:"Group Assign error",message:o.data.message,color:"warning"}})}).catch(o=>{console.error("Error:",o)})}else c({type:d,payload:{status:!0,title:"Error!",message:"Driver group assign error",color:"warning"}})},Ae=(e,s)=>{if(s&&e){const r={id:s,rider:e};l&&f&&l&&p.put(g+"assistant/groups/rider/remove",r,{headers:{Authorization:`Bearer ${l}`}}).then(o=>{o.status===200?(m(!1),M(""),b([]),A(),c({type:d,payload:{status:!0,title:"Market Group Remove",message:"successfully Market Group removed from the picker ",color:"success"}})):o.status===204?c({type:d,payload:{status:!0,title:"Group remove error",message:o.data.message,color:"warning"}}):o.status===500&&c({type:d,payload:{status:!0,title:"Group remove error",message:o.data.message,color:"warning"}})}).catch(o=>{console.error("Error:",o)})}else c({type:d,payload:{status:!0,title:"Error!",message:"Driver group assign error",color:"warning"}})};return a.jsxs(Ee,{children:[a.jsx(G,{style:{marginLeft:"34%"},color:"secondary",children:"Filter by"}),a.jsxs(C,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[a.jsx(y,{style:{color:"white"},children:ie}),a.jsxs(k,{children:[a.jsx(u,{onClick:()=>h("all","view"),children:"All"}),a.jsx(u,{onClick:()=>h("Milan","view"),children:"Milan"}),a.jsx(u,{onClick:()=>h("Napoli","view"),children:"Napoli"})]})]}),a.jsxs(C,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[a.jsx(y,{style:{color:"white"},children:ce}),a.jsxs(k,{children:[a.jsx(u,{onClick:()=>O("all"),children:"All"}),he.map((e,s)=>a.jsx(u,{onClick:()=>O(e.id,e.name),children:e.name},s))]})]}),a.jsxs(C,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[a.jsx(y,{style:{color:"white"},children:ne}),a.jsxs(k,{children:[a.jsx(u,{onClick:()=>K("all"),children:"All"}),de.map((e,s)=>a.jsx(u,{onClick:()=>K(e._id,e.name),children:e.name},s))]})]}),a.jsx(Z,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),oe?a.jsx(Y,{}):a.jsxs(ee,{children:[a.jsx(ae,{children:a.jsxs(w,{children:[a.jsx(i,{scope:"col",children:"#"}),a.jsx(i,{scope:"col",children:"First Name"}),a.jsx(i,{scope:"col",children:"Last Name"}),a.jsx(i,{scope:"col",children:"Email"}),a.jsx(i,{scope:"col",children:"Phone"}),a.jsx(i,{scope:"col",children:"Country"}),a.jsx(i,{scope:"col",children:"Employee ID"}),a.jsx(i,{scope:"col",children:"Language"}),a.jsx(i,{scope:"col",children:"Group"}),a.jsx(i,{scope:"col",children:"Add Market Group"})]})}),a.jsx(se,{children:v.map((e,s)=>a.jsxs(w,{children:[a.jsx(n,{children:s+1}),a.jsx(n,{children:e.name}),a.jsx(n,{children:e.surname}),a.jsx(n,{children:e.email}),a.jsx(n,{children:e.contact}),a.jsx(n,{children:e.country==="it"||e.country==="Italy"?"Italy":e.country}),a.jsx(n,{children:e.employeeId?e.employeeId:a.jsx(G,{color:"warning",children:"Not Provide"})}),a.jsx(n,{children:e.language==="en"?"English":e.language==="it"?"Italy":e.language==="es"?"Spanish":e.language}),a.jsx(n,{children:e.groups.map((r,o)=>a.jsx("div",{children:r.name},o))}),a.jsx(n,{children:e.groups.length>0?a.jsx(j,{size:"sm",onClick:()=>Q(e.groups,e.id),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Assign"}):a.jsx(j,{size:"sm",onClick:()=>Q(e.groups,e.id),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Add"})})]},s))})]}),a.jsxs(Te,{alignment:"center",visible:S,scrollable:!0,size:"xl",onClose:()=>m(!1),children:[a.jsx(Le,{closeButton:!0,children:a.jsx(Pe,{children:"Market Group Assign"})}),a.jsxs(Ne,{children:[a.jsx(G,{style:{marginLeft:"74%"},color:"secondary",children:"Filter by"}),a.jsxs(C,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[a.jsx(y,{style:{color:"white"},children:fe}),a.jsxs(k,{children:[a.jsx(u,{onClick:()=>h("all","modal"),children:"All"}),a.jsx(u,{onClick:()=>h("Milano","modal"),children:"Milano"}),a.jsx(u,{onClick:()=>h("Napoli","modal"),children:"Napoli"})]})]}),a.jsx(Z,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),je?a.jsx(Y,{}):a.jsxs(ee,{children:[a.jsx(ae,{children:a.jsxs(w,{children:[a.jsx(i,{scope:"col",children:"#"}),a.jsx(i,{scope:"col",children:"Name"}),a.jsx(i,{scope:"col",children:"City"}),a.jsx(i,{scope:"col",children:"Location"})]})}),a.jsx(se,{children:me.map((e,s)=>a.jsxs(w,{children:[a.jsx(n,{children:x+s+1}),a.jsx(n,{children:e.name}),a.jsx(n,{children:e.city}),a.jsx(n,{children:ge.map(r=>r.id).includes(e._id)?a.jsx(j,{size:"sm",onClick:()=>Ae(I,e._id),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Remove"}):a.jsx(j,{size:"sm",onClick:()=>be(I,e._id),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Add"})})]},s))})]})]}),a.jsx(Be,{children:a.jsxs(ze,{"aria-label":"Page navigation example",children:[a.jsx(te,{disabled:x<=0,onClick:Me,children:"Previous"}),a.jsx(te,{disabled:Ce===!0,onClick:De,children:"Next"})]})})]})]})};export{Ke as default};
