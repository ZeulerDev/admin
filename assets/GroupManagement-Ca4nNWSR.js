import{r as t,y as Me,l as Se,A as d,j as a,i as O}from"./index-BBeIiOn3.js";import{a as p}from"./axios-Cm0UX6qg.js";import{B as g}from"./config-HOLfLxHr.js";import{b as be,a as C}from"./CContainer-BiZOElAC.js";import{C as Ae}from"./CNavbar-BL-VEIRH.js";import{C as m,a as j,b as y,c as u,e as we}from"./DefaultLayout-beOdIcic.js";import{C as Q,a as W,b as k,c as i,d as X,e as n}from"./CTable-5ctrsLOx.js";import{C as Ge,a as ve,b as Ee,c as Pe}from"./CModalTitle-Bx1gV3ov.js";import{C as Be,a as Y}from"./CPaginationItem-C-sQio_N.js";import{C as Ne}from"./CModalFooter-C8wMkyUZ.js";const Ve=()=>{const[G,f]=t.useState(!1),[{user:x,token:l},c]=Me(),[Z,ee]=t.useState([]),[ae,v]=t.useState(!1),[E,P]=t.useState(""),[B,N]=t.useState(""),[z,L]=t.useState("");t.useState(!1),t.useState(""),Se();const[se,te]=t.useState(!1),[re,T]=t.useState("All Cities"),[oe,$]=t.useState("All Market Groups"),[le,R]=t.useState("All Chains"),[ie,ne]=t.useState([]),[ce,de]=t.useState([]),[_,D]=t.useState(""),[ue,M]=t.useState([]),[he,I]=t.useState("All Cities"),[H,F]=t.useState(""),[pe,ge]=t.useState([]),[fe,U]=t.useState(!1),[xe,V]=t.useState(!0),[S,b]=t.useState(0);t.useEffect(()=>{A(),Ce()},[]);const A=()=>{l&&p.get(g+"market/groups/dropdown/fetch",{headers:{Authorization:`Bearer ${l}`}}).then(e=>{e.status===200?ne(e.data):e.status===500&&c({type:d,payload:{status:!0,title:"Market Group Loading error",message:e.data.message}})}).catch(e=>{console.error("Error: ",e)})},Ce=()=>{l&&p.get(g+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${l}`}}).then(e=>{e.status===200?(de(e.data),te(!1)):e.status===500&&c({type:d,payload:{status:!0,title:"Chain Loading error",message:e.data.message}})}).catch(e=>{console.error("Error: ",e)})};t.useEffect(()=>{me()},[E,B,z,se]);const me=()=>{x&&l&&(v(!0),p.get(g+`assistant/riders/:skip?city=${E}&group=${B}&chain=${z}`,{headers:{Authorization:`Bearer ${l}`}}).then(e=>{e.status===200?(ee(e.data),v(!1)):e.status===500&&c({type:d,payload:{status:!0,title:"Error",message:e.data.message,color:"warning"}})}).catch(e=>{console.error("Error:",e)}))},h=(e,s)=>{s==="view"?e==="all"?(P(""),T("All Cities")):(P(e),T(e)):s==="modal"&&(e==="all"?(F(""),I("All Cities")):(F(e),I(e)))},q=(e,s)=>{e==="all"?(N(""),$("All Market Groups")):(N(e),$(s))},J=(e,s)=>{e==="all"?(L(""),R("All Chains")):(L(e),R(s))},K=(e,s)=>{f(!G),console.log("group",e,"driver ID",s),D(s),M(e)};t.useEffect(()=>{x&&l&&w(0,!0)},[x,H]);const w=(e,s)=>{U(!0),p.get(g+`market/groups/fetch/${e}?city=${H}`,{headers:{Authorization:`Bearer ${l}`}}).then(o=>{if(o.status===200)if(ge(o.data),U(!1),o.data.length<20?(V(!0),console.log("ok")):o.data.length>19&&V(!1),s){const r=e+o.data.length;b(r)}else{const r=e-o.data.length;e<0?b(0):b(r)}else o.status===500&&c({type:d,payload:{status:!0,title:"Makrket Group loading error",message:o.data.message}})}).catch(o=>{console.error("Error:",o)})},je=()=>{w(S,!0)},ye=()=>{w(S,!1)},ke=(e,s)=>{if(console.log("driver id",e),console.log("group id",s),s&&e){const o={id:s,rider:e};l&&x&&l&&p.put(g+"assistant/groups/rider/assign",o,{headers:{Authorization:`Bearer ${l}`}}).then(r=>{r.status===200?(f(!1),D(""),M([]),console.log(r.data),A()):r.status===204?c({type:d,payload:{status:!0,title:"Group Assign error",message:r.data.message,color:"warning"}}):r.status===500&&c({type:d,payload:{status:!0,title:"Group Assign error",message:r.data.message,color:"warning"}})}).catch(r=>{console.error("Error:",r)})}else c({type:d,payload:{status:!0,title:"Error!",message:"Driver group assign error",color:"warning"}})},De=(e,s)=>{if(s&&e){const o={id:s,rider:e};l&&x&&l&&p.put(g+"assistant/groups/rider/remove",o,{headers:{Authorization:`Bearer ${l}`}}).then(r=>{r.status===200?(f(!1),D(""),M([]),A()):r.status===204?c({type:d,payload:{status:!0,title:"Group remove error",message:r.data.message,color:"warning"}}):r.status===500&&c({type:d,payload:{status:!0,title:"Group remove error",message:r.data.message,color:"warning"}})}).catch(r=>{console.error("Error:",r)})}else c({type:d,payload:{status:!0,title:"Error!",message:"Driver group assign error",color:"warning"}})};return a.jsxs(be,{children:[a.jsxs(Ae,{className:"bg-body-tertiary",children:[a.jsxs(m,{style:{marginLeft:"43%",width:"10%",backgroundColor:"#ff4d4d"},children:[a.jsx(j,{children:re}),a.jsxs(y,{children:[a.jsx(u,{onClick:()=>h("all","view"),children:"All"}),a.jsx(u,{onClick:()=>h("Milan","view"),children:"Milan"}),a.jsx(u,{onClick:()=>h("Napoli","view"),children:"Napoli"})]})]}),a.jsxs(m,{style:{marginRight:"0%",width:"15%",backgroundColor:"#ff4d4d"},children:[a.jsx(j,{children:le}),a.jsxs(y,{children:[a.jsx(u,{onClick:()=>J("all"),children:"All"}),ce.map((e,s)=>a.jsx(u,{onClick:()=>J(e.id,e.name),children:e.name},s))]})]}),a.jsxs(m,{style:{marginRight:"1%",width:"30%",backgroundColor:"#ff4d4d"},children:[a.jsx(j,{children:oe}),a.jsxs(y,{children:[a.jsx(u,{onClick:()=>q("all"),children:"All"}),ie.map((e,s)=>a.jsx(u,{onClick:()=>q(e._id,e.name),children:e.name},s))]})]})]}),ae?a.jsx(O,{}):a.jsxs(Q,{children:[a.jsx(W,{children:a.jsxs(k,{children:[a.jsx(i,{scope:"col",children:"First Name"}),a.jsx(i,{scope:"col",children:"Last Name"}),a.jsx(i,{scope:"col",children:"Email"}),a.jsx(i,{scope:"col",children:"Phone"}),a.jsx(i,{scope:"col",children:"Country"}),a.jsx(i,{scope:"col",children:"Employee ID"}),a.jsx(i,{scope:"col",children:"Language"}),a.jsx(i,{scope:"col",children:"Group"}),a.jsx(i,{scope:"col",children:"Status"})]})}),a.jsx(X,{children:Z.map((e,s)=>a.jsxs(k,{children:[a.jsx(n,{children:e.name}),a.jsx(n,{children:e.surname}),a.jsx(n,{children:e.email}),a.jsx(n,{children:e.contact}),a.jsx(n,{children:e.country==="it"||e.country==="Italy"?"Italy":e.country}),a.jsx(n,{children:e.employeeId?e.employeeId:a.jsx(we,{color:"warning",children:"Not Provide"})}),a.jsx(n,{children:e.language==="en"?"English":e.language==="it"?"Italy":e.language==="es"?"Spanish":e.language}),a.jsx(n,{children:e.groups.map((o,r)=>a.jsx("div",{children:o.name},r))}),a.jsx(n,{children:e.groups.length>0?a.jsx(C,{size:"sm",onClick:()=>K(e.groups,e.id),style:{backgroundColor:"#ff4d4d",width:90},children:"Assign"}):a.jsx(C,{size:"sm",onClick:()=>K(e.groups,e.id),style:{backgroundColor:"#ff4d4d",width:90},children:"Add"})})]},s))})]}),a.jsxs(Ge,{alignment:"center",visible:G,scrollable:!0,size:"xl",onClose:()=>f(!1),children:[a.jsxs(ve,{closeButton:!0,children:[a.jsx(Ee,{children:"Confirmation"}),a.jsxs(m,{style:{marginLeft:0,width:"10%",backgroundColor:"#ff4d4d"},children:[a.jsx(j,{children:he}),a.jsxs(y,{children:[a.jsx(u,{onClick:()=>h("all","modal"),children:"All"}),a.jsx(u,{onClick:()=>h("Milano","modal"),children:"Milano"}),a.jsx(u,{onClick:()=>h("Napoli","modal"),children:"Napoli"})]})]})]}),a.jsxs(Pe,{children:[fe?a.jsx(O,{}):a.jsxs(Q,{children:[a.jsx(W,{children:a.jsxs(k,{children:[a.jsx(i,{scope:"col",children:"Name"}),a.jsx(i,{scope:"col",children:"City"}),a.jsx(i,{scope:"col",children:"Location"})]})}),a.jsx(X,{children:pe.map((e,s)=>a.jsxs(k,{children:[a.jsx(i,{scope:"row",children:e.name}),a.jsx(n,{children:e.city}),a.jsx(n,{children:ue.map(o=>o.id).includes(e._id)?a.jsx(C,{size:"sm",onClick:()=>De(_,e._id),style:{backgroundColor:"#ff4d4d",width:90},children:"Remove"}):a.jsx(C,{size:"sm",onClick:()=>ke(_,e._id),style:{backgroundColor:"#ff4d4d",width:90},children:"Add"})})]},s))})]}),a.jsxs(Be,{"aria-label":"Page navigation example",children:[a.jsx(Y,{disabled:S<=20,onClick:ye,children:"Previous"}),a.jsx(Y,{disabled:xe===!0,onClick:je,children:"Next"})]})]}),a.jsx(Ne,{children:a.jsx(C,{color:"secondary",onClick:()=>f(!1),children:"Close"})})]})]})};export{Ve as default};
