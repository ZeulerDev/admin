import{r as t,y as ve,A as h,j as a,i as ee}from"./index-CaYaFnV6.js";import{a as f}from"./axios-Cm0UX6qg.js";import{B as x}from"./config-HOLfLxHr.js";import{b as Be,a as A}from"./CContainer-B9Em2jPq.js";import{C as Le}from"./CNavbar-DMXNcqxD.js";import{C as m,a as k,b as y,c as d}from"./DefaultLayout-DweglOhE.js";import{C as ae,a as se,b as w,c as i,d as te,e as n}from"./CTable-DeWYaT23.js";import{C as $e,a as ze,b as Ge,c as Te}from"./CModalTitle-CZ-yS-Uo.js";import{C as Ne}from"./CModalFooter-BhhGa6wx.js";import{C as Re,a as le}from"./CPaginationItem-2nqblV7r.js";const Qe=()=>{const[$,M]=t.useState(!1),[{user:g,token:o},c]=ve(),[b,D]=t.useState([]),[re,z]=t.useState(!1),[oe,G]=t.useState(!1),[T,N]=t.useState(""),[R,_]=t.useState(""),[H,F]=t.useState("");t.useState(!1),t.useState("");const[ie,ne]=t.useState(!1),[de,I]=t.useState("All Cities"),[ce,U]=t.useState("All Market Groups"),[he,V]=t.useState("All Chains"),[ue,pe]=t.useState([]),[Ce,fe]=t.useState([]),[xe,q]=t.useState("All Cities"),[ge,J]=t.useState("All Chains"),[je,me]=t.useState([]),[K,O]=t.useState(""),[Q,W]=t.useState(""),[ke,ye]=t.useState([]),[P,E]=t.useState(0),[X,v]=t.useState(""),[Me,B]=t.useState("");t.useEffect(()=>{Se(),Ae()},[]);const Se=()=>{o&&f.get(x+"market/groups/dropdown/fetch",{headers:{Authorization:`Bearer ${o}`}}).then(e=>{e.status===200?pe(e.data):e.status===500&&c({type:h,payload:{status:!0,title:"Market Group Loading error",message:e.data.message}})}).catch(e=>{console.error("Error: ",e)})},Ae=()=>{o&&f.get(x+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${o}`}}).then(e=>{e.status===200?(fe(e.data),me(e.data)):e.status===500&&c({type:h,payload:{status:!0,title:"Chain Loading error",message:e.data.message}})}).catch(e=>{console.error("Error: ",e)})};t.useEffect(()=>{we()},[T,R,H,ie]);const we=()=>{g&&o&&(z(!0),f.get(x+`assistant/shoppers/:skip?city=${T}&group=${R}&chain=${H}`,{headers:{Authorization:`Bearer ${o}`}}).then(e=>{e.status===200?(D(e.data),z(!1),ne(!1)):e.status===500&&c({type:h,payload:{status:!0,title:"Error",message:e.data.message,color:"warning"}})}).catch(e=>{console.error("Error:",e)}))},C=(e,s)=>{s==="view"?e==="all"?(N(""),I("All Cities")):(N(e),I(e)):s==="modal"&&(e==="all"?(O(""),q("All Cities")):(O(e),q(e)))},Y=(e,s)=>{e==="all"?(_(""),U("All Market Groups")):(_(e),U(s))},S=(e,s,r)=>{r==="view"?e==="all"?(F(""),V("All Chains")):(F(e),V(s)):r==="modal"&&(e==="all"?(W(""),J("All Chains")):(W(e),J(s)))},Z=(e,s)=>{M(!$),console.log(e,s),v(e),B(s)};t.useEffect(()=>{g&&o&&L(0,!0)},[Q,K,g]);const L=(e,s)=>{G(!0),f.get(x+`assistant/market/locations/${e}?brand=${Q}&city=${K}`,{headers:{Authorization:`Bearer ${o}`}}).then(r=>{if(r.status===200)if(ye(r.data.data),G(!1),s){const l=e+r.data.data.length;E(l)}else{const l=e-r.data.data.length;e<0?E(0):E(l)}else r.status===500&&c({type:h,payload:{status:!0,title:"Market Loading error",message:r.data.message}})}).catch(r=>{console.error("Error: ",r)})},be=()=>{L(P,!0)},De=()=>{L(P,!1)},Pe=(e,s)=>{if(s&&e){const r={market:s,shopper:e};o&&g&&o&&f.post(x+"assistant/picker/assign/market",r,{headers:{Authorization:`Bearer ${o}`}}).then(l=>{if(l.status===200){M(!1),v(""),B("");const p=l.data,u=b.map(j=>j.id===p.id?p:j);D([...u])}else l.status===204?c({type:h,payload:{status:!0,title:"Market Assign error",message:l.data.message,color:"warning"}}):l.status===500&&c({type:h,payload:{status:!0,title:"Market Assign error",message:l.data.message,color:"warning"}})}).catch(l=>{console.error("Error:",l)})}else c({type:h,payload:{status:!0,title:"Error!",message:"Picker Registration error, Please Check the input fields",color:"warning"}})},Ee=(e,s)=>{if(s&&e){const r={market:s,shopper:e};o&&g&&o&&f.post(x+"assistant/picker/remove/market",r,{headers:{Authorization:`Bearer ${o}`}}).then(l=>{if(l.status===200){M(!1),v(""),B("");const p=l.data,u=b.map(j=>j.id===p.id?p:j);D([...u])}else l.status===204?c({type:h,payload:{status:!0,title:"Market remove error",message:l.data.message,color:"warning"}}):l.status===500&&c({type:h,payload:{status:!0,title:"Market remove error",message:l.data.message,color:"warning"}})}).catch(l=>{console.error("Error:",l)})}else c({type:h,payload:{status:!0,title:"Error!",message:"Picker Registration error, Please Check the input fields",color:"warning"}})};return a.jsxs(Be,{children:[a.jsxs(Le,{className:"bg-body-tertiary",children:[a.jsxs(m,{style:{marginLeft:"43%",width:"10%",backgroundColor:"#ff4d4d"},children:[a.jsx(k,{children:de}),a.jsxs(y,{children:[a.jsx(d,{onClick:()=>C("all","view"),children:"All"}),a.jsx(d,{onClick:()=>C("Milan","view"),children:"Milan"}),a.jsx(d,{onClick:()=>C("Napoli","view"),children:"Napoli"})]})]}),a.jsxs(m,{style:{marginRight:"0%",width:"15%",backgroundColor:"#ff4d4d"},children:[a.jsx(k,{children:he}),a.jsxs(y,{children:[a.jsx(d,{onClick:()=>S("all",null,"view"),children:"All"}),Ce.map((e,s)=>a.jsx(d,{onClick:()=>S(e.id,e.name,"view"),children:e.name},s))]})]}),a.jsxs(m,{style:{marginRight:"1%",width:"30%",backgroundColor:"#ff4d4d"},children:[a.jsx(k,{children:ce}),a.jsxs(y,{children:[a.jsx(d,{onClick:()=>Y("all"),children:"All"}),ue.map((e,s)=>a.jsx(d,{onClick:()=>Y(e._id,e.name),children:e.name},s))]})]})]}),re?a.jsx(ee,{}):a.jsxs(ae,{children:[a.jsx(se,{children:a.jsxs(w,{children:[a.jsx(i,{scope:"col",children:"First Name"}),a.jsx(i,{scope:"col",children:"Last Name"}),a.jsx(i,{scope:"col",children:"Email"}),a.jsx(i,{scope:"col",children:"Phone"}),a.jsx(i,{scope:"col",children:"Country"}),a.jsx(i,{scope:"col",children:"City"}),a.jsx(i,{scope:"col",children:"Language"}),a.jsx(i,{scope:"col",children:"Market"}),a.jsx(i,{scope:"col",children:"Status"})]})}),a.jsx(te,{children:b.map((e,s)=>{var r,l,p;return a.jsxs(w,{children:[a.jsx(n,{children:e.name}),a.jsx(n,{children:e.surname}),a.jsx(n,{children:e.email}),a.jsx(n,{children:e.contact}),a.jsx(n,{children:e.country==="it"||e.country==="Italy"?"Italy":e.country}),a.jsx(n,{children:e.city}),a.jsx(n,{children:e.language==="en"?"English":e.language==="it"?"Italy":e.language==="es"?"Spanish":e.language}),a.jsxs(n,{children:[(l=(r=e.market)==null?void 0:r.chain)==null?void 0:l.name," - ",e.market.address]}),a.jsx(n,{children:(p=e.market)!=null&&p.id?a.jsx(A,{size:"sm",onClick:()=>{var u;return Z(e.id,(u=e.market)==null?void 0:u.id)},style:{backgroundColor:"#ff4d4d",width:90},children:"Assign"}):a.jsx(A,{size:"sm",onClick:()=>{var u;return Z(e.id,(u=e.market)==null?void 0:u.id)},style:{backgroundColor:"#ff4d4d",width:90},children:"Add"})})]},s)})})]}),a.jsxs($e,{visible:$,scrollable:!0,size:"xl",onClose:()=>M(!1),children:[a.jsxs(ze,{closeButton:!0,children:[a.jsx(Ge,{children:"Market"}),a.jsxs(m,{style:{marginLeft:0,width:"10%",backgroundColor:"#ff4d4d"},children:[a.jsx(k,{children:xe}),a.jsxs(y,{children:[a.jsx(d,{onClick:()=>C("all","modal"),children:"All"}),a.jsx(d,{onClick:()=>C("Milano","modal"),children:"Milano"}),a.jsx(d,{onClick:()=>C("Napoli","modal"),children:"Napoli"})]})]}),a.jsxs(m,{style:{marginLeft:"20%",width:"15%",backgroundColor:"#ff4d4d"},children:[a.jsx(k,{children:ge}),a.jsxs(y,{children:[a.jsx(d,{onClick:()=>S("all",null,"modal"),children:"All"}),je.map((e,s)=>a.jsx(d,{onClick:()=>S(e.id,e.name,"modal"),children:e.name},s))]})]})]}),a.jsxs(Te,{children:[oe?a.jsx(ee,{}):a.jsxs(ae,{children:[a.jsx(se,{children:a.jsxs(w,{children:[a.jsx(i,{scope:"col",children:"Name"}),a.jsx(i,{scope:"col",children:"Address"}),a.jsx(i,{scope:"col",children:"City"}),a.jsx(i,{scope:"col",children:"Measurement"}),a.jsx(i,{scope:"col"})]})}),a.jsx(te,{children:ke.map((e,s)=>a.jsxs(w,{children:[a.jsx(n,{children:e.chain.name}),a.jsx(n,{children:e.address}),a.jsx(n,{children:e.city}),a.jsx(n,{children:e.scraped}),a.jsx(n,{children:Me===e._id?a.jsx(A,{size:"sm",onClick:()=>Ee(X,e._id),style:{backgroundColor:"#ff4d4d",width:90},children:"Remove"}):a.jsx(A,{size:"sm",onClick:()=>Pe(X,e._id),style:{backgroundColor:"#ff4d4d",width:90},children:"Add"})})]},s))})]}),a.jsx(Ne,{children:a.jsxs(Re,{"aria-label":"Page navigation example",children:[a.jsx(le,{disabled:P<=20,onClick:De,children:"Previous"}),a.jsx(le,{onClick:be,children:"Next"})]})})]})]})]})};export{Qe as default};
