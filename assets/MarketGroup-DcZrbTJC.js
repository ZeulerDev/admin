import{y as kt,r as a,A as o,j as e,L as k,h as Q,m as y}from"./index-Bsn8dk4K.js";import{a as h}from"./axios-Cm0UX6qg.js";import{B as g}from"./config-CAsDK75y.js";import{b as yt,a as u}from"./CContainer-AV4JspaL.js";import{C as Pe,a as W,b as X,d as Z,e as p}from"./DefaultLayout-FA2rmZWX.js";import{C as De}from"./CNavbar-5ERL6Uil.js";import{C as ee,a as te,b as C,c as n,d as se,e as c}from"./CTable-CwbSrcrF.js";import{c as Mt}from"./cil-pencil-m516yCOw.js";import{c as bt}from"./cil-trash-CBbKHhHb.js";import{c as wt}from"./cil-map-dAArMthr.js";import{C as Le,a as B}from"./CPaginationItem-TLWytmzh.js";import{C as M,a as b,b as w,c as A}from"./CModalTitle-BnZCXL7j.js";import{C as ae}from"./CFormInput--iaGGot-.js";import{C as le}from"./CModalFooter-ylOqhqYb.js";import{C as ze}from"./CCol-S6pnG2SN.js";import"./CFormLabel-iOJk5yzm.js";var Ee=["512 512","<polygon fill='var(--ci-primary-color, currentColor)' points='440 240 272 240 272 72 240 72 240 240 72 240 72 272 240 272 240 440 272 440 272 272 440 272 440 240' class='ci-primary'/>"];const Ht=()=>{const[{user:m,token:d},r]=kt(),[re,v]=a.useState(""),[Ne,S]=a.useState("All Cities"),[P,T]=a.useState([]),[D,oe]=a.useState(0),[Be,ie]=a.useState(!0),[Te,G]=a.useState(!1),[ne,L]=a.useState(!1),[Ge,$e]=a.useState(""),[_e,$]=a.useState(!1),[Ie,ce]=a.useState(""),[z,de]=a.useState(""),[Re,ue]=a.useState(""),[Ve,_]=a.useState(!1),[he,x]=a.useState(""),[Fe,He]=a.useState([]),[Ue,ge]=a.useState(!1),[Ye,I]=a.useState(!1),[qe,Je]=a.useState([]),[me,R]=a.useState(""),[Ke,V]=a.useState("All Cities"),[At,pe]=a.useState(""),[fe,F]=a.useState(""),[Oe,H]=a.useState("All Chains"),[vt,xe]=a.useState("All Chains"),[Qe,je]=a.useState(!1),[We,Xe]=a.useState([]),[Ze,Ce]=a.useState(!0),[E,U]=a.useState(0),[ke,ye]=a.useState(""),[j,Me]=a.useState([]),[et,Y]=a.useState(!1),[q,be]=a.useState(""),[we,Ae]=a.useState(""),[ve,tt]=a.useState(""),J=t=>{t==="all"?(v(""),S("All Cities")):(v(t),S(t))};a.useEffect(()=>{const t=setTimeout(()=>{r({type:o,payload:{status:!0,title:"Data Loading",message:"Data loading error: Timeout exceeded",color:"warning"}}),G(!1)},2e4);return m&&d&&N(0,t),()=>{clearTimeout(t)}},[m,re]);const N=(t,s)=>{G(!0),h.get(g+`market/groups/fetch/${t}?city=${re}`,{headers:{Authorization:`Bearer ${d}`}}).then(l=>{l.status===200?(T(l.data),G(!1),clearTimeout(s),l.data.length<20?ie(!0):l.data.length>19&&ie(!1)):l.status===500&&r({type:o,payload:{status:!0,title:"Makrket Group loading error",message:l.data.message}})}).catch(l=>{console.error("Error:",l)})},st=()=>{const t=D+20;oe(t),N(t,!0)},at=()=>{const t=D-20;console.log(t),oe(t),N(t,!1)},lt=t=>{L(!ne),$e(t)},rt=t=>{console.log(t),h.delete(g+"marketgroup/"+t,{headers:{Authorization:`Bearer ${d}`}}).then(s=>{s.status===200?(r({type:o,payload:{status:!0,title:"Market Group Delete",message:"Market Group Delete Success",color:"success"}}),L(!1),N(0,!0),console.log("Remove Market Group")):s.status===203?r({type:o,payload:{status:!0,title:"Market Group Delete",message:s.data.message,color:"warning"}}):s.status===404?r({type:o,payload:{status:!0,title:"Market Group Delete",message:s.data.message,color:"warning"}}):s.status===500&&r({type:o,payload:{status:!0,title:"Market Group Delete",message:s.data.message,color:"warning"}})}).catch(s=>{console.error("Error:",s)})},ot=(t,s)=>{$(!0),ce(t),ue(s),console.log(s)},it=()=>{console.log("name",z),z==""?r({type:o,payload:{status:!0,title:"Alert",message:"Please Enter Name",color:"danger"}}):nt(Ie)},nt=t=>{if(t){let s={name:z};console.log(s,t),m&&d&&h.put(g+"marketgroup/update/"+t,s,{headers:{Authorization:`Bearer ${d}`}}).then(l=>{if(l.status===200){const i=l.data,f=P.find(Ct=>Ct.id===i.id);f&&(f.name=i.name),T([...P]),r({type:o,payload:{status:!0,title:"Market Group Update",message:"Market group name updated successfully",color:"success"}}),ce(""),de(""),$(!1),ue("")}else l.status===204?r({type:o,payload:{status:!0,title:"Pick up area update  error",message:l.data.message,color:"danger"}}):l.status===500&&r({type:o,payload:{status:!0,title:"Pick up area update  error",message:l.data.message,color:"danger"}})}).catch(l=>{console.error("Error:",l)})}else alert("Please Check the Fields!")},ct=t=>{console.log("markets",t),_(!0),x(t),dt(t)},dt=t=>{ge(!0),h.get(g+`marketgroup/markets/${t}`,{headers:{Authorization:`Bearer ${d}`}}).then(s=>{s.status===200?(He(s.data),console.log("data market",s.data),ge(!1)):s.status===204?r({type:o,payload:{status:!0,title:"Market Loading error",message:s.data.message}}):s.status===500&&r({type:o,payload:{status:!0,title:"Market Loading error",message:s.data.message}})}).catch(s=>{console.error("Error: ",s)})},ut=t=>{console.log("markets group",t),x(t),I(!0),tt(t)},K=(t,s)=>{s==="view"?t==="all"?(v(""),S("All Cities")):(v(t),S(t)):s==="modal"&&(t==="all"?(R(""),V("All Cities")):(R(t),V(t)))},Se=(t,s,l)=>{l==="view"?t==="all"?(pe(""),xe("All Chains")):(pe(t),xe(s)):l==="modal"&&(t==="all"?(F(""),H("All Chains")):(F(t),H(s)))};a.useEffect(()=>{ht()},[]);const ht=()=>{d&&h.get(g+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${d}`}}).then(t=>{t.status===200?Je(t.data):t.status===500&&r({type:o,payload:{status:!0,title:"Chain Loading error",message:t.data.message}})}).catch(t=>{console.error("Error: ",t)})};a.useEffect(()=>{m&&d&&O(0)},[fe,me,m,ve]);const O=(t,s)=>{je(!0),h.get(g+`assistant/market/add/group/${t}?brand=${fe}&city=${me}&gid=${ve}`,{headers:{Authorization:`Bearer ${d}`}}).then(l=>{l.status===200?(Xe(l.data.data),je(!1),l.data.data.length<20?Ce(!0):l.data.data.length>19&&Ce(!1)):l.status===500&&r({type:o,payload:{status:!0,title:"Market Loading error",message:l.data.message}})}).catch(l=>{console.error("Error: ",l)})},gt=()=>{const t=E+20;U(t),O(t)},mt=()=>{const t=E-20;console.log(t),U(t),O(t)},pt=(t,s)=>{if(s&&t){const l={marketId:s};d&&m&&d&&h.patch(g+"marketgroup/add/market/"+t,l,{headers:{Authorization:`Bearer ${d}`}}).then(i=>{i.status===200?(I(!1),x(""),r({type:o,payload:{status:!0,title:"Market Assign",message:"successfully Market assigned to the market group",color:"success"}})):i.status===400?r({type:o,payload:{status:!0,title:"Market Assign error",message:i.data.message,color:"warning"}}):i.status===404?r({type:o,payload:{status:!0,title:"Market Assign error",message:i.data.message,color:"warning"}}):i.status===500&&r({type:o,payload:{status:!0,title:"Market Assign error",message:i.data.message,color:"warning"}})}).catch(i=>{console.error("Error:",i)})}else r({type:o,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},ft=(t,s)=>{if(s&&t){const l={marketId:s};d&&m&&d&&h.patch(g+"marketgroup/remove/market/"+t,l,{headers:{Authorization:`Bearer ${d}`}}).then(i=>{i.status===200?(_(!1),x(""),r({type:o,payload:{status:!0,title:"Market Assign",message:"successfully Market remove from the market group",color:"success"}})):i.status===400?r({type:o,payload:{status:!0,title:"Market remove error",message:i.data.message,color:"warning"}}):i.status===404?r({type:o,payload:{status:!0,title:"Market remove error",message:i.data.message,color:"warning"}}):i.status===500&&r({type:o,payload:{status:!0,title:"Market remove error",message:i.data.message,color:"warning"}})}).catch(i=>{console.error("Error:",i)})}else r({type:o,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},xt=(t,s)=>{s&&(Y(!0),Me(t),Ae(t.lat),be(t.lng),ye(s))},jt=()=>{if(q){console.log("center",ke,we,q);const t={lat:we,lng:q};d&&m&&d&&h.patch(g+"marketgroup/update/center/"+ke,t,{headers:{Authorization:`Bearer ${d}`}}).then(s=>{if(s.status===200){Y(!1),ye(""),Me([]);const l=s.data,i=P.map(f=>(f._id===l._id&&(f.center=l.center),f));T([...i]),r({type:o,payload:{status:!0,title:"Manage Center Point",message:"successfully center point assigned to the market group",color:"success"}})}else s.status===400?r({type:o,payload:{status:!0,title:"Manage Center Point",message:s.data.message,color:"warning"}}):s.status===404?r({type:o,payload:{status:!0,title:"Manage Center Point",message:s.data.message,color:"warning"}}):s.status===500&&r({type:o,payload:{status:!0,title:"Manage Center Point",message:s.data.message,color:"warning"}})}).catch(s=>{console.error("Error:",s)})}else r({type:o,payload:{status:!0,title:"Error!",message:"check fields again",color:"warning"}})};return e.jsxs(yt,{children:[e.jsx(k,{to:"/marketgroups/marketmap",children:e.jsx(u,{style:{marginLeft:"0%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Add Market"})}),e.jsx(k,{to:"/marketgroups/createmarketgroup",children:e.jsx(u,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Create Market Group"})}),e.jsx(Pe,{style:{marginLeft:"39%"},color:"secondary",children:"Filter by"}),e.jsxs(W,{style:{marginLeft:"2%",width:"17%",marginRight:"5px",backgroundColor:"#ff4d4d"},children:[e.jsx(X,{style:{color:"white"},children:Ne}),e.jsxs(Z,{children:[e.jsx(p,{onClick:()=>J("all"),children:"All"}),e.jsx(p,{onClick:()=>J("Milano"),children:"Milano"}),e.jsx(p,{onClick:()=>J("Napoli"),children:"Napoli"})]})]}),e.jsx(De,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),Te?e.jsx(Q,{}):e.jsxs(ee,{children:[e.jsx(te,{children:e.jsxs(C,{children:[e.jsx(n,{scope:"col",children:"#"}),e.jsx(n,{scope:"col",children:"Name"}),e.jsx(n,{scope:"col",children:"City"}),e.jsx(n,{scope:"col",children:"Assigned Market"}),e.jsx(n,{scope:"col",children:"Location"}),e.jsx(n,{scope:"col",children:"Action"}),e.jsx(n,{scope:"col",children:"Add Markets"}),e.jsx(n,{scope:"col",children:"Add Center Point"}),e.jsx(n,{scope:"col",children:"View Map"})]})}),e.jsx(se,{children:P.map((t,s)=>e.jsxs(C,{children:[e.jsx(c,{children:D+s+1}),e.jsxs(c,{children:[e.jsx("span",{children:t.name}),e.jsx(k,{to:"",children:e.jsx(y,{style:{marginLeft:20,float:"right"},icon:Mt,size:"sm",onClick:()=>ot(t._id,t.name)})})]}),e.jsx(c,{children:t.city}),e.jsx(c,{children:e.jsx(u,{onClick:()=>{ct(t._id)},size:"sm",style:{backgroundColor:"#ff4d4d",marginLeft:"5px",color:"white"},children:"view"})}),e.jsx(c,{children:e.jsx(k,{to:`/marketgroups/marketdistance/${t._id}`,children:e.jsx(u,{size:"sm",style:{backgroundColor:"#ff4d4d",marginLeft:"5px",color:"white"},children:"view"})})}),e.jsx(c,{children:e.jsx(u,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>lt(t._id),children:e.jsx(y,{icon:bt,size:"lg",style:{color:"white"}})})}),e.jsx(c,{children:e.jsx(u,{onClick:()=>{ut(t._id)},size:"sm",style:{backgroundColor:"#ff4d4d",color:"white"},variant:"outline",children:e.jsx(y,{icon:Ee,size:"lg",style:{color:"white"}})})}),e.jsx(c,{children:e.jsx(u,{onClick:()=>{xt(t.center,t._id)},size:"sm",style:{backgroundColor:"#ff4d4d",color:"white"},variant:"outline",children:e.jsx(y,{icon:Ee,size:"lg",style:{color:"white"}})})}),e.jsx(c,{children:e.jsx(k,{to:`/marketgroups/view/map/${t._id}`,children:e.jsx(u,{size:"sm",style:{backgroundColor:"#ff4d4d",color:"white"},variant:"outline",children:e.jsx(y,{icon:wt,size:"lg",style:{color:"white"}})})})})]},s))})]}),e.jsxs(Le,{"aria-label":"Page navigation example",children:[e.jsx(B,{disabled:D<=0,onClick:at,children:"Previous"}),e.jsx(B,{disabled:Be===!0,onClick:st,children:"Next"})]}),e.jsxs(M,{alignment:"center",visible:_e,scrollable:!0,size:"sm",onClose:()=>$(!1),children:[e.jsx(b,{closeButton:!0,children:e.jsx(w,{children:"Change Name"})}),e.jsxs(A,{children:[e.jsx("a",{children:"Enter New Name"}),e.jsx("br",{}),e.jsx(ae,{type:"text",placeholder:Re,value:z,onChange:t=>de(t.target.value)})]}),e.jsx(le,{children:e.jsx(u,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>it(),children:"Save changes"})})]}),e.jsxs(M,{alignment:"center",visible:ne,scrollable:!0,size:"sm",onClose:()=>L(!1),children:[e.jsx(b,{closeButton:!1,children:e.jsx(w,{children:"Confirmation"})}),e.jsxs(A,{children:[e.jsx("a",{children:"Are you sure you want to delete this market group?"}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[e.jsx(u,{onClick:()=>rt(Ge),style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),e.jsx(u,{onClick:()=>L(!1),style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]}),e.jsxs(M,{alignment:"center",visible:Ve,scrollable:!0,size:"lg",onClose:()=>{_(!1),x("")},children:[e.jsx(b,{closeButton:!0,children:e.jsx(w,{children:"All Assign Markets details"})}),e.jsx(A,{children:Ue?e.jsx(Q,{}):e.jsxs(ee,{children:[e.jsx(te,{children:e.jsxs(C,{children:[e.jsx(n,{scope:"col",children:"#"}),e.jsx(n,{scope:"col",children:"Chain Name"}),e.jsx(n,{scope:"col",children:"Address"}),e.jsx(n,{scope:"col",children:"City"}),e.jsx(n,{scope:"col",children:"Remove"})]})}),e.jsx(se,{children:Fe.map((t,s)=>e.jsxs(C,{children:[e.jsx(c,{children:s+1}),e.jsx(c,{children:t.chain.name}),e.jsx(c,{children:t.address}),e.jsx(c,{children:t.city}),e.jsx(c,{children:e.jsx(u,{size:"sm",onClick:()=>ft(he,t._id),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Remove"})})]},s))})]})}),e.jsx(le,{})]}),e.jsxs(M,{visible:Ye,scrollable:!0,size:"xl",onClose:()=>{I(!1),U(0),x(""),R(""),F(""),V("All Cities"),H("All Chains")},children:[e.jsx(b,{closeButton:!0,children:e.jsx(w,{children:"Market assign view"})}),e.jsxs(A,{children:[e.jsx(Pe,{style:{marginLeft:"54%"},color:"secondary",children:"Filter by"}),e.jsxs(W,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(X,{style:{color:"white"},children:Ke}),e.jsxs(Z,{children:[e.jsx(p,{onClick:()=>K("all","modal"),children:"All"}),e.jsx(p,{onClick:()=>K("Milano","modal"),children:"Milano"}),e.jsx(p,{onClick:()=>K("Napoli","modal"),children:"Napoli"})]})]}),e.jsxs(W,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(X,{style:{color:"white"},children:Oe}),e.jsxs(Z,{children:[e.jsx(p,{onClick:()=>Se("all",null,"modal"),children:"All"}),qe.map((t,s)=>e.jsx(p,{onClick:()=>Se(t.id,t.name,"modal"),children:t.name},s))]})]}),e.jsx(De,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),Qe?e.jsx(Q,{}):e.jsxs(ee,{children:[e.jsx(te,{children:e.jsxs(C,{children:[e.jsx(n,{scope:"col",children:"#"}),e.jsx(n,{scope:"col",children:"Name"}),e.jsx(n,{scope:"col",children:"Address"}),e.jsx(n,{scope:"col",children:"City"}),e.jsx(n,{scope:"col",children:"Scraped"}),e.jsx(n,{scope:"col"})]})}),e.jsx(se,{children:We.map((t,s)=>e.jsxs(C,{children:[e.jsx(c,{children:E+s+1}),e.jsx(c,{children:t.chain.name}),e.jsx(c,{children:t.address}),e.jsx(c,{children:t.city}),e.jsx(c,{children:t.scraped}),e.jsx(c,{children:e.jsx(u,{size:"sm",onClick:()=>pt(he,t._id),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Add"})})]},s))})]}),e.jsx(le,{children:e.jsxs(Le,{"aria-label":"Page navigation example",children:[e.jsx(B,{disabled:E<=0,onClick:mt,children:"Previous"}),e.jsx(B,{disabled:Ze===!0,onClick:gt,children:"Next"})]})})]})]}),e.jsxs(M,{visible:et,scrollable:!0,size:"lg",onClose:()=>Y(!1),children:[e.jsx(b,{closeButton:!0,children:e.jsx(w,{children:"Manage Center Point"})}),e.jsx(A,{children:e.jsxs("div",{className:"row g-3",children:[e.jsx(ze,{md:6,children:e.jsx(ae,{id:"lat",label:"Latitude",defaultValue:j==null?void 0:j.lat,onChange:t=>Ae(t.target.value)})}),e.jsx(ze,{md:6,children:e.jsx(ae,{id:"lng",label:"Longitude",defaultValue:j==null?void 0:j.lng,onChange:t=>be(t.target.value)})}),e.jsx(u,{type:"submit",style:{marginBottom:"3%",width:"200px",backgroundColor:"#ff4d4d",color:"white"},onClick:()=>jt(),children:"Add Center Point"})]})})]})]})};export{Ht as default};
