import{r,y as H,A as h,j as e,R as J,m as A}from"./index-xkWvTOBi.js";import{M as K,T as Q,P as L,L as V}from"./leaflet-bpSNagj_.js";import{B as E}from"./config-CAsDK75y.js";import{a as G}from"./axios-Cm0UX6qg.js";/* empty css               */import{b as X}from"./CContainer-3EDy8eE_.js";import{C as Y,a as T,b as v,d as z,e as n}from"./DefaultLayout-CKh5LGPH.js";import{D as tt}from"./index-CkgraYDA.js";import{C as et}from"./CNavbar-DMk1JdFZ.js";import{M as B}from"./Marker-DXikZAR0.js";import{c as R}from"./cil-info-CmGCY32x.js";import{f as I}from"./index-PqYCJD3r.js";import"./inheritsLoose-BR9xv5Kf.js";import"./typeof-QjJsDpFa.js";const xt=()=>{const[f,x]=r.useState(""),[$,y]=r.useState("All Status"),[j,C]=r.useState(""),[P,k]=r.useState("All Market Groups"),[N,F]=r.useState([]),[{user:w,token:d},p]=H(),[u,S]=r.useState([]),[at,i]=r.useState(!1),[_,O]=r.useState([]);r.useState([{market:[],customers:[]}]);const U=t=>{if(t){const o=I(t[0],"yyyy-MM-dd"),a=I(t[1],"yyyy-MM-dd");S([o,a]),console.log(o,a)}else S([])};r.useEffect(()=>{const t=setTimeout(()=>{p({type:h,payload:{status:!0,title:"Data Loading",message:"Data loading error or Timeout exceeded",color:"warning"}}),i(!1)},2e4);return w&&d&&W(0,t),()=>{clearTimeout(t)}},[w,d,f,u,j]);const W=(t,o)=>{i(!0),G.get(E+`assistant/solo/courier/all/map/${t}?status=${f}&date=${u}&group=${j}`,{headers:{Authorization:`Bearer ${d}`}}).then(a=>{if(console.log(a.status),a.status===200){console.log(a.data.data);let g=a.data.data.map(s=>{let m=s.markets.map(l=>({lat:l.location.lat,lng:l.location.lng,address:l.address})),q=s.customers.map(l=>({lat:l.lat,lng:l.lng,address:l.address}));return{market:m,customer:q}});console.log(g),O(g),console.log(a.data.data.length),i(!1),clearTimeout(o)}else a.status===204?(i(!1),p({type:h,payload:{status:!0,title:"Batches loading error",message:"No data to show or something went wrong"}})):a.status===500&&(i(!1),p({type:h,payload:{status:!0,title:"Batches loading error",message:"No data to show or something went wrong"}}))}).catch(a=>{i(!1),console.error("Error:",a),p({type:h,payload:{status:!0,title:"Batches error",message:res.data.message}})})},c=t=>{t==="all"?(x(""),y("All Status")):(x(t),y(t))},D=(t,o)=>{t==="all"?(C(""),k("All Market Groups")):(C(t),k(o))};r.useEffect(()=>{Z()},[]);const Z=()=>{d&&G.get(E+"market/groups/dropdown/fetch",{headers:{Authorization:`Bearer ${d}`}}).then(t=>{t.status===200?F(t.data):t.status===500&&p({type:h,payload:{status:!0,title:"Market Group Loading error",message:t.data.message}})}).catch(t=>{console.error("Error: ",t)})},M=()=>{const t="0123456789ABCDEF";let o="#";for(let a=0;a<6;a++)o+=t[Math.floor(Math.random()*16)];return o},b=t=>V.divIcon({className:"custom-div-icon",html:`
        <div style="
            position: relative;
            width: 25px;
            height: 41px;
            background-color: ${t}; 
            border-radius: 50% 50% 50% 0;
            transform: rotate(-45deg);
            border: 2px solid white;
            box-shadow: 1px 1px 5px rgba(0, 0, 0, 0.5);
        ">
            <div style="
                position: absolute;
                top: 50%;
                left: 50%;
                width: 8px;
                height: 8px;
                background-color: white;  /* Inner circle color */
                border-radius: 50%;
                transform: translate(-50%, -50%);
            "></div>
        </div>`,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[0,-41]});return e.jsxs(X,{children:[e.jsx(Y,{style:{marginLeft:"28%"},color:"secondary",children:"Filter by"}),e.jsx(tt,{style:{marginLeft:15,zIndex:1e3},format:"yyyy/MM/dd",onChange:U,value:u.length>0?[new Date(u[0]),new Date(u[1])]:null}),e.jsxs(T,{style:{marginLeft:"2%",width:"20%",backgroundColor:"#ff4d4d"},children:[e.jsx(v,{style:{color:"white"},children:P}),e.jsxs(z,{children:[e.jsx(n,{onClick:()=>D("all"),children:"All"}),N.map((t,o)=>e.jsx(n,{onClick:()=>D(t._id,t.name),children:t.name},o))]})]}),e.jsxs(T,{style:{marginLeft:"2%",width:"20%",backgroundColor:"#ff4d4d"},children:[e.jsx(v,{style:{color:"white"},children:$}),e.jsxs(z,{children:[e.jsx(n,{onClick:()=>c("all"),children:"All Status"}),e.jsx(n,{onClick:()=>c("ready"),children:"Ready"}),e.jsx(n,{onClick:()=>c("picking"),children:"Picking"}),e.jsx(n,{onClick:()=>c("finished"),children:"Finished"}),e.jsx(n,{onClick:()=>c("start"),children:"Start"}),e.jsx(n,{onClick:()=>c("delivery"),children:"Delivery"})]})]}),e.jsx(et,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),e.jsxs(K,{dragging:!0,center:[40.85631,14.24641],zoom:13,scrollWheelZoom:!0,style:{height:"500px",width:"100%",zIndex:0},children:[e.jsx(Q,{attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),_.map((t,o)=>{const a=M(),g=M();return e.jsxs(J.Fragment,{children:[t.customer.map((s,m)=>e.jsx(B,{position:[s.lat,s.lng],icon:b(g),children:e.jsxs(L,{children:[e.jsx(A,{icon:R,size:"lg",style:{marginLeft:"10px"}})," ",e.jsx("span",{children:s.address})]})},m)),t.market.map((s,m)=>e.jsx(B,{position:[s.lat,s.lng],icon:b(a),children:e.jsxs(L,{children:[e.jsx(A,{icon:R,size:"lg",style:{marginLeft:"10px"}})," ",e.jsx("span",{children:s.address})]})},m))]},o)})]})]})};export{xt as default};
