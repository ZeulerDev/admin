import{r as o,_ as ie,u as ne,R as l,a as $,P as d,c as S,y as ce,l as de,A as c,j as a,L as ue,h as me,m as he}from"./index-DCIC8fO6.js";import{a as A}from"./axios-Cm0UX6qg.js";import{B as T}from"./config-HOLfLxHr.js";import{b as fe,a as I}from"./CContainer-Dhr2RTMc.js";import{C as pe,a as X,b as Z,c as _,d as L}from"./DefaultLayout-C0sUmu94.js";import{C as ke}from"./CNavbar-R1oxGH4k.js";import{C as Ce,a as ge,b as ee,c as p,d as be,e as k}from"./CTable-Bvq_3Do7.js";import{a as se,C as ae}from"./CFormLabel-BFz3Pslt.js";import{c as xe}from"./cil-trash-CBbKHhHb.js";import{C as ye,a as te}from"./CPaginationItem-Dt9jjho8.js";import{C as ve,a as je,b as Ee,c as De}from"./CModalTitle-CmK17VBN.js";var y=o.forwardRef(function(s,u){var i=s.className,n=s.button,V=s.feedback,N=s.feedbackInvalid,U=s.feedbackValid,w=s.floatingLabel,F=s.tooltipFeedback,v=s.hitArea,h=s.id,f=s.indeterminate,P=s.inline,j=s.invalid,C=s.label,H=s.reverse,E=s.type,O=E===void 0?"checkbox":E,g=s.valid,R=ie(s,["className","button","feedback","feedbackInvalid","feedbackValid","floatingLabel","tooltipFeedback","hitArea","id","indeterminate","inline","invalid","label","reverse","type","valid"]),b=o.useRef(null),B=ne(u,b);o.useEffect(function(){b.current&&f&&(b.current.indeterminate=f)},[f,b.current]);var m=function(){return l.createElement("input",$({type:O,className:S(n?"btn-check":"form-check-input",{"is-invalid":j,"is-valid":g,"me-2":v}),id:h},R,{ref:B}))},D=function(){return l.createElement(se,{describedby:R["aria-describedby"],feedback:V,feedbackInvalid:N,feedbackValid:U,floatingLabel:w,invalid:j,tooltipFeedback:F,valid:g})},z=function(){var M;return l.createElement(ae,$({customClassName:S(n?S("btn",n.variant?"btn-".concat(n.variant,"-").concat(n.color):"btn-".concat(n.color),(M={},M["btn-".concat(n.size)]=n.size,M),"".concat(n.shape)):"form-check-label")},h&&{htmlFor:h}),C)},x=function(){return n?l.createElement(l.Fragment,null,l.createElement(m,null),C&&l.createElement(z,null),l.createElement(D,null)):C?v?l.createElement(l.Fragment,null,l.createElement(m,null),l.createElement(ae,$({customClassName:S("form-check-label stretched-link",i)},h&&{htmlFor:h}),C),l.createElement(D,null)):l.createElement("div",{className:S("form-check",{"form-check-inline":P,"form-check-reverse":H,"is-invalid":j,"is-valid":g},i)},l.createElement(m,null),l.createElement(z,null),l.createElement(D,null)):l.createElement(m,null)};return l.createElement(x,null)});y.propTypes=$({button:d.object,className:d.string,hitArea:d.oneOf(["full"]),id:d.string,indeterminate:d.bool,inline:d.bool,label:d.oneOfType([d.string,d.node]),reverse:d.bool,type:d.oneOf(["checkbox","radio"])},se.propTypes);y.displayName="CFormCheck";const ze=()=>{const[{user:s,token:u},i]=ce(),[n,V]=o.useState([]),[N,U]=o.useState([]),[w,F]=o.useState(""),[v,h]=o.useState(""),[f,P]=o.useState(0);o.useState(0);const[j,C]=o.useState("All Cities"),[H,E]=o.useState("All Chains");o.useState();const[O,g]=o.useState(!1),[R,b]=o.useState(!0);de();const[B,m]=o.useState(!1),[D,z]=o.useState("");o.useEffect(()=>{u&&A.get(T+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${u}`}}).then(e=>{e.status===200?V(e.data):e.status===500&&i({type:c,payload:{status:!0,title:"Chain Loading error",message:e.data.message}})}).catch(e=>{console.error("Error: ",e)})},[]),o.useEffect(()=>{const e=setTimeout(()=>{i({type:c,payload:{status:!0,title:"Data Loading",message:"Data loading error: Timeout exceeded",color:"warning"}}),g(!1)},2e4);return s&&u&&x(0,e),()=>{clearTimeout(e)}},[w,v,s]);const x=(e,t)=>{g(!0),A.get(T+`assistant/market/locations/${e}?brand=${w}&city=${v}`,{headers:{Authorization:`Bearer ${u}`}}).then(r=>{r.status===200?(U(r.data.data),g(!1),clearTimeout(t),r.data.data.length<20?(b(!0),console.log("ok")):r.data.data.length>19&&b(!1)):r.status===500&&i({type:c,payload:{status:!0,title:"Market Loading error",message:r.data.message}})}).catch(r=>{console.error("Error: ",r)})},M=()=>{const e=f+20;P(e),x(e,!0)},le=()=>{const e=f-20;console.log(e),P(e),x(e,!1)},G=(e,t)=>{e==="all"?(F(""),E("All Chains")):(F(e),E(t))},Y=e=>{e==="all"?(h(""),C("All Cities")):(h(e),C(e))},J=(e,t,r)=>{console.log(e),console.log(N),r==="delivery"?(Q({market:e,service:r}),console.log("add delivery")):r==="pickup"&&(Q({market:e,service:r}),console.log("add pickup"))},K=(e,t,r)=>{r==="delivery"?(W({market:e,service:r}),console.log("remove delivery")):r==="pickup"&&(W({market:e,service:r}),console.log("remove pickup"))},Q=e=>{A.post(T+"assistant/markets/add/services",e,{headers:{Authorization:`Bearer ${u}`}}).then(t=>{t.status===200?console.log("Updated add service"):t.status===203?i({type:c,payload:{status:!0,title:"Market Updated error",message:t.data.message}}):t.status===204?i({type:c,payload:{status:!0,title:"Market Updated error",message:t.data.message}}):t.status===500&&i({type:c,payload:{status:!0,title:"Market Updated error",message:t.data.message}})}).catch(t=>{console.error("Error:",t)})},W=e=>{A.post(T+"assistant/markets/remove/services",e,{headers:{Authorization:`Bearer ${u}`}}).then(t=>{t.status===200?console.log("Updated remove service"):t.status===203?i({type:c,payload:{status:!0,title:"Market remove error",message:t.data.message}}):t.status===204?i({type:c,payload:{status:!0,title:"Market remove error",message:t.data.message}}):t.status===500&&i({type:c,payload:{status:!0,title:"Market remove error",message:t.data.message}})}).catch(t=>{console.error("Error:",t)})},re=e=>{m(!B),z(e)},oe=e=>{console.log(e),A.delete(T+"market/"+e,{headers:{Authorization:`Bearer ${u}`}}).then(t=>{t.status===200?(i({type:c,payload:{status:!0,title:"Market Delete",message:"Market Remove Success",color:"success"}}),m(!1),x(0,!0),console.log("Remove Market")):t.status===404?i({type:c,payload:{status:!0,title:"Market remove error",message:t.data.message}}):t.status===500&&i({type:c,payload:{status:!0,title:"Market remove error",message:t.data.message}})}).catch(t=>{console.error("Error:",t)})};return a.jsxs(fe,{children:[a.jsx(ue,{to:"/markets/addmarket",children:a.jsx(I,{style:{marginLeft:"0%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Add New Market"})}),a.jsx(pe,{style:{marginLeft:"39.5%"},color:"secondary",children:"Filter by"}),a.jsxs(X,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[a.jsx(Z,{style:{color:"white"},children:j}),a.jsxs(_,{children:[a.jsx(L,{onClick:()=>Y("all"),children:"All"}),a.jsx(L,{onClick:()=>Y("Milano"),children:"Milano"}),a.jsx(L,{onClick:()=>Y("Napoli"),children:"Napoli"})]})]}),a.jsxs(X,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[a.jsx(Z,{style:{color:"white"},children:H}),a.jsxs(_,{children:[a.jsx(L,{onClick:()=>G("all"),children:"All"}),n.map((e,t)=>a.jsx(L,{onClick:()=>G(e.id,e.name),children:e.name},t))]})]}),a.jsx(ke,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),O?a.jsx(me,{}):a.jsxs(Ce,{children:[a.jsx(ge,{children:a.jsxs(ee,{children:[a.jsx(p,{scope:"col",children:"#"}),a.jsx(p,{scope:"col",children:"Name"}),a.jsx(p,{scope:"col",children:"Address"}),a.jsx(p,{scope:"col",children:"City"}),a.jsx(p,{scope:"col",children:"Delivery"}),a.jsx(p,{scope:"col",children:"Pickup"}),a.jsx(p,{scope:"col",children:"Scraped"}),a.jsx(p,{scope:"col",children:"Remove"})]})}),a.jsx(be,{children:N.map((e,t)=>a.jsxs(ee,{children:[a.jsx(k,{children:f+t+1}),a.jsx(k,{children:e.chain.name}),a.jsx(k,{children:e.address}),a.jsx(k,{children:e.city}),a.jsx(k,{children:e.services.includes("delivery")?a.jsx(y,{id:"flexCheckChecked",label:"",defaultChecked:!0,onChange:()=>K(e._id,!0,"delivery")}):a.jsx(y,{id:"flexCheckChecked",label:"",onChange:()=>J(e._id,!0,"delivery")})}),a.jsx(k,{children:e.services.includes("pickup")?a.jsx(y,{id:"flexCheckChecked",label:"",defaultChecked:!0,onChange:()=>K(e._id,!0,"pickup")}):a.jsx(y,{id:"flexCheckChecked",label:"",onChange:()=>J(e._id,!0,"pickup")})}),a.jsx(k,{children:e.scraped}),a.jsx(k,{children:a.jsx(I,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>re(e._id),children:a.jsx(he,{icon:xe,size:"lg",style:{color:"white"}})})})]},t))})]}),a.jsxs(ye,{"aria-label":"Page navigation example",children:[a.jsx(te,{disabled:f<=0,onClick:le,children:"Previous"}),a.jsx(te,{disabled:R===!0,onClick:M,children:"Next"})]}),a.jsxs(ve,{alignment:"center",visible:B,scrollable:!0,size:"sm",onClose:()=>m(!1),children:[a.jsx(je,{closeButton:!1,children:a.jsx(Ee,{children:"Confirmation"})}),a.jsxs(De,{children:[a.jsx("a",{children:"Are you sure you want to delete this market?"}),a.jsx("br",{}),a.jsx("br",{}),a.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[a.jsx(I,{onClick:()=>oe(D),style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),a.jsx(I,{onClick:()=>m(!1),style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]})]})};export{ze as default};
