import{y as pe,r as a,l as je,A as r,j as e,h as $,m as V}from"./index-B08OXeWv.js";import{a as y}from"./axios-Cm0UX6qg.js";import{B as k}from"./config-HOLfLxHr.js";import{b as ye,a as h}from"./CContainer-Bcycrjrg.js";import{C as ke,a as _,b as H,c as Z,d as f}from"./DefaultLayout-ZVM7TRL_.js";import{C as be}from"./CNavbar-CI1ooECg.js";import{C as Me,a as Pe,b as F,c,d as Se,e as d}from"./CTable-isbk2Vch.js";import{c as ve}from"./cil-trash-CBbKHhHb.js";import{C as De,a as S}from"./CPaginationItem-BtMnBLEs.js";import{C as Y,a as U,b as q,c as G}from"./CModalTitle-BEzJ5tl5.js";var Ae=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M425.706,86.294A240,240,0,0,0,86.294,425.705,240,240,0,0,0,425.706,86.294ZM256,48A207.1,207.1,0,0,1,391.528,98.345L98.345,391.528A207.1,207.1,0,0,1,48,256C48,141.309,141.309,48,256,48Zm0,416a207.084,207.084,0,0,1-134.986-49.887l293.1-293.1A207.084,207.084,0,0,1,464,256C464,370.691,370.691,464,256,464Z' class='ci-primary'/>"];const He=()=>{const[{user:g,token:i},o]=pe(),[J,K]=a.useState([]),[O,Q]=a.useState([]),[v,D]=a.useState(""),[A,w]=a.useState(""),[x,b]=a.useState(0),[W,T]=a.useState("All Cities"),[X,E]=a.useState("All Chains");a.useState();const[ee,m]=a.useState(!1),[te,L]=a.useState(!1),[we,B]=a.useState(!1),[se,N]=a.useState(!0);je();const[I,C]=a.useState(!1),[z,p]=a.useState(!1),[ae,le]=a.useState(""),[oe,re]=a.useState(""),[ie,ne]=a.useState(0),[j,M]=a.useState(1);a.useEffect(()=>{i&&y.get(k+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${i}`}}).then(t=>{t.status===200?K(t.data):t.status===500&&o({type:r,payload:{status:!0,title:"Chain Loading error",message:t.data.message}})}).catch(t=>{console.error("Error: ",t)})},[]),a.useEffect(()=>{const t=setTimeout(()=>{o({type:r,payload:{status:!0,title:"Data Loading",message:"Data loading error: Timeout exceeded",color:"warning"}}),m(!1)},2e4);return g&&i&&u(0,t),()=>{clearTimeout(t)}},[v,A,g]);const u=(t,s)=>{m(!0),y.get(k+`assistant/virtual/market/locations/${t}?brand=${v}&city=${A}`,{headers:{Authorization:`Bearer ${i}`}}).then(l=>{l.status===200?(Q(l.data.data),ne(l.data.count),console.log("count",l.data.count),m(!1),clearTimeout(s),l.data.data.length<20?(N(!0),console.log("ok")):l.data.data.length>19&&N(!1)):l.status===500&&(m(!1),o({type:r,payload:{status:!0,title:"Market Loading error",message:l.data.message}}))}).catch(l=>{m(!1),console.error("Error: ",l)})},ce=()=>{M(j+1);const t=x+20;b(t),u(t,!0)},de=()=>{M(j-1);const t=x-20;console.log(t),b(t),u(t,!0)},R=(t,s)=>{t==="all"?(D(""),E("All Chains")):(D(t),E(s))},P=t=>{t==="all"?(w(""),T("All Cities")):(w(t),T(t))},ue=t=>{C(!I),le(t)},he=t=>{p(!z),re(t)},me=t=>{g&&i&&(L(!0),console.log(t),y.delete(k+"market/virtual/"+t,{headers:{Authorization:`Bearer ${i}`}}).then(s=>{s.status===200?(o({type:r,payload:{status:!0,title:"Market Delete",message:"Market Remove Success",color:"success"}}),L(!1),C(!1),u(0,!0)):s.status===404?o({type:r,payload:{status:!0,title:"Market remove error",message:s.data.message}}):s.status===500&&o({type:r,payload:{status:!0,title:"Market remove error",message:s.data.message}})}).catch(s=>{console.error("Error:",s)}))},fe=t=>{g&&i&&(B(!0),console.log("id",t),y.delete(k+"product/delete/all/"+t,{headers:{Authorization:`Bearer ${i}`}}).then(s=>{s.status===200?(o({type:r,payload:{status:!0,title:"Market Products Delete",message:"Market Products Remove Success",color:"success"}}),B(!1),p(!1),u(0,!0),console.log("Remove Market Products")):s.status===404?o({type:r,payload:{status:!0,title:"Market Products remove error",message:s.data.message}}):s.status===500&&o({type:r,payload:{status:!0,title:"Market Products remove error",message:s.data.message}})}).catch(s=>{console.error("Error:",s)}))},ge=t=>{M(t);const s=(t-1)*20;b(s),u(s,!0)},xe=()=>{const t=Math.ceil(ie/20),s=[];for(let n=1;n<=t;n++)s.push(n);console.log(s,t);const l=Math.max(j-2,1),Ce=Math.min(l+4,t);return s.slice(l-1,Ce).map(n=>e.jsx(S,{active:j===n,onClick:()=>ge(n),children:n},n))};return e.jsxs(ye,{children:[e.jsx(ke,{style:{marginLeft:"57%"},color:"secondary",children:"Filter by"}),e.jsxs(_,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[e.jsx(H,{style:{color:"white"},children:W}),e.jsxs(Z,{children:[e.jsx(f,{onClick:()=>P("all"),children:"All"}),e.jsx(f,{onClick:()=>P("Milano"),children:"Milano"}),e.jsx(f,{onClick:()=>P("Napoli"),children:"Napoli"})]})]}),e.jsxs(_,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[e.jsx(H,{style:{color:"white"},children:X}),e.jsxs(Z,{children:[e.jsx(f,{onClick:()=>R("all"),children:"All"}),J.map((t,s)=>e.jsx(f,{onClick:()=>R(t.id,t.name),children:t.name},s))]})]}),e.jsx(be,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),ee?e.jsx($,{}):e.jsxs(Me,{children:[e.jsx(Pe,{children:e.jsxs(F,{children:[e.jsx(c,{scope:"col",children:"#"}),e.jsx(c,{scope:"col",children:"Name"}),e.jsx(c,{scope:"col",children:"Address"}),e.jsx(c,{scope:"col",children:"City"}),e.jsx(c,{scope:"col",children:"Scraped"}),e.jsx(c,{scope:"col",children:"Delete"}),e.jsx(c,{scope:"col",children:"Empty Products"})]})}),e.jsx(Se,{children:O.map((t,s)=>e.jsxs(F,{children:[e.jsx(d,{children:x+s+1}),e.jsx(d,{children:t.chain.name}),e.jsx(d,{children:t.address}),e.jsx(d,{children:t.city}),e.jsx(d,{children:t.scraped}),e.jsx(d,{children:e.jsx(h,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>ue(t._id),children:e.jsx(V,{icon:ve,size:"lg",style:{color:"white"}})})}),e.jsx(d,{children:e.jsx(h,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>he(t._id),children:e.jsx(V,{icon:Ae,size:"lg",style:{color:"white"}})})})]},s))})]}),e.jsxs(De,{"aria-label":"Page navigation example",children:[e.jsx(S,{disabled:x<=0,onClick:de,children:"Previous"}),xe(),e.jsx(S,{disabled:se===!0,onClick:ce,children:"Next"})]}),e.jsxs(Y,{alignment:"center",visible:I,scrollable:!0,size:"sm",onClose:()=>C(!1),children:[e.jsx(U,{closeButton:!1,children:e.jsx(q,{children:"Confirmation"})}),e.jsxs(G,{children:[e.jsx("a",{children:"Are you sure you want to delete this market?"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:te?e.jsx($,{}):e.jsxs(e.Fragment,{children:[e.jsx(h,{onClick:()=>me(ae),style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),e.jsx(h,{onClick:()=>C(!1),style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})})]})]}),e.jsxs(Y,{alignment:"center",visible:z,scrollable:!0,size:"sm",onClose:()=>p(!1),children:[e.jsx(U,{closeButton:!1,children:e.jsx(q,{children:"Confirmation"})}),e.jsxs(G,{children:[e.jsx("a",{children:"Are you sure you want to delete all products in this market?"}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[e.jsx(h,{onClick:()=>fe(oe),style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),e.jsx(h,{onClick:()=>p(!1),style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]})]})};export{He as default};
