import{x as qe,r,z as c,j as t,h as M,L as Ge,m as Je}from"./index-Dy30eiM6.js";import{a as m}from"./axios-B4uVmeYG.js";import{B as x}from"./config-HOLfLxHr.js";import{b as Ke,a as u}from"./CContainer-PswvU4of.js";import{C as de,a as ue,b as pe,d as he,e as U}from"./DefaultLayout-E8F3KeA2.js";import{C as We}from"./CNavbar-DSEUJjHx.js";import{C as ge}from"./CFormInput-C4Xof77t.js";import{C as Xe,a as Ze,b as fe,c as d,d as et,e as y}from"./CTable-2kSvDEKq.js";import{C as me}from"./CCardImage-BhaXftd9.js";import{c as tt}from"./cil-pencil-m516yCOw.js";import{C as st,a as V}from"./CPaginationItem-CIVwLBfW.js";import{C as Q,a as H,b as _,c as O}from"./CModalTitle-CFHTVTiy.js";import{C as xe}from"./CModalFooter-BrzcW4v0.js";import"./CFormLabel-CXmS8KuA.js";const yt=()=>{const[{user:C,token:n},o]=qe(),[ye,P]=r.useState(!1),[Y,k]=r.useState(!1);r.useState(!1);const[Ce,j]=r.useState(!1),[q,G]=r.useState([]),[A,z]=r.useState(0),[je,D]=r.useState(!0),[Pe,ke]=r.useState([]),[Se,L]=r.useState("All Chains"),[N,I]=r.useState("All market"),[at,E]=r.useState(""),[S,w]=r.useState(""),[be,J]=r.useState([]),[p,b]=r.useState(""),[Ae,K]=r.useState(p),[De,B]=r.useState(!1),[Ie,W]=r.useState(""),[T,X]=r.useState(""),[we,Z]=r.useState(""),[ve,Me]=r.useState(0),[v,$]=r.useState(1);r.useState("NAME");const[ee,R]=r.useState(!1),[Ue,te]=r.useState(""),[ze,h]=r.useState(!1),[Le,se]=r.useState(!1);r.useEffect(()=>{C&&n&&g(0)},[C,n,S,Ae]),r.useEffect(()=>{const e=setTimeout(()=>{(p.length>=3||p.length===0)&&K(p)},500);return()=>{clearTimeout(e)}},[p]),r.useEffect(()=>{n&&m.get(x+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${n}`}}).then(e=>{e.status===200?ke(e.data):e.status===500&&o({type:c,payload:{status:!0,title:"Chain Loading error",message:e.data.message}})}).catch(e=>{console.error("Error: ",e)})},[]);const Ne=e=>{m.get(x+`assistant/reference/market/locations?brand=${e}`,{headers:{Authorization:`Bearer ${n}`}}).then(s=>{s.status===200?(J(s.data.data),s.data.data.length<20?(D(!0),console.log("ok")):s.data.data.length>19&&D(!1)):s.status===500&&o({type:c,payload:{status:!0,title:"Market Loading error",message:s.data.message}})}).catch(s=>{console.error("Error: ",s)})},g=(e,s)=>{P(!0),m.get(x+`virtual/product/all/${e}?marketId=${S}&name=${p}`,{headers:{Authorization:`Bearer ${n}`}}).then(a=>{a.status===200?(G(a.data.list),Me(a.data.count),console.log(a.data.count),P(!1),a.data.list.length<20?(D(!0),console.log("ok")):a.data.list.length>19&&D(!1)):a.status===203?(P(!1),o({type:c,payload:{status:!0,title:"product loading error error",message:a.data.message}})):a.status===204?(P(!1),o({type:c,payload:{status:!0,title:"No Products",message:"No products found in this market address",color:"info"}})):a.status===500&&(P(!1),o({type:c,payload:{status:!0,title:"product loading error error",message:a.data.message}}))}).catch(a=>{P(!1),console.error("Error:",a)})},ae=(e,s)=>{e==="all"?(E(""),L("All Chains"),w(""),I("All Markets"),b("")):(E(e),Ne(e),L(s),w(""),I("All Markets"),b(""))},re=(e,s)=>{e==="all"?(w(""),I("All Markets"),E(""),L("All Chains"),J([]),b("")):(w(e),I(s),b(""))},Ee=()=>{$(v+1);const e=A+50;z(e),g(e)},Be=()=>{$(v-1);const e=A-50;console.log(e),z(e),g(e)},Te=(e,s)=>{B(!0),W(e),Z(s)},$e=()=>{console.log("called"),T==""?o({type:c,payload:{status:!0,title:"Alert",message:"Please enter the price",color:"warning"}}):Ve(Ie)},Re=e=>{$(e);const s=(e-1)*50;z(s),g(s)},Fe=()=>{const e=Math.ceil(ve/50),s=[];for(let i=1;i<=e;i++)s.push(i);const a=Math.max(v-2,1),l=Math.min(a+4,e);return s.slice(a-1,l).map(i=>t.jsx(V,{active:v===i,onClick:()=>Re(i),children:i},i))},Ve=e=>{if(e){let s={price:T+" â‚¬"};C&&n&&m.put(x+"product/update/price/"+e,s,{headers:{Authorization:`Bearer ${n}`}}).then(a=>{if(a.status===200){const l=a.data,f=q.map(i=>(i.productId===l.productId&&(i.price.basePrice=l.price.basePrice,i.price.tax=l.price.tax,i.price.markup=l.price.markup,i.price.total=l.price.total),i));G([...f]),o({type:c,payload:{status:!0,title:"Product Details Update",message:"Product price update Success",color:"success"}}),W(""),X(""),B(!1),Z("")}else a.status===204?o({type:c,payload:{status:!0,title:"Product Details Update error",message:a.data.message,color:"danger"}}):a.status===500&&o({type:c,payload:{status:!0,title:"Product Details Update error",message:a.data.message,color:"danger"}})}).catch(a=>{console.error("Error:",a)})}else alert("Please Check the Fields!")},Qe=e=>{R(!ee),te(e)},[He,F]=r.useState(null),[le,oe]=r.useState(null),_e=e=>{console.log(e),oe(URL.createObjectURL(e)),F(e)},Oe=async(e,s)=>{if(console.log(e,s),C&&n){const a=new FormData;a.append("image",s),a.append("id",e),m.post(x+"test/product/image/update",a,{headers:{Authorization:`Bearer ${n}`}}).then(l=>{l.status===200?(R(!1),te(""),F(null),console.log("response",l.data),o({type:c,payload:{status:!0,title:"Image upload ",message:"Image upload success",color:"success"}}),g(0)):l.status===500&&o({type:c,payload:{status:!0,title:"Image upload error",message:l.data.message,color:"danger"}})}).catch(l=>{console.error("Error:",l)})}},ce=(e,s)=>{if(e){let a={status:s};C&&n&&m.put(x+"product/update/status/"+e,a,{headers:{Authorization:`Bearer ${n}`}}).then(l=>{l.status===200?(o({type:c,payload:{status:!0,title:"Product Status Update",message:"Product status update Success",color:"success"}}),g(0)):l.status===204?o({type:c,payload:{status:!0,title:"Product Details Update error",message:"Product status update error",color:"danger"}}):l.status===500&&o({type:c,payload:{status:!0,title:"Product Details Update error",message:"Product status update error",color:"danger"}})}).catch(l=>{console.error("Error:",l)})}else alert("Please Check the Fields!")},ne=e=>{h(!0),e==="active"?se(!0):e==="deactive"&&se(!1)},ie=(e,s)=>{k(!0);let a;if(e==="1"?a=!0:e==="0"&&(a=!1),s){let l={status:a,mid:s};console.log("data",l),C&&n&&m.put(x+"product/update/all",l,{headers:{Authorization:`Bearer ${n}`}}).then(f=>{f.status===200?(o({type:c,payload:{status:!0,title:"Product Status Update",message:"Product status update Success",color:"success"}}),g(0),k(!1),h(!1)):f.status===204?(o({type:c,payload:{status:!0,title:"Product Details Update",message:"No products found in this market address to update",color:"info"}}),k(!1),h(!1)):f.status===500&&(o({type:c,payload:{status:!0,title:"Product Details Update error",message:"Product status update error",color:"danger"}}),k(!1),h(!1))}).catch(f=>{console.error("Error:",f),k(!1),h(!1)})}else o({type:c,payload:{status:!0,title:"Alert",message:"Please select the market",color:"danger"}}),j(!1),k(!1),h(!1)},Ye=e=>{j(!0),console.log("mid",e),C&&n&&(e?(console.log("data"),m.put(x+"product/sync/all/"+e,{},{headers:{Authorization:`Bearer ${n}`}}).then(s=>{s.status===200?(o({type:c,payload:{status:!0,title:"Product Sync",message:"Product sync Success",color:"success"}}),g(0),j(!1)):s.status===204?(o({type:c,payload:{status:!0,title:"Product Sync error",message:"Product sync error",color:"danger"}}),j(!1)):s.status===500&&(o({type:c,payload:{status:!0,title:"Product Sync error",message:"Product sync error",color:"danger"}}),j(!1))}).catch(s=>{console.error("Error:",s),j(!1)})):(j(!1),o({type:c,payload:{status:!0,title:"Alert",message:"Please select the market",color:"danger"}})))};return t.jsxs(Ke,{children:[t.jsx(de,{style:{marginLeft:"0%"},color:"secondary",children:"Action "}),t.jsx(u,{size:"sm",onClick:()=>{ne("active")},style:{backgroundColor:"#ff4d4d",marginLeft:"2%",width:120,color:"white"},children:Y?t.jsx(M,{size:"sm"}):"Activate All"}),t.jsx(u,{size:"sm",onClick:()=>{ne("deactive")},style:{backgroundColor:"#ff4d4d",marginLeft:"2%",width:120,color:"white"},children:Y?t.jsx(M,{size:"sm"}):"Deactivate All"}),t.jsx(u,{size:"sm",onClick:()=>{Ye(S)},style:{backgroundColor:"#ff4d4d",marginLeft:"2%",width:120,color:"white"},children:Ce?t.jsx(M,{size:"sm"}):"Sync"}),t.jsx(de,{style:{marginLeft:"15%"},color:"secondary",children:"Filter by"}),t.jsxs(ue,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[t.jsx(pe,{style:{color:"white"},children:Se}),t.jsxs(he,{children:[t.jsx(U,{onClick:()=>ae("all"),children:"All"}),Pe.map((e,s)=>t.jsx(U,{onClick:()=>ae(e.id,e.name),children:e.name},s))]})]}),t.jsxs(ue,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[t.jsx(pe,{style:{color:"white"},children:N.length>15?`${N.substring(0,15)}...`:N}),t.jsxs(he,{children:[t.jsx(U,{onClick:()=>re("all"),children:"Select the Chain"}),be.map((e,s)=>t.jsx(U,{onClick:()=>re(e._id,e.address),children:t.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[t.jsx("span",{children:e.address.substring(0,e.address.length/2)}),t.jsx("span",{children:e.address.substring(e.address.length/2)})]})},s))]})]}),t.jsx(We,{style:{marginTop:"1%"},className:"bg-body-tertiary",children:t.jsx(ge,{type:"text",placeholder:"Search products by name, brand name and product id",style:{width:450,marginRight:"50%"},value:p,onChange:e=>b(e.target.value)})}),ye?t.jsx("div",{className:"d-flex justify-content-center",children:t.jsx(M,{style:{marginTop:"15%"}})}):t.jsxs(Xe,{children:[t.jsx(Ze,{children:t.jsxs(fe,{children:[t.jsx(d,{scope:"col",children:"#"}),t.jsx(d,{scope:"col",children:"Product Id"}),t.jsx(d,{scope:"col",children:"Photo"}),t.jsx(d,{scope:"col",children:"Name"}),t.jsx(d,{scope:"col",children:"Price"}),t.jsx(d,{scope:"col",children:"Brand"}),t.jsx(d,{scope:"col",children:"Chain"}),t.jsx(d,{scope:"col",children:"Market Address"}),t.jsx(d,{scope:"col",children:"Action"})]})}),t.jsx(et,{children:q.map((e,s)=>t.jsxs(fe,{children:[t.jsx(y,{children:A+s+1}),t.jsx(y,{children:e.pid}),t.jsx(d,{onClick:()=>{Qe(e.productId)},children:t.jsx(me,{style:{width:"50px",height:"50px"},src:"https://api.zeuler.com/image/"+e.image})}),t.jsx(y,{children:e.name}),t.jsxs(y,{children:[e.price.basePrice,t.jsx(Ge,{to:"",children:t.jsx(Je,{icon:tt,size:"sm",onClick:()=>Te(e.productId,e.price.basePrice)})})]}),t.jsx(y,{children:e.brand}),t.jsx(y,{children:e.chainName}),t.jsx(y,{children:e.marketAddress}),t.jsx(y,{children:e.status?t.jsx(u,{size:"sm",onClick:()=>{ce(e.productId,!1)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Deactivate"}):t.jsx(u,{size:"sm",onClick:()=>{ce(e.productId,!0)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Activate"})})]},s))})]}),t.jsxs(st,{"aria-label":"Page navigation example",children:[t.jsx(V,{disabled:A<=0,onClick:Be,children:"Previous"}),Fe(),t.jsx(V,{disabled:je===!0,onClick:Ee,children:"Next"})]}),t.jsxs(Q,{alignment:"center",visible:ze,scrollable:!0,size:"sm",onClose:()=>h(!1),children:[t.jsx(H,{closeButton:!1,children:t.jsx(_,{children:"Confirmation"})}),t.jsxs(O,{children:[t.jsx("a",{children:"Are you sure you want to change the status of all these products?"}),t.jsx("br",{}),t.jsx("br",{}),t.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[t.jsx(u,{onClick:()=>{ie(Le?"1":"0",S)},style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),t.jsx(u,{onClick:()=>{h(!1)},style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]}),t.jsxs(Q,{alignment:"center",visible:De,scrollable:!0,size:"sm",onClose:()=>B(!1),children:[t.jsx(H,{closeButton:!0,children:t.jsx(_,{children:"Change Price"})}),t.jsxs(O,{children:[t.jsx("a",{children:"Enter New Name"}),t.jsx("br",{}),t.jsx(ge,{type:"text",placeholder:we,value:T,onChange:e=>X(e.target.value)})]}),t.jsx(xe,{children:t.jsx(u,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>$e(),children:"Save changes"})})]}),t.jsxs(Q,{alignment:"center",visible:ee,scrollable:!0,size:"lg",onClose:()=>{R(!1),F(null),oe(null)},children:[t.jsx(H,{closeButton:!0,children:t.jsx(_,{children:"Image Uploader"})}),t.jsxs(O,{children:[le&&t.jsx(me,{style:{width:"100px",height:"100px"},src:le,alt:"Uploaded Image"}),t.jsx("input",{style:{marginLeft:"5%"},type:"file",accept:".jpg, .jpeg, .png",onChange:e=>_e(e.target.files[0])})]}),t.jsx(xe,{children:t.jsx(u,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>{Oe(Ue,He)},children:"Upload Image"})})]})]})};export{yt as default};
