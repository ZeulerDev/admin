import{r as o,y as J,A as d,j as e,h as K}from"./index-BLq9IGGh.js";import{a as D}from"./axios-Cm0UX6qg.js";import{B as N}from"./config-HOLfLxHr.js";import{b as O,a as P}from"./CContainer-Bm_zxevC.js";import{C as W}from"./CNavbar-BfXdO2OZ.js";import{C as B}from"./CFormInput-C-WC_959.js";import{C as X,a as Z,b as M,c as l,d as ee,e as c}from"./CTable-B__h2VZV.js";import{C as h}from"./DefaultLayout-M8tVtSf7.js";import{C as se,a as k}from"./CPaginationItem-BpsAQI8q.js";import{C as te,a as ae,b as oe,c as re}from"./CModalTitle-BX8CLHZF.js";import{C as le}from"./CModalFooter-D0M-wwHe.js";import"./CFormLabel-CjV9U-Jd.js";const Ce=()=>{const[T,m]=o.useState(!1),[{user:I,token:p},n]=J(),[f,S]=o.useState([]),[z,j]=o.useState(!1),[L,R]=o.useState(""),[A,V]=o.useState(""),[C,H]=o.useState(""),[$,F]=o.useState(0),[g,y]=o.useState(1),[b,v]=o.useState(0),[Q,w]=o.useState(!0);o.useEffect(()=>{let s=setTimeout(()=>{n({type:d,payload:{status:!0,title:"Data Loading",message:"Data loading error: Timeout exceeded",color:"warning"}}),j(!1)},2e4);return x(0,s),()=>{clearTimeout(s)}},[C]);const x=(s,t)=>{I&&p&&(j(!0),D.get(N+`assistant/vat/shoppers/${s}?search=`+C,{headers:{Authorization:`Bearer ${p}`}}).then(a=>{a.status===200?(S(a.data.list),F(a.data.count),clearTimeout(t),j(!1),a.data.list.length<50?(w(!0),console.log("ok")):a.data.list.length>49&&w(!1)):a.status===204?n({type:d,payload:{status:!0,title:"Error",message:a.data.message,color:"warning"}}):a.status===500&&n({type:d,payload:{status:!0,title:"Error",message:a.data.message,color:"warning"}})}).catch(a=>{console.error("Error:",a)}))},U=()=>{y(g+1);const s=b+50;v(s),x(s,!0)},Y=()=>{y(g-1);const s=b-50;console.log(s),v(s),x(s,!1)},E=(s,t=null)=>{m(!T),R(s),t!==null?V(t):console.log("VAT PID not provided"),console.log(s)},_=()=>{const s={vat:A};I&&p&&D.patch(N+"assistant/shopper/vat/"+L,s,{headers:{Authorization:`Bearer ${p}`}}).then(t=>{if(t.status===200){console.log("updated"),m(!1);const a=t.data,i=f.find(u=>u.id===a.id);i&&(i.vat=a.vat),S([...f]),n({type:d,payload:{status:!0,title:"Picker VAT Id ",message:"VAT Id updated successfully"}})}else t.status===203?(console.log("203"),n({type:d,payload:{status:!0,title:"Picker VAT Id update error",message:t.data.message}})):t.status===204?(console.log("204"),n({type:d,payload:{status:!0,title:"Picker VAT Id update error",message:t.data.message}})):t.status===500&&n({type:d,payload:{status:!0,title:"Picker VAT Id update error",message:t.data.message}})}).catch(t=>{console.error(t)})},q=s=>{y(s);const t=(s-1)*50;v(t),x(t,!0)},G=()=>{const s=Math.ceil($/50),t=[];for(let r=1;r<=s;r++)t.push(r);const a=Math.max(g-2,1),i=Math.min(a+4,s);return t.slice(a-1,i).map(r=>e.jsx(k,{active:g===r,onClick:()=>q(r),children:r},r))};return e.jsxs(O,{children:[e.jsx(W,{className:"bg-body-tertiary",children:e.jsx(B,{type:"text",placeholder:"Search",style:{width:450,marginLeft:"0%"},value:C,onChange:s=>H(s.target.value)})}),z?e.jsx(K,{}):e.jsxs(X,{children:[e.jsx(Z,{children:e.jsxs(M,{children:[e.jsx(l,{scope:"col",children:"#"}),e.jsx(l,{scope:"col",children:"Name"}),e.jsx(l,{scope:"col",children:"City"}),e.jsx(l,{scope:"col",children:"Vat"}),e.jsx(l,{scope:"col",children:"Activate"}),e.jsx(l,{scope:"col",children:"Disabled"}),e.jsx(l,{scope:"col",children:"market"}),e.jsx(l,{scope:"col",children:"Action"})]})}),e.jsx(ee,{children:f.map((s,t)=>{var a,i,u;return e.jsxs(M,{children:[e.jsx(c,{children:t+1}),e.jsx(c,{children:s.name}),e.jsx(c,{children:s.city}),e.jsx(c,{children:s.vat?s.vat:e.jsx(h,{color:"warning",children:"Empty"})}),e.jsx(c,{children:s.activate?e.jsx(h,{color:"success",children:"Yes"}):e.jsx(h,{color:"warning",children:"No"})}),e.jsx(c,{children:s.disabled?e.jsx(h,{color:"success",children:"No"}):e.jsx(h,{color:"warning",children:"Yes"})}),e.jsxs(c,{children:[(i=(a=s.market)==null?void 0:a.chain)==null?void 0:i.name," - ",(u=s.market)==null?void 0:u.address]}),e.jsx(c,{children:s.vat===""?e.jsx(P,{size:"sm",style:{backgroundColor:"#ff4d4d",width:70,color:"white"},onClick:()=>E(s.id,s.vat),children:"Insert "}):e.jsx(P,{size:"sm",style:{backgroundColor:"#ff4d4d",width:70,color:"white"},onClick:()=>E(s.id,s.vat),children:"Edit "})})]},t)})})]}),e.jsxs(se,{"aria-label":"Page navigation example",children:[e.jsx(k,{disabled:b<=0,onClick:Y,children:"Previous"}),G(),e.jsx(k,{disabled:Q===!0,onClick:U,children:"Next"})]}),e.jsxs(te,{alignment:"center",visible:T,scrollable:!0,size:"sm",onClose:()=>m(!1),children:[e.jsx(ae,{closeButton:!0,children:e.jsx(oe,{children:"Confirmation"})}),e.jsxs(re,{children:[e.jsx("a",{children:"Enter Picker's VAT id here"}),e.jsx("br",{}),e.jsx(B,{type:"text",placeholder:"Vat id",value:A,onChange:s=>V(s.target.value)})]}),e.jsx(le,{children:e.jsx(P,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>_(),children:"Save changes"})})]})]})};export{Ce as default};
