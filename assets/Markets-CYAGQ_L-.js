import{r as o,_ as fe,u as pe,R as r,a as H,P as d,c as P,y as ge,l as Ce,A as c,j as a,L as ke,h as be,m as xe}from"./index-DMn7TfLK.js";import{a as T}from"./axios-Cm0UX6qg.js";import{B as L}from"./config-HOLfLxHr.js";import{b as ye,a as U}from"./CContainer-C-FJ-9CV.js";import{C as ve,a as te,b as se,c as le,d as w}from"./DefaultLayout-BP76b2zU.js";import{C as je}from"./CNavbar-BHAXnYql.js";import{C as Ee,a as Me,b as re,c as g,d as De,e as C}from"./CTable-ADTVBny_.js";import{a as ne,C as oe}from"./CFormLabel-D7TwMY3S.js";import{c as Se}from"./cil-trash-CBbKHhHb.js";import{C as Ne,a as W}from"./CPaginationItem-wmkx6O61.js";import{C as Ae,a as Pe,b as Te,c as Le}from"./CModalTitle-CuSuP-v1.js";var y=o.forwardRef(function(l,u){var n=l.className,i=l.button,O=l.feedback,F=l.feedbackInvalid,Y=l.feedbackValid,R=l.floatingLabel,B=l.tooltipFeedback,v=l.hitArea,h=l.id,f=l.indeterminate,j=l.inline,E=l.invalid,k=l.label,q=l.reverse,M=l.type,G=M===void 0?"checkbox":M,b=l.valid,z=fe(l,["className","button","feedback","feedbackInvalid","feedbackValid","floatingLabel","tooltipFeedback","hitArea","id","indeterminate","inline","invalid","label","reverse","type","valid"]),x=o.useRef(null),I=pe(u,x);o.useEffect(function(){x.current&&f&&(x.current.indeterminate=f)},[f,x.current]);var m=function(){return r.createElement("input",H({type:G,className:P(i?"btn-check":"form-check-input",{"is-invalid":E,"is-valid":b,"me-2":v}),id:h},z,{ref:I}))},D=function(){return r.createElement(ne,{describedby:z["aria-describedby"],feedback:O,feedbackInvalid:F,feedbackValid:Y,floatingLabel:R,invalid:E,tooltipFeedback:B,valid:b})},$=function(){var S;return r.createElement(oe,H({customClassName:P(i?P("btn",i.variant?"btn-".concat(i.variant,"-").concat(i.color):"btn-".concat(i.color),(S={},S["btn-".concat(i.size)]=i.size,S),"".concat(i.shape)):"form-check-label")},h&&{htmlFor:h}),k)},J=function(){return i?r.createElement(r.Fragment,null,r.createElement(m,null),k&&r.createElement($,null),r.createElement(D,null)):k?v?r.createElement(r.Fragment,null,r.createElement(m,null),r.createElement(oe,H({customClassName:P("form-check-label stretched-link",n)},h&&{htmlFor:h}),k),r.createElement(D,null)):r.createElement("div",{className:P("form-check",{"form-check-inline":j,"form-check-reverse":q,"is-invalid":E,"is-valid":b},n)},r.createElement(m,null),r.createElement($,null),r.createElement(D,null)):r.createElement(m,null)};return r.createElement(J,null)});y.propTypes=H({button:d.object,className:d.string,hitArea:d.oneOf(["full"]),id:d.string,indeterminate:d.bool,inline:d.bool,label:d.oneOfType([d.string,d.node]),reverse:d.bool,type:d.oneOf(["checkbox","radio"])},ne.propTypes);y.displayName="CFormCheck";const qe=()=>{const[{user:l,token:u},n]=ge(),[i,O]=o.useState([]),[F,Y]=o.useState([]),[R,B]=o.useState(""),[v,h]=o.useState(""),[f,j]=o.useState(0),[E,k]=o.useState("All Cities"),[q,M]=o.useState("All Chains");o.useState();const[G,b]=o.useState(!1),[z,x]=o.useState(!0);Ce();const[I,m]=o.useState(!1),[D,$]=o.useState(""),[J,S]=o.useState(0),[V,K]=o.useState(1);o.useEffect(()=>{u&&T.get(L+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${u}`}}).then(e=>{e.status===200?O(e.data):e.status===500&&n({type:c,payload:{status:!0,title:"Chain Loading error",message:e.data.message}})}).catch(e=>{console.error("Error: ",e)})},[]),o.useEffect(()=>{const e=setTimeout(()=>{n({type:c,payload:{status:!0,title:"Data Loading",message:"Data loading error: Timeout exceeded",color:"warning"}}),b(!1)},2e4);return l&&u&&N(0,e),()=>{clearTimeout(e)}},[R,v,l]);const N=(e,t)=>{b(!0),T.get(L+`assistant/market/locations/${e}?brand=${R}&city=${v}`,{headers:{Authorization:`Bearer ${u}`}}).then(s=>{s.status===200?(Y(s.data.data),S(s.data.count),b(!1),clearTimeout(t),s.data.data.length<20?(x(!0),console.log("ok")):s.data.data.length>19&&x(!1)):s.status===500&&n({type:c,payload:{status:!0,title:"Market Loading error",message:s.data.message}})}).catch(s=>{console.error("Error: ",s)})},ie=()=>{K(V+1);const e=f+20;j(e),N(e,!0)},ce=()=>{K(V-1);const e=f-20;console.log(e),j(e),N(e,!0)},X=(e,t)=>{e==="all"?(B(""),M("All Chains")):(B(e),M(t))},Q=e=>{e==="all"?(h(""),k("All Cities")):(h(e),k(e))},Z=(e,t,s)=>{console.log(e),console.log(F),s==="delivery"?(ee({market:e,service:s}),console.log("add delivery")):s==="pickup"&&(ee({market:e,service:s}),console.log("add pickup"))},_=(e,t,s)=>{s==="delivery"?(ae({market:e,service:s}),console.log("remove delivery")):s==="pickup"&&(ae({market:e,service:s}),console.log("remove pickup"))},ee=e=>{T.post(L+"assistant/markets/add/services",e,{headers:{Authorization:`Bearer ${u}`}}).then(t=>{t.status===200?console.log("Updated add service"):t.status===203?n({type:c,payload:{status:!0,title:"Market Updated error",message:t.data.message}}):t.status===204?n({type:c,payload:{status:!0,title:"Market Updated error",message:t.data.message}}):t.status===500&&n({type:c,payload:{status:!0,title:"Market Updated error",message:t.data.message}})}).catch(t=>{console.error("Error:",t)})},ae=e=>{T.post(L+"assistant/markets/remove/services",e,{headers:{Authorization:`Bearer ${u}`}}).then(t=>{t.status===200?console.log("Updated remove service"):t.status===203?n({type:c,payload:{status:!0,title:"Market remove error",message:t.data.message}}):t.status===204?n({type:c,payload:{status:!0,title:"Market remove error",message:t.data.message}}):t.status===500&&n({type:c,payload:{status:!0,title:"Market remove error",message:t.data.message}})}).catch(t=>{console.error("Error:",t)})},de=e=>{m(!I),$(e)},ue=e=>{console.log(e),T.delete(L+"market/"+e,{headers:{Authorization:`Bearer ${u}`}}).then(t=>{t.status===200?(n({type:c,payload:{status:!0,title:"Market Delete",message:"Market Remove Success",color:"success"}}),m(!1),N(0,!0),console.log("Remove Market")):t.status===404?n({type:c,payload:{status:!0,title:"Market remove error",message:t.data.message}}):t.status===500&&n({type:c,payload:{status:!0,title:"Market remove error",message:t.data.message}})}).catch(t=>{console.error("Error:",t)})},me=e=>{K(e);const t=(e-1)*20;j(t),N(t,!0)},he=()=>{const e=Math.ceil(J/20),t=[];for(let p=1;p<=e;p++)t.push(p);console.log(t,e);const s=Math.max(V-2,1),A=Math.min(s+4,e);return t.slice(s-1,A).map(p=>a.jsx(W,{active:V===p,onClick:()=>me(p),children:p},p))};return a.jsxs(ye,{children:[a.jsx(ke,{to:"/markets/addmarket",children:a.jsx(U,{style:{marginLeft:"0%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Add New Market"})}),a.jsx(ve,{style:{marginLeft:"39.5%"},color:"secondary",children:"Filter by"}),a.jsxs(te,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[a.jsx(se,{style:{color:"white"},children:E}),a.jsxs(le,{children:[a.jsx(w,{onClick:()=>Q("all"),children:"All"}),a.jsx(w,{onClick:()=>Q("Milano"),children:"Milano"}),a.jsx(w,{onClick:()=>Q("Napoli"),children:"Napoli"})]})]}),a.jsxs(te,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[a.jsx(se,{style:{color:"white"},children:q}),a.jsxs(le,{children:[a.jsx(w,{onClick:()=>X("all"),children:"All"}),i.map((e,t)=>a.jsx(w,{onClick:()=>X(e.id,e.name),children:e.name},t))]})]}),a.jsx(je,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),G?a.jsx(be,{}):a.jsxs(Ee,{children:[a.jsx(Me,{children:a.jsxs(re,{children:[a.jsx(g,{scope:"col",children:"#"}),a.jsx(g,{scope:"col",children:"Name"}),a.jsx(g,{scope:"col",children:"Address"}),a.jsx(g,{scope:"col",children:"City"}),a.jsx(g,{scope:"col",children:"Delivery"}),a.jsx(g,{scope:"col",children:"Pickup"}),a.jsx(g,{scope:"col",children:"Scraped"}),a.jsx(g,{scope:"col",children:"Remove"})]})}),a.jsx(De,{children:F.map((e,t)=>a.jsxs(re,{children:[a.jsx(C,{children:f+t+1}),a.jsx(C,{children:e.chain.name}),a.jsx(C,{children:e.address}),a.jsx(C,{children:e.city}),a.jsx(C,{children:e.services.includes("delivery")?a.jsx(y,{id:"flexCheckChecked",label:"",defaultChecked:!0,onChange:()=>_(e._id,!0,"delivery")}):a.jsx(y,{id:"flexCheckChecked",label:"",onChange:()=>Z(e._id,!0,"delivery")})}),a.jsx(C,{children:e.services.includes("pickup")?a.jsx(y,{id:"flexCheckChecked",label:"",defaultChecked:!0,onChange:()=>_(e._id,!0,"pickup")}):a.jsx(y,{id:"flexCheckChecked",label:"",onChange:()=>Z(e._id,!0,"pickup")})}),a.jsx(C,{children:e.scraped}),a.jsx(C,{children:a.jsx(U,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>de(e._id),children:a.jsx(xe,{icon:Se,size:"lg",style:{color:"white"}})})})]},t))})]}),a.jsxs(Ne,{"aria-label":"Page navigation example",children:[a.jsx(W,{disabled:f<=0,onClick:ce,children:"Previous"}),he(),a.jsx(W,{disabled:z===!0,onClick:ie,children:"Next"})]}),a.jsxs(Ae,{alignment:"center",visible:I,scrollable:!0,size:"sm",onClose:()=>m(!1),children:[a.jsx(Pe,{closeButton:!1,children:a.jsx(Te,{children:"Confirmation"})}),a.jsxs(Le,{children:[a.jsx("a",{children:"Are you sure you want to delete this market?"}),a.jsx("br",{}),a.jsx("br",{}),a.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[a.jsx(U,{onClick:()=>ue(D),style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),a.jsx(U,{onClick:()=>m(!1),style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]})]})};export{qe as default};
