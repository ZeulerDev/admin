import{r as t,x as De,l as Me,z as d,j as a,i as K}from"./index-B2mJY6nk.js";import{a as p}from"./axios-B4uVmeYG.js";import{b as Se,a as x}from"./CContainer-HxaQKhHw.js";import{C as be}from"./CNavbar-C6aw6t1r.js";import{C,a as j,b as m,c as h,e as we}from"./DefaultLayout-CXJ534N4.js";import{C as O,a as Q,b as y,c as i,d as U,e as n}from"./CTable-D7t5m_Bv.js";import{C as Ae,a as Ge,b as ve,c as Ee}from"./CModalTitle-CJnjKzOP.js";import{C as Pe,a as W}from"./CPaginationItem-DTZe_mIK.js";import{C as ze}from"./CModalFooter-DI0RJn1I.js";const Fe=()=>{const[w,g]=t.useState(!1),[{user:f,token:r},c]=De(),[X,Y]=t.useState([]),[Z,A]=t.useState(!1),[G,v]=t.useState(""),[E,P]=t.useState(""),[z,N]=t.useState("");t.useState(!1),t.useState(""),Me();const[ee,ae]=t.useState(!1),[se,B]=t.useState("All Cities"),[te,T]=t.useState("All Market Groups"),[oe,$]=t.useState("All Chains"),[le,re]=t.useState([]),[ie,ne]=t.useState([]),[L,k]=t.useState(""),[ce,D]=t.useState([]),[de,R]=t.useState("All Cities"),[I,_]=t.useState(""),[he,ue]=t.useState([]),[pe,H]=t.useState(!1),[ge,F]=t.useState(!0),[M,S]=t.useState(0);t.useEffect(()=>{fe(),xe()},[]);const fe=()=>{r&&p.get("http://localhost:8003/market/groups/dropdown/fetch",{headers:{Authorization:`Bearer ${r}`}}).then(e=>{e.status===200?re(e.data):e.status===500&&c({type:d,payload:{status:!0,title:"Market Group Loading error",message:e.data.message}})}).catch(e=>{console.error("Error: ",e)})},xe=()=>{r&&p.get("http://localhost:8003/assistant/market/chains/all",{headers:{Authorization:`Bearer ${r}`}}).then(e=>{e.status===200?(ne(e.data),ae(!1)):e.status===500&&c({type:d,payload:{status:!0,title:"Chain Loading error",message:e.data.message}})}).catch(e=>{console.error("Error: ",e)})};t.useEffect(()=>{Ce()},[G,E,z,ee]);const Ce=()=>{f&&r&&(A(!0),p.get(`http://localhost:8003/assistant/riders/:skip?city=${G}&group=${E}&chain=${z}`,{headers:{Authorization:`Bearer ${r}`}}).then(e=>{e.status===200?(Y(e.data),A(!1)):e.status===500&&c({type:d,payload:{status:!0,title:"Error",message:e.data.message,color:"warning"}})}).catch(e=>{console.error("Error:",e)}))},u=(e,s)=>{s==="view"?e==="all"?(v(""),B("All Cities")):(v(e),B(e)):s==="modal"&&(e==="all"?(_(""),R("All Cities")):(_(e),R(e)))},V=(e,s)=>{e==="all"?(P(""),T("All Market Groups")):(P(e),T(s))},q=(e,s)=>{e==="all"?(N(""),$("All Chains")):(N(e),$(s))},J=(e,s)=>{g(!w),console.log("group",e,"driver ID",s),k(s),D(e)};t.useEffect(()=>{f&&r&&b(0,!0)},[f,I]);const b=(e,s)=>{H(!0),p.get(`http://localhost:8003/market/groups/fetch/${e}?city=${I}`,{headers:{Authorization:`Bearer ${r}`}}).then(l=>{if(l.status===200)if(ue(l.data),H(!1),l.data.length<20?(F(!0),console.log("ok")):l.data.length>19&&F(!1),s){const o=e+l.data.length;S(o)}else{const o=e-l.data.length;e<0?S(0):S(o)}else l.status===500&&c({type:d,payload:{status:!0,title:"Makrket Group loading error",message:l.data.message}})}).catch(l=>{console.error("Error:",l)})},je=()=>{b(M,!0)},me=()=>{b(M,!1)},ye=(e,s)=>{if(console.log("driver id",e),console.log("group id",s),s&&e){const l={id:s,rider:e};r&&f&&r&&p.put("http://localhost:8003/assistant/groups/rider/assign",l,{headers:{Authorization:`Bearer ${r}`}}).then(o=>{o.status===200?(g(!1),k(""),D([]),console.log(o.data)):o.status===204?c({type:d,payload:{status:!0,title:"Group Assign error",message:o.data.message,color:"warning"}}):o.status===500&&c({type:d,payload:{status:!0,title:"Group Assign error",message:o.data.message,color:"warning"}})}).catch(o=>{console.error("Error:",o)})}else c({type:d,payload:{status:!0,title:"Error!",message:"Driver group assign error",color:"warning"}})},ke=(e,s)=>{if(s&&e){const l={id:s,rider:e};r&&f&&r&&p.put("http://localhost:8003/assistant/groups/rider/remove",l,{headers:{Authorization:`Bearer ${r}`}}).then(o=>{o.status===200?(g(!1),k(""),D([])):o.status===204?c({type:d,payload:{status:!0,title:"Group remove error",message:o.data.message,color:"warning"}}):o.status===500&&c({type:d,payload:{status:!0,title:"Group remove error",message:o.data.message,color:"warning"}})}).catch(o=>{console.error("Error:",o)})}else c({type:d,payload:{status:!0,title:"Error!",message:"Driver group assign error",color:"warning"}})};return a.jsxs(Se,{children:[a.jsxs(be,{className:"bg-body-tertiary",children:[a.jsxs(C,{style:{marginLeft:"43%",width:"10%",backgroundColor:"#ff4d4d"},children:[a.jsx(j,{children:se}),a.jsxs(m,{children:[a.jsx(h,{onClick:()=>u("all","view"),children:"All"}),a.jsx(h,{onClick:()=>u("Milan","view"),children:"Milan"}),a.jsx(h,{onClick:()=>u("Napoli","view"),children:"Napoli"})]})]}),a.jsxs(C,{style:{marginRight:"0%",width:"15%",backgroundColor:"#ff4d4d"},children:[a.jsx(j,{children:oe}),a.jsxs(m,{children:[a.jsx(h,{onClick:()=>q("all"),children:"All"}),ie.map((e,s)=>a.jsx(h,{onClick:()=>q(e.id,e.name),children:e.name},s))]})]}),a.jsxs(C,{style:{marginRight:"1%",width:"30%",backgroundColor:"#ff4d4d"},children:[a.jsx(j,{children:te}),a.jsxs(m,{children:[a.jsx(h,{onClick:()=>V("all"),children:"All"}),le.map((e,s)=>a.jsx(h,{onClick:()=>V(e._id,e.name),children:e.name},s))]})]})]}),Z?a.jsx(K,{}):a.jsxs(O,{children:[a.jsx(Q,{children:a.jsxs(y,{children:[a.jsx(i,{scope:"col",children:"First Name"}),a.jsx(i,{scope:"col",children:"Last Name"}),a.jsx(i,{scope:"col",children:"Email"}),a.jsx(i,{scope:"col",children:"Phone"}),a.jsx(i,{scope:"col",children:"Country"}),a.jsx(i,{scope:"col",children:"Employee ID"}),a.jsx(i,{scope:"col",children:"Language"}),a.jsx(i,{scope:"col",children:"Group"}),a.jsx(i,{scope:"col",children:"Status"})]})}),a.jsx(U,{children:X.map((e,s)=>a.jsxs(y,{children:[a.jsx(n,{children:e.name}),a.jsx(n,{children:e.surname}),a.jsx(n,{children:e.email}),a.jsx(n,{children:e.contact}),a.jsx(n,{children:e.country==="it"||e.country==="Italy"?"Italy":e.country}),a.jsx(n,{children:e.employeeId?e.employeeId:a.jsx(we,{color:"warning",children:"Not Provide"})}),a.jsx(n,{children:e.language==="en"?"English":e.language==="it"?"Italy":e.language==="es"?"Spanish":e.language}),a.jsx(n,{children:e.groups.map((l,o)=>a.jsx("div",{children:l.name},o))}),a.jsx(n,{children:e.groups.length>0?a.jsx(x,{size:"sm",onClick:()=>J(e.groups,e.id),style:{backgroundColor:"#ff4d4d",width:90},children:"Assign"}):a.jsx(x,{size:"sm",onClick:()=>J(e.groups,e.id),style:{backgroundColor:"#ff4d4d",width:90},children:"Add"})})]},s))})]}),a.jsxs(Ae,{alignment:"center",visible:w,scrollable:!0,size:"xl",onClose:()=>g(!1),children:[a.jsxs(Ge,{closeButton:!0,children:[a.jsx(ve,{children:"Confirmation"}),a.jsxs(C,{style:{marginLeft:0,width:"10%",backgroundColor:"#ff4d4d"},children:[a.jsx(j,{children:de}),a.jsxs(m,{children:[a.jsx(h,{onClick:()=>u("all","modal"),children:"All"}),a.jsx(h,{onClick:()=>u("Milano","modal"),children:"Milano"}),a.jsx(h,{onClick:()=>u("Napoli","modal"),children:"Napoli"})]})]})]}),a.jsxs(Ee,{children:[pe?a.jsx(K,{}):a.jsxs(O,{children:[a.jsx(Q,{children:a.jsxs(y,{children:[a.jsx(i,{scope:"col",children:"Name"}),a.jsx(i,{scope:"col",children:"City"}),a.jsx(i,{scope:"col",children:"Location"})]})}),a.jsx(U,{children:he.map((e,s)=>a.jsxs(y,{children:[a.jsx(i,{scope:"row",children:e.name}),a.jsx(n,{children:e.city}),a.jsx(n,{children:ce.map(l=>l.id).includes(e._id)?a.jsx(x,{size:"sm",onClick:()=>ke(L,e._id),style:{backgroundColor:"#ff4d4d",width:90},children:"Remove"}):a.jsx(x,{size:"sm",onClick:()=>ye(L,e._id),style:{backgroundColor:"#ff4d4d",width:90},children:"Add"})})]},s))})]}),a.jsxs(Pe,{"aria-label":"Page navigation example",children:[a.jsx(W,{disabled:M<=20,onClick:me,children:"Previous"}),a.jsx(W,{disabled:ge===!0,onClick:je,children:"Next"})]})]}),a.jsx(ze,{children:a.jsx(x,{color:"secondary",onClick:()=>g(!1),children:"Close"})})]})]})};export{Fe as default};
