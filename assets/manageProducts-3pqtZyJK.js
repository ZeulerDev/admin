import{B as ss,r as o,y as ts,A as c,j as e,h as le,L as as,m as ce}from"./index-C7xebdlB.js";import{B as m}from"./config-HOLfLxHr.js";import{a as x}from"./axios-Cm0UX6qg.js";/* empty css               */import{b as os,a as f}from"./CContainer-DmyDJSbi.js";import{C as de}from"./CNavbar-DAGRjB36.js";import{C as A}from"./CFormInput-BJT20qYv.js";import{C as ne,a as ie,b as v,c as d,d as ue,e as n}from"./CTable-bhvJ0O4o.js";import{C as pe}from"./CCardImage-Ca25NGao.js";import{c as rs}from"./cil-pencil-m516yCOw.js";import{c as ls}from"./cil-trash-CBbKHhHb.js";import{C as he,a as P}from"./CPaginationItem-BwX0sL4W.js";import{C as V,a as _,b as U,c as Q}from"./CModalTitle-DqlcJFLS.js";import{C as cs,a as ds,b as ns,c as is,d as ge}from"./DefaultLayout-jQufvVlr.js";import{C as H}from"./CModalFooter-DExbXLa3.js";import"./CFormLabel-Dfa51LwS.js";const ws=()=>{const{id:p}=ss();o.useState([]);const[me,j]=o.useState(!1),[{user:h,token:u},l]=ts(),[xe,k]=o.useState(!1),[fe,O]=o.useState(!1);o.useState("All Cities");const[je,q]=o.useState("All Markets");o.useState(""),o.useState(""),o.useState(""),o.useState("All Cities"),o.useState(""),o.useState("All Chains"),o.useState([]),o.useState([]),o.useState([]);const[ye,Pe]=o.useState([{_id:"",name:""}]),[Ce,G]=o.useState(!0),[w,I]=o.useState(0),[ke,be]=o.useState(0),[b,N]=o.useState(1),[Se,Me]=o.useState(0),[S,B]=o.useState(1),[Ae,J]=o.useState(!0),[C,D]=o.useState(0),[K,W]=o.useState([]),[ve,we]=o.useState([]),[Ie,Ne]=o.useState([]),[M,X]=o.useState(""),[T,Be]=o.useState(""),[z,Y]=o.useState(""),[De,Z]=o.useState(!1),[Te,E]=o.useState(!1),[ze,ee]=o.useState(""),[$,se]=o.useState(""),[Ee,te]=o.useState(""),[$e,F]=o.useState(!1),[L,ae]=o.useState(""),[us,Fe]=o.useState("");o.useEffect(()=>{console.log("id",p),g(p,0)},[T]);const g=(s,t)=>{s?(console.log("id",s),h&&u?(j(!0),x.get(m+`promotion/products/${t}?promotionId=${s}&name=${T}`,{headers:{Authorization:`Bearer ${u}`}}).then(a=>{a.status===200?(console.log("products",a.data.list),W(a.data.list),be(a.data.count),Ne(a.data.list.map(r=>r.productId)),j(!1),a.data.list.length<50?(G(!0),console.log("ok")):a.data.list.length>49&&G(!1)):a.status===203?(console.log("products 203"),j(!1),l({type:c,payload:{status:!0,title:" Products loading error",message:a.data.message}})):a.status===204?(console.log("products 204"),j(!1),l({type:c,payload:{status:!0,title:" Products loading error",message:"No products found",color:"info"}})):a.status===500&&(console.log("products 500"),j(!1),l({type:c,payload:{status:!0,title:" Products loading error",message:a.data.message}}))})):(console.log("products non"),j(!1))):l({type:c,payload:{status:!0,title:" markets loading error",message:"No id found"}})},Le=()=>{k(!0)},Re=(s,t)=>{if(console.log("promotionId",s,"pId",t),t&&s){const a={productId:t};u&&h&&u&&x.patch(m+"promotion/add/product/"+s,a,{headers:{Authorization:`Bearer ${u}`}}).then(r=>{r.status===200?(k(!1),g(s),l({type:c,payload:{status:!0,title:"Product Assign",message:"successfully Product assigned to the promotion",color:"success"}})):r.status===400?l({type:c,payload:{status:!0,title:"Product Assign error",message:r.data.message,color:"warning"}}):r.status===404?l({type:c,payload:{status:!0,title:"Product Assign error",message:r.data.message,color:"warning"}}):r.status===500&&l({type:c,payload:{status:!0,title:"Product Assign error",message:r.data.message,color:"warning"}})}).catch(r=>{console.error("Error:",r)})}else l({type:c,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},oe=(s,t)=>{if(console.log("promotionId",s,"pid",t),t&&s){const a={productId:t};u&&h&&u&&x.patch(m+"promotion/remove/product/"+s,a,{headers:{Authorization:`Bearer ${u}`}}).then(r=>{r.status===200?(g(s),k(!1),l({type:c,payload:{status:!0,title:"Market Assign",message:"successfully Market removed from the promotion",color:"success"}})):r.status===204?l({type:c,payload:{status:!0,title:"Market remove error",message:r.data.message,color:"warning"}}):r.status===500&&l({type:c,payload:{status:!0,title:"Market remove error",message:r.data.message,color:"warning"}})}).catch(r=>{console.error("Error:",r)})}else l({type:c,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},Ve=()=>{N(b+1);const s=w+50;I(s),g(p,s)},_e=()=>{N(b-1);const s=w-50;console.log(s),I(s),g(p,s)},Ue=s=>{N(s);const t=(s-1)*50;I(t),g(p,t)},Qe=()=>{const s=Math.ceil(ke/50),t=[];for(let i=1;i<=s;i++)t.push(i);const a=Math.max(b-2,1),r=Math.min(a+4,s);return t.slice(a-1,r).map(i=>e.jsx(P,{active:b===i,onClick:()=>Ue(i),children:i},i))},He=s=>{s?(console.log("id",s),h&&u?x.get(m+"promotion/all/markets/"+s,{headers:{Authorization:`Bearer ${u}`}}).then(t=>{t.status===200?(console.log("market",t.data.market),Pe(t.data.market.map(a=>({_id:a._id,name:a.address})))):t.status===203?l({type:c,payload:{status:!0,title:" markets loading error",message:t.data.message}}):t.status===500&&l({type:c,payload:{status:!0,title:" markets loading error",message:t.data.message}})}):l({type:c,payload:{status:!0,title:" markets loading error",message:"No user or token found"}})):l({type:c,payload:{status:!0,title:" markets loading error",message:"No id found"}})},re=(s,t)=>{t==="all"?(X(""),q("All Markets"),y(0,"",p),console.log("all")):(console.log("selected",s),X(s),q(t),y(0,s,p))};o.useEffect(()=>{De&&y(0,M,p)},[z]);const y=(s,t,a)=>{h&&u?(O(!0),x.get(m+`promotion/all/markets/products/${s}?marketId=${t}&promoId=${a}&name=${z}`,{headers:{Authorization:`Bearer ${u}`}}).then(r=>{r.status===200?(we(r.data.list),Me(r.data.count),O(!1),Z(!0),r.data.list.length<20?(J(!0),console.log("ok")):r.data.list.length>19&&J(!1)):r.status===203?l({type:c,payload:{status:!0,title:" Products loading error",message:r.data.message}}):r.status===500&&l({type:c,payload:{status:!0,title:" Products loading error",message:r.data.message}})})):l({type:c,payload:{status:!0,title:" Products loading error",message:"No user or token found"}})},Oe=()=>{B(S+1);const s=C+50;D(s),y(s,M,p)},qe=()=>{B(S-1);const s=C-50;console.log(s),D(s),y(s,M,p)},Ge=s=>{B(s);const t=(s-1)*50;D(t),loadData(t,!0)},Je=()=>{const s=Math.ceil(Se/50),t=[];for(let i=1;i<=s;i++)t.push(i);const a=Math.max(S-2,1),r=Math.min(a+4,s);return t.slice(a-1,r).map(i=>e.jsx(P,{active:S===i,onClick:()=>Ge(i),children:i},i))},Ke=(s,t)=>{E(!0),ee(s),te(t)},We=()=>{console.log("called"),$==""?l({type:c,payload:{status:!0,title:"Alert",message:"Please enter the promotion price",color:"warning"}}):Xe(ze)},Xe=s=>{if(console.log("product Id",s),s){const t={value:$};console.log("formData",t),u&&h&&u&&x.patch(m+"promotion/update/promo/value/"+s,t,{headers:{Authorization:`Bearer ${u}`}}).then(a=>{if(a.status===200){l({type:c,payload:{status:!0,title:"Product Details Update",message:"Product promotion price update Success",color:"success"}}),ee(""),se(""),E(!1),te("");const r=a.data,R=K.map(i=>(i.productId===r.productId&&(i.promo_value=r.promo_value),i));W([...R])}else a.status===400?l({type:c,payload:{status:!0,title:"Product update error",message:a.data.message,color:"warning"}}):a.status===404?l({type:c,payload:{status:!0,title:"Product update error",message:a.data.message,color:"warning"}}):a.status===500&&l({type:c,payload:{status:!0,title:"Product update error",message:a.data.message,color:"warning"}})}).catch(a=>{console.error("Error:",a)})}else l({type:c,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},Ye=()=>{F(!0)},Ze=()=>{console.log("called"),L==""?l({type:c,payload:{status:!0,title:"Alert",message:"Please enter the promotion price",color:"warning"}}):es(p)},es=s=>{if(console.log("promotion Id",s),s){const t={value:L};console.log("formData",t),u&&h&&u&&x.patch(m+"promotion/update/promo/all/value/"+s,t,{headers:{Authorization:`Bearer ${u}`}}).then(a=>{a.status===200?(l({type:c,payload:{status:!0,title:"Product Details Update",message:"Product promotion price update Success",color:"success"}}),ae(""),F(!1),Fe(""),g(s,0)):a.status===400?l({type:c,payload:{status:!0,title:"Product update error",message:a.data.message,color:"warning"}}):a.status===404?l({type:c,payload:{status:!0,title:"Product update error",message:a.data.message,color:"warning"}}):a.status===500&&l({type:c,payload:{status:!0,title:"Product update error",message:a.data.message,color:"warning"}})}).catch(a=>{console.error("Error:",a)})}else l({type:c,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})};return e.jsxs(os,{children:[e.jsx(f,{onClick:()=>{Le(),He(p),y(0,M,p)},style:{marginLeft:"0%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Add Products"}),e.jsxs(de,{style:{justifyContent:"flex-start"},className:"bg-body-tertiary",children:[e.jsx(A,{type:"text",placeholder:"Search products by name",style:{width:450,marginRight:"0%"},value:T,onChange:s=>Be(s.target.value)}),e.jsx(f,{onClick:()=>{Ye()},style:{marginLeft:"44%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Apply All"})]}),me?e.jsx(le,{}):e.jsxs(ne,{children:[e.jsx(ie,{children:e.jsxs(v,{children:[e.jsx(d,{scope:"col",children:"#"}),e.jsx(d,{scope:"col",children:"Product Id"}),e.jsx(d,{scope:"col",children:"Photo"}),e.jsx(d,{scope:"col",children:"Name"}),e.jsx(d,{scope:"col",children:"Base Price"}),e.jsx(d,{scope:"col",children:"Tax"}),e.jsx(d,{scope:"col",children:"Markup Percentage "}),e.jsx(d,{scope:"col",children:"Markup"}),e.jsx(d,{scope:"col",children:"Total"}),e.jsx(d,{scope:"col",children:"Promotion Value"}),e.jsx(d,{scope:"col",children:"Brand"}),e.jsx(d,{scope:"col",children:"Chain"}),e.jsx(d,{scope:"col",children:"Market Address"}),e.jsx(d,{scope:"col",children:"Remove"})]})}),e.jsx(ue,{children:K.map((s,t)=>e.jsxs(v,{children:[e.jsx(n,{children:C+t+1}),e.jsx(n,{children:s.pid}),e.jsx(d,{onClick:()=>{},children:e.jsx(pe,{style:{width:"50px",height:"50px"},src:"https://api.zeuler.com/image/"+s.image})}),e.jsx(n,{children:s.name}),e.jsx(n,{children:s.price.basePrice.toFixed(2)}),e.jsx(n,{children:s.price.tax.toFixed(2)}),e.jsxs(n,{children:[s.price.percentage,"%"]}),e.jsx(n,{children:s.price.markup.toFixed(2)}),e.jsx(n,{children:s.price.total.toFixed(2)}),e.jsxs(n,{children:[s.promo_value," €",e.jsx(as,{to:"",children:e.jsx(ce,{icon:rs,size:"sm",onClick:()=>Ke(s.productId,s.promo_value)})})]}),e.jsx(n,{children:s.brand}),e.jsx(n,{children:s.chainName}),e.jsx(n,{children:s.marketAddress}),e.jsx(n,{children:e.jsx(f,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>{oe(p,s.productId)},children:e.jsx(ce,{icon:ls,size:"lg",style:{color:"white"}})})})]},t))})]}),e.jsxs(he,{"aria-label":"Page navigation example",children:[e.jsx(P,{disabled:w<=0,onClick:_e,children:"Previous"}),Qe(),e.jsx(P,{disabled:Ce===!0,onClick:Ve,children:"Next"})]}),e.jsxs(V,{visible:xe,scrollable:!0,size:"xl",onClose:()=>{Z(!1),k(!1),Y("")},children:[e.jsx(_,{closeButton:!0,children:e.jsx(U,{children:"Products assign view"})}),e.jsxs(Q,{children:[e.jsx(cs,{style:{marginLeft:"64%"},color:"secondary",children:"Filter by"}),e.jsxs(ds,{style:{marginLeft:"2%",width:"28%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(ns,{style:{color:"white"},children:je}),e.jsxs(is,{children:[e.jsx(ge,{onClick:()=>re(null,"all"),children:"All"}),ye.map((s,t)=>e.jsx(ge,{onClick:()=>re(s._id,s.name),children:s.name},t))]})]}),e.jsx(de,{style:{marginTop:"1%"},className:"bg-body-tertiary",children:e.jsx(A,{type:"text",placeholder:"Search products by name",style:{width:450,marginRight:"60%"},value:z,onChange:s=>Y(s.target.value)})}),fe?e.jsx(le,{}):e.jsxs(ne,{children:[e.jsx(ie,{children:e.jsxs(v,{children:[e.jsx(d,{scope:"col",children:"#"}),e.jsx(d,{scope:"col",children:"Product Id"}),e.jsx(d,{scope:"col",children:"Photo"}),e.jsx(d,{scope:"col",children:"Name"}),e.jsx(d,{scope:"col",children:"Base Price"}),e.jsx(d,{scope:"col",children:"Tax"}),e.jsx(d,{scope:"col",children:"Markup Percentage "}),e.jsx(d,{scope:"col",children:"Markup"}),e.jsx(d,{scope:"col",children:"Total"}),e.jsx(d,{scope:"col",children:"Brand"}),e.jsx(d,{scope:"col",children:"Chain"}),e.jsx(d,{scope:"col",children:"Market Address"}),e.jsx(d,{scope:"col",children:"Action"})]})}),e.jsx(ue,{children:ve.map((s,t)=>e.jsxs(v,{children:[e.jsx(n,{children:C+t+1}),e.jsx(n,{children:s.pid}),e.jsx(d,{children:e.jsx(pe,{style:{width:"50px",height:"50px"},src:"https://api.zeuler.com/image/"+s.image})}),e.jsx(n,{children:s.name}),e.jsx(n,{children:s.price.basePrice.toFixed(2)}),e.jsx(n,{children:s.price.tax.toFixed(2)}),e.jsxs(n,{children:[s.price.percentage,"%"]}),e.jsx(n,{children:s.price.markup.toFixed(2)}),e.jsx(n,{children:s.price.total.toFixed(2)}),e.jsx(n,{children:s.brand}),e.jsx(n,{children:s.chainName}),e.jsx(n,{children:s.marketAddress}),e.jsx(n,{children:Ie.includes(s.productId)?e.jsx(f,{size:"sm",onClick:()=>{oe(p,s.productId)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Remove"}):e.jsx(f,{size:"sm",onClick:()=>{Re(p,s.productId)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Add"})})]},t))})]}),e.jsx(H,{children:e.jsxs(he,{"aria-label":"Page navigation example",children:[e.jsx(P,{disabled:C<=0,onClick:qe,children:"Previous"}),Je(),e.jsx(P,{disabled:Ae===!0,onClick:Oe,children:"Next"})]})})]})]}),e.jsxs(V,{alignment:"center",visible:Te,scrollable:!0,size:"sm",onClose:()=>E(!1),children:[e.jsx(_,{closeButton:!0,children:e.jsx(U,{children:"Change Promotion Value"})}),e.jsxs(Q,{children:[e.jsx("a",{children:"Add Promotion Value"}),e.jsx("br",{}),e.jsx(A,{type:"text",placeholder:Ee,value:$,onChange:s=>se(s.target.value)})]}),e.jsx(H,{children:e.jsx(f,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>We(),children:"Save changes"})})]}),e.jsxs(V,{alignment:"center",visible:$e,scrollable:!0,size:"sm",onClose:()=>F(!1),children:[e.jsx(_,{closeButton:!0,children:e.jsx(U,{children:"Add promotion value to all products"})}),e.jsxs(Q,{children:[e.jsx("a",{children:"Add Promotion Value"}),e.jsx("br",{}),e.jsx(A,{type:"text",value:L,onChange:s=>ae(s.target.value)})]}),e.jsx(H,{children:e.jsx(f,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>Ze(),children:"Save changes"})})]})]})};export{ws as default};
