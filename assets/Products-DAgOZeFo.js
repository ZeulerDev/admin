import{y as Ue,r as l,A as r,j as a,h as Ne,L as ve,m as Be}from"./index-Ce9Pt6aD.js";import{a as g}from"./axios-Cm0UX6qg.js";import{B as U}from"./config-HOLfLxHr.js";import{b as Ee,a as O}from"./CContainer-qKAPghSJ.js";import{C as Le,a as q,b as G,c as J,d as j}from"./DefaultLayout-BetbveVL.js";import{C as Te}from"./CNavbar-DmMCgjcW.js";import{C as K}from"./CFormInput-0qZe6T22.js";import{C as $e,a as ze,b as W,c,d as Re,e as u}from"./CTable-BZo_5Coh.js";import{C as X}from"./CCardImage-Csj39-lW.js";import{c as Fe}from"./cil-pencil-m516yCOw.js";import{C as He,a as N}from"./CPaginationItem-BfnXBS27.js";import{C as Y,a as Z,b as ee,c as ae}from"./CModalTitle-CaRaI3h5.js";import{C as te}from"./CModalFooter-CZ-XH9Eo.js";import"./CFormLabel-DhxNcKpC.js";const la=()=>{const[{user:m,token:n},o]=Ue(),[se,h]=l.useState(!1),[le,oe]=l.useState([]),[x,y]=l.useState(0),[re,f]=l.useState(!0),[ne,ce]=l.useState([]),[de,b]=l.useState("All Chains"),[P,v]=l.useState("All market"),[Ve,k]=l.useState(""),[B,E]=l.useState(""),[ie,L]=l.useState([]),[S,ue]=l.useState(""),[he,I]=l.useState(!1),[pe,T]=l.useState(""),[D,$]=l.useState(""),[ge,z]=l.useState(""),[me,xe]=l.useState(0),[C,M]=l.useState(1);l.useState("NAME");const[R,A]=l.useState(!1),[fe,F]=l.useState("");l.useEffect(()=>{m&&n&&p(0)},[m,n,B,S]),l.useEffect(()=>{n&&g.get("http://localhost:8003/assistant/market/chains/all",{headers:{Authorization:`Bearer ${n}`}}).then(e=>{e.status===200?ce(e.data):e.status===500&&o({type:r,payload:{status:!0,title:"Chain Loading error",message:e.data.message}})}).catch(e=>{console.error("Error: ",e)})},[]);const Ce=e=>{g.get(`http://localhost:8003/assistant/market/locations?brand=${e}`,{headers:{Authorization:`Bearer ${n}`}}).then(t=>{t.status===200?(L(t.data.data),t.data.data.length<20?(f(!0),console.log("ok")):t.data.data.length>19&&f(!1)):t.status===500&&o({type:r,payload:{status:!0,title:"Market Loading error",message:t.data.message}})}).catch(t=>{console.error("Error: ",t)})},p=(e,t)=>{h(!0),g.get(U+`product/all/${e}?marketId=${B}&name=${S}`,{headers:{Authorization:`Bearer ${n}`}}).then(s=>{s.status===200?(oe(s.data.list),xe(s.data.count),h(!1),s.data.list.length<20?(f(!0),console.log("ok")):s.data.list.length>19&&f(!1)):s.status===203?(h(!1),o({type:r,payload:{status:!0,title:"product loading error error",message:s.data.message}})):s.status===204?(h(!1),o({type:r,payload:{status:!0,title:"No Products",message:"No products found in this market address",color:"info"}})):s.status===500&&(h(!1),o({type:r,payload:{status:!0,title:"product loading error error",message:s.data.message}}))}).catch(s=>{h(!1),console.error("Error:",s)})},H=(e,t)=>{e==="all"?(k(""),b("All Chains")):(k(e),Ce(e),b(t))},V=(e,t)=>{e==="all"?(E(""),v("All Markets"),k(""),b("All Chains"),L([])):(E(e),v(t))},je=()=>{M(C+1);const e=x+50;y(e),p(e)},ye=()=>{M(C-1);const e=x-50;console.log(e),y(e),p(e)},be=(e,t)=>{I(!0),T(e),z(t)},Pe=()=>{console.log("called"),D==""?o({type:r,payload:{status:!0,title:"Alert",message:"Please enter the price",color:"warning"}}):Ie(pe)},ke=e=>{M(e);const t=(e-1)*50;y(t),p(t)},Se=()=>{const e=Math.ceil(me/50),t=[];for(let i=1;i<=e;i++)t.push(i);const s=Math.max(C-2,1),d=Math.min(s+4,e);return t.slice(s-1,d).map(i=>a.jsx(N,{active:C===i,onClick:()=>ke(i),children:i},i))},Ie=e=>{if(e){let t={price:D+" â‚¬"};m&&n&&g.put(U+"product/update/price/"+e,t,{headers:{Authorization:`Bearer ${n}`}}).then(s=>{s.status===200?(o({type:r,payload:{status:!0,title:"Product Details Update",message:"Product price update Success",color:"success"}}),T(""),$(""),p(0),I(!1),z("")):s.status===204?o({type:r,payload:{status:!0,title:"Product Details Update error",message:s.data.message,color:"danger"}}):s.status===500&&o({type:r,payload:{status:!0,title:"Product Details Update error",message:s.data.message,color:"danger"}})}).catch(s=>{console.error("Error:",s)})}else alert("Please Check the Fields!")},De=e=>{A(!R),F(e)},[Me,w]=l.useState(null),[_,Q]=l.useState(null),Ae=e=>{console.log(e),Q(URL.createObjectURL(e)),w(e)},we=async(e,t)=>{if(console.log(e,t),m&&n){const s=new FormData;s.append("image",t),s.append("id",e),g.post(U+"test/product/image/update",s,{headers:{Authorization:`Bearer ${n}`}}).then(d=>{d.status===200?(A(!1),F(""),w(null),console.log("response",d.data),o({type:r,payload:{status:!0,title:"Image upload ",message:"Image upload success",color:"success"}}),p(0)):d.status===500&&o({type:r,payload:{status:!0,title:"Image upload error",message:d.data.message,color:"danger"}})}).catch(d=>{console.error("Error:",d)})}};return a.jsxs(Ee,{children:[a.jsx(Le,{style:{marginLeft:"57%"},color:"secondary",children:"Filter by"}),a.jsxs(q,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[a.jsx(G,{children:de}),a.jsxs(J,{children:[a.jsx(j,{onClick:()=>H("all"),children:"All"}),ne.map((e,t)=>a.jsx(j,{onClick:()=>H(e.id,e.name),children:e.name},t))]})]}),a.jsxs(q,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[a.jsx(G,{children:P.length>15?`${P.substring(0,15)}...`:P}),a.jsxs(J,{children:[a.jsx(j,{onClick:()=>V("all"),children:"Select the Chain"}),ie.map((e,t)=>a.jsx(j,{onClick:()=>V(e._id,e.address),children:a.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[a.jsx("span",{children:e.address.substring(0,e.address.length/2)}),a.jsx("span",{children:e.address.substring(e.address.length/2)})]})},t))]})]}),a.jsx(Te,{style:{marginTop:"1%"},className:"bg-body-tertiary",children:a.jsx(K,{type:"text",placeholder:"Search products by name, brand name and product id",style:{width:450,marginRight:"60%"},value:S,onChange:e=>ue(e.target.value)})}),se?a.jsx(Ne,{}):a.jsxs($e,{children:[a.jsx(ze,{children:a.jsxs(W,{children:[a.jsx(c,{scope:"col",children:"#"}),a.jsx(c,{scope:"col",children:"Product Id"}),a.jsx(c,{scope:"col",children:"Photo"}),a.jsx(c,{scope:"col",children:"Name"}),a.jsx(c,{scope:"col",children:"Price"}),a.jsx(c,{scope:"col",children:"Brand"}),a.jsx(c,{scope:"col",children:"Chain"}),a.jsx(c,{scope:"col",children:"Market Address"})]})}),a.jsx(Re,{children:le.map((e,t)=>a.jsxs(W,{children:[a.jsx(u,{children:x+t+1}),a.jsx(u,{children:e.pid}),a.jsx(c,{onClick:()=>{De(e.productId)},children:a.jsx(X,{style:{width:"50px",height:"50px"},src:"https://api.zeuler.com/image/"+e.image})}),a.jsx(u,{children:e.name}),a.jsxs(u,{children:[e.price,a.jsx(ve,{to:"",children:a.jsx(Be,{icon:Fe,size:"sm",onClick:()=>be(e.productId,e.price)})})]}),a.jsx(u,{children:e.brand}),a.jsx(u,{children:e.chainName}),a.jsx(u,{children:e.marketAddress})]},t))})]}),a.jsxs(He,{"aria-label":"Page navigation example",children:[a.jsx(N,{disabled:x<=0,onClick:ye,children:"Previous"}),Se(),a.jsx(N,{disabled:re===!0,onClick:je,children:"Next"})]}),a.jsxs(Y,{alignment:"center",visible:he,scrollable:!0,size:"sm",onClose:()=>I(!1),children:[a.jsx(Z,{closeButton:!0,children:a.jsx(ee,{children:"Change Price"})}),a.jsxs(ae,{children:[a.jsx("a",{children:"Enter New Price"}),a.jsx("br",{}),a.jsx(K,{type:"text",placeholder:ge,value:D,onChange:e=>$(e.target.value)})]}),a.jsx(te,{children:a.jsx(O,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>Pe(),children:"Save changes"})})]}),a.jsxs(Y,{alignment:"center",visible:R,scrollable:!0,size:"lg",onClose:()=>{A(!1),w(null),Q(null)},children:[a.jsx(Z,{closeButton:!0,children:a.jsx(ee,{children:"Image Uploader"})}),a.jsxs(ae,{children:[_&&a.jsx(X,{style:{width:"100px",height:"100px"},src:_,alt:"Uploaded Image"}),a.jsx("input",{style:{marginLeft:"5%"},type:"file",accept:".jpg, .jpeg, .png",onChange:e=>Ae(e.target.files[0])})]}),a.jsx(te,{children:a.jsx(O,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>{we(fe,Me)},children:"Upload Image"})})]})]})};export{la as default};
