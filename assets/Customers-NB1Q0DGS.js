import{r as o,y as es,l as ss,A as c,j as e,h as ge,L as G,m as Y}from"./index-DMn7TfLK.js";import{a as C}from"./axios-Cm0UX6qg.js";import{B as x}from"./config-HOLfLxHr.js";import{b as ts,a as q}from"./CContainer-C-FJ-9CV.js";import{C as as}from"./CNavbar-BHAXnYql.js";import{C as p}from"./CFormInput-BVc4Aq36.js";import{C as xe,a as je,b as N,c as l,d as fe,e as d}from"./CTable-ADTVBny_.js";import{C as Ce}from"./CCardImage-CafqthIp.js";import{c as os}from"./cil-pencil-m516yCOw.js";import{c as rs}from"./cil-info-CmGCY32x.js";import{C as ye,a as j}from"./CPaginationItem-wmkx6O61.js";import{C as E,a as M,b as T,c as U}from"./CModalTitle-CuSuP-v1.js";import{C as J}from"./CModalFooter-CBMlyI2g.js";import{C as h}from"./CCol-DeOn7CxI.js";import"./CFormLabel-D7TwMY3S.js";import"./DefaultLayout-BP76b2zU.js";var ls=["512 512","<rect width='288' height='32' x='112' y='152' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='288' height='32' x='112' y='240' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='152' height='32' x='112' y='328' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M480,48H32V464H480ZM448,432H64V80H448Z' class='ci-primary'/>"];const ws=()=>{const[K,W]=o.useState(!1),[{user:f,token:u},n]=es();ss();const[X,O]=o.useState([]),[Pe,be]=o.useState([]);o.useState(!1);const[we,ee]=o.useState(!1),[Se,B]=o.useState(!1),[y,D]=o.useState(0),[se,P]=o.useState(!1),[m,Ie]=o.useState([]),[te,ae]=o.useState(),[oe,re]=o.useState(),[le,ne]=o.useState(),[ce,de]=o.useState(),[z,ve]=o.useState(""),[Ae,ie]=o.useState(!0),[ke,Ne]=o.useState(0),[b,L]=o.useState(1),[w,S]=o.useState(0),[I,v]=o.useState(1),[Ee,Me]=o.useState(0),[Te,R]=o.useState(!0),[V,H]=o.useState(""),[A,Ue]=o.useState(""),[_,Be]=o.useState(""),[De,$]=o.useState(!1),[ue,F]=o.useState(!1),[ze,he]=o.useState("");o.useEffect(()=>{const s=setTimeout(()=>{n({type:c,payload:{status:!0,title:"Data Loading",message:"Data loading error: Timeout exceeded",color:"warning"}}),B(!1)},2e4);return f&&u&&g(0,s),()=>{clearTimeout(s)}},[f,u,z]);const g=(s,a)=>{B(!0),C.get(x+"assistant/customers/"+s+"?email="+z,{headers:{Authorization:`Bearer ${u}`}}).then(t=>{t.status===200?(O(t.data.list),Ne(t.data.count),B(!1),clearTimeout(a),console.log(x),t.data.list.length<50?(ie(!0),console.log("ok")):t.data.list.length>49&&ie(!1)):t.status===500&&n({type:c,payload:{status:!0,title:"Customers loading error",message:t.data.message}})}).catch(t=>{console.error("Error:",t)})},Le=()=>{L(b+1);const s=y+50;D(s),g(s,!0)},Re=()=>{L(b-1);const s=y-50;console.log(s),D(s),g(s,!1)},Ve=()=>{v(I+1);const s=w+20;S(s),k(V,s)},He=()=>{v(I-1);const s=w-20;console.log(s),S(s),k(V,s)},_e=s=>{W(!K),H(s),k(s,0)},k=(s,a)=>{H(s),u&&(ee(!0),C.get(x+`assistant/addresses/customer/${a}/`+s,{headers:{Authorization:`Bearer ${u}`}}).then(t=>{t.status===200?(console.log(t.data.count),be(t.data.list),Me(t.data.count),t.data.list.length<20?(R(!0),console.log("ok")):t.data.list.length>19&&R(!1),ee(!1)):t.status===500&&n({type:c,payload:{status:!0,title:"Customers address error",message:t.data.message}})}).catch(t=>{console.error("Customers address:",t)}))},$e=s=>{console.log(s),P(!se),Ie(s),ae(s.name),re(s.surname),ne(s.email),de(s.contact)},Fe=()=>{if(te&&oe&&le&&ce){const s={name:te,surname:oe,email:le,contact:ce},a=m._id;console.log("id",a),u&&f&&u&&C.patch(x+"assistant/customers/update/"+a,s,{headers:{Authorization:`Bearer ${u}`}}).then(t=>{if(t.status===200){P(!1),g(0,!0);const i=t.data,Z=X.map(r=>r.id===i.id?i:r);O([...Z]),n({type:c,payload:{status:!0,title:"Customer update",message:"Customer updated successfully",color:"success"}})}else t.status===203?n({type:c,payload:{status:!0,title:"Customer update error",message:"203",color:"warning"}}):t.status===204?n({type:c,payload:{status:!0,title:"Customer update error",message:"204",color:"warning"}}):t.status===500&&n({type:c,payload:{status:!0,title:"Customer update error",message:"500",color:"warning"}})}).catch(t=>{console.error("Error:",t)})}else n({type:c,payload:{status:!0,title:"Error!",message:"Customer update error, Please Check the input fields",color:"warning"}})},Qe=s=>{L(s);const a=(s-1)*50;D(a),g(a,!0)},Ze=()=>{const s=Math.ceil(ke/50),a=[];for(let r=1;r<=s;r++)a.push(r);const t=Math.max(b-2,1),i=Math.min(t+4,s);return a.slice(t-1,i).map(r=>e.jsx(j,{active:b===r,onClick:()=>Qe(r),children:r},r))},Ge=s=>{v(s);const a=(s-1)*20;S(a),k(V,a)},Ye=()=>{const s=Math.ceil(Ee/20),a=[];for(let r=1;r<=s;r++)a.push(r);const t=Math.max(I-2,1),i=Math.min(t+4,s);return a.slice(t-1,i).map(r=>e.jsx(j,{active:I===r,onClick:()=>Ge(r),children:r},r))},qe=()=>{P(!1),$(!0)},Je=s=>{if(A===""||_==="")n({type:c,payload:{status:!0,title:"Password update error",message:"Check the input fields",color:"warning"}});else if(A===_){const a={password:A};console.log(a,s),f&&u&&C.patch(x+"assistant/customers/update/"+s,a,{headers:{Authorization:`Bearer ${u}`}}).then(t=>{t.status===200?($(!1),n({type:c,payload:{status:!0,title:"Password update",message:"Password updated successfully",color:"success"}}),setVisiblePicker(!0)):t.status===203?n({type:c,payload:{status:!0,title:"Password update error",message:t.data.message}}):t.status===204?n({type:c,payload:{status:!0,title:"Password update error",message:t.data.message}}):t.status===500&&n({type:c,payload:{status:!0,title:"Password update error",message:t.data.message}})}).catch(t=>{console.error(t)})}else n(A!==_?{type:c,payload:{status:!0,title:"Password update error",message:"Password does not match",color:"warning"}}:{type:c,payload:{status:!0,title:"Password update error",message:"Password update error or check the input fields",color:"warning"}})},Ke=s=>{F(!ue),he(s)},[We,Q]=o.useState(null),[pe,me]=o.useState(null),Xe=s=>{console.log(s),me(URL.createObjectURL(s)),Q(s)},Oe=async(s,a)=>{if(console.log(s,a),f&&u){const t=new FormData;t.append("image",a),t.append("id",s),C.post(x+"test/customer/image/update",t,{headers:{Authorization:`Bearer ${u}`}}).then(i=>{i.status===200?(F(!1),he(""),Q(null),console.log("response",i.data),n({type:c,payload:{status:!0,title:"Image upload ",message:"Image upload success",color:"success"}}),g(0,!0)):i.status===500&&n({type:c,payload:{status:!0,title:"Image upload error",message:i.data.message,color:"danger"}})}).catch(i=>{console.error("Error:",i)})}};return e.jsxs(ts,{children:[e.jsx(as,{className:"bg-body-tertiary",children:e.jsx(p,{type:"text",placeholder:"Search by customer email",style:{width:450,marginLeft:"0%"},value:z,onChange:s=>ve(s.target.value)})}),Se?e.jsx(ge,{}):e.jsxs(xe,{children:[e.jsx(je,{children:e.jsxs(N,{children:[e.jsx(l,{scope:"col",children:"#"}),e.jsx(l,{scope:"col",children:"Photo"}),e.jsx(l,{scope:"col",children:"Name"}),e.jsx(l,{scope:"col",children:"Surname"}),e.jsx(l,{scope:"col",children:"email"}),e.jsx(l,{scope:"col",children:"Contact"}),e.jsx(l,{scope:"col",children:"Country"}),e.jsx(l,{scope:"col",children:"Language"}),e.jsx(l,{scope:"col",children:"Edit"}),e.jsx(l,{scope:"col",children:"Address"}),e.jsx(l,{scope:"col",children:"Grocery"})]})}),e.jsx(fe,{children:X.map((s,a)=>e.jsxs(N,{children:[e.jsx(d,{children:y+a+1}),e.jsx(l,{onClick:()=>{Ke(s._id)},children:e.jsx(Ce,{style:{width:50,height:50,borderRadius:10},src:"https://api.zeuler.com/image/"+s.photo})}),e.jsx(d,{children:s.name}),e.jsx(d,{children:s.surname}),e.jsx(d,{children:s.email}),e.jsx(d,{children:s.contact}),e.jsx(d,{children:s.country==="it"||s.country==="Italy"?"Italy":s.country}),e.jsx(d,{children:s.language==="en"?"English":s.language==="it"?"Italy":s.language}),e.jsx(d,{children:e.jsx(G,{children:e.jsx(Y,{icon:os,size:"xl",onClick:()=>$e(s)})})}),e.jsx(d,{children:e.jsx(G,{children:e.jsx(Y,{icon:rs,size:"xl",onClick:()=>_e(s._id)})})}),e.jsx(d,{children:e.jsx(G,{to:`/customers/list/${s._id}`,children:e.jsx(Y,{icon:ls,size:"xl"})})})]},a))})]}),e.jsxs(ye,{"aria-label":"Page navigation example",children:[e.jsx(j,{disabled:y<=0,onClick:Re,children:"Previous"}),Ze(),e.jsx(j,{disabled:Ae===!0,onClick:Le,children:"Next"})]}),e.jsxs(E,{alignment:"center",visible:ue,scrollable:!0,size:"lg",onClose:()=>{F(!1),Q(null),me(null)},children:[e.jsx(M,{closeButton:!0,children:e.jsx(T,{children:"Image Uploader"})}),e.jsxs(U,{children:[pe&&e.jsx(Ce,{style:{width:"100px",height:"100px"},src:pe,alt:"Uploaded Image"}),e.jsx("input",{style:{marginLeft:"5%"},type:"file",accept:".jpg, .jpeg, .png",onChange:s=>Xe(s.target.files[0])})]}),e.jsx(J,{children:e.jsx(q,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>{Oe(ze,We)},children:"Upload Image"})})]}),e.jsxs(E,{alignment:"center",visible:De,scrollable:!0,size:"sm",onClose:()=>$(!1),children:[e.jsx(M,{closeButton:!0,children:e.jsx(T,{children:"Update Password"})}),e.jsxs(U,{children:[e.jsx(h,{md:12,children:e.jsx(p,{id:"password",label:"Enter New Password",type:"password",onChange:s=>Ue(s.target.value)})}),e.jsx("br",{}),e.jsx(h,{md:12,children:e.jsx(p,{id:"repassword",label:"Re Enter Password",type:"password",onChange:s=>Be(s.target.value)})})]}),e.jsx(J,{children:e.jsx(q,{type:"submit",style:{marginBottom:"3%",backgroundColor:"#ff4d4d",color:"white"},onClick:()=>{Je(m._id)},children:"Update"})})]}),e.jsxs(E,{visible:K,scrollable:!0,size:"xl",onClose:()=>{W(!1),S(0),v(1),R(!0),H("")},children:[e.jsx(M,{closeButton:!0,children:e.jsx(T,{children:"Used Addresses"})}),e.jsx(U,{style:{overflowY:"auto",maxHeight:"70vh",display:"flex",justifyContent:"center"},children:we?e.jsx(ge,{}):e.jsxs(xe,{children:[e.jsx(je,{children:e.jsxs(N,{children:[e.jsx(l,{scope:"col",children:"#"}),e.jsx(l,{scope:"col",children:"Name"}),e.jsx(l,{scope:"col",children:"Intercom"}),e.jsx(l,{scope:"col",children:"Flat"}),e.jsx(l,{scope:"col",children:"Street"}),e.jsx(l,{scope:"col",children:"House Number"})]})}),e.jsx(fe,{children:Pe.map((s,a)=>e.jsxs(N,{children:[e.jsx(d,{children:w+a+1}),e.jsx(d,{children:s.name}),e.jsx(d,{children:s.intercom}),e.jsx(d,{children:s.flat}),e.jsx(d,{children:s.street}),e.jsx(d,{children:s.houseNumber})]},a))})]})}),e.jsx(J,{children:e.jsxs(ye,{"aria-label":"Page navigation example",children:[e.jsx(j,{disabled:w<=0,onClick:He,children:"Previous"}),Ye(),e.jsx(j,{disabled:Te===!0,onClick:Ve,children:"Next"})]})})]}),e.jsxs(E,{visible:se,scrollable:!0,size:"lg",onClose:()=>P(!1),children:[e.jsx(M,{closeButton:!0,children:e.jsx(T,{children:"Edit Customer Information"})}),e.jsx(U,{children:e.jsxs("div",{className:"row g-3",children:[e.jsx(h,{md:6,children:e.jsx(p,{id:"name",label:"Firt Name",defaultValue:m.name,onChange:s=>ae(s.target.value)})}),e.jsx(h,{md:6,children:e.jsx(p,{id:"surname",label:"LastName",defaultValue:m.surname,onChange:s=>re(s.target.value)})}),e.jsx(h,{md:6,children:e.jsx(p,{id:"email",label:"Email",defaultValue:m.email,onChange:s=>ne(s.target.value)})}),e.jsx(h,{md:6,children:e.jsx(p,{id:"phone",label:"Contact Number",defaultValue:m.contact,onChange:s=>de(s.target.value)})}),e.jsx(h,{xs:6,children:e.jsx(q,{type:"submit",style:{marginBottom:"3%",width:"200px",backgroundColor:"#ff4d4d",color:"white"},onClick:()=>Fe(),children:"Update Customer"})}),e.jsx(h,{xs:6,children:e.jsx("span",{style:{fontSize:15,color:"red",cursor:"pointer",marginLeft:"64%",marginTop:"10%"},onClick:()=>qe(),children:"Change Password"})})]})})]})]})};export{ws as default};
