import{y as kt,r as a,A as o,j as e,L as y,h as Q,m as M}from"./index-UGMi1yYD.js";import{a as h}from"./axios-Cm0UX6qg.js";import{B as g}from"./config-HOLfLxHr.js";import{b as yt,a as u}from"./CContainer-DyKYeaQQ.js";import{C as Ne,a as W,b as X,d as Z,e as x}from"./DefaultLayout-CzLgNllg.js";import{C as Le}from"./CNavbar-CJm5RN47.js";import{C as ee,a as te,b as m,c,d as se,e as n}from"./CTable-Bh49LxGZ.js";import{c as Mt}from"./cil-pencil-m516yCOw.js";import{c as bt}from"./cil-trash-CBbKHhHb.js";import{c as ze}from"./cil-plus-D8mtC-W5.js";import{c as wt}from"./cil-map-dAArMthr.js";import{C as Te,a as E}from"./CPaginationItem-2Xn3uQKT.js";import{C as b,a as w,b as A,c as S}from"./CModalTitle-Cj2x-Lbp.js";import{C as ae}from"./CFormInput-CxPGKAGO.js";import{C as le}from"./CModalFooter-iKJhetg6.js";import{C as Ee}from"./CCol-BiiKwAZ6.js";import"./CFormLabel-CaVfy1Ba.js";const Ut=()=>{const[{user:p,token:d},r]=kt(),[re,v]=a.useState(""),[Be,D]=a.useState("All Cities"),[k,B]=a.useState([]),[P,oe]=a.useState(0),[Ge,ie]=a.useState(!0),[$e,G]=a.useState(!1),[ne,N]=a.useState(!1),[_e,Ie]=a.useState(""),[Re,$]=a.useState(!1),[Ve,ce]=a.useState(""),[L,de]=a.useState(""),[Fe,ue]=a.useState(""),[He,_]=a.useState(!1),[he,j]=a.useState(""),[ge,Ue]=a.useState([]),[Ye,me]=a.useState(!1),[qe,I]=a.useState(!1),[Je,Ke]=a.useState([]),[pe,R]=a.useState(""),[Oe,V]=a.useState("All Cities"),[At,xe]=a.useState(""),[fe,F]=a.useState(""),[Qe,H]=a.useState("All Chains"),[St,je]=a.useState("All Chains"),[We,Ce]=a.useState(!1),[ke,Xe]=a.useState([]),[Ze,ye]=a.useState(!0),[z,U]=a.useState(0),[Me,be]=a.useState(""),[C,we]=a.useState([]),[et,Y]=a.useState(!1),[q,Ae]=a.useState(""),[Se,ve]=a.useState(""),[De,tt]=a.useState(""),J=t=>{t==="all"?(v(""),D("All Cities")):(v(t),D(t))};a.useEffect(()=>{const t=setTimeout(()=>{r({type:o,payload:{status:!0,title:"Data Loading",message:"Data loading error: Timeout exceeded",color:"warning"}}),G(!1)},2e4);return p&&d&&T(0,t),()=>{clearTimeout(t)}},[p,re]);const T=(t,s)=>{G(!0),h.get(g+`market/groups/fetch/${t}?city=${re}`,{headers:{Authorization:`Bearer ${d}`}}).then(l=>{l.status===200?(B(l.data),G(!1),clearTimeout(s),l.data.length<20?ie(!0):l.data.length>19&&ie(!1)):l.status===500&&r({type:o,payload:{status:!0,title:"Makrket Group loading error",message:l.data.message}})}).catch(l=>{console.error("Error:",l)})},st=()=>{const t=P+20;oe(t),T(t,!0)},at=()=>{const t=P-20;console.log(t),oe(t),T(t,!1)},lt=t=>{N(!ne),Ie(t)},rt=t=>{console.log(t),h.delete(g+"marketgroup/"+t,{headers:{Authorization:`Bearer ${d}`}}).then(s=>{s.status===200?(r({type:o,payload:{status:!0,title:"Market Group Delete",message:"Market Group Delete Success",color:"success"}}),N(!1),T(0,!0),console.log("Remove Market Group")):s.status===203?r({type:o,payload:{status:!0,title:"Market Group Delete",message:s.data.message,color:"warning"}}):s.status===404?r({type:o,payload:{status:!0,title:"Market Group Delete",message:s.data.message,color:"warning"}}):s.status===500&&r({type:o,payload:{status:!0,title:"Market Group Delete",message:s.data.message,color:"warning"}})}).catch(s=>{console.error("Error:",s)})},ot=(t,s)=>{$(!0),ce(t),ue(s),console.log(s)},it=()=>{console.log("name",L),L==""?r({type:o,payload:{status:!0,title:"Alert",message:"Please Enter Name",color:"danger"}}):nt(Ve)},nt=t=>{if(t){let s={name:L};console.log(s,t),p&&d&&h.put(g+"marketgroup/update/"+t,s,{headers:{Authorization:`Bearer ${d}`}}).then(l=>{if(l.status===200){const i=l.data,f=k.find(Ct=>Ct.id===i.id);f&&(f.name=i.name),B([...k]),r({type:o,payload:{status:!0,title:"Market Group Update",message:"Market group name updated successfully",color:"success"}}),ce(""),de(""),$(!1),ue("")}else l.status===204?r({type:o,payload:{status:!0,title:"Pick up area update  error",message:l.data.message,color:"danger"}}):l.status===500&&r({type:o,payload:{status:!0,title:"Pick up area update  error",message:l.data.message,color:"danger"}})}).catch(l=>{console.error("Error:",l)})}else alert("Please Check the Fields!")},ct=t=>{console.log("markets",t),_(!0),j(t),dt(t)},dt=t=>{me(!0),h.get(g+`marketgroup/markets/${t}`,{headers:{Authorization:`Bearer ${d}`}}).then(s=>{s.status===200?(Ue(s.data),console.log("data market",s.data),me(!1)):s.status===204?r({type:o,payload:{status:!0,title:"Market Loading error",message:s.data.message}}):s.status===500&&r({type:o,payload:{status:!0,title:"Market Loading error",message:s.data.message}})}).catch(s=>{console.error("Error: ",s)})},ut=t=>{console.log("markets group",t),j(t),I(!0),tt(t)},K=(t,s)=>{s==="view"?t==="all"?(v(""),D("All Cities")):(v(t),D(t)):s==="modal"&&(t==="all"?(R(""),V("All Cities")):(R(t),V(t)))},Pe=(t,s,l)=>{l==="view"?t==="all"?(xe(""),je("All Chains")):(xe(t),je(s)):l==="modal"&&(t==="all"?(F(""),H("All Chains")):(F(t),H(s)))};a.useEffect(()=>{ht()},[]);const ht=()=>{d&&h.get(g+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${d}`}}).then(t=>{t.status===200?Ke(t.data):t.status===500&&r({type:o,payload:{status:!0,title:"Chain Loading error",message:t.data.message}})}).catch(t=>{console.error("Error: ",t)})};a.useEffect(()=>{p&&d&&O(0)},[fe,pe,p,De]);const O=(t,s)=>{Ce(!0),h.get(g+`assistant/market/add/group/${t}?brand=${fe}&city=${pe}&gid=${De}`,{headers:{Authorization:`Bearer ${d}`}}).then(l=>{l.status===200?(Xe(l.data.data),Ce(!1),l.data.data.length<20?ye(!0):l.data.data.length>19&&ye(!1)):l.status===500&&r({type:o,payload:{status:!0,title:"Market Loading error",message:l.data.message}})}).catch(l=>{console.error("Error: ",l)})},gt=()=>{const t=z+20;U(t),O(t)},mt=()=>{const t=z-20;console.log(t),U(t),O(t)},pt=(t,s)=>{if(s&&t){const l={marketId:s};d&&p&&d&&h.patch(g+"marketgroup/add/market/"+t,l,{headers:{Authorization:`Bearer ${d}`}}).then(i=>{i.status===200?(I(!1),j(""),r({type:o,payload:{status:!0,title:"Market Assign",message:"successfully Market assigned to the market group",color:"success"}})):i.status===400?r({type:o,payload:{status:!0,title:"Market Assign error",message:i.data.message,color:"warning"}}):i.status===404?r({type:o,payload:{status:!0,title:"Market Assign error",message:i.data.message,color:"warning"}}):i.status===500&&r({type:o,payload:{status:!0,title:"Market Assign error",message:i.data.message,color:"warning"}})}).catch(i=>{console.error("Error:",i)})}else r({type:o,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},xt=(t,s)=>{if(s&&t){const l={marketId:s};d&&p&&d&&h.patch(g+"marketgroup/remove/market/"+t,l,{headers:{Authorization:`Bearer ${d}`}}).then(i=>{i.status===200?(_(!1),j(""),r({type:o,payload:{status:!0,title:"Market Assign",message:"successfully Market remove from the market group",color:"success"}})):i.status===400?r({type:o,payload:{status:!0,title:"Market remove error",message:i.data.message,color:"warning"}}):i.status===404?r({type:o,payload:{status:!0,title:"Market remove error",message:i.data.message,color:"warning"}}):i.status===500&&r({type:o,payload:{status:!0,title:"Market remove error",message:i.data.message,color:"warning"}})}).catch(i=>{console.error("Error:",i)})}else r({type:o,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},ft=(t,s)=>{s&&(Y(!0),we(t),ve(t.lat),Ae(t.lng),be(s))},jt=()=>{if(q){console.log("center",Me,Se,q);const t={lat:Se,lng:q};d&&p&&d&&h.patch(g+"marketgroup/update/center/"+Me,t,{headers:{Authorization:`Bearer ${d}`}}).then(s=>{if(s.status===200){Y(!1),be(""),we([]);const l=s.data,i=k.map(f=>(f._id===l._id&&(f.center=l.center),f));B([...i]),r({type:o,payload:{status:!0,title:"Manage Center Point",message:"successfully center point assigned to the market group",color:"success"}})}else s.status===400?r({type:o,payload:{status:!0,title:"Manage Center Point",message:s.data.message,color:"warning"}}):s.status===404?r({type:o,payload:{status:!0,title:"Manage Center Point",message:s.data.message,color:"warning"}}):s.status===500&&r({type:o,payload:{status:!0,title:"Manage Center Point",message:s.data.message,color:"warning"}})}).catch(s=>{console.error("Error:",s)})}else r({type:o,payload:{status:!0,title:"Error!",message:"check fields again",color:"warning"}})};return e.jsxs(yt,{children:[e.jsx(y,{to:"/marketgroups/marketmap",children:e.jsx(u,{style:{marginLeft:"0%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Add Market"})}),e.jsx(y,{to:"/marketgroups/createmarketgroup",children:e.jsx(u,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Create Market Group"})}),e.jsx(Ne,{style:{marginLeft:"39%"},color:"secondary",children:"Filter by"}),e.jsxs(W,{style:{marginLeft:"2%",width:"17%",marginRight:"5px",backgroundColor:"#ff4d4d"},children:[e.jsx(X,{style:{color:"white"},children:Be}),e.jsxs(Z,{children:[e.jsx(x,{onClick:()=>J("all"),children:"All"}),e.jsx(x,{onClick:()=>J("Milano"),children:"Milano"}),e.jsx(x,{onClick:()=>J("Napoli"),children:"Napoli"})]})]}),e.jsx(Le,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),$e?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(Q,{style:{marginTop:"15%"}})}):e.jsxs(ee,{children:[e.jsx(te,{children:e.jsxs(m,{children:[e.jsx(c,{scope:"col",children:"#"}),e.jsx(c,{scope:"col",children:"Name"}),e.jsx(c,{scope:"col",children:"City"}),e.jsx(c,{scope:"col",children:"Assigned Market"}),e.jsx(c,{scope:"col",children:"Location"}),e.jsx(c,{scope:"col",children:"Action"}),e.jsx(c,{scope:"col",children:"Add Markets"}),e.jsx(c,{scope:"col",children:"Add Center Point"}),e.jsx(c,{scope:"col",children:"View Map"})]})}),e.jsx(se,{children:k.length===0?e.jsx(m,{children:e.jsx(n,{colSpan:"9",style:{textAlign:"center",backgroundColor:"white"},children:e.jsx("h6",{style:{marginTop:"1%"},children:"No Data"})})}):k.map((t,s)=>e.jsxs(m,{children:[e.jsx(n,{children:P+s+1}),e.jsxs(n,{children:[e.jsx("span",{children:t.name}),e.jsx(y,{to:"",children:e.jsx(M,{style:{marginLeft:20,float:"right"},icon:Mt,size:"sm",onClick:()=>ot(t._id,t.name)})})]}),e.jsx(n,{children:t.city}),e.jsx(n,{children:e.jsx(u,{onClick:()=>{ct(t._id)},size:"sm",style:{backgroundColor:"#ff4d4d",marginLeft:"5px",color:"white"},children:"view"})}),e.jsx(n,{children:e.jsx(y,{to:`/marketgroups/marketdistance/${t._id}`,children:e.jsx(u,{size:"sm",style:{backgroundColor:"#ff4d4d",marginLeft:"5px",color:"white"},children:"view"})})}),e.jsx(n,{children:e.jsx(u,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>lt(t._id),children:e.jsx(M,{icon:bt,size:"lg",style:{color:"white"}})})}),e.jsx(n,{children:e.jsx(u,{onClick:()=>{ut(t._id)},size:"sm",style:{backgroundColor:"#ff4d4d",color:"white"},variant:"outline",children:e.jsx(M,{icon:ze,size:"lg",style:{color:"white"}})})}),e.jsx(n,{children:e.jsx(u,{onClick:()=>{ft(t.center,t._id)},size:"sm",style:{backgroundColor:"#ff4d4d",color:"white"},variant:"outline",children:e.jsx(M,{icon:ze,size:"lg",style:{color:"white"}})})}),e.jsx(n,{children:e.jsx(y,{to:`/marketgroups/view/map/${t._id}`,children:e.jsx(u,{size:"sm",style:{backgroundColor:"#ff4d4d",color:"white"},variant:"outline",children:e.jsx(M,{icon:wt,size:"lg",style:{color:"white"}})})})})]},s))})]}),e.jsxs(Te,{"aria-label":"Page navigation example",children:[e.jsx(E,{disabled:P<=0,onClick:at,children:"Previous"}),e.jsx(E,{disabled:Ge===!0,onClick:st,children:"Next"})]}),e.jsxs(b,{alignment:"center",visible:Re,scrollable:!0,size:"sm",onClose:()=>$(!1),children:[e.jsx(w,{closeButton:!0,children:e.jsx(A,{children:"Change Name"})}),e.jsxs(S,{children:[e.jsx("a",{children:"Enter New Name"}),e.jsx("br",{}),e.jsx(ae,{type:"text",placeholder:Fe,value:L,onChange:t=>de(t.target.value)})]}),e.jsx(le,{children:e.jsx(u,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>it(),children:"Save changes"})})]}),e.jsxs(b,{alignment:"center",visible:ne,scrollable:!0,size:"sm",onClose:()=>N(!1),children:[e.jsx(w,{closeButton:!1,children:e.jsx(A,{children:"Confirmation"})}),e.jsxs(S,{children:[e.jsx("a",{children:"Are you sure you want to delete this market group?"}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[e.jsx(u,{onClick:()=>rt(_e),style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),e.jsx(u,{onClick:()=>N(!1),style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]}),e.jsxs(b,{alignment:"center",visible:He,scrollable:!0,size:"lg",onClose:()=>{_(!1),j("")},children:[e.jsx(w,{closeButton:!0,children:e.jsx(A,{children:"All Assign Markets details"})}),e.jsx(S,{children:Ye?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(Q,{style:{marginTop:"15%"}})}):e.jsxs(ee,{children:[e.jsx(te,{children:e.jsxs(m,{children:[e.jsx(c,{scope:"col",children:"#"}),e.jsx(c,{scope:"col",children:"Chain Name"}),e.jsx(c,{scope:"col",children:"Address"}),e.jsx(c,{scope:"col",children:"City"}),e.jsx(c,{scope:"col",children:"Remove"})]})}),e.jsx(se,{children:ge.length===0?e.jsx(m,{children:e.jsx(n,{colSpan:"5",style:{textAlign:"center",backgroundColor:"white"},children:e.jsx("h6",{style:{marginTop:"1%"},children:"No Data"})})}):ge.map((t,s)=>e.jsxs(m,{children:[e.jsx(n,{children:s+1}),e.jsx(n,{children:t.chain.name}),e.jsx(n,{children:t.address}),e.jsx(n,{children:t.city}),e.jsx(n,{children:e.jsx(u,{size:"sm",onClick:()=>xt(he,t._id),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Remove"})})]},s))})]})}),e.jsx(le,{})]}),e.jsxs(b,{visible:qe,scrollable:!0,size:"xl",onClose:()=>{I(!1),U(0),j(""),R(""),F(""),V("All Cities"),H("All Chains")},children:[e.jsx(w,{closeButton:!0,children:e.jsx(A,{children:"Market assign view"})}),e.jsxs(S,{children:[e.jsx(Ne,{style:{marginLeft:"54%"},color:"secondary",children:"Filter by"}),e.jsxs(W,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(X,{style:{color:"white"},children:Oe}),e.jsxs(Z,{children:[e.jsx(x,{onClick:()=>K("all","modal"),children:"All"}),e.jsx(x,{onClick:()=>K("Milano","modal"),children:"Milano"}),e.jsx(x,{onClick:()=>K("Napoli","modal"),children:"Napoli"})]})]}),e.jsxs(W,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(X,{style:{color:"white"},children:Qe}),e.jsxs(Z,{children:[e.jsx(x,{onClick:()=>Pe("all",null,"modal"),children:"All"}),Je.map((t,s)=>e.jsx(x,{onClick:()=>Pe(t.id,t.name,"modal"),children:t.name},s))]})]}),e.jsx(Le,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),We?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(Q,{style:{marginTop:"15%"}})}):e.jsxs(ee,{children:[e.jsx(te,{children:e.jsxs(m,{children:[e.jsx(c,{scope:"col",children:"#"}),e.jsx(c,{scope:"col",children:"Name"}),e.jsx(c,{scope:"col",children:"Address"}),e.jsx(c,{scope:"col",children:"City"}),e.jsx(c,{scope:"col",children:"Scraped"}),e.jsx(c,{scope:"col"})]})}),e.jsx(se,{children:ke.length===0?e.jsx(m,{children:e.jsx(n,{colSpan:"6",style:{textAlign:"center",backgroundColor:"white"},children:e.jsx("h6",{style:{marginTop:"1%"},children:"No Data"})})}):ke.map((t,s)=>e.jsxs(m,{children:[e.jsx(n,{children:z+s+1}),e.jsx(n,{children:t.chain.name}),e.jsx(n,{children:t.address}),e.jsx(n,{children:t.city}),e.jsx(n,{children:t.scraped}),e.jsx(n,{children:e.jsx(u,{size:"sm",onClick:()=>pt(he,t._id),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Add"})})]},s))})]}),e.jsx(le,{children:e.jsxs(Te,{"aria-label":"Page navigation example",children:[e.jsx(E,{disabled:z<=0,onClick:mt,children:"Previous"}),e.jsx(E,{disabled:Ze===!0,onClick:gt,children:"Next"})]})})]})]}),e.jsxs(b,{visible:et,scrollable:!0,size:"lg",onClose:()=>Y(!1),children:[e.jsx(w,{closeButton:!0,children:e.jsx(A,{children:"Manage Center Point"})}),e.jsx(S,{children:e.jsxs("div",{className:"row g-3",children:[e.jsx(Ee,{md:6,children:e.jsx(ae,{id:"lat",label:"Latitude",defaultValue:C==null?void 0:C.lat,onChange:t=>ve(t.target.value)})}),e.jsx(Ee,{md:6,children:e.jsx(ae,{id:"lng",label:"Longitude",defaultValue:C==null?void 0:C.lng,onChange:t=>Ae(t.target.value)})}),e.jsx(u,{type:"submit",style:{marginBottom:"3%",width:"200px",backgroundColor:"#ff4d4d",color:"white"},onClick:()=>jt(),children:"Add Center Point"})]})})]})]})};export{Ut as default};
