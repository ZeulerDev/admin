import{r as o,x as L,l as $,j as e,m as N}from"./index-CPWz2mBo.js";import{M as _,T as z,a as B,P as D}from"./leaflet-D_HqG7pf.js";import{a as c}from"./axios-B4uVmeYG.js";import{b as G,a as p}from"./CContainer-DVjuDtow.js";import{C as H}from"./CNavbar-BtIsg1Gz.js";import{C as P,a as I,b as F,c as k}from"./DefaultLayout-DMPR4tUM.js";import{c as O}from"./cil-info-CmGCY32x.js";import{C as V,a as W,b as Y,c as Z}from"./CModalTitle-Xk0eoXg3.js";import{C as q,a as J,b as y,c as h,d as K,e as u}from"./CTable-CHBcUNK4.js";import{C as Q}from"./CModalFooter-HZC0g86p.js";const ne=()=>{const[m,l]=o.useState(!1),[{user:n,token:r},i]=L(),[x,f]=o.useState("Napoli"),[M,g]=o.useState("Napoli"),[T,b]=o.useState([]),[E,A]=o.useState([]),[d,S]=o.useState();$();const C=(a,t)=>{l(!m),S(t),c.get(`https://15.160.211.157/market/groups/fetch/0?city=${a}`,{headers:{Authorization:`Bearer ${r}`}}).then(s=>{s.status===200?A(s.data):s.status===500&&i({type:SET_ALERT,payload:{status:!0,title:"City loading error",message:s.data.message}})}).catch(s=>{console.error("Error:",s)})},j=a=>{a==="all"?(f(""),g("Napoli")):(f(a),g(a))};o.useEffect(()=>{n&&r&&c.get(`https://15.160.211.157/assistant/markets/groups/locations/delivery/${x}`,{headers:{Authorization:`Bearer ${r}`}}).then(a=>{a.status===200?b(a.data):a.status===500&&i({type:SET_ALERT,payload:{status:!0,title:"Market Group loading error",message:a.data.message}})}).catch(a=>{console.error("Error:",a)})},[n,x]);const v=(a,t)=>{a&&t&&n&&r&&(console.log("one"),c.put(`https://15.160.211.157/market/groups/assign/${t}/${a}`,{},{headers:{Authorization:`Bearer ${r}`}}).then(s=>{s.status===200?l(!1):s.status===204?i({type:SET_ALERT,payload:{status:!0,title:"Market Assign error",message:s.data.message}}):s.status===500&&i({type:SET_ALERT,payload:{status:!0,title:"Market Assign error",message:s.data.message}})}).catch(s=>{console.error("Error:",s)}))},w=(a,t)=>{a&&t&&n&&r&&c.put(`https://15.160.211.157/market/groups/remove/${t}/${a}`,{},{headers:{Authorization:`Bearer ${r}`}}).then(s=>{s.status===200?l(!1):s.status===204?i({type:SET_ALERT,payload:{status:!0,title:"Market Remove error",message:s.data.message}}):s.status===500&&i({type:SET_ALERT,payload:{status:!0,title:"Market Remove error",message:s.data.message}})}).catch(s=>{console.error("Error:",s)})};return e.jsxs(G,{children:[e.jsx(H,{className:"bg-body-tertiary",children:e.jsxs(P,{style:{marginLeft:"90%",width:"10%",marginRight:"5px",backgroundColor:"#ff4d4d"},children:[e.jsx(I,{children:M}),e.jsxs(F,{children:[e.jsx(k,{onClick:()=>j("Napoli"),children:"Napoli"}),e.jsx(k,{onClick:()=>j("Milano"),children:"Milano"})]})]})}),e.jsxs(_,{dragging:!0,center:[40.85631,14.24641],zoom:13,scrollWheelZoom:!0,style:{height:"500px",width:"100%"},children:[e.jsx(z,{attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),T.map((a,t)=>e.jsx(B,{position:[a.lat,a.lng],onClick:C,children:e.jsx(D,{children:e.jsxs("div",{onClick:()=>C(a.city,a._id),children:[e.jsx(N,{icon:O,size:"lg",style:{marginLeft:"10px"}})," ",e.jsx("span",{children:a.address})]})})},t))]}),e.jsxs(V,{visible:m,scrollable:!0,size:"xl",onClose:()=>l(!1),children:[e.jsx(W,{closeButton:!0,children:e.jsx(Y,{children:"Map Information"})}),e.jsx(Z,{style:{overflowY:"auto",maxHeight:"70vh"},children:e.jsxs(q,{children:[e.jsx(J,{children:e.jsxs(y,{children:[e.jsx(h,{scope:"col",children:"Name"}),e.jsx(h,{scope:"col",children:"Market"}),e.jsx(h,{scope:"col",children:"Action"})]})}),e.jsx(K,{children:E.map((a,t)=>e.jsxs(y,{children:[e.jsx(u,{children:a.name}),e.jsx(u,{children:a.markets.map((s,R)=>e.jsxs("div",{children:[s.chain.name," - ",s.address," "]},R))}),e.jsx(u,{children:a.markets.some(s=>s.id===d)?e.jsx(p,{style:{backgroundColor:"#ff4d4d",width:"90px"},onClick:()=>w(d,a._id),children:"Remove"}):e.jsx(p,{style:{backgroundColor:"#ff4d4d",width:"90px"},onClick:()=>v(d,a._id),children:"Assign"})})]},t))})]})}),e.jsx(Q,{children:e.jsx(p,{color:"secondary",onClick:()=>l(!1),children:"Close"})})]})]})};export{ne as default};
