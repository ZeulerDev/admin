import{r as t,y as be,A as l,j as e,h as Pe,L as we,m as A}from"./index-CqxShCkz.js";import{a as y}from"./axios-Cm0UX6qg.js";import{E as Se}from"./leaflet.draw-DEjnK1IK.js";import{M as Ae,T as Me,P as De}from"./leaflet-DS4KrRZ4.js";import{B as j}from"./config-HOLfLxHr.js";import{b as Ne,a as n}from"./CContainer-BmaXnLJf.js";import{d as G,C as q,a as H,b as U,c as m}from"./DefaultLayout-umetxDSO.js";import{C as O}from"./CNavbar-CKmVlwO9.js";import{C as Le,a as ve,b as W,c,d as Te,e as d}from"./CTable-DcZlOfvl.js";import{c as Ee}from"./cil-pencil-m516yCOw.js";import{c as ze}from"./cil-trash-CBbKHhHb.js";import{C as Be,a as Y}from"./CPaginationItem-D9T1ls33.js";import{C as M,a as D,b as N,c as L}from"./CModalTitle-7RGV4Fgd.js";import{M as Re}from"./Marker-B1tEZw8H.js";import{c as Ie}from"./cil-info-CmGCY32x.js";import{P as Fe}from"./Polygon-Bq6q3ed1.js";import{F as _e}from"./FeatureGroup-nMNy9eWH.js";import{C as Z}from"./CModalFooter-C7beuWX1.js";import{C as $e}from"./CFormInput-C7b0GOpH.js";import"./index-Br0IS9sI.js";import"./CFormLabel-DjiHfxIS.js";const ns=()=>{const J=t.useRef(null),[{user:p,token:i},r]=be(),[K,Q]=t.useState([]),[v,T]=t.useState(""),[g,E]=t.useState(0),[X,z]=t.useState("All Cities"),[ee,B]=t.useState(!1),[se,R]=t.useState(!0),[ae,C]=t.useState(!1),[te,k]=t.useState(!1),[oe,re]=t.useState([]),[b,le]=t.useState("Napoli"),[I,ie]=t.useState([]),[P,ne]=t.useState([]),[w,S]=t.useState(""),[f,F]=t.useState(""),[ce,_]=t.useState(""),[$,x]=t.useState(!1),[de,pe]=t.useState(!1);t.useEffect(()=>{p&&i&&u(0)},[v,p]);const u=s=>{B(!0),y.get(j+`pickups/areas/${s}?city=${v}`,{headers:{Authorization:`Bearer ${i}`}}).then(a=>{a.status===200?(Q(a.data),B(!1),a.data.length<20?R(!0):a.data.length>19&&R(!1)):a.status===500&&r({type:l,payload:{status:!0,title:"Market Loading error",message:a.data.message}})}).catch(a=>{console.error("Error: ",a),a.response?(console.error("Response data:",a.response.data),console.error("Response status:",a.response.status),console.error("Response headers:",a.response.headers)):a.request?console.error("Request data:",a.request):console.error("Error message:",a.message)})},ue=()=>{const s=g+20;E(s),u(s)},he=()=>{const s=g-20;console.log(s),E(s),u(s)},h=s=>{s==="all"?(T(""),z("All Cities")):(T(s),z(s),le(s))},me=(s,a)=>{C(!0),console.log(s);const o=ge(s);ie(o),S(a),console.log(o)};function ge(s){return s.map(a=>a.map(o=>({lng:o[0],lat:o[1]})))}const fe=(s,a)=>{k(!0),S(s),_(a),console.log(a)};t.useEffect(()=>{p&&i&&y.get(j+`assistant/markets/groups/locations/pickup/${b}`,{headers:{Authorization:`Bearer ${i}`}}).then(s=>{s.status===200?re(s.data):s.status===500&&r({type:l,payload:{status:!0,title:"Market Group loading error",message:s.data.message}})}).catch(s=>{console.error("Error:",s)})},[p,b]);const xe=s=>{const a=s.layer;console.log("layer",a._latlngs),ne(a._latlngs)},V=s=>{if(s){let a={};P&&(a={area:P}),f&&(a={name:f}),console.log(a,s),p&&i&&y.put(j+"pickup/area/update/"+s,a,{headers:{Authorization:`Bearer ${i}`}}).then(o=>{o.status===200?(r({type:l,payload:{status:!0,title:"Pickup Area Update",message:"Pick up area update Success",color:"success"}}),S(""),F(""),u(0),C(!1),k(!1),_("")):o.status===204?r({type:l,payload:{status:!0,title:"Pick up area update  error",message:o.data.message,color:"danger"}}):o.status===500&&r({type:l,payload:{status:!0,title:"Pick up area update  error",message:o.data.message,color:"danger"}})}).catch(o=>{console.error("Error:",o)})}else alert("Please Check the Fields!")},ye=()=>{P==""?r({type:l,payload:{status:!0,title:"Alert",message:"Please select the area",color:"danger"}}):V(w)},je=()=>{f==""&&w==""?r({type:l,payload:{status:!0,title:"Alert",message:"Please Name",color:"danger"}}):V(w)},Ce=s=>{x(!$),pe(s)},ke=s=>{console.log(s),y.delete(j+"pickup/area/delete/"+s,{headers:{Authorization:`Bearer ${i}`}}).then(a=>{a.status===200?(r({type:l,payload:{status:!0,title:"Pickup Area Delete",message:"Pick up area deleted Successfully",color:"success"}}),x(!1),u(0)):a.status===204?r({type:l,payload:{status:!0,title:"Pickup Area Delete",message:a.data.message,color:"warning"}}):a.status===500&&r({type:l,payload:{status:!0,title:"Pickup Area Delete",message:a.data.message,color:"warning"}})}).catch(a=>{console.error("Error:",a)})};return e.jsxs(Ne,{children:[e.jsx(G,{style:{marginLeft:"75.5%"},color:"secondary",children:"Filter by"}),e.jsxs(q,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[e.jsx(H,{style:{color:"white"},children:X}),e.jsxs(U,{children:[e.jsx(m,{onClick:()=>h("all"),children:"All"}),e.jsx(m,{onClick:()=>h("Milano"),children:"Milano"}),e.jsx(m,{onClick:()=>h("Napoli"),children:"Napoli"})]})]}),e.jsx(O,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),ee?e.jsx(Pe,{}):e.jsxs(Le,{children:[e.jsx(ve,{children:e.jsxs(W,{children:[e.jsx(c,{scope:"col",children:"#"}),e.jsx(c,{scope:"col",children:"Name"}),e.jsx(c,{scope:"col",children:"Type"}),e.jsx(c,{scope:"col",children:"City"}),e.jsx(c,{scope:"col",children:"View"}),e.jsx(c,{scope:"col",children:"Action"})]})}),e.jsx(Te,{children:K.map((s,a)=>e.jsxs(W,{children:[e.jsx(d,{children:g+a+1}),e.jsxs(d,{children:[e.jsx("span",{children:s.name}),e.jsx(we,{to:"",children:e.jsx(A,{style:{marginLeft:20,float:"right"},icon:Ee,size:"sm",onClick:()=>fe(s._id,s.name)})})]}),e.jsx(d,{children:s.geometry.type}),e.jsx(d,{children:s.city}),e.jsx(d,{children:e.jsx(n,{size:"sm",style:{backgroundColor:"#ff4d4d",color:"white"},variant:"outline",onClick:()=>me(s.geometry.coordinates,s._id),children:"View map"})}),e.jsx(d,{children:e.jsx(n,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>Ce(s._id),children:e.jsx(A,{icon:ze,size:"lg",style:{color:"white"}})})})]},a))})]}),e.jsxs(Be,{"aria-label":"Page navigation example",children:[e.jsx(Y,{disabled:g<=0,onClick:he,children:"Previous"}),e.jsx(Y,{disabled:se===!0,onClick:ue,children:"Next"})]}),e.jsxs(M,{alignment:"center",visible:ae,scrollable:!0,size:"xl",onClose:()=>C(!1),children:[e.jsx(D,{closeButton:!0,children:e.jsx(N,{children:"Map View"})}),e.jsxs(L,{children:[e.jsx(G,{style:{marginLeft:"81.5%"},color:"secondary",children:"Filter by"}),e.jsxs(q,{style:{marginLeft:"2%",width:"10%",backgroundColor:"#ff4d4d"},children:[e.jsx(H,{style:{color:"white"},children:b}),e.jsxs(U,{children:[e.jsx(m,{onClick:()=>h("Milano"),children:"Milano"}),e.jsx(m,{onClick:()=>h("Napoli"),children:"Napoli"})]})]}),e.jsx(O,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),e.jsxs(Ae,{dragging:!0,center:[40.85631,14.24641],zoom:13,scrollWheelZoom:!0,style:{height:"500px",width:"100%"},children:[e.jsx(Me,{attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),oe.map((s,a)=>e.jsx(Re,{position:[s.lat,s.lng],children:e.jsx(De,{children:e.jsxs("div",{children:[e.jsx(A,{icon:Ie,size:"lg",style:{marginLeft:"10px"}})," ",e.jsx("span",{children:s.address})]})})},a)),I.length>0&&e.jsx(Fe,{positions:I}),e.jsx(_e,{ref:J,children:e.jsx(Se,{position:"topright",onCreated:xe,draw:{polygon:!0,circle:!0,polyline:!0,marker:!1,circlemarker:!1}})})]})]}),e.jsx(Z,{children:e.jsx(n,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>ye(),children:"Save updated area"})})]}),e.jsxs(M,{alignment:"center",visible:te,scrollable:!0,size:"sm",onClose:()=>k(!1),children:[e.jsx(D,{closeButton:!0,children:e.jsx(N,{children:"Change Name"})}),e.jsxs(L,{children:[e.jsx("a",{children:"Enter New Name"}),e.jsx("br",{}),e.jsx($e,{type:"text",placeholder:ce,value:f,onChange:s=>F(s.target.value)})]}),e.jsx(Z,{children:e.jsx(n,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>je(),children:"Save changes"})})]}),e.jsxs(M,{alignment:"center",visible:$,scrollable:!0,size:"sm",onClose:()=>x(!1),children:[e.jsx(D,{closeButton:!1,children:e.jsx(N,{children:"Confirmation"})}),e.jsxs(L,{children:[e.jsx("a",{children:"Are you sure you want to delete this pickup area?"}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[e.jsx(n,{onClick:()=>ke(de),style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),e.jsx(n,{onClick:()=>x(!1),style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]})]})};export{ns as default};
