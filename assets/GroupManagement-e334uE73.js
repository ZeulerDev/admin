import{r as t,y as ke,l as Me,A as d,j as a,h as J}from"./index-D8W7eoM5.js";import{a as p}from"./axios-Cm0UX6qg.js";import{B as g}from"./config-HOLfLxHr.js";import{b as we,a as C}from"./CContainer-EQGOw-z2.js";import{C as G,a as A,b as S,d as v,e as u}from"./DefaultLayout-CwPF-zRq.js";import{C as K}from"./CNavbar-bbh6w27I.js";import{C as O,a as Q,b as y,c as i,d as W,e as n}from"./CTable-jf2tizix.js";import{C as De,a as be,b as Ge,c as Ae}from"./CModalTitle-DXUyO86j.js";import{C as Se}from"./CModalFooter-VrnOxKGp.js";import{C as ve,a as X}from"./CPaginationItem-D4fVq3gA.js";const He=()=>{const[E,f]=t.useState(!1),[{user:m,token:l},c]=ke(),[Y,Z]=t.useState([]),[ee,x]=t.useState(!1),[T,P]=t.useState(""),[L,N]=t.useState(""),[B,Ee]=t.useState("");t.useState(!1),t.useState(""),Me();const[ae,se]=t.useState(!1),[te,z]=t.useState("All Cities"),[re,$]=t.useState("All Market Groups");t.useState("All Chains");const[oe,le]=t.useState([]),[Te,ie]=t.useState([]),[I,k]=t.useState(""),[ne,M]=t.useState([]),[ce,w]=t.useState("All Cities"),[R,D]=t.useState(""),[de,ue]=t.useState([]),[he,_]=t.useState(!1),[pe,F]=t.useState(!0),[j,H]=t.useState(0);t.useEffect(()=>{b(),ge()},[]);const b=()=>{l&&p.get(g+"market/groups/dropdown/fetch",{headers:{Authorization:`Bearer ${l}`}}).then(e=>{e.status===200?le(e.data):e.status===500&&c({type:d,payload:{status:!0,title:"Market Group Loading error",message:e.data.message}})}).catch(e=>{console.error("Error: ",e)})},ge=()=>{l&&p.get(g+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${l}`}}).then(e=>{e.status===200?(ie(e.data),se(!1)):e.status===500&&c({type:d,payload:{status:!0,title:"Chain Loading error",message:e.data.message}})}).catch(e=>{console.error("Error: ",e)})};t.useEffect(()=>{const e=setTimeout(()=>{c({type:d,payload:{status:!0,title:"Data Loading",message:"Data loading error: Timeout exceeded",color:"warning"}}),x(!1)},2e4);return U(e),()=>{clearTimeout(e)}},[T,L,B,ae]);const U=e=>{m&&l&&(x(!0),p.get(g+`assistant/riders/test/0?city=${T}&group=${L}&chain=${B}`,{headers:{Authorization:`Bearer ${l}`}}).then(s=>{s.status===200?(Z(s.data),x(!1),clearTimeout(e)):s.status===500&&c({type:d,payload:{status:!0,title:"Error",message:s.data.message,color:"warning"}})}).catch(s=>{console.error("Error:",s)}))},h=(e,s)=>{s==="view"?e==="all"?(P(""),z("All Cities")):(P(e),z(e)):s==="modal"&&(e==="all"?(D(""),w("All Cities")):(D(e),w(e)))},V=(e,s)=>{e==="all"?(N(""),$("All Market Groups")):(N(e),$(s))},q=(e,s)=>{w("All Cities"),D(""),f(!E),k(s),M(e)};t.useEffect(()=>{m&&l&&me(0)},[m,R]);const me=(e,s)=>{_(!0),p.get(g+`market/groups/fetch/${e}?city=${R}`,{headers:{Authorization:`Bearer ${l}`}}).then(o=>{o.status===200?(ue(o.data),_(!1),o.data.length<20?(F(!0),console.log("ok")):o.data.length>19&&F(!1)):o.status===500&&c({type:d,payload:{status:!0,title:"Makrket Group loading error",message:o.data.message}})}).catch(o=>{console.error("Error:",o)})},fe=()=>{const e=j+20;H(e),loadData(e,!0)},xe=()=>{const e=j-20;console.log(e),H(e),loadData(e,!1)},je=(e,s)=>{if(console.log("driver id",e),console.log("group id",s),s&&e){const o={id:s,rider:e};l&&m&&l&&p.put(g+"assistant/groups/rider/assign",o,{headers:{Authorization:`Bearer ${l}`}}).then(r=>{if(r.status===200){f(!1),k(""),M([]),console.log(r.data),b();const ye=setTimeout(()=>{x(!1)},2e4);U(ye),c({type:d,payload:{status:!0,title:"Market Group Assign",message:"successfully Market Group assigned to the picker ",color:"success"}})}else r.status===204?c({type:d,payload:{status:!0,title:"Group Assign error",message:r.data.message,color:"warning"}}):r.status===500&&c({type:d,payload:{status:!0,title:"Group Assign error",message:r.data.message,color:"warning"}})}).catch(r=>{console.error("Error:",r)})}else c({type:d,payload:{status:!0,title:"Error!",message:"Driver group assign error",color:"warning"}})},Ce=(e,s)=>{if(s&&e){const o={id:s,rider:e};l&&m&&l&&p.put(g+"assistant/groups/rider/remove",o,{headers:{Authorization:`Bearer ${l}`}}).then(r=>{r.status===200?(f(!1),k(""),M([]),b(),c({type:d,payload:{status:!0,title:"Market Group Remove",message:"successfully Market Group removed from the picker ",color:"success"}})):r.status===204?c({type:d,payload:{status:!0,title:"Group remove error",message:r.data.message,color:"warning"}}):r.status===500&&c({type:d,payload:{status:!0,title:"Group remove error",message:r.data.message,color:"warning"}})}).catch(r=>{console.error("Error:",r)})}else c({type:d,payload:{status:!0,title:"Error!",message:"Driver group assign error",color:"warning"}})};return a.jsxs(we,{children:[a.jsx(G,{style:{marginLeft:"54%"},color:"secondary",children:"Filter by"}),a.jsxs(A,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[a.jsx(S,{style:{color:"white"},children:te}),a.jsxs(v,{children:[a.jsx(u,{onClick:()=>h("all","view"),children:"All"}),a.jsx(u,{onClick:()=>h("Milan","view"),children:"Milan"}),a.jsx(u,{onClick:()=>h("Napoli","view"),children:"Napoli"})]})]}),a.jsxs(A,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[a.jsx(S,{style:{color:"white"},children:re}),a.jsxs(v,{children:[a.jsx(u,{onClick:()=>V("all"),children:"All"}),oe.map((e,s)=>a.jsx(u,{onClick:()=>V(e._id,e.name),children:e.name},s))]})]}),a.jsx(K,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),ee?a.jsx(J,{}):a.jsxs(O,{children:[a.jsx(Q,{children:a.jsxs(y,{children:[a.jsx(i,{scope:"col",children:"#"}),a.jsx(i,{scope:"col",children:"First Name"}),a.jsx(i,{scope:"col",children:"Last Name"}),a.jsx(i,{scope:"col",children:"Email"}),a.jsx(i,{scope:"col",children:"Phone"}),a.jsx(i,{scope:"col",children:"Country"}),a.jsx(i,{scope:"col",children:"Employee ID"}),a.jsx(i,{scope:"col",children:"Language"}),a.jsx(i,{scope:"col",children:"Group"}),a.jsx(i,{scope:"col",children:"Add Market Group"})]})}),a.jsx(W,{children:Y.map((e,s)=>a.jsxs(y,{children:[a.jsx(n,{children:s+1}),a.jsx(n,{children:e.name}),a.jsx(n,{children:e.surname}),a.jsx(n,{children:e.email}),a.jsx(n,{children:e.contact}),a.jsx(n,{children:e.country==="it"||e.country==="Italy"?"Italy":e.country}),a.jsx(n,{children:e.employeeId?e.employeeId:a.jsx(G,{color:"warning",children:"Not Provide"})}),a.jsx(n,{children:e.language==="en"?"English":e.language==="it"?"Italy":e.language==="es"?"Spanish":e.language}),a.jsx(n,{children:e.groups.map((o,r)=>a.jsx("div",{children:o.name},r))}),a.jsx(n,{children:e.groups.length>0?a.jsx(C,{size:"sm",onClick:()=>q(e.groups,e.id),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Assign"}):a.jsx(C,{size:"sm",onClick:()=>q(e.groups,e.id),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Add"})})]},s))})]}),a.jsxs(De,{alignment:"center",visible:E,scrollable:!0,size:"xl",onClose:()=>f(!1),children:[a.jsx(be,{closeButton:!0,children:a.jsx(Ge,{children:"Market Group Assign"})}),a.jsxs(Ae,{children:[a.jsx(G,{style:{marginLeft:"74%"},color:"secondary",children:"Filter by"}),a.jsxs(A,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[a.jsx(S,{style:{color:"white"},children:ce}),a.jsxs(v,{children:[a.jsx(u,{onClick:()=>h("all","modal"),children:"All"}),a.jsx(u,{onClick:()=>h("Milano","modal"),children:"Milano"}),a.jsx(u,{onClick:()=>h("Napoli","modal"),children:"Napoli"})]})]}),a.jsx(K,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),he?a.jsx(J,{}):a.jsxs(O,{children:[a.jsx(Q,{children:a.jsxs(y,{children:[a.jsx(i,{scope:"col",children:"#"}),a.jsx(i,{scope:"col",children:"Name"}),a.jsx(i,{scope:"col",children:"City"}),a.jsx(i,{scope:"col",children:"Location"})]})}),a.jsx(W,{children:de.map((e,s)=>a.jsxs(y,{children:[a.jsx(n,{children:j+s+1}),a.jsx(n,{children:e.name}),a.jsx(n,{children:e.city}),a.jsx(n,{children:ne.map(o=>o.id).includes(e._id)?a.jsx(C,{size:"sm",onClick:()=>Ce(I,e._id),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Remove"}):a.jsx(C,{size:"sm",onClick:()=>je(I,e._id),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Add"})})]},s))})]})]}),a.jsx(Se,{children:a.jsxs(ve,{"aria-label":"Page navigation example",children:[a.jsx(X,{disabled:j<=0,onClick:xe,children:"Previous"}),a.jsx(X,{disabled:pe===!0,onClick:fe,children:"Next"})]})})]})]})};export{He as default};
