import{B as fe,r as t,y as ge,A as i,j as e,h as H,m as Ce}from"./index-vIOSoMUu.js";import{B as f}from"./config-HOLfLxHr.js";import{a as g}from"./axios-Cm0UX6qg.js";import{b as pe,a as j}from"./CContainer-DQqje6Yb.js";import{C as F}from"./CNavbar-CKkucrSO.js";import{C as U,a as V,b as y,c as d,d as q,e as c}from"./CTable-CA_T2BdW.js";import{c as xe}from"./cil-trash-CBbKHhHb.js";import{C as je,a as ye,b as ke,c as Me}from"./CModalTitle-UWL2UZXd.js";import{C as be,a as G,b as I,c as J,d as C}from"./DefaultLayout-CKhc0dtY.js";import{C as Ae}from"./CModalFooter-CdxMNKJi.js";import{C as we,a as K}from"./CPaginationItem-4rDKfmAB.js";const Ve=()=>{const{id:h}=fe(),[O,Q]=t.useState([]),[W,u]=t.useState(!1),[{user:m,token:n},r]=ge(),[X,p]=t.useState(!1),[Y,A]=t.useState(!1),[Z,w]=t.useState("All Cities"),[ee,S]=t.useState("All Chains"),[D,v]=t.useState(""),[P,E]=t.useState(""),[Se,B]=t.useState(""),[De,T]=t.useState("All Cities"),[ve,z]=t.useState(""),[Pe,L]=t.useState("All Chains"),[Ee,ae]=t.useState([]),[se,te]=t.useState([]),[oe,le]=t.useState([]),[re,N]=t.useState(!0),[x,$]=t.useState(0),[ie,ne]=t.useState([]);t.useEffect(()=>{console.log("id",h),k(h)},[]);const k=a=>{a?(console.log("id",a),m&&n?(u(!0),g.get(f+"promotion/all/markets/"+a,{headers:{Authorization:`Bearer ${n}`}}).then(s=>{s.status===200?(console.log("market",s.data.market),Q(s.data.market),ne(s.data.market.map(o=>o._id)),u(!1)):s.status===203?(u(!1),r({type:i,payload:{status:!0,title:" markets loading error",message:s.data.message}})):s.status===500&&(u(!1),r({type:i,payload:{status:!0,title:" markets loading error",message:s.data.message}}))})):(u(!1),r({type:i,payload:{status:!0,title:" markets loading error",message:"No user or token found"}}))):r({type:i,payload:{status:!0,title:" markets loading error",message:"No id found"}})};t.useEffect(()=>{de()},[]);const de=()=>{n&&g.get(f+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${n}`}}).then(a=>{a.status===200?(ae(a.data),te(a.data)):a.status===500&&r({type:i,payload:{status:!0,title:"Chain Loading error",message:a.data.message}})}).catch(a=>{console.error("Error: ",a)})},M=(a,s)=>{s==="view"?a==="all"?(z(""),T("All Cities")):(z(a),T(a)):s==="modal"&&(a==="all"?(E(""),w("All Cities")):(E(a),w(a)))},_=(a,s,o)=>{o==="view"?a==="all"?(B(""),L("All Chains")):(B(a),L(s)):o==="modal"&&(a==="all"?(v(""),S("All Chains")):(v(a),S(s)))};t.useEffect(()=>{m&&n&&b(0)},[D,P,m]);const b=(a,s)=>{A(!0),g.get(f+`assistant/market/locations/${a}?brand=${D}&city=${P}`,{headers:{Authorization:`Bearer ${n}`}}).then(o=>{o.status===200?(le(o.data.data),console.log("data market"),A(!1),o.data.data.length<20?(N(!0),console.log("ok")):o.data.data.length>19&&N(!1)):o.status===500&&r({type:i,payload:{status:!0,title:"Market Loading error",message:o.data.message}})}).catch(o=>{console.error("Error: ",o)})},ce=()=>{const a=x+20;$(a),b(a)},he=()=>{const a=x-20;console.log(a),$(a),b(a)},ue=()=>{p(!0)},me=(a,s)=>{if(s&&a){const o={marketId:s};n&&m&&n&&g.patch(f+"promotion/add/market/"+a,o,{headers:{Authorization:`Bearer ${n}`}}).then(l=>{l.status===200?(p(!1),k(a),r({type:i,payload:{status:!0,title:"Market Assign",message:"successfully Market assigned to the promotion",color:"success"}})):l.status===400?r({type:i,payload:{status:!0,title:"Market Assign error",message:l.data.message,color:"warning"}}):l.status===404?r({type:i,payload:{status:!0,title:"Market Assign error",message:l.data.message,color:"warning"}}):l.status===500&&r({type:i,payload:{status:!0,title:"Market Assign error",message:l.data.message,color:"warning"}})}).catch(l=>{console.error("Error:",l)})}else r({type:i,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},R=(a,s)=>{if(s&&a){const o={marketId:s};n&&m&&n&&g.patch(f+"promotion/remove/market/"+a,o,{headers:{Authorization:`Bearer ${n}`}}).then(l=>{l.status===200?(k(a),p(!1),r({type:i,payload:{status:!0,title:"Market Assign",message:"successfully Market removed from the promotion",color:"success"}})):l.status===204?r({type:i,payload:{status:!0,title:"Market remove error",message:l.data.message,color:"warning"}}):l.status===500&&r({type:i,payload:{status:!0,title:"Market remove error",message:l.data.message,color:"warning"}})}).catch(l=>{console.error("Error:",l)})}else r({type:i,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})};return e.jsxs(pe,{children:[e.jsx(j,{onClick:()=>{ue()},style:{marginLeft:"0%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Add Market"}),e.jsx(F,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),W?e.jsx(H,{}):e.jsxs(U,{children:[e.jsx(V,{children:e.jsxs(y,{children:[e.jsx(d,{scope:"col",children:"#"}),e.jsx(d,{scope:"col",children:"Name"}),e.jsx(d,{scope:"col",children:"Address"}),e.jsx(d,{scope:"col",children:"City"}),e.jsx(d,{scope:"col",children:"Remove Market "})]})}),e.jsx(q,{children:O.map((a,s)=>e.jsxs(y,{children:[e.jsx(c,{children:s+1}),e.jsx(c,{children:a.chain.name}),e.jsx(c,{children:a.address}),e.jsx(c,{children:a.city}),e.jsx(c,{children:e.jsx(j,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>{R(h,a._id)},children:e.jsx(Ce,{icon:xe,size:"lg",style:{color:"white"}})})})]},s))})]}),e.jsxs(je,{visible:X,scrollable:!0,size:"xl",onClose:()=>p(!1),children:[e.jsx(ye,{closeButton:!0,children:e.jsx(ke,{children:"Market assign view"})}),e.jsxs(Me,{children:[e.jsx(be,{style:{marginLeft:"54%"},color:"secondary",children:"Filter by"}),e.jsxs(G,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(I,{style:{color:"white"},children:Z}),e.jsxs(J,{children:[e.jsx(C,{onClick:()=>M("all","modal"),children:"All"}),e.jsx(C,{onClick:()=>M("Milano","modal"),children:"Milano"}),e.jsx(C,{onClick:()=>M("Napoli","modal"),children:"Napoli"})]})]}),e.jsxs(G,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(I,{style:{color:"white"},children:ee}),e.jsxs(J,{children:[e.jsx(C,{onClick:()=>_("all",null,"modal"),children:"All"}),se.map((a,s)=>e.jsx(C,{onClick:()=>_(a.id,a.name,"modal"),children:a.name},s))]})]}),e.jsx(F,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),Y?e.jsx(H,{}):e.jsxs(U,{children:[e.jsx(V,{children:e.jsxs(y,{children:[e.jsx(d,{scope:"col",children:"#"}),e.jsx(d,{scope:"col",children:"Name"}),e.jsx(d,{scope:"col",children:"Address"}),e.jsx(d,{scope:"col",children:"City"}),e.jsx(d,{scope:"col",children:"Measurement"}),e.jsx(d,{scope:"col"})]})}),e.jsx(q,{children:oe.map((a,s)=>e.jsxs(y,{children:[e.jsx(c,{children:x+s+1}),e.jsx(c,{children:a.chain.name}),e.jsx(c,{children:a.address}),e.jsx(c,{children:a.city}),e.jsx(c,{children:a.scraped}),e.jsx(c,{children:ie.includes(a._id)?e.jsx(j,{size:"sm",onClick:()=>R(h,a._id),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Remove"}):e.jsx(j,{size:"sm",onClick:()=>me(h,a._id),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Add"})})]},s))})]}),e.jsx(Ae,{children:e.jsxs(we,{"aria-label":"Page navigation example",children:[e.jsx(K,{disabled:x<=0,onClick:he,children:"Previous"}),e.jsx(K,{disabled:re===!0,onClick:ce,children:"Next"})]})})]})]})]})};export{Ve as default};
