import{r as t,y as Be,A as d,j as e,h as ae}from"./index-HuPlWL3O.js";import{a as f}from"./axios-Cm0UX6qg.js";import{B as x}from"./config-HOLfLxHr.js";import{b as $e,a as D}from"./CContainer-CEyMh38M.js";import{C as se,a as C,b as y,d as k,e as h}from"./DefaultLayout-DaRxHJhP.js";import{C as te}from"./CNavbar-CEL_iAib.js";import{C as le,a as re,b as M,c as i,d as oe,e as o}from"./CTable-Bbt1Gt8e.js";import{C as ze,a as Ge,b as Re,c as _e}from"./CModalTitle-uHuXCtFq.js";import{C as Fe}from"./CModalFooter--x-yC4vX.js";import{C as He,a as ie}from"./CPaginationItem-DbvxjRQn.js";const Ye=()=>{const[G,w]=t.useState(!1),[{user:m,token:n},c]=Be(),[A,P]=t.useState([]),[ne,v]=t.useState(!1),[ce,R]=t.useState(!1),[_,F]=t.useState(""),[H,I]=t.useState(""),[U,V]=t.useState("");t.useState(!1),t.useState("");const[de,he]=t.useState(!1),[ue,q]=t.useState("All Cities"),[pe,J]=t.useState("All Market Groups"),[ge,K]=t.useState("All Chains"),[fe,xe]=t.useState([]),[me,je]=t.useState([]),[Ce,E]=t.useState("All Cities"),[ye,T]=t.useState("All Chains"),[ke,Me]=t.useState([]),[O,L]=t.useState(""),[Q,N]=t.useState(""),[we,Ae]=t.useState([]),[S,W]=t.useState(0),[X,B]=t.useState(""),[Se,$]=t.useState(""),[be,Y]=t.useState(!0);t.useEffect(()=>{De(),Pe()},[]);const De=()=>{n&&f.get(x+"market/groups/dropdown/fetch",{headers:{Authorization:`Bearer ${n}`}}).then(a=>{a.status===200?xe(a.data):a.status===500&&c({type:d,payload:{status:!0,title:"Market Group Loading error",message:a.data.message}})}).catch(a=>{console.error("Error: ",a)})},Pe=()=>{n&&f.get(x+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${n}`}}).then(a=>{a.status===200?(je(a.data),Me(a.data)):a.status===500&&c({type:d,payload:{status:!0,title:"Chain Loading error",message:a.data.message}})}).catch(a=>{console.error("Error: ",a)})};t.useEffect(()=>{const a=setTimeout(()=>{c({type:d,payload:{status:!0,title:"Data Loading",message:"Data loading error: Timeout exceeded",color:"warning"}}),v(!1)},2e4);return ve(a),()=>{clearTimeout(a)}},[_,H,U,de]);const ve=a=>{m&&n&&(v(!0),f.get(x+`assistant/shoppers/:skip?city=${_}&group=${H}&chain=${U}`,{headers:{Authorization:`Bearer ${n}`}}).then(s=>{s.status===200?(P(s.data),v(!1),he(!1),clearTimeout(a)):s.status===500&&c({type:d,payload:{status:!0,title:"Error",message:s.data.message,color:"warning"}})}).catch(s=>{console.error("Error:",s)}))},g=(a,s)=>{s==="view"?a==="all"?(F(""),q("All Cities")):(F(a),q(a)):s==="modal"&&(a==="all"?(L(""),E("All Cities")):(L(a),E(a)))},Z=(a,s)=>{a==="all"?(I(""),J("All Market Groups")):(I(a),J(s))},b=(a,s,r)=>{r==="view"?a==="all"?(V(""),K("All Chains")):(V(a),K(s)):r==="modal"&&(a==="all"?(N(""),T("All Chains")):(N(a),T(s)))},ee=(a,s)=>{L(""),N(""),E("All Cities"),T("All Chains"),w(!G),console.log(a,s),B(a),$(s)};t.useEffect(()=>{m&&n&&z(0)},[Q,O,m]);const z=(a,s)=>{R(!0),f.get(x+`assistant/market/locations/${a}?brand=${Q}&city=${O}`,{headers:{Authorization:`Bearer ${n}`}}).then(r=>{r.status===200?(Ae(r.data.data),console.log("data market"),R(!1),r.data.data.length<20?(Y(!0),console.log("ok")):r.data.data.length>19&&Y(!1)):r.status===500&&c({type:d,payload:{status:!0,title:"Market Loading error",message:r.data.message}})}).catch(r=>{console.error("Error: ",r)})},Ee=()=>{const a=S+20;W(a),z(a)},Te=()=>{const a=S-20;console.log(a),W(a),z(a)},Le=(a,s)=>{if(s&&a){const r={market:s,shopper:a};n&&m&&n&&f.post(x+"assistant/picker/assign/market",r,{headers:{Authorization:`Bearer ${n}`}}).then(l=>{if(l.status===200){w(!1),B(""),$("");const p=l.data,u=A.map(j=>j.id===p.id?p:j);P([...u]),c({type:d,payload:{status:!0,title:"Market Assign",message:"successfully Market assigned to the picker ",color:"success"}})}else l.status===204?c({type:d,payload:{status:!0,title:"Market Assign error",message:l.data.message,color:"warning"}}):l.status===500&&c({type:d,payload:{status:!0,title:"Market Assign error",message:l.data.message,color:"warning"}})}).catch(l=>{console.error("Error:",l)})}else c({type:d,payload:{status:!0,title:"Error!",message:"Picker Registration error, Please Check the input fields",color:"warning"}})},Ne=(a,s)=>{if(s&&a){const r={market:s,shopper:a};n&&m&&n&&f.post(x+"assistant/picker/remove/market",r,{headers:{Authorization:`Bearer ${n}`}}).then(l=>{if(l.status===200){w(!1),B(""),$("");const p=l.data,u=A.map(j=>j.id===p.id?p:j);P([...u]),c({type:d,payload:{status:!0,title:"Market Assign",message:"successfully Market removed from the picker ",color:"success"}})}else l.status===204?c({type:d,payload:{status:!0,title:"Market remove error",message:l.data.message,color:"warning"}}):l.status===500&&c({type:d,payload:{status:!0,title:"Market remove error",message:l.data.message,color:"warning"}})}).catch(l=>{console.error("Error:",l)})}else c({type:d,payload:{status:!0,title:"Error!",message:"Picker Registration error, Please Check the input fields",color:"warning"}})};return e.jsxs($e,{children:[e.jsx(se,{style:{marginLeft:"34%"},color:"secondary",children:"Filter by"}),e.jsxs(C,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(y,{style:{color:"white"},children:ue}),e.jsxs(k,{children:[e.jsx(h,{onClick:()=>g("all","view"),children:"All"}),e.jsx(h,{onClick:()=>g("Milan","view"),children:"Milan"}),e.jsx(h,{onClick:()=>g("Napoli","view"),children:"Napoli"})]})]}),e.jsxs(C,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(y,{style:{color:"white"},children:ge}),e.jsxs(k,{children:[e.jsx(h,{onClick:()=>b("all",null,"view"),children:"All"}),me.map((a,s)=>e.jsx(h,{onClick:()=>b(a.id,a.name,"view"),children:a.name},s))]})]}),e.jsxs(C,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(y,{style:{color:"white"},children:pe}),e.jsxs(k,{children:[e.jsx(h,{onClick:()=>Z("all"),children:"All"}),fe.map((a,s)=>e.jsx(h,{onClick:()=>Z(a._id,a.name),children:a.name},s))]})]}),e.jsx(te,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),ne?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(ae,{style:{marginTop:"15%"}})}):e.jsxs(le,{children:[e.jsx(re,{children:e.jsxs(M,{children:[e.jsx(i,{scope:"col",children:"#"}),e.jsx(i,{scope:"col",children:"First Name"}),e.jsx(i,{scope:"col",children:"Last Name"}),e.jsx(i,{scope:"col",children:"Email"}),e.jsx(i,{scope:"col",children:"Phone"}),e.jsx(i,{scope:"col",children:"Country"}),e.jsx(i,{scope:"col",children:"City"}),e.jsx(i,{scope:"col",children:"Language"}),e.jsx(i,{scope:"col",children:"Market"}),e.jsx(i,{scope:"col",children:"Add Market"})]})}),e.jsx(oe,{children:A.length===0?e.jsx(M,{children:e.jsx(o,{colSpan:"10",style:{textAlign:"center",backgroundColor:"white"},children:e.jsx("h6",{style:{marginTop:"1%"},children:"No Data"})})}):A.map((a,s)=>{var r,l,p;return e.jsxs(M,{children:[e.jsx(o,{children:s+1}),e.jsx(o,{children:a.name}),e.jsx(o,{children:a.surname}),e.jsx(o,{children:a.email}),e.jsx(o,{children:a.contact}),e.jsx(o,{children:a.country==="it"||a.country==="Italy"?"Italy":a.country}),e.jsx(o,{children:a.city}),e.jsx(o,{children:a.language==="en"?"English":a.language==="it"?"Italy":a.language==="es"?"Spanish":a.language}),e.jsxs(o,{children:[(l=(r=a.market)==null?void 0:r.chain)==null?void 0:l.name," - ",a.market.address]}),e.jsx(o,{children:(p=a.market)!=null&&p.id?e.jsx(D,{size:"sm",onClick:()=>{var u;return ee(a.id,(u=a.market)==null?void 0:u.id)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Assign"}):e.jsx(D,{size:"sm",onClick:()=>{var u;return ee(a.id,(u=a.market)==null?void 0:u.id)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Add"})})]},s)})})]}),e.jsxs(ze,{visible:G,scrollable:!0,size:"xl",onClose:()=>w(!1),children:[e.jsx(Ge,{closeButton:!0,children:e.jsx(Re,{children:"Market assign view"})}),e.jsxs(_e,{children:[e.jsx(se,{style:{marginLeft:"54%"},color:"secondary",children:"Filter by"}),e.jsxs(C,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(y,{style:{color:"white"},children:Ce}),e.jsxs(k,{children:[e.jsx(h,{onClick:()=>g("all","modal"),children:"All"}),e.jsx(h,{onClick:()=>g("Milano","modal"),children:"Milano"}),e.jsx(h,{onClick:()=>g("Napoli","modal"),children:"Napoli"})]})]}),e.jsxs(C,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(y,{style:{color:"white"},children:ye}),e.jsxs(k,{children:[e.jsx(h,{onClick:()=>b("all",null,"modal"),children:"All"}),ke.map((a,s)=>e.jsx(h,{onClick:()=>b(a.id,a.name,"modal"),children:a.name},s))]})]}),e.jsx(te,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),ce?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(ae,{style:{marginTop:"15%"}})}):e.jsxs(le,{children:[e.jsx(re,{children:e.jsxs(M,{children:[e.jsx(i,{scope:"col",children:"#"}),e.jsx(i,{scope:"col",children:"Name"}),e.jsx(i,{scope:"col",children:"Address"}),e.jsx(i,{scope:"col",children:"City"}),e.jsx(i,{scope:"col",children:"Measurement"}),e.jsx(i,{scope:"col"})]})}),e.jsx(oe,{children:we.map((a,s)=>e.jsxs(M,{children:[e.jsx(o,{children:S+s+1}),e.jsx(o,{children:a.chain.name}),e.jsx(o,{children:a.address}),e.jsx(o,{children:a.city}),e.jsx(o,{children:a.scraped}),e.jsx(o,{children:Se===a._id?e.jsx(D,{size:"sm",onClick:()=>Ne(X,a._id),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Remove"}):e.jsx(D,{size:"sm",onClick:()=>Le(X,a._id),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Add"})})]},s))})]}),e.jsx(Fe,{children:e.jsxs(He,{"aria-label":"Page navigation example",children:[e.jsx(ie,{disabled:S<=0,onClick:Te,children:"Previous"}),e.jsx(ie,{disabled:be===!0,onClick:Ee,children:"Next"})]})})]})]})]})};export{Ye as default};
