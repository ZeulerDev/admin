import{y as Ee,r,A as u,j as a,h as Ne,L as Be,m as Le}from"./index-CUWfyW-O.js";import{a as f}from"./axios-Cm0UX6qg.js";import{B as j}from"./config-HOLfLxHr.js";import{b as $e,a as X}from"./CContainer-BItPl6AZ.js";import{C as ze,a as Y,b as Z,d as ee,e as I}from"./DefaultLayout-DhMnxolp.js";import{C as Fe}from"./CNavbar-DtbDRkDL.js";import{C as ae}from"./CFormInput-D-GUVRHw.js";import{C as Re,a as Qe,b as L,c,d as He,e as n}from"./CTable-DCkylyCt.js";import{C as te}from"./CCardImage-2oki6Tdu.js";import{c as Ve}from"./cil-pencil-m516yCOw.js";import{C as _e,a as $}from"./CPaginationItem-H7icVTj5.js";import{C as se,a as re,b as le,c as oe}from"./CModalTitle-CVe0vSxH.js";import{C as ce}from"./CModalFooter-ZYN1WUD3.js";import"./CFormLabel-D70FFWaS.js";const oa=()=>{const[{user:C,token:i},d]=Ee(),[ne,h]=r.useState(!1),[D,z]=r.useState([]),[y,M]=r.useState(0),[ie,k]=r.useState(!0),[de,ue]=r.useState([]),[pe,A]=r.useState("All Chains"),[w,P]=r.useState("All market"),[Oe,T]=r.useState(""),[F,b]=r.useState(""),[he,R]=r.useState([]),[p,g]=r.useState(""),[ge,Q]=r.useState(p),[xe,U]=r.useState(!1),[me,H]=r.useState(""),[v,V]=r.useState(""),[fe,_]=r.useState(""),[je,Ce]=r.useState(0),[S,E]=r.useState(1);r.useState("NAME");const[O,N]=r.useState(!1),[ye,q]=r.useState("");r.useEffect(()=>{C&&i&&x(0)},[C,i,F,ge]),r.useEffect(()=>{const e=setTimeout(()=>{(p.length>=3||p.length===0)&&Q(p)},500);return()=>{clearTimeout(e)}},[p]),r.useEffect(()=>{i&&f.get(j+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${i}`}}).then(e=>{e.status===200?ue(e.data):e.status===500&&d({type:u,payload:{status:!0,title:"Chain Loading error",message:e.data.message}})}).catch(e=>{console.error("Error: ",e)})},[]);const ke=e=>{f.get(j+`assistant/market/locations?brand=${e}`,{headers:{Authorization:`Bearer ${i}`}}).then(t=>{t.status===200?(R(t.data.data),t.data.data.length<20?(k(!0),console.log("ok")):t.data.data.length>19&&k(!1)):t.status===500&&d({type:u,payload:{status:!0,title:"Market Loading error",message:t.data.message}})}).catch(t=>{console.error("Error: ",t)})},x=(e,t)=>{h(!0),f.get(j+`product/all/${e}?marketId=${F}&name=${p}`,{headers:{Authorization:`Bearer ${i}`}}).then(s=>{s.status===200?(z(s.data.list),Ce(s.data.count),h(!1),s.data.list.length<20?(k(!0),console.log("ok")):s.data.list.length>19&&k(!1)):s.status===203?(h(!1),d({type:u,payload:{status:!0,title:"product loading error error",message:s.data.message}})):s.status===204?h(!1):s.status===500&&(h(!1),d({type:u,payload:{status:!0,title:"product loading error error",message:s.data.message}}))}).catch(s=>{h(!1),console.error("Error:",s)})},G=(e,t)=>{e==="all"?(T(""),A("All Chains"),b(""),P("All Markets"),g("")):(T(e),ke(e),A(t),P("All Markets"),g(""),b(""))},J=(e,t)=>{e==="all"?(b(""),P("All Markets"),T(""),A("All Chains"),R([]),g("")):(b(e),P(t),g(""))},Pe=()=>{E(S+1);const e=y+50;M(e),x(e)},be=()=>{E(S-1);const e=y-50;console.log(e),M(e),x(e)},Se=(e,t)=>{U(!0),H(e),_(t)},Ie=()=>{console.log("called"),v==""?d({type:u,payload:{status:!0,title:"Alert",message:"Please enter the price",color:"warning"}}):Ae(me)},De=e=>{E(e);const t=(e-1)*50;M(t),x(t)},Me=()=>{const e=Math.ceil(je/50),t=[];for(let l=1;l<=e;l++)t.push(l);const s=Math.max(S-2,1),o=Math.min(s+4,e);return t.slice(s-1,o).map(l=>a.jsx($,{active:S===l,onClick:()=>De(l),children:l},l))},Ae=e=>{if(e){let t={price:v+" â‚¬"};C&&i&&f.put(j+"product/update/price/"+e,t,{headers:{Authorization:`Bearer ${i}`}}).then(s=>{if(s.status===200){const o=s.data,m=D.map(l=>(l.productId===o.productId&&(l.price.basePrice=o.price.basePrice,l.price.tax=o.price.tax,l.price.markup=o.price.markup,l.price.total=o.price.total),l));z([...m]),d({type:u,payload:{status:!0,title:"Product Details Update",message:"Product price update Success",color:"success"}}),H(""),V(""),U(!1),_("")}else s.status===204?d({type:u,payload:{status:!0,title:"Product Details Update error",message:s.data.message,color:"danger"}}):s.status===500&&d({type:u,payload:{status:!0,title:"Product Details Update error",message:s.data.message,color:"danger"}})}).catch(s=>{console.error("Error:",s)})}else alert("Please Check the Fields!")},we=e=>{N(!O),q(e)},[Te,B]=r.useState(null),[K,W]=r.useState(null),Ue=e=>{console.log(e),W(URL.createObjectURL(e)),B(e)},ve=async(e,t)=>{if(console.log(e,t),C&&i){const s=new FormData;s.append("image",t),s.append("id",e),f.post(j+"test/product/image/update",s,{headers:{Authorization:`Bearer ${i}`}}).then(o=>{o.status===200?(N(!1),q(""),B(null),console.log("response",o.data),d({type:u,payload:{status:!0,title:"Image upload ",message:"Image upload success",color:"success"}}),x(0)):o.status===500&&d({type:u,payload:{status:!0,title:"Image upload error",message:o.data.message,color:"danger"}})}).catch(o=>{console.error("Error:",o)})}};return a.jsxs($e,{children:[a.jsx(ze,{style:{marginLeft:"57%"},color:"secondary",children:"Filter by"}),a.jsxs(Y,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[a.jsx(Z,{style:{color:"white"},children:pe}),a.jsxs(ee,{children:[a.jsx(I,{onClick:()=>G("all"),children:"All"}),de.map((e,t)=>a.jsx(I,{onClick:()=>G(e.id,e.name),children:e.name},t))]})]}),a.jsxs(Y,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[a.jsx(Z,{style:{color:"white"},children:w.length>15?`${w.substring(0,15)}...`:w}),a.jsxs(ee,{children:[a.jsx(I,{onClick:()=>J("all"),children:"Select the Chain"}),he.map((e,t)=>a.jsx(I,{onClick:()=>J(e._id,e.address),children:a.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[a.jsx("span",{children:e.address.substring(0,e.address.length/2)}),a.jsx("span",{children:e.address.substring(e.address.length/2)})]})},t))]})]}),a.jsx(Fe,{style:{marginTop:"1%"},className:"bg-body-tertiary",children:a.jsx(ae,{type:"text",placeholder:"Search products by name, brand name and product id",style:{width:450,marginRight:"60%"},value:p,onChange:e=>g(e.target.value)})}),ne?a.jsx("div",{className:"d-flex justify-content-center",children:a.jsx(Ne,{style:{marginTop:"15%"}})}):a.jsxs(Re,{children:[a.jsx(Qe,{children:a.jsxs(L,{children:[a.jsx(c,{scope:"col",children:"#"}),a.jsx(c,{scope:"col",children:"Product Id"}),a.jsx(c,{scope:"col",children:"Photo"}),a.jsx(c,{scope:"col",children:"Name"}),a.jsx(c,{scope:"col",children:"Base Price"}),a.jsx(c,{scope:"col",children:"Tax"}),a.jsx(c,{scope:"col",children:"Markup Percentage "}),a.jsx(c,{scope:"col",children:"Markup"}),a.jsx(c,{scope:"col",children:"Total"}),a.jsx(c,{scope:"col",children:"Brand"}),a.jsx(c,{scope:"col",children:"Chain"}),a.jsx(c,{scope:"col",children:"Market Address"})]})}),a.jsx(He,{children:D.length===0?a.jsx(L,{children:a.jsx(n,{colSpan:"12",style:{textAlign:"center",backgroundColor:"white"},children:a.jsx("h6",{style:{marginTop:"1%"},children:"No Data"})})}):D.map((e,t)=>{var s,o,m,l;return a.jsxs(L,{children:[a.jsx(n,{children:y+t+1}),a.jsx(n,{children:e.pid}),a.jsx(c,{onClick:()=>{we(e.productId)},children:a.jsx(te,{style:{width:"50px",height:"50px"},src:"https://api.zeuler.com/image/"+e.image})}),a.jsx(n,{children:e.name}),a.jsxs(n,{children:[(((s=e.price)==null?void 0:s.basePrice)??0).toFixed(2),a.jsx(Be,{to:"",children:a.jsx(Le,{icon:Ve,size:"sm",onClick:()=>Se(e.productId,e.price.basePrice)})})]}),a.jsx(n,{children:(((o=e.price)==null?void 0:o.tax)??0).toFixed(2)}),a.jsxs(n,{children:[e.price.percentage,"%"]}),a.jsx(n,{children:(((m=e.price)==null?void 0:m.markup)??0).toFixed(2)}),a.jsx(n,{children:(((l=e.price)==null?void 0:l.total)??0).toFixed(2)}),a.jsx(n,{children:e.brand}),a.jsx(n,{children:e.chainName}),a.jsx(n,{children:e.marketAddress})]},t)})})]}),a.jsxs(_e,{"aria-label":"Page navigation example",children:[a.jsx($,{disabled:y<=0,onClick:be,children:"Previous"}),Me(),a.jsx($,{disabled:ie===!0,onClick:Pe,children:"Next"})]}),a.jsxs(se,{alignment:"center",visible:xe,scrollable:!0,size:"sm",onClose:()=>U(!1),children:[a.jsx(re,{closeButton:!0,children:a.jsx(le,{children:"Change Price"})}),a.jsxs(oe,{children:[a.jsx("a",{children:"Enter New Price"}),a.jsx("br",{}),a.jsx(ae,{type:"text",placeholder:fe,value:v,onChange:e=>V(e.target.value)})]}),a.jsx(ce,{children:a.jsx(X,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>Ie(),children:"Save changes"})})]}),a.jsxs(se,{alignment:"center",visible:O,scrollable:!0,size:"lg",onClose:()=>{N(!1),B(null),W(null)},children:[a.jsx(re,{closeButton:!0,children:a.jsx(le,{children:"Image Uploader"})}),a.jsxs(oe,{children:[K&&a.jsx(te,{style:{width:"100px",height:"100px"},src:K,alt:"Uploaded Image"}),a.jsx("input",{style:{marginLeft:"5%"},type:"file",accept:".jpg, .jpeg, .png",onChange:e=>Ue(e.target.files[0])})]}),a.jsx(ce,{children:a.jsx(X,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>{ve(ye,Te)},children:"Upload Image"})})]})]})};export{oa as default};
