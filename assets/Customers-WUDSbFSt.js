import{r,y as ge,l as je,A as d,j as e,h as U,L as P,m as N}from"./index-C5Bwpkvq.js";import{a as w}from"./axios-Cm0UX6qg.js";import{B as j}from"./config-HOLfLxHr.js";import{b as Ce,a as fe}from"./CContainer-C1WIjXH1.js";import{C as ye}from"./CNavbar-BSl6MFMs.js";import{C as h}from"./CFormInput-B7GuH3nF.js";import{C as Z,a as Y,b as C,c as o,d as q,e as l}from"./CTable-DFNtBtEq.js";import{C as be}from"./CCardImage-hP7BPIm1.js";import{c as Se}from"./cil-pencil-m516yCOw.js";import{c as ve}from"./cil-info-CmGCY32x.js";import{C as Pe,a as E}from"./CPaginationItem-CmD2twZ8.js";import{C as J,a as K,b as W,c as X}from"./CModalTitle-D6Hg3qg_.js";import{C as Ne}from"./CModalFooter-C5wvQAvz.js";import{C as m}from"./CCol-O325NQfN.js";import"./CFormLabel-Cogh2aXj.js";import"./DefaultLayout-C-xguh5Y.js";var we=["512 512","<rect width='288' height='32' x='112' y='152' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='288' height='32' x='112' y='240' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='152' height='32' x='112' y='328' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M480,48H32V464H480ZM448,432H64V80H448Z' class='ci-primary'/>"];const Ge=()=>{const[T,I]=r.useState(!1),[{user:f,token:c},n]=ge();je();const[M,k]=r.useState([]),[O,ee]=r.useState([]),[se,B]=r.useState(!1),[te,y]=r.useState(!1),[x,b]=r.useState(0),[D,S]=r.useState(!1),[u,ae]=r.useState([]),[L,A]=r.useState(),[z,H]=r.useState(),[V,R]=r.useState(),[F,_]=r.useState(),[v,re]=r.useState(""),[oe,$]=r.useState(!0),[le,ie]=r.useState(0);r.useState(0),r.useEffect(()=>{const s=setTimeout(()=>{n({type:d,payload:{status:!0,title:"Data Loading",message:"Data loading error: Timeout exceeded",color:"warning"}}),y(!1)},2e4);return f&&c&&p(0,s),()=>{clearTimeout(s)}},[f,c,v]);const p=(s,t)=>{y(!0),w.get(j+"assistant/customers/"+s+"?email="+v,{headers:{Authorization:`Bearer ${c}`}}).then(a=>{a.status===200?(k(a.data.list),ie(a.data.count),y(!1),clearTimeout(t),console.log(j),a.data.list.length<50?($(!0),console.log("ok")):a.data.list.length>49&&$(!1)):a.status===500&&n({type:d,payload:{status:!0,title:"Customers loading error",message:a.data.message}})}).catch(a=>{console.error("Error:",a)})},ce=()=>{const s=x+50;b(s),p(s,!0)},ne=()=>{const s=x-50;console.log(s),b(s),p(s,!1)},de=s=>{I(!T),c&&(B(!0),w.get(j+"assistant/addresses/customer/"+s,{headers:{Authorization:`Bearer ${c}`}}).then(t=>{t.status===200?(console.log(t.data),ee(t.data),B(!1)):t.status===500&&n({type:d,payload:{status:!0,title:"Customers address error",message:t.data.message}})}).catch(t=>{console.error("Customers address:",t)}))},ue=s=>{console.log(s),S(!D),ae(s),A(s.name),H(s.surname),R(s.email),_(s.contact)},he=()=>{if(L&&z&&V&&F){const s={name:L,surname:z,email:V,contact:F},t=u.id;c&&f&&c&&w.patch(j+"assistant/customers/update/"+t,s,{headers:{Authorization:`Bearer ${c}`}}).then(a=>{if(a.status===200){S(!1);const g=a.data,Q=M.map(i=>i.id===g.id?g:i);k([...Q])}else a.status===203?n({type:d,payload:{status:!0,title:"Customer update error",message:a.data.message,color:"warning"}}):a.status===204?n({type:d,payload:{status:!0,title:"Customer update error",message:a.data.message,color:"warning"}}):a.status===500&&n({type:d,payload:{status:!0,title:"Customer update error",message:a.data.message,color:"warning"}})}).catch(a=>{console.error("Error:",a)})}else n({type:d,payload:{status:!0,title:"Error!",message:"Customer update error, Please Check the input fields",color:"warning"}})},[G,me]=r.useState(1),xe=s=>{me(s);const t=(s-1)*50;b(t),p(t,!0)},pe=()=>{const s=Math.ceil(le/50),t=[];for(let i=1;i<=s;i++)t.push(i);const a=Math.max(G-2,1),g=Math.min(a+4,s);return t.slice(a-1,g).map(i=>e.jsx(E,{active:G===i,onClick:()=>xe(i),children:i},i))};return e.jsxs(Ce,{children:[e.jsx(ye,{className:"bg-body-tertiary",children:e.jsx(h,{type:"text",placeholder:"Search by customer email",style:{width:450,marginLeft:"0%"},value:v,onChange:s=>re(s.target.value)})}),te?e.jsx(U,{}):e.jsxs(Z,{children:[e.jsx(Y,{children:e.jsxs(C,{children:[e.jsx(o,{scope:"col",children:"#"}),e.jsx(o,{scope:"col",children:"Photo"}),e.jsx(o,{scope:"col",children:"Name"}),e.jsx(o,{scope:"col",children:"Surname"}),e.jsx(o,{scope:"col",children:"email"}),e.jsx(o,{scope:"col",children:"Contact"}),e.jsx(o,{scope:"col",children:"Country"}),e.jsx(o,{scope:"col",children:"Language"}),e.jsx(o,{scope:"col",children:"Edit"}),e.jsx(o,{scope:"col",children:"Address"}),e.jsx(o,{scope:"col",children:"Grocery"})]})}),e.jsx(q,{children:M.map((s,t)=>e.jsxs(C,{children:[e.jsx(l,{children:x+t+1}),e.jsx(o,{scope:"row",children:e.jsx(be,{style:{width:50,height:50,borderRadius:10},src:"https://api.zeuler.com/image/"+s.photo})}),e.jsx(l,{children:s.name}),e.jsx(l,{children:s.surname}),e.jsx(l,{children:s.email}),e.jsx(l,{children:s.contact}),e.jsx(l,{children:s.country==="it"||s.country==="Italy"?"Italy":s.country}),e.jsx(l,{children:s.language==="en"?"English":s.language==="it"?"Italy":s.language}),e.jsx(l,{children:e.jsx(P,{children:e.jsx(N,{icon:Se,size:"xl",onClick:()=>ue(s)})})}),e.jsx(l,{children:e.jsx(P,{children:e.jsx(N,{icon:ve,size:"xl",onClick:()=>de(s._id)})})}),e.jsx(l,{children:e.jsx(P,{to:`/customers/list/${s._id}`,children:e.jsx(N,{icon:we,size:"xl"})})})]},t))})]}),e.jsxs(Pe,{"aria-label":"Page navigation example",children:[e.jsx(E,{disabled:x<=0,onClick:ne,children:"Previous"}),pe(),e.jsx(E,{disabled:oe===!0,onClick:ce,children:"Next"})]}),e.jsxs(J,{visible:T,scrollable:!0,size:"xl",onClose:()=>I(!1),children:[e.jsx(K,{closeButton:!0,children:e.jsx(W,{children:"Order Grocery List"})}),e.jsx(X,{style:{overflowY:"auto",maxHeight:"70vh",display:"flex",justifyContent:"center"},children:se?e.jsx(U,{}):e.jsxs(Z,{children:[e.jsx(Y,{children:e.jsxs(C,{children:[e.jsx(o,{scope:"col",children:"#"}),e.jsx(o,{scope:"col",children:"Name"}),e.jsx(o,{scope:"col",children:"Intercom"}),e.jsx(o,{scope:"col",children:"Flat"}),e.jsx(o,{scope:"col",children:"Street"}),e.jsx(o,{scope:"col",children:"House Number"})]})}),e.jsx(q,{children:O.map((s,t)=>e.jsxs(C,{children:[e.jsx(l,{scope:"row",children:t+1}),e.jsx(l,{children:s.name}),e.jsx(l,{children:s.intercom}),e.jsx(l,{children:s.flat}),e.jsx(l,{children:s.street}),e.jsx(l,{children:s.houseNumber})]},t))})]})}),e.jsx(Ne,{})]}),e.jsxs(J,{visible:D,scrollable:!0,size:"lg",onClose:()=>S(!1),children:[e.jsx(K,{closeButton:!0,children:e.jsx(W,{children:"Edit Customer Information"})}),e.jsx(X,{children:e.jsxs("div",{className:"row g-3",children:[e.jsx(m,{md:6,children:e.jsx(h,{id:"name",label:"Firt Name",defaultValue:u.name,onChange:s=>A(s.target.value)})}),e.jsx(m,{md:6,children:e.jsx(h,{id:"surname",label:"LastName",defaultValue:u.surname,onChange:s=>H(s.target.value)})}),e.jsx(m,{md:6,children:e.jsx(h,{id:"email",label:"Email",defaultValue:u.email,onChange:s=>R(s.target.value)})}),e.jsx(m,{md:6,children:e.jsx(h,{id:"phone",label:"Contact Number",defaultValue:u.contact,onChange:s=>_(s.target.value)})}),e.jsx(m,{xs:12,children:e.jsx(fe,{type:"submit",style:{marginBottom:"3%",width:"200px",backgroundColor:"#ff4d4d",color:"white"},onClick:()=>he(),children:"Update Customer"})})]})})]})]})};export{Ge as default};
