import{r as o,y as B,l as _,j as e,m as $}from"./index-WZigiEvM.js";import{M as N,T as z,a as D,P as G}from"./leaflet-wzHiX_CP.js";import{a as c}from"./axios-Cm0UX6qg.js";import{B as d}from"./config-HOLfLxHr.js";import{b as H,a as h}from"./CContainer-D8oWyoQj.js";import{C as P}from"./CNavbar-BXqR78KC.js";import{C as I,a as F,b as O,c as k}from"./DefaultLayout-Cp4xcUfQ.js";import{c as U}from"./cil-info-CmGCY32x.js";import{C as V,a as W,b as Y,c as Z}from"./CModalTitle-fklO3HKb.js";import{C as q,a as J,b as M,c as u,d as K,e as m}from"./CTable-B9oPknyX.js";import{C as Q}from"./CModalFooter-cBYm_HGr.js";const de=()=>{const[f,l]=o.useState(!1),[{user:n,token:r},i]=B(),[x,g]=o.useState("Napoli"),[T,C]=o.useState("Napoli"),[b,E]=o.useState([]),[A,S]=o.useState([]),[p,v]=o.useState();_();const j=(a,t)=>{l(!f),v(t),c.get(d+`market/groups/fetch/0?city=${a}`,{headers:{Authorization:`Bearer ${r}`}}).then(s=>{s.status===200?S(s.data):s.status===500&&i({type:SET_ALERT,payload:{status:!0,title:"City loading error",message:s.data.message}})}).catch(s=>{console.error("Error:",s)})},y=a=>{a==="all"?(g(""),C("Napoli")):(g(a),C(a))};o.useEffect(()=>{n&&r&&c.get(d+`assistant/markets/groups/locations/delivery/${x}`,{headers:{Authorization:`Bearer ${r}`}}).then(a=>{a.status===200?E(a.data):a.status===500&&i({type:SET_ALERT,payload:{status:!0,title:"Market Group loading error",message:a.data.message}})}).catch(a=>{console.error("Error:",a)})},[n,x]);const w=(a,t)=>{a&&t&&n&&r&&(console.log("one"),c.put(d+`market/groups/assign/${t}/${a}`,{},{headers:{Authorization:`Bearer ${r}`}}).then(s=>{s.status===200?l(!1):s.status===204?i({type:SET_ALERT,payload:{status:!0,title:"Market Assign error",message:s.data.message}}):s.status===500&&i({type:SET_ALERT,payload:{status:!0,title:"Market Assign error",message:s.data.message}})}).catch(s=>{console.error("Error:",s)}))},R=(a,t)=>{a&&t&&n&&r&&c.put(d+`market/groups/remove/${t}/${a}`,{},{headers:{Authorization:`Bearer ${r}`}}).then(s=>{s.status===200?l(!1):s.status===204?i({type:SET_ALERT,payload:{status:!0,title:"Market Remove error",message:s.data.message}}):s.status===500&&i({type:SET_ALERT,payload:{status:!0,title:"Market Remove error",message:s.data.message}})}).catch(s=>{console.error("Error:",s)})};return e.jsxs(H,{children:[e.jsx(P,{className:"bg-body-tertiary",children:e.jsxs(I,{style:{marginLeft:"90%",width:"10%",marginRight:"5px",backgroundColor:"#ff4d4d"},children:[e.jsx(F,{children:T}),e.jsxs(O,{children:[e.jsx(k,{onClick:()=>y("Napoli"),children:"Napoli"}),e.jsx(k,{onClick:()=>y("Milano"),children:"Milano"})]})]})}),e.jsxs(N,{dragging:!0,center:[40.85631,14.24641],zoom:13,scrollWheelZoom:!0,style:{height:"500px",width:"100%"},children:[e.jsx(z,{attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),b.map((a,t)=>e.jsx(D,{position:[a.lat,a.lng],onClick:j,children:e.jsx(G,{children:e.jsxs("div",{onClick:()=>j(a.city,a._id),children:[e.jsx($,{icon:U,size:"lg",style:{marginLeft:"10px"}})," ",e.jsx("span",{children:a.address})]})})},t))]}),e.jsxs(V,{visible:f,scrollable:!0,size:"xl",onClose:()=>l(!1),children:[e.jsx(W,{closeButton:!0,children:e.jsx(Y,{children:"Map Information"})}),e.jsx(Z,{style:{overflowY:"auto",maxHeight:"70vh"},children:e.jsxs(q,{children:[e.jsx(J,{children:e.jsxs(M,{children:[e.jsx(u,{scope:"col",children:"Name"}),e.jsx(u,{scope:"col",children:"Market"}),e.jsx(u,{scope:"col",children:"Action"})]})}),e.jsx(K,{children:A.map((a,t)=>e.jsxs(M,{children:[e.jsx(m,{children:a.name}),e.jsx(m,{children:a.markets.map((s,L)=>e.jsxs("div",{children:[s.chain.name," - ",s.address," "]},L))}),e.jsx(m,{children:a.markets.some(s=>s.id===p)?e.jsx(h,{style:{backgroundColor:"#ff4d4d",width:"90px"},onClick:()=>R(p,a._id),children:"Remove"}):e.jsx(h,{style:{backgroundColor:"#ff4d4d",width:"90px"},onClick:()=>w(p,a._id),children:"Assign"})})]},t))})]})}),e.jsx(Q,{children:e.jsx(h,{color:"secondary",onClick:()=>l(!1),children:"Close"})})]})]})};export{de as default};
