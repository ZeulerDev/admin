import{y as xs,r as a,A as i,j as e,h as Ae,L as Pe,m as De}from"./index-BbIMGn6I.js";import{a as j}from"./axios-Cm0UX6qg.js";/* empty css               */import{B as f}from"./config-HOLfLxHr.js";import{b as js,a as p}from"./CContainer-DW1l_mtt.js";import{d as A,C as P,a as D,b as B,c as n}from"./DefaultLayout-DAj23qfB.js";import{C as Be}from"./CNavbar-CaFAFoGR.js";import{D as fs}from"./index-CK9oxSL5.js";import{C as b}from"./CFormInput-CYaLtnDR.js";import{C as Ee,a as Ge,b as E,c as l,d as Te,e as r}from"./CTable-Bo3KO6JA.js";import{c as ms}from"./cil-pencil-m516yCOw.js";import{c as ys}from"./cil-info-CmGCY32x.js";import{C as Cs,a as ze}from"./CPaginationItem-Cm1VX4Uo.js";import{C as G,a as T,b as z,c as M}from"./CModalTitle-BlxPdlJz.js";import{C as V}from"./CModalFooter-Bw9Pc4Sk.js";import{C as ks}from"./CRow-DQ9uwbxh.js";import{C as _}from"./CFormLabel-0HkVgzW6.js";import{C as U}from"./CCol-n25nGd7N.js";import{f as Me}from"./index-PqYCJD3r.js";import"./inheritsLoose-BR9xv5Kf.js";import"./typeof-QjJsDpFa.js";const Vs=()=>{var ke,be,Se;const[{user:m,token:d},c]=xs(),[y,S]=a.useState([]),[Le,L]=a.useState(!1),[x,ve]=a.useState(""),[Ie,Q]=a.useState(x),[C,Y]=a.useState(0),[W,v]=a.useState(!1),[Ne,Fe]=a.useState(""),[q,J]=a.useState(""),[I,K]=a.useState(""),[Re,He]=a.useState([]),[$e,Oe]=a.useState([]),[X,Z]=a.useState(""),[ee,se]=a.useState(""),[te,ae]=a.useState(""),[oe,le]=a.useState(""),[Ve,re]=a.useState("All Cities"),[_e,ne]=a.useState("All Status"),[Ue,ce]=a.useState("All Market Groups"),[Qe,ie]=a.useState("All Chains"),[Ye,We]=a.useState([]),[qe,de]=a.useState(!1),[N,F]=a.useState(!1),[k,Je]=a.useState([]),[ue,R]=a.useState(!1),[Ke,Xe]=a.useState(""),[he,Ze]=a.useState(""),[es,ss]=a.useState(""),[pe,w]=a.useState(!1),[ge,xe]=a.useState([]),[ts,je]=a.useState(!0);a.useEffect(()=>{const s=setTimeout(()=>{c({type:i,payload:{status:!0,title:"Data Loading",message:"Data loading error: Timeout exceeded",color:"warning"}}),L(!1)},2e4);return m&&d&&H(0,s),()=>{clearTimeout(s)}},[m,d,Ie,ee,ge]),a.useEffect(()=>{const s=setTimeout(()=>{(x.length>=3||x.length===0)&&Q(x)},500);return()=>{clearTimeout(s)}},[x]);const H=(s,t)=>{L(!0),j.get(f+"assistant/grocery/group/"+s+"?rider="+x+"&status="+ee+"&date="+ge,{headers:{Authorization:`Bearer ${d}`}}).then(o=>{console.log("data"),o.status===200?(S(o.data),console.log("dataaaaaaa"),L(!1),clearTimeout(t),o.data.length<50?(je(!0),console.log("ok")):o.data.length>49&&je(!1)):o.status===204?c({type:i,payload:{status:!0,title:"Grocery groups loading error",message:o.data.message}}):o.status===500&&c({type:i,payload:{status:!0,title:"Grocery groups error",message:o.data.message}})}).catch(o=>{console.error("Error:",o)})},as=()=>{console.log(C);const s=C+50;console.log(s),Y(s),H(s,!0)},os=()=>{const s=C-50;console.log(s),Y(s),H(s,!1)},ls=(s,t=null)=>{v(!W),Fe(s),t!==null?J(t):console.log("Bonus number not provided")},rs=()=>{const s={bonus:q};console.log(s),m&&d&&j.put(f+"assistant/grocery/group/bonus/"+Ne,s,{headers:{Authorization:`Bearer ${d}`}}).then(t=>{if(t.status===200){console.log("updated"),v(!1);const o=t.data,h=y.find(u=>u.id===o._id);h&&(h.bonus=o.bonus),S([...y])}else t.status===203?(console.log("203"),c({type:i,payload:{status:!0,title:"Bonus Update error",message:t.data.message}})):t.status===204?(console.log("204"),c({type:i,payload:{status:!0,title:"Bonus Update error",message:t.data.message}})):t.status===500&&c({type:i,payload:{status:!0,title:"Bonus Update error",message:t.data.message}})}).catch(t=>{console.error(t)})};a.useEffect(()=>{ns(),cs()},[]);const ns=()=>{d&&j.get(f+"market/groups/dropdown/fetch",{headers:{Authorization:`Bearer ${d}`}}).then(s=>{s.status===200?He(s.data):s.status===500&&c({type:i,payload:{status:!0,title:"Market Group Loading error",message:s.data.message}})}).catch(s=>{console.error("Error: ",s)})},cs=()=>{d&&j.get(f+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${d}`}}).then(s=>{s.status===200?Oe(s.data):s.status===500&&c({type:i,payload:{status:!0,title:"Chain Loading error",message:s.data.message}})}).catch(s=>{console.error("Error: ",s)})},$=s=>{s==="all"?(Z(""),re("All Cities")):(Z(s),re(s))},g=s=>{s==="all"?(se(""),ne("All Status")):(se(s),ne(s))},fe=(s,t)=>{s==="all"?(ae(""),ce("All Market Groups")):(ae(s),ce(t))},me=(s,t)=>{s==="all"?(le(""),ie("All Chains")):(le(s),ie(t))};a.useEffect(()=>{is()},[X,te,oe,alert]);const is=()=>{m&&d&&(de(!0),j.get(f+`assistant/shoppers/:skip?city=${X}&group=${te}&chain=${oe}`,{headers:{Authorization:`Bearer ${d}`}}).then(s=>{s.status===200?(We(s.data),de(!1)):s.status===500&&c({type:i,payload:{status:!0,title:"Error",message:s.data.message,color:"warning"}})}).catch(s=>{console.error("Error:",s)}))},ds=(s,t,o)=>{F(!N),console.log("Grocery ID",s),Je(o),K(t)},ye=(s,t,o)=>{R(!ue),console.log("picker id",s),console.log("Grocery id",o),K(t),Ze(o),Xe(s)},Ce=(s,t,o)=>{console.log("bid",s,"PID",t,o);const h={pickerId:t,status:o};console.log(h),m&&d&&j.put(f+"assistant/grocery/group/picker/"+s,h,{headers:{Authorization:`Bearer ${d}`}}).then(u=>{if(u.status===200){console.log("updated",u.data),N&&F(!1),R(!1);const O=u.data,gs=y.map(we=>we.id===O._id?(console.log("matched"),O):we);console.log("update obj",O),S([...gs]),c({type:i,payload:{status:!0,title:"Picker Assign ",message:"Successfully picker assigned to the grocery group",color:"success"}})}else u.status===203?(console.log("203"),c({type:i,payload:{status:!0,title:"Picker Assign error",message:u.data.message}})):u.status===204?(console.log("204"),c({type:i,payload:{status:!0,title:"Picker Assign error",message:u.data.message}})):u.status===500&&c({type:i,payload:{status:!0,title:"Picker Assign error",message:u.data.message}})}).catch(u=>{console.error(u)})},us=s=>{w(!pe),ss(s)},hs=s=>{console.log("status",s),m&&d&&j.put(f+"assistant/grocery/group/status/"+s,{},{headers:{Authorization:`Bearer ${d}`}}).then(t=>{if(t.status===200){console.log("updated",t.data),w(!1);const o=t.data,h=y.find(u=>u.id===o._id);h&&(console.log("done",h),h.status=o.status),S([...y])}else t.status===203?(console.log("203"),c({type:i,payload:{status:!0,title:"Status update error",message:t.data.message}})):t.status===204?(console.log("204"),c({type:i,payload:{status:!0,title:"Status update error",message:t.data.message}})):t.status===500&&c({type:i,payload:{status:!0,title:"Status update error",message:t.data.message}})}).catch(t=>{console.error(t)})},ps=s=>{if(s){const t=Me(s[0],"MM/dd/yyyy HH:mm"),o=Me(s[1],"MM/dd/yyyy HH:mm");xe([t,o])}else xe([])};return e.jsxs(js,{children:[e.jsx(A,{style:{marginLeft:"76%"},color:"secondary",children:"Filter by"}),e.jsxs(P,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[e.jsx(D,{style:{color:"white"},children:_e}),e.jsxs(B,{children:[e.jsx(n,{onClick:()=>g("all"),children:"All Status"}),e.jsx(n,{onClick:()=>g("created"),children:"Created"}),e.jsx(n,{onClick:()=>g("ready"),children:"Ready"}),e.jsx(n,{onClick:()=>g("finalized"),children:"Finalized"}),e.jsx(n,{onClick:()=>g("freeze"),children:"Freeze"}),e.jsx(n,{onClick:()=>g("forced"),children:"Forced"}),e.jsx(n,{onClick:()=>g("open"),children:"Open"}),e.jsx(n,{onClick:()=>g("completed"),children:"Completed"}),e.jsx(n,{onClick:()=>g("waiting"),children:"Waiting"}),e.jsx(n,{onClick:()=>g("paid "),children:"Paid "})]})]}),e.jsxs(Be,{style:{marginTop:"1%"},className:"bg-body-tertiary",children:[e.jsx(fs,{style:{marginLeft:1},format:"MM/dd/yyyy HH:mm",onChange:ps}),e.jsx(b,{type:"text",placeholder:"Search By Rider No",style:{width:300,marginLeft:"5%"},value:x,onChange:s=>ve(s.target.value)})]}),Le?e.jsx(Ae,{}):e.jsxs(Ee,{children:[e.jsx(Ge,{children:e.jsxs(E,{children:[e.jsx(l,{scope:"col",children:"#"}),e.jsx(l,{scope:"col",children:"No"}),e.jsx(l,{scope:"col",children:"Rider Assign No"}),e.jsx(l,{scope:"col",children:"Rider Status"}),e.jsx(l,{scope:"col",children:"Duration"}),e.jsx(l,{scope:"col",children:"Status"}),e.jsx(l,{scope:"col",children:"Date"}),e.jsx(l,{scope:"col",children:"Bonus"}),e.jsx(l,{scope:"col",children:"Amount"}),e.jsx(l,{scope:"col",children:"Hour"}),e.jsx(l,{scope:"col",children:"Rank"}),e.jsx(l,{scope:"col",children:"Start"}),e.jsx(l,{scope:"col",children:"End"}),e.jsx(l,{scope:"col",children:"Picker"}),e.jsx(l,{scope:"col",children:"Order"}),e.jsx(l,{scope:"col",children:"Order Details"})]})}),e.jsx(Te,{children:y.map((s,t)=>e.jsxs(E,{children:[e.jsx(r,{children:C+t+1}),e.jsx(r,{children:s.no}),e.jsx(r,{children:s.ridersAssigningNo}),e.jsx(r,{children:e.jsx(A,{style:{width:80},color:"info",children:s.ridersAssigningStatus})}),e.jsxs(r,{children:[s.duration," min"]}),e.jsx(r,{children:e.jsx(A,{style:{width:80},color:"warning",children:s.status})}),e.jsx(r,{children:s.date}),e.jsxs(r,{children:[s.bonus!=null?s.bonus.toFixed(2):0," ",e.jsx(Pe,{to:"",children:e.jsx(De,{icon:ms,size:"sm",onClick:()=>ls(s.id,s.bonus)})})," "]}),e.jsx(r,{children:s.amount}),e.jsx(r,{children:s.hour}),e.jsx(r,{children:s.rank+1}),e.jsx(r,{children:s.start}),e.jsx(r,{children:s.end}),e.jsx(r,{children:s.shopper?e.jsx(p,{onClick:()=>ds(s.id,s.status,s),size:"sm",style:{width:80,backgroundColor:"#ff4d4d",color:"white"},children:"View"}):e.jsx(p,{onClick:()=>ye(s.accepted,s.status,s.id),size:"sm",style:{width:80,backgroundColor:"#ff4d4d",color:"white"},children:"Add"})}),e.jsx(r,{children:s.status==="complete"?e.jsx(p,{size:"sm",disabled:!0,style:{width:80,backgroundColor:"#ff4d4d",color:"white"},children:"Cancel"}):s.status==="canceled"?e.jsx(p,{size:"sm",disabled:!0,style:{width:80,backgroundColor:"#ff4d4d",color:"white"},children:"Cancel"}):e.jsx(p,{onClick:()=>us(s.id),size:"sm",style:{width:80,backgroundColor:"#ff4d4d",color:"white"},children:"Cancel"})}),e.jsx(r,{children:e.jsx(Pe,{to:`/order/grocerygroup/orders/${s.id}`,children:e.jsx(De,{icon:ys,size:"xl"})})})]},t))})]}),e.jsxs(Cs,{"aria-label":"Page navigation example",children:[e.jsx(ze,{disabled:C<=50,onClick:os,children:"Previous"}),e.jsx(ze,{disabled:ts===!0,onClick:as,children:"Next"})]}),e.jsxs(G,{alignment:"center",visible:W,scrollable:!0,size:"sm",onClose:()=>v(!1),children:[e.jsx(T,{closeButton:!0,children:e.jsx(z,{children:"Confirmation"})}),e.jsxs(M,{children:[e.jsx("a",{children:"Enter Bonus Amount"}),e.jsx("br",{}),e.jsx(b,{type:"text",placeholder:"Bonus",value:q,onChange:s=>J(s.target.value)})]}),e.jsx(V,{children:e.jsx(p,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>rs(),children:"Save changes"})})]}),e.jsxs(G,{alignment:"center",visible:N,scrollable:!0,size:"lg",onClose:()=>F(!1),children:[e.jsx(T,{closeButton:!0,children:e.jsx(z,{children:"Picker Information"})}),e.jsx(M,{style:{overflowY:"auto",maxHeight:"70vh",display:"flex",justifyContent:"center"},children:e.jsx("div",{children:e.jsxs(ks,{className:"mb-3",children:[e.jsx(_,{htmlFor:"staticEmail",className:"col-sm-2 col-form-label",children:"Name"}),e.jsx(U,{sm:10,children:e.jsx(b,{type:"text",defaultValue:(ke=k.shopper)==null?void 0:ke.name,readOnly:!0,plainText:!0})}),e.jsx(_,{htmlFor:"staticEmail",className:"col-sm-2 col-form-label",children:"Email"}),e.jsx(U,{sm:10,children:e.jsx(b,{type:"text",defaultValue:(be=k.shopper)==null?void 0:be.email,readOnly:!0,plainText:!0})}),e.jsx(_,{htmlFor:"staticEmail",className:"col-sm-2 col-form-label",children:"Contact"}),e.jsx(U,{sm:10,children:e.jsx(b,{type:"text",defaultValue:(Se=k.shopper)==null?void 0:Se.contact,readOnly:!0,plainText:!0})})]})})}),e.jsx(V,{children:e.jsx(p,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>{var s;return ye((s=k.shopper)==null?void 0:s.id,I,k.id)},children:"Change"})})]}),e.jsxs(G,{alignment:"center",visible:ue,scrollable:!0,size:"xl",onClose:()=>R(!1),children:[e.jsx(T,{closeButton:!0,children:e.jsx(z,{children:"Picker Assing to the Grocery Batch"})}),e.jsxs(M,{children:[e.jsx(A,{style:{marginLeft:"37%"},color:"secondary",children:"Filter by"}),e.jsxs(P,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[e.jsx(D,{style:{color:"white"},children:Ve}),e.jsxs(B,{children:[e.jsx(n,{onClick:()=>$("all"),children:"All"}),e.jsx(n,{onClick:()=>$("Milan"),children:"Milan"}),e.jsx(n,{onClick:()=>$("Napoli"),children:"Napoli"})]})]}),e.jsxs(P,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[e.jsx(D,{style:{color:"white"},children:Qe}),e.jsxs(B,{children:[e.jsx(n,{onClick:()=>me("all"),children:"All"}),$e.map((s,t)=>e.jsx(n,{onClick:()=>me(s.id,s.name),children:s.name},t))]})]}),e.jsxs(P,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[e.jsx(D,{style:{color:"white"},children:Ue}),e.jsxs(B,{children:[e.jsx(n,{onClick:()=>fe("all"),children:"All"}),Re.map((s,t)=>e.jsx(n,{onClick:()=>fe(s._id,s.name),children:s.name},t))]})]}),e.jsx(Be,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),qe?e.jsx(Ae,{}):e.jsxs(Ee,{children:[e.jsx(Ge,{children:e.jsxs(E,{children:[e.jsx(l,{scope:"col",children:"#"}),e.jsx(l,{scope:"col",children:"First Name"}),e.jsx(l,{scope:"col",children:"Last Name"}),e.jsx(l,{scope:"col",children:"Email"}),e.jsx(l,{scope:"col",children:"Phone"}),e.jsx(l,{scope:"col",children:"Country"}),e.jsx(l,{scope:"col",children:"City"}),e.jsx(l,{scope:"col",children:"Language"}),e.jsx(l,{scope:"col",children:"Market"}),e.jsx(l,{scope:"col",children:"Action"})]})}),e.jsx(Te,{children:Ye.map((s,t)=>{var o,h;return e.jsxs(E,{children:[e.jsx(r,{children:t+1}),e.jsx(r,{children:s.name}),e.jsx(r,{children:s.surname}),e.jsx(r,{children:s.email}),e.jsx(r,{children:s.contact}),e.jsx(r,{children:s.country==="it"||s.country==="Italy"?"Italy":s.country}),e.jsx(r,{children:s.city}),e.jsx(r,{children:s.language==="en"?"English":s.language==="it"?"Italy":s.language==="es"?"Spanish":s.language}),e.jsxs(r,{children:[(h=(o=s.market)==null?void 0:o.chain)==null?void 0:h.name," - ",s.market.address]}),e.jsx(r,{children:s.id===Ke?e.jsx(p,{size:"sm",onClick:()=>Ce(he,s.id,I),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Assigned"}):e.jsx(p,{size:"sm",onClick:()=>Ce(he,s.id,I),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Add"})})]},t)})})]})]}),e.jsx(V,{})]}),e.jsxs(G,{alignment:"center",visible:pe,scrollable:!0,size:"sm",onClose:()=>w(!1),children:[e.jsx(T,{closeButton:!0,children:e.jsx(z,{children:"Confirmation"})}),e.jsxs(M,{children:[e.jsx("a",{children:"Are you sure you want to cancel this grocery group order?"}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[e.jsx(p,{onClick:()=>hs(es),style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),e.jsx(p,{onClick:()=>w(!1),style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]})]})};export{Vs as default};
