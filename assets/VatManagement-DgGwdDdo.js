import{r as o,y as O,A as u,j as e,h as W}from"./index-B08OXeWv.js";import{a as N}from"./axios-Cm0UX6qg.js";import{B}from"./config-HOLfLxHr.js";import{b as X,a as P}from"./CContainer-Bcycrjrg.js";import{C as Z}from"./CNavbar-CI1ooECg.js";import{C as M}from"./CFormInput-BdPiiS44.js";import{C as ee,a as te,b as z,c,d as se,e as n}from"./CTable-isbk2Vch.js";import{C as p}from"./DefaultLayout-ZVM7TRL_.js";import{C as ae,a as k}from"./CPaginationItem-BtMnBLEs.js";import{C as oe,a as re,b as le,c as ce}from"./CModalTitle-BEzJ5tl5.js";import{C as ne}from"./CModalFooter-CT0DeHo_.js";import"./CFormLabel-SAczgcRM.js";const be=()=>{const[T,f]=o.useState(!1),[{user:S,token:g},i]=O(),[j,I]=o.useState([]),[L,C]=o.useState(!1),[R,Q]=o.useState(""),[A,V]=o.useState(""),[r,H]=o.useState(""),[$,E]=o.useState(r),[F,U]=o.useState(0),[x,y]=o.useState(1),[b,v]=o.useState(0),[Y,w]=o.useState(!0);o.useEffect(()=>{let t=setTimeout(()=>{i({type:u,payload:{status:!0,title:"Data Loading",message:"Data loading error: Timeout exceeded",color:"warning"}}),C(!1)},2e4);return m(0,t),()=>{clearTimeout(t)}},[$]),o.useEffect(()=>{const t=setTimeout(()=>{(r.length>=3||r.length===0)&&E(r)},500);return()=>{clearTimeout(t)}},[r]);const m=(t,s)=>{S&&g&&(C(!0),N.get(B+`assistant/vat/shoppers/${t}?search=`+r,{headers:{Authorization:`Bearer ${g}`}}).then(a=>{a.status===200?(I(a.data.list),U(a.data.count),clearTimeout(s),C(!1),a.data.list.length<50?(w(!0),console.log("ok")):a.data.list.length>49&&w(!1)):a.status===204?i({type:u,payload:{status:!0,title:"Error",message:a.data.message,color:"warning"}}):a.status===500&&i({type:u,payload:{status:!0,title:"Error",message:a.data.message,color:"warning"}})}).catch(a=>{console.error("Error:",a)}))},_=()=>{y(x+1);const t=b+50;v(t),m(t,!0)},q=()=>{y(x-1);const t=b-50;console.log(t),v(t),m(t,!1)},D=(t,s=null)=>{f(!T),Q(t),s!==null?V(s):console.log("VAT PID not provided"),console.log(t)},G=()=>{const t={vat:A};S&&g&&N.patch(B+"assistant/shopper/vat/"+R,t,{headers:{Authorization:`Bearer ${g}`}}).then(s=>{if(s.status===200){console.log("updated"),f(!1);const a=s.data,d=j.find(h=>h.id===a.id);d&&(d.vat=a.vat),I([...j]),i({type:u,payload:{status:!0,title:"Picker VAT Id ",message:"VAT Id updated successfully"}})}else s.status===203?(console.log("203"),i({type:u,payload:{status:!0,title:"Picker VAT Id update error",message:s.data.message}})):s.status===204?(console.log("204"),i({type:u,payload:{status:!0,title:"Picker VAT Id update error",message:s.data.message}})):s.status===500&&i({type:u,payload:{status:!0,title:"Picker VAT Id update error",message:s.data.message}})}).catch(s=>{console.error(s)})},J=t=>{y(t);const s=(t-1)*50;v(s),m(s,!0)},K=()=>{const t=Math.ceil(F/50),s=[];for(let l=1;l<=t;l++)s.push(l);const a=Math.max(x-2,1),d=Math.min(a+4,t);return s.slice(a-1,d).map(l=>e.jsx(k,{active:x===l,onClick:()=>J(l),children:l},l))};return e.jsxs(X,{children:[e.jsx(Z,{className:"bg-body-tertiary",children:e.jsx(M,{type:"text",placeholder:"Search",style:{width:450,marginLeft:"0%"},value:r,onChange:t=>H(t.target.value)})}),L?e.jsx(W,{}):e.jsxs(ee,{children:[e.jsx(te,{children:e.jsxs(z,{children:[e.jsx(c,{scope:"col",children:"#"}),e.jsx(c,{scope:"col",children:"Name"}),e.jsx(c,{scope:"col",children:"City"}),e.jsx(c,{scope:"col",children:"Vat"}),e.jsx(c,{scope:"col",children:"Activate"}),e.jsx(c,{scope:"col",children:"Disabled"}),e.jsx(c,{scope:"col",children:"market"}),e.jsx(c,{scope:"col",children:"Action"})]})}),e.jsx(se,{children:j.map((t,s)=>{var a,d,h;return e.jsxs(z,{children:[e.jsx(n,{children:s+1}),e.jsx(n,{children:t.name}),e.jsx(n,{children:t.city}),e.jsx(n,{children:t.vat?t.vat:e.jsx(p,{color:"warning",children:"Empty"})}),e.jsx(n,{children:t.activate?e.jsx(p,{color:"success",children:"Yes"}):e.jsx(p,{color:"warning",children:"No"})}),e.jsx(n,{children:t.disabled?e.jsx(p,{color:"success",children:"No"}):e.jsx(p,{color:"warning",children:"Yes"})}),e.jsxs(n,{children:[(d=(a=t.market)==null?void 0:a.chain)==null?void 0:d.name," - ",(h=t.market)==null?void 0:h.address]}),e.jsx(n,{children:t.vat===""?e.jsx(P,{size:"sm",style:{backgroundColor:"#ff4d4d",width:70,color:"white"},onClick:()=>D(t.id,t.vat),children:"Insert "}):e.jsx(P,{size:"sm",style:{backgroundColor:"#ff4d4d",width:70,color:"white"},onClick:()=>D(t.id,t.vat),children:"Edit "})})]},s)})})]}),e.jsxs(ae,{"aria-label":"Page navigation example",children:[e.jsx(k,{disabled:b<=0,onClick:q,children:"Previous"}),K(),e.jsx(k,{disabled:Y===!0,onClick:_,children:"Next"})]}),e.jsxs(oe,{alignment:"center",visible:T,scrollable:!0,size:"sm",onClose:()=>f(!1),children:[e.jsx(re,{closeButton:!0,children:e.jsx(le,{children:"Confirmation"})}),e.jsxs(ce,{children:[e.jsx("a",{children:"Enter Picker's VAT id here"}),e.jsx("br",{}),e.jsx(M,{type:"text",placeholder:"Vat id",value:A,onChange:t=>V(t.target.value)})]}),e.jsx(ne,{children:e.jsx(P,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>G(),children:"Save changes"})})]})]})};export{be as default};
