function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-COiTDGNb.js","assets/index-CJ-e1XdK.js","assets/index-BwGgfx4E.css","assets/leaflet-nKYme2WM.js","assets/leaflet-D-6_-wuJ.css","assets/Polygon-CPKNH7Ye.js","assets/Marker-Bzkk49Qq.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{R as Te,f as Ee,r as s,y as Ie,A as r,j as e,h as ze,L as _e,m as M}from"./index-CJ-e1XdK.js";import{a as C}from"./axios-Cm0UX6qg.js";import{E as Be}from"./leaflet.draw-DcEYHnRa.js";import{L as se,M as Re,T as Fe,P as Ue}from"./leaflet-nKYme2WM.js";import{B as k}from"./config-HOLfLxHr.js";import{m as Ve,a as $e,b as Ge}from"./marker-shadow-ClvVsAuX.js";import{b as He,a as d}from"./CContainer-BPPY1Q9a.js";import{C as Z,a as q,b as J,c as K,d as f}from"./DefaultLayout-DWwaUX_t.js";import{C as Q}from"./CNavbar-DPyXGWVC.js";import{C as Oe,a as We,b as X,c as p,d as Ye,e as u}from"./CTable-CkE6FbZW.js";import{c as Ze}from"./cil-pencil-m516yCOw.js";import{c as qe}from"./cil-trash-CBbKHhHb.js";import{C as Je,a as ee}from"./CPaginationItem-DoU_pNV3.js";import{C as v,a as N,b as T,c as E}from"./CModalTitle-DYJ0rQad.js";import{c as Ke}from"./cil-info-CmGCY32x.js";import{P as ae,F as Qe}from"./Polygon-CPKNH7Ye.js";import{C as te}from"./CModalFooter-D_v9FH3H.js";import{C as Xe}from"./CFormInput-DBMCobyK.js";import"./index-Hvm1Ie9r.js";import"./CFormLabel-BEtRyV2p.js";const ea=Te.lazy(()=>Ee(()=>import("./index-COiTDGNb.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(b=>({default:b.Marker})));delete se.Icon.Default.prototype._getIconUrl;se.Icon.Default.mergeOptions({iconRetinaUrl:Ve,iconUrl:$e,shadowUrl:Ge});const ka=()=>{const b=s.useRef(null),[{user:h,token:c},l]=Ie(),[oe,le]=s.useState([]),[I,z]=s.useState(""),[x,_]=s.useState(0),[re,B]=s.useState("All Cities"),[ie,R]=s.useState(!1),[ne,F]=s.useState(!0),[ce,P]=s.useState(!1),[de,w]=s.useState(!1),[pe,ue]=s.useState([]),[A,he]=s.useState("Napoli"),[U,me]=s.useState([]),[S,ge]=s.useState([]),[L,D]=s.useState(""),[y,V]=s.useState(""),[fe,$]=s.useState(""),[G,j]=s.useState(!1),[xe,ye]=s.useState(!1),[H,je]=s.useState([]),[Ce,O]=s.useState([]);s.useEffect(()=>{h&&c&&m(0)},[I,h]);const m=a=>{R(!0),C.get(k+`pickups/areas/${a}?city=${I}`,{headers:{Authorization:`Bearer ${c}`}}).then(t=>{if(t.status===200){le(t.data);const o=t.data.map(g=>g.geometry.coordinates),n=ke(o);je(n),R(!1),t.data.length<20?F(!0):t.data.length>19&&F(!1)}else t.status===500&&l({type:r,payload:{status:!0,title:"Market Loading error",message:t.data.message}})}).catch(t=>{console.error("Error: ",t)})};function ke(a){return a.map(t=>t.map(o=>o.map(n=>({lng:n[0],lat:n[1]}))))}const be=()=>{const a=x+20;_(a),m(a)},Pe=()=>{const a=x-20;console.log(a),_(a),m(a)},i=a=>{a==="all"?(z(""),B("All Cities")):(z(a),B(a),he(a))},we=(a,t,o)=>{P(!0),o==="Milano"?(O([45.4666507,9.1823022]),i("Milano")):o==="Napoli"&&(O([40.85631,14.24641]),i("Napoli"));const n=Ae(a);me(n),D(t)};function Ae(a){return a.map(t=>t.map(o=>({lng:o[0],lat:o[1]})))}const Se=(a,t)=>{w(!0),D(a),$(t),console.log(t)};s.useEffect(()=>{h&&c&&C.get(k+`assistant/markets/groups/locations/pickup/${A}`,{headers:{Authorization:`Bearer ${c}`}}).then(a=>{a.status===200?ue(a.data):a.status===500&&l({type:r,payload:{status:!0,title:"Market Group loading error",message:a.data.message}})}).catch(a=>{console.error("Error:",a)})},[h,A]);const Le=a=>{const t=a.layer;console.log("layer",t._latlngs);const o=t._latlngs.map(n=>{const g=n.map(Y=>[Y.lng,Y.lat]);return g.push(g[0]),g});console.log(o),ge(o)},W=a=>{if(a){let t={};S&&(t={area:S}),y&&(t={name:y}),console.log(t,a),h&&c&&C.put(k+"pickup/area/update/"+a,t,{headers:{Authorization:`Bearer ${c}`}}).then(o=>{o.status===200?(l({type:r,payload:{status:!0,title:"Pickup Area Update",message:"Pick up area update Success",color:"success"}}),D(""),V(""),m(0),P(!1),w(!1),$("")):o.status===204?l({type:r,payload:{status:!0,title:"Pick up area update  error",message:o.data.message,color:"danger"}}):o.status===500&&l({type:r,payload:{status:!0,title:"Pick up area update  error",message:o.data.message,color:"danger"}})}).catch(o=>{console.error("Error:",o)})}else alert("Please Check the Fields!")},De=()=>{S==""?l({type:r,payload:{status:!0,title:"Alert",message:"Please select the area",color:"danger"}}):W(L)},Me=()=>{y==""&&L==""?l({type:r,payload:{status:!0,title:"Alert",message:"Please Name",color:"danger"}}):W(L)},ve=a=>{j(!G),ye(a)},Ne=a=>{console.log(a),C.delete(k+"pickup/area/delete/"+a,{headers:{Authorization:`Bearer ${c}`}}).then(t=>{t.status===200?(l({type:r,payload:{status:!0,title:"Pickup Area Delete",message:"Pick up area deleted Successfully",color:"success"}}),j(!1),m(0)):t.status===204?l({type:r,payload:{status:!0,title:"Pickup Area Delete",message:t.data.message,color:"warning"}}):t.status===500&&l({type:r,payload:{status:!0,title:"Pickup Area Delete",message:t.data.message,color:"warning"}})}).catch(t=>{console.error("Error:",t)})};return e.jsxs(He,{children:[e.jsx(Z,{style:{marginLeft:"75.5%"},color:"secondary",children:"Filter by"}),e.jsxs(q,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[e.jsx(J,{style:{color:"white"},children:re}),e.jsxs(K,{children:[e.jsx(f,{onClick:()=>i("all"),children:"All"}),e.jsx(f,{onClick:()=>i("Milano"),children:"Milano"}),e.jsx(f,{onClick:()=>i("Napoli"),children:"Napoli"})]})]}),e.jsx(Q,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),ie?e.jsx(ze,{}):e.jsxs(Oe,{children:[e.jsx(We,{children:e.jsxs(X,{children:[e.jsx(p,{scope:"col",children:"#"}),e.jsx(p,{scope:"col",children:"Name"}),e.jsx(p,{scope:"col",children:"Type"}),e.jsx(p,{scope:"col",children:"City"}),e.jsx(p,{scope:"col",children:"View"}),e.jsx(p,{scope:"col",children:"Action"})]})}),e.jsx(Ye,{children:oe.map((a,t)=>e.jsxs(X,{children:[e.jsx(u,{children:x+t+1}),e.jsxs(u,{children:[e.jsx("span",{children:a.name}),e.jsx(_e,{to:"",children:e.jsx(M,{style:{marginLeft:20,float:"right"},icon:Ze,size:"sm",onClick:()=>Se(a._id,a.name)})})]}),e.jsx(u,{children:a.geometry.type}),e.jsx(u,{children:a.city}),e.jsx(u,{children:e.jsx(d,{size:"sm",style:{backgroundColor:"#ff4d4d",color:"white"},variant:"outline",onClick:()=>we(a.geometry.coordinates,a._id,a.city),children:"View map"})}),e.jsx(u,{children:e.jsx(d,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>ve(a._id),children:e.jsx(M,{icon:qe,size:"lg",style:{color:"white"}})})})]},t))})]}),e.jsxs(Je,{"aria-label":"Page navigation example",children:[e.jsx(ee,{disabled:x<=0,onClick:Pe,children:"Previous"}),e.jsx(ee,{disabled:ne===!0,onClick:be,children:"Next"})]}),e.jsxs(v,{alignment:"center",visible:ce,scrollable:!0,size:"xl",onClose:()=>{P(!1),i("all")},children:[e.jsx(N,{closeButton:!0,children:e.jsx(T,{children:"Map View"})}),e.jsxs(E,{children:[e.jsx(Z,{style:{marginLeft:"81.5%"},color:"secondary",children:"Filter by"}),e.jsxs(q,{style:{marginLeft:"2%",width:"10%",backgroundColor:"#ff4d4d"},children:[e.jsx(J,{style:{color:"white"},children:A}),e.jsxs(K,{children:[e.jsx(f,{onClick:()=>i("Milano"),children:"Milano"}),e.jsx(f,{onClick:()=>i("Napoli"),children:"Napoli"})]})]}),e.jsx(Q,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),e.jsxs(Re,{dragging:!0,center:Ce,zoom:13,scrollWheelZoom:!0,style:{height:"500px",width:"100%"},children:[e.jsx(Fe,{attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsxs(s.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:[pe.map((a,t)=>e.jsx(ea,{position:[a.lat,a.lng],children:e.jsx(Ue,{children:e.jsxs("div",{children:[e.jsx(M,{icon:Ke,size:"lg",style:{marginLeft:"10px"}})," ",e.jsx("span",{children:a.address})]})})},t)),U.length>0&&e.jsx(ae,{strokeColor:"yellow",strokeWidth:2,fillColor:"red",positions:U}),H.length>0&&e.jsx(ae,{positions:H}),e.jsx(Qe,{ref:b,children:e.jsx(Be,{position:"topright",onCreated:Le,draw:{polygon:!0,circle:!0,polyline:!0,marker:!1,circlemarker:!1}})})]})]})]}),e.jsx(te,{children:e.jsx(d,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>De(),children:"Save updated area"})})]}),e.jsxs(v,{alignment:"center",visible:de,scrollable:!0,size:"sm",onClose:()=>w(!1),children:[e.jsx(N,{closeButton:!0,children:e.jsx(T,{children:"Change Name"})}),e.jsxs(E,{children:[e.jsx("a",{children:"Enter New Name"}),e.jsx("br",{}),e.jsx(Xe,{type:"text",placeholder:fe,value:y,onChange:a=>V(a.target.value)})]}),e.jsx(te,{children:e.jsx(d,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>Me(),children:"Save changes"})})]}),e.jsxs(v,{alignment:"center",visible:G,scrollable:!0,size:"sm",onClose:()=>j(!1),children:[e.jsx(N,{closeButton:!1,children:e.jsx(T,{children:"Confirmation"})}),e.jsxs(E,{children:[e.jsx("a",{children:"Are you sure you want to delete this pickup area?"}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[e.jsx(d,{onClick:()=>Ne(xe),style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),e.jsx(d,{onClick:()=>j(!1),style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]})]})};export{ka as default};
