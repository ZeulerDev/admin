import{B as ye,r as t,y as Me,A as i,j as e,h as q,m as be}from"./index-UGMi1yYD.js";import{B as C}from"./config-HOLfLxHr.js";import{a as p}from"./axios-Cm0UX6qg.js";import{b as Ae,a as M}from"./CContainer-DyKYeaQQ.js";import{C as G}from"./CNavbar-CJm5RN47.js";import{C as J,a as K,b as u,c as d,d as O,e as n}from"./CTable-Bh49LxGZ.js";import{c as Se}from"./cil-trash-CBbKHhHb.js";import{C as we,a as De,b as Pe,c as ve}from"./CModalTitle-Cj2x-Lbp.js";import{C as Ne,a as Q,b as W,d as X,e as x}from"./DefaultLayout-CzLgNllg.js";import{C as Te}from"./CModalFooter-iKJhetg6.js";import{C as Ee,a as T}from"./CPaginationItem-2Xn3uQKT.js";const Ye=()=>{const{id:m}=ye(),[E,Y]=t.useState([]),[Z,g]=t.useState(!1),[{user:f,token:c},r]=Me(),[ee,j]=t.useState(!1),[ae,B]=t.useState(!1),[se,b]=t.useState("All Cities"),[te,A]=t.useState("All Chains"),[z,S]=t.useState(""),[L,w]=t.useState(""),[Be,$]=t.useState(""),[ze,R]=t.useState("All Cities"),[Le,_]=t.useState(""),[$e,H]=t.useState("All Chains"),[Re,le]=t.useState([]),[oe,re]=t.useState([]),[I,ie]=t.useState([]),[_e,F]=t.useState(!0);t.useState(0);const[ne,ce]=t.useState([]),[de,He]=t.useState(!0),[k,D]=t.useState(0),[he,ue]=t.useState(0),[y,P]=t.useState(1);t.useEffect(()=>{console.log("id",m),v(m)},[]);const v=a=>{a?(console.log("id",a),f&&c?(g(!0),p.get(C+"promotion/all/markets/"+a,{headers:{Authorization:`Bearer ${c}`}}).then(s=>{s.status===200?(console.log("market",s.data.market),Y(s.data.market),ce(s.data.market.map(l=>l._id)),g(!1)):s.status===203?(g(!1),r({type:i,payload:{status:!0,title:" markets loading error",message:s.data.message}})):s.status===500&&(g(!1),r({type:i,payload:{status:!0,title:" markets loading error",message:s.data.message}}))})):(g(!1),r({type:i,payload:{status:!0,title:" markets loading error",message:"No user or token found"}}))):r({type:i,payload:{status:!0,title:" markets loading error",message:"No id found"}})};t.useEffect(()=>{me()},[]);const me=()=>{c&&p.get(C+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${c}`}}).then(a=>{a.status===200?(le(a.data),re(a.data)):a.status===500&&r({type:i,payload:{status:!0,title:"Chain Loading error",message:a.data.message}})}).catch(a=>{console.error("Error: ",a)})},N=(a,s)=>{s==="view"?a==="all"?(_(""),R("All Cities")):(_(a),R(a)):s==="modal"&&(a==="all"?(w(""),b("All Cities")):(w(a),b(a)))},U=(a,s,l)=>{l==="view"?a==="all"?($(""),H("All Chains")):($(a),H(s)):l==="modal"&&(a==="all"?(S(""),A("All Chains")):(S(a),A(s)))};t.useEffect(()=>{f&&c&&ge(0)},[z,L,f]);const ge=(a,s)=>{B(!0),p.get(C+`assistant/market/locations/${a}?brand=${z}&city=${L}`,{headers:{Authorization:`Bearer ${c}`}}).then(l=>{l.status===200?(ie(l.data.data),ue(l.data.count),console.log("data market"),B(!1),l.data.data.length<20?(F(!0),console.log("ok")):l.data.data.length>19&&F(!1)):l.status===500&&r({type:i,payload:{status:!0,title:"Market Loading error",message:l.data.message}})}).catch(l=>{console.error("Error: ",l)})},fe=()=>{P(y+1);const a=k+20;D(a),loadDataMarket(a,!0)},Ce=()=>{P(y-1);const a=k-20;console.log(a),D(a),loadDataMarket(a,!0)},pe=a=>{P(a);const s=(a-1)*20;D(s),loadDataMarket(s,!0)},xe=()=>{const a=Math.ceil(he/20),s=[];for(let h=1;h<=a;h++)s.push(h);const l=Math.max(y-2,1),o=Math.min(l+4,a);return s.slice(l-1,o).map(h=>e.jsx(T,{active:y===h,onClick:()=>pe(h),children:h},h))},je=()=>{j(!0)},ke=(a,s)=>{if(s&&a){const l={marketId:s};c&&f&&c&&p.patch(C+"promotion/add/market/"+a,l,{headers:{Authorization:`Bearer ${c}`}}).then(o=>{o.status===200?(j(!1),v(a),r({type:i,payload:{status:!0,title:"Market Assign",message:"successfully Market assigned to the promotion",color:"success"}})):o.status===400?r({type:i,payload:{status:!0,title:"Market Assign error",message:o.data.message,color:"warning"}}):o.status===404?r({type:i,payload:{status:!0,title:"Market Assign error",message:o.data.message,color:"warning"}}):o.status===500&&r({type:i,payload:{status:!0,title:"Market Assign error",message:o.data.message,color:"warning"}})}).catch(o=>{console.error("Error:",o)})}else r({type:i,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},V=(a,s)=>{if(s&&a){const l={marketId:s};c&&f&&c&&p.patch(C+"promotion/remove/market/"+a,l,{headers:{Authorization:`Bearer ${c}`}}).then(o=>{o.status===200?(v(a),j(!1),r({type:i,payload:{status:!0,title:"Market Assign",message:"successfully Market removed from the promotion",color:"success"}})):o.status===204?r({type:i,payload:{status:!0,title:"Market remove error",message:o.data.message,color:"warning"}}):o.status===500&&r({type:i,payload:{status:!0,title:"Market remove error",message:o.data.message,color:"warning"}})}).catch(o=>{console.error("Error:",o)})}else r({type:i,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})};return e.jsxs(Ae,{children:[e.jsx(M,{onClick:()=>{je()},style:{marginLeft:"0%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Add Market"}),e.jsx(G,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),Z?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(q,{})}):e.jsxs(J,{children:[e.jsx(K,{children:e.jsxs(u,{children:[e.jsx(d,{scope:"col",children:"#"}),e.jsx(d,{scope:"col",children:"Name"}),e.jsx(d,{scope:"col",children:"Address"}),e.jsx(d,{scope:"col",children:"City"}),e.jsx(d,{scope:"col",children:"Remove Market "})]})}),e.jsx(O,{children:E.length===0?e.jsx(u,{children:e.jsx(n,{colSpan:"5",style:{textAlign:"center",backgroundColor:"white"},children:e.jsx("h6",{style:{marginTop:"1%"},children:"No Data"})})}):E.map((a,s)=>e.jsxs(u,{children:[e.jsx(n,{children:s+1}),e.jsx(n,{children:a.chain.name}),e.jsx(n,{children:a.address}),e.jsx(n,{children:a.city}),e.jsx(n,{children:e.jsx(M,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>{V(m,a._id)},children:e.jsx(be,{icon:Se,size:"lg",style:{color:"white"}})})})]},s))})]}),e.jsxs(we,{visible:ee,scrollable:!0,size:"xl",onClose:()=>{j(!1),A("All Chains"),b("All Cities"),S(""),w("")},children:[e.jsx(De,{closeButton:!0,children:e.jsx(Pe,{children:"Market assign view"})}),e.jsxs(ve,{children:[e.jsx(Ne,{style:{marginLeft:"54%"},color:"secondary",children:"Filter by"}),e.jsxs(Q,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(W,{style:{color:"white"},children:se}),e.jsxs(X,{children:[e.jsx(x,{onClick:()=>N("all","modal"),children:"All"}),e.jsx(x,{onClick:()=>N("Milano","modal"),children:"Milano"}),e.jsx(x,{onClick:()=>N("Napoli","modal"),children:"Napoli"})]})]}),e.jsxs(Q,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(W,{style:{color:"white"},children:te}),e.jsxs(X,{children:[e.jsx(x,{onClick:()=>U("all",null,"modal"),children:"All"}),oe.map((a,s)=>e.jsx(x,{onClick:()=>U(a.id,a.name,"modal"),children:a.name},s))]})]}),e.jsx(G,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),ae?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(q,{style:{marginTop:"15%"}})}):e.jsxs(J,{children:[e.jsx(K,{children:e.jsxs(u,{children:[e.jsx(d,{scope:"col",children:"#"}),e.jsx(d,{scope:"col",children:"Name"}),e.jsx(d,{scope:"col",children:"Address"}),e.jsx(d,{scope:"col",children:"City"}),e.jsx(d,{scope:"col",children:"Measurement"}),e.jsx(d,{scope:"col"})]})}),e.jsx(O,{children:I.length===0?e.jsx(u,{children:e.jsx(n,{colSpan:"6",style:{textAlign:"center",backgroundColor:"white"},children:e.jsx("h6",{style:{marginTop:"1%"},children:"No Data"})})}):I.map((a,s)=>e.jsxs(u,{children:[e.jsx(n,{children:k+s+1}),e.jsx(n,{children:a.chain.name}),e.jsx(n,{children:a.address}),e.jsx(n,{children:a.city}),e.jsx(n,{children:a.scraped}),e.jsx(n,{children:ne.includes(a._id)?e.jsx(M,{size:"sm",onClick:()=>V(m,a._id),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Remove"}):e.jsx(M,{size:"sm",onClick:()=>ke(m,a._id),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Add"})})]},s))})]}),e.jsx(Te,{children:e.jsxs(Ee,{"aria-label":"Page navigation example",children:[e.jsx(T,{disabled:k<=0,onClick:Ce,children:"Previous"}),xe(),e.jsx(T,{disabled:de===!0,onClick:fe,children:"Next"})]})})]})]})]})};export{Ye as default};
