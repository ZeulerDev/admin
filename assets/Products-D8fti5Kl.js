import{y as Ne,r,A as d,j as a,h as ve,L as Be,m as Ee}from"./index-1nLR5RGy.js";import{a as m}from"./axios-Cm0UX6qg.js";import{B as N}from"./config-HOLfLxHr.js";import{b as Te,a as J}from"./CContainer-DfgIIkA9.js";import{C as Le,a as K,b as W,c as X,d as y}from"./DefaultLayout-PY4GQLlg.js";import{C as $e}from"./CNavbar-Cn5Tba6R.js";import{C as Y}from"./CFormInput-B-dT1a4O.js";import{C as ze,a as Fe,b as Z,c,d as Re,e as i}from"./CTable-BbDDKHT4.js";import{C as ee}from"./CCardImage-BNe5Nk8h.js";import{c as He}from"./cil-pencil-m516yCOw.js";import{C as Ve,a as v}from"./CPaginationItem-p0LfWE13.js";import{C as ae,a as te,b as se,c as re}from"./CModalTitle-H_mL68lj.js";import{C as le}from"./CModalFooter-BePzWYJy.js";import"./CFormLabel-DeTrB1R-.js";const ra=()=>{const[{user:x,token:p},n]=Ne(),[oe,u]=r.useState(!1),[B,E]=r.useState([]),[f,P]=r.useState(0),[ce,j]=r.useState(!0),[ne,de]=r.useState([]),[ie,k]=r.useState("All Chains"),[b,T]=r.useState("All market"),[_e,S]=r.useState(""),[L,$]=r.useState(""),[pe,z]=r.useState([]),[I,ue]=r.useState(""),[he,D]=r.useState(!1),[ge,F]=r.useState(""),[M,R]=r.useState(""),[me,H]=r.useState(""),[xe,fe]=r.useState(0),[C,A]=r.useState(1);r.useState("NAME");const[V,w]=r.useState(!1),[je,_]=r.useState("");r.useEffect(()=>{x&&p&&h(0)},[x,p,L,I]),r.useEffect(()=>{p&&m.get("http://localhost:8003/assistant/market/chains/all",{headers:{Authorization:`Bearer ${p}`}}).then(e=>{e.status===200?de(e.data):e.status===500&&n({type:d,payload:{status:!0,title:"Chain Loading error",message:e.data.message}})}).catch(e=>{console.error("Error: ",e)})},[]);const Ce=e=>{m.get(`http://localhost:8003/assistant/market/locations?brand=${e}`,{headers:{Authorization:`Bearer ${p}`}}).then(t=>{t.status===200?(z(t.data.data),t.data.data.length<20?(j(!0),console.log("ok")):t.data.data.length>19&&j(!1)):t.status===500&&n({type:d,payload:{status:!0,title:"Market Loading error",message:t.data.message}})}).catch(t=>{console.error("Error: ",t)})},h=(e,t)=>{u(!0),m.get(N+`product/all/${e}?marketId=${L}&name=${I}`,{headers:{Authorization:`Bearer ${p}`}}).then(s=>{s.status===200?(E(s.data.list),fe(s.data.count),u(!1),s.data.list.length<20?(j(!0),console.log("ok")):s.data.list.length>19&&j(!1)):s.status===203?(u(!1),n({type:d,payload:{status:!0,title:"product loading error error",message:s.data.message}})):s.status===204?(u(!1),n({type:d,payload:{status:!0,title:"No Products",message:"No products found in this market address",color:"info"}})):s.status===500&&(u(!1),n({type:d,payload:{status:!0,title:"product loading error error",message:s.data.message}}))}).catch(s=>{u(!1),console.error("Error:",s)})},Q=(e,t)=>{e==="all"?(S(""),k("All Chains")):(S(e),Ce(e),k(t))},O=(e,t)=>{e==="all"?($(""),T("All Markets"),S(""),k("All Chains"),z([])):($(e),T(t))},ye=()=>{A(C+1);const e=f+50;P(e),h(e)},Pe=()=>{A(C-1);const e=f-50;console.log(e),P(e),h(e)},ke=(e,t)=>{D(!0),F(e),H(t)},be=()=>{console.log("called"),M==""?n({type:d,payload:{status:!0,title:"Alert",message:"Please enter the price",color:"warning"}}):De(ge)},Se=e=>{A(e);const t=(e-1)*50;P(t),h(t)},Ie=()=>{const e=Math.ceil(xe/50),t=[];for(let l=1;l<=e;l++)t.push(l);const s=Math.max(C-2,1),o=Math.min(s+4,e);return t.slice(s-1,o).map(l=>a.jsx(v,{active:C===l,onClick:()=>Se(l),children:l},l))},De=e=>{if(e){let t={price:M+" â‚¬"};x&&p&&m.put(N+"product/update/price/"+e,t,{headers:{Authorization:`Bearer ${p}`}}).then(s=>{if(s.status===200){const o=s.data,g=B.map(l=>(l.productId===o.productId&&(l.price.basePrice=o.price.basePrice,l.price.tax=o.price.tax,l.price.markup=o.price.markup,l.price.total=o.price.total),l));E([...g]),n({type:d,payload:{status:!0,title:"Product Details Update",message:"Product price update Success",color:"success"}}),F(""),R(""),D(!1),H("")}else s.status===204?n({type:d,payload:{status:!0,title:"Product Details Update error",message:s.data.message,color:"danger"}}):s.status===500&&n({type:d,payload:{status:!0,title:"Product Details Update error",message:s.data.message,color:"danger"}})}).catch(s=>{console.error("Error:",s)})}else alert("Please Check the Fields!")},Me=e=>{w(!V),_(e)},[Ae,U]=r.useState(null),[q,G]=r.useState(null),we=e=>{console.log(e),G(URL.createObjectURL(e)),U(e)},Ue=async(e,t)=>{if(console.log(e,t),x&&p){const s=new FormData;s.append("image",t),s.append("id",e),m.post(N+"test/product/image/update",s,{headers:{Authorization:`Bearer ${p}`}}).then(o=>{o.status===200?(w(!1),_(""),U(null),console.log("response",o.data),n({type:d,payload:{status:!0,title:"Image upload ",message:"Image upload success",color:"success"}}),h(0)):o.status===500&&n({type:d,payload:{status:!0,title:"Image upload error",message:o.data.message,color:"danger"}})}).catch(o=>{console.error("Error:",o)})}};return a.jsxs(Te,{children:[a.jsx(Le,{style:{marginLeft:"57%"},color:"secondary",children:"Filter by"}),a.jsxs(K,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[a.jsx(W,{children:ie}),a.jsxs(X,{children:[a.jsx(y,{onClick:()=>Q("all"),children:"All"}),ne.map((e,t)=>a.jsx(y,{onClick:()=>Q(e.id,e.name),children:e.name},t))]})]}),a.jsxs(K,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[a.jsx(W,{children:b.length>15?`${b.substring(0,15)}...`:b}),a.jsxs(X,{children:[a.jsx(y,{onClick:()=>O("all"),children:"Select the Chain"}),pe.map((e,t)=>a.jsx(y,{onClick:()=>O(e._id,e.address),children:a.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[a.jsx("span",{children:e.address.substring(0,e.address.length/2)}),a.jsx("span",{children:e.address.substring(e.address.length/2)})]})},t))]})]}),a.jsx($e,{style:{marginTop:"1%"},className:"bg-body-tertiary",children:a.jsx(Y,{type:"text",placeholder:"Search products by name, brand name and product id",style:{width:450,marginRight:"60%"},value:I,onChange:e=>ue(e.target.value)})}),oe?a.jsx(ve,{}):a.jsxs(ze,{children:[a.jsx(Fe,{children:a.jsxs(Z,{children:[a.jsx(c,{scope:"col",children:"#"}),a.jsx(c,{scope:"col",children:"Product Id"}),a.jsx(c,{scope:"col",children:"Photo"}),a.jsx(c,{scope:"col",children:"Name"}),a.jsx(c,{scope:"col",children:"Base Price"}),a.jsx(c,{scope:"col",children:"Tax"}),a.jsx(c,{scope:"col",children:"Markup Percentage "}),a.jsx(c,{scope:"col",children:"Markup"}),a.jsx(c,{scope:"col",children:"Total"}),a.jsx(c,{scope:"col",children:"Brand"}),a.jsx(c,{scope:"col",children:"Chain"}),a.jsx(c,{scope:"col",children:"Market Address"})]})}),a.jsx(Re,{children:B.map((e,t)=>{var s,o,g,l;return a.jsxs(Z,{children:[a.jsx(i,{children:f+t+1}),a.jsx(i,{children:e.pid}),a.jsx(c,{onClick:()=>{Me(e.productId)},children:a.jsx(ee,{style:{width:"50px",height:"50px"},src:"https://api.zeuler.com/image/"+e.image})}),a.jsx(i,{children:e.name}),a.jsxs(i,{children:[(((s=e.price)==null?void 0:s.basePrice)??0).toFixed(2),a.jsx(Be,{to:"",children:a.jsx(Ee,{icon:He,size:"sm",onClick:()=>ke(e.productId,e.price.basePrice)})})]}),a.jsx(i,{children:(((o=e.price)==null?void 0:o.tax)??0).toFixed(2)}),a.jsxs(i,{children:[e.price.percentage,"%"]}),a.jsx(i,{children:(((g=e.price)==null?void 0:g.markup)??0).toFixed(2)}),a.jsx(i,{children:(((l=e.price)==null?void 0:l.total)??0).toFixed(2)}),a.jsx(i,{children:e.brand}),a.jsx(i,{children:e.chainName}),a.jsx(i,{children:e.marketAddress})]},t)})})]}),a.jsxs(Ve,{"aria-label":"Page navigation example",children:[a.jsx(v,{disabled:f<=0,onClick:Pe,children:"Previous"}),Ie(),a.jsx(v,{disabled:ce===!0,onClick:ye,children:"Next"})]}),a.jsxs(ae,{alignment:"center",visible:he,scrollable:!0,size:"sm",onClose:()=>D(!1),children:[a.jsx(te,{closeButton:!0,children:a.jsx(se,{children:"Change Price"})}),a.jsxs(re,{children:[a.jsx("a",{children:"Enter New Price"}),a.jsx("br",{}),a.jsx(Y,{type:"text",placeholder:me,value:M,onChange:e=>R(e.target.value)})]}),a.jsx(le,{children:a.jsx(J,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>be(),children:"Save changes"})})]}),a.jsxs(ae,{alignment:"center",visible:V,scrollable:!0,size:"lg",onClose:()=>{w(!1),U(null),G(null)},children:[a.jsx(te,{closeButton:!0,children:a.jsx(se,{children:"Image Uploader"})}),a.jsxs(re,{children:[q&&a.jsx(ee,{style:{width:"100px",height:"100px"},src:q,alt:"Uploaded Image"}),a.jsx("input",{style:{marginLeft:"5%"},type:"file",accept:".jpg, .jpeg, .png",onChange:e=>we(e.target.files[0])})]}),a.jsx(le,{children:a.jsx(J,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>{Ue(je,Ae)},children:"Upload Image"})})]})]})};export{ra as default};
