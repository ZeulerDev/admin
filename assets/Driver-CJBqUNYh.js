import{r,y as Xe,l as Ze,A as o,j as e,L as Ce,h as Oe,m as ve}from"./index-CWrNKnUn.js";import{a as m}from"./axios-Cm0UX6qg.js";/* empty css               */import{B as g}from"./config-HOLfLxHr.js";import{b as es,a as h}from"./CContainer-rLvsNxDy.js";import{C as we,a as V,b as G,c as $,d as f}from"./DefaultLayout-Dl-jL1Ob.js";import{C as ss}from"./CNavbar-DgcRwyXb.js";import{C as p}from"./CFormInput-BFhklKIl.js";import{C as ts,a as as,b as be,c as n,d as rs,e as d}from"./CTable-BefVuclu.js";import{c as ls}from"./cil-pencil-m516yCOw.js";import{c as os}from"./cil-trash-CBbKHhHb.js";import{C as D,a as k,b as S,c as E}from"./CModalTitle-KQ4EoNH0.js";import{C as c}from"./CCol-CDM90Uys.js";import{C as is}from"./CModalFooter-Ndk1GWoC.js";import{C as ns}from"./CFormSelect-DhiPq6Ro.js";import"./CFormLabel-DxUs0q6J.js";const ks=()=>{const[F,y]=r.useState(!1),[U,C]=r.useState(!1),[{user:v,token:i},l]=Xe(),[A,P]=r.useState([]),[De,T]=r.useState(!1),[H,_]=r.useState(""),[Y,q]=r.useState(""),[J,K]=r.useState(""),[B,ke]=r.useState(""),[L,Q]=r.useState(!1),[W,X]=r.useState("");Ze();const[Se,Ee]=r.useState(!1),[Ae,Z]=r.useState("All Cities"),[Pe,O]=r.useState("All Market Groups"),[Te,ee]=r.useState("All Chains"),[Be,Le]=r.useState([]),[Ne,Me]=r.useState([]),[se,j]=r.useState(!1),[u,ze]=r.useState([]),[te,ae]=r.useState(),[re,le]=r.useState(),[oe,ie]=r.useState(),[ne,de]=r.useState(),[ce,ue]=r.useState(),[N,he]=r.useState(),[Ie,pe]=r.useState(),[me,ge]=r.useState(),[Re,Ve]=r.useState(),[w,Ge]=r.useState(""),[M,$e]=r.useState(""),[Fe,z]=r.useState(!1);r.useEffect(()=>{Ue(),He()},[]);const Ue=()=>{i&&m.get(g+"market/groups/dropdown/fetch",{headers:{Authorization:`Bearer ${i}`}}).then(s=>{s.status===200?Le(s.data):s.status===500&&l({type:o,payload:{status:!0,title:"Market Group Loading error",message:s.data.message}})}).catch(s=>{console.error("Error: ",s)})},He=()=>{i&&m.get(g+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${i}`}}).then(s=>{s.status===200?(Me(s.data),Ee(!1)):s.status===500&&l({type:o,payload:{status:!0,title:"Chain Loading error",message:s.data.message}})}).catch(s=>{console.error("Error: ",s)})};r.useEffect(()=>{const s=setTimeout(()=>{l({type:o,payload:{status:!0,title:"Data Loading",message:"Data loading error: Timeout exceeded",color:"warning"}}),T(!1)},2e4);return I(s),()=>{clearTimeout(s)}},[H,Y,J,B,Se]);const I=s=>{if(v&&i){T(!0);let t=g+`assistant/riders/0?city=${H}&group=${Y}&chain=${J}&code=${B}`;m.get(t,{headers:{Authorization:`Bearer ${i}`}}).then(a=>{a.status===200?(P(a.data),T(!1),clearTimeout(s)):a.status===500&&l({type:o,payload:{status:!0,title:"Error",message:a.data.message,color:"warning"}})}).catch(a=>{console.error("Error:",a)})}},R=s=>{s==="all"?(_(""),Z("All Cities")):(_(s),Z(s))},fe=(s,t)=>{s==="all"?(q(""),O("All Market Groups")):(q(s),O(t))},xe=(s,t)=>{s==="all"?(K(""),ee("All Chains")):(K(s),ee(t))},je=(s,t)=>{y(!F),Q(t),X(s)},_e=()=>{const s={status:L};console.log(L),console.log(W,s),v&&i&&m.patch(g+"assistant/rider/status/"+W,s,{headers:{Authorization:`Bearer ${i}`}}).then(t=>{if(t.status===200){console.log("updated",t.data),y(!1),Q(""),X("");const a=t.data,x=A.map(b=>b.id===a.id?a:b);P([...x]),l({type:o,payload:{status:!0,title:"Driver status update",message:"Driver status updated successfully",color:"success"}})}else t.status===203?l({type:o,payload:{status:!0,title:"Driver status update error",message:t.data.message}}):t.status===204?l({type:o,payload:{status:!0,title:"Driver status update error",message:t.data.message}}):t.status===500&&l({type:o,payload:{status:!0,title:"Driver status update error",message:t.data.message}})}).catch(t=>{console.error(t)})},Ye=s=>{j(!se),ze(s),ae(s.name),le(s.surname),ie(s.email),de(s.contact),ue(s.iban),he(s.city),ge(s.address),pe(s.vat)},qe=()=>{if(te&&re&&oe&&ne&&ce&&N&&me){const s={name:te,surname:re,email:oe,contact:ne,iban:ce,city:N,vat:Ie,address:me},t=u.id;i&&v&&i&&m.patch(g+"assistant/rider/update/"+t,s,{headers:{Authorization:`Bearer ${i}`}}).then(a=>{if(a.status===200){j(!1);const x=a.data,b=A.map(ye=>ye.id===x.id?x:ye);P([...b]),I(),l({type:o,payload:{status:!0,title:"Driver update",message:"Driver updated successfully",color:"success"}})}else a.status===203?l({type:o,payload:{status:!0,title:"Driver update error",message:"Email already exist",color:"warning"}}):a.status===204?(console.log(a.message),l({type:o,payload:{status:!0,title:"Driver update error",message:"Something is missing",color:"warning"}})):a.status===404?(console.log(a.message),l({type:o,payload:{status:!0,title:"Driver update error",message:"Driver not found",color:"warning"}})):a.status===500&&l({type:o,payload:{status:!0,title:"Driver update error",message:a.data.message,color:"warning"}})}).catch(a=>{console.error("Error:",a)})}else l({type:o,payload:{status:!0,title:"Error!",message:"Picker update error, Please Check the input fields",color:"warning"}})},Je=s=>{C(!U),Ve(s)},Ke=s=>{m.delete(g+"assistant/rider/delete/"+s,{headers:{Authorization:`Bearer ${i}`}}).then(t=>{t.status===200?(l({type:o,payload:{status:!0,title:"Driver Delete",message:"Driver deleted successfully",color:"success"}}),C(!1),I()):t.status===404?l({type:o,payload:{status:!0,title:"Driver remove error",message:t.data.message}}):t.status===500&&l({type:o,payload:{status:!0,title:"Driver remove error",message:t.data.message}})}).catch(t=>{console.error("Error:",t)})},Qe=()=>{j(!1),z(!0)},We=s=>{if(w===""||M==="")l({type:o,payload:{status:!0,title:"Password update error",message:"Check the input fields",color:"warning"}});else if(w===M){const t={passcode:w};console.log(t,s),v&&i&&m.patch(g+"assistant/rider/update/"+s,t,{headers:{Authorization:`Bearer ${i}`}}).then(a=>{a.status===200?(z(!1),l({type:o,payload:{status:!0,title:"Password update",message:"Password updated successfully",color:"success"}}),j(!0)):a.status===204?l({type:o,payload:{status:!0,title:"Password update error",message:a.data.message}}):a.status===404?l({type:o,payload:{status:!0,title:"Password update error",message:a.data.message}}):a.status===500&&l({type:o,payload:{status:!0,title:"Password update error",message:a.data.message}})}).catch(a=>{console.error(a)})}else l(w!==M?{type:o,payload:{status:!0,title:"Password update error",message:"Password does not match",color:"warning"}}:{type:o,payload:{status:!0,title:"Password update error",message:"Password update error or check the input fields",color:"warning"}})};return e.jsxs(es,{children:[e.jsx(Ce,{to:"/driver/adddriver",className:"picker-link",children:e.jsx(h,{style:{marginLeft:"0%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Add Driver"})}),e.jsx(we,{style:{marginLeft:"20%"},color:"secondary",children:"Filter by"}),e.jsxs(V,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(G,{style:{color:"white"},children:Ae}),e.jsxs($,{children:[e.jsx(f,{onClick:()=>R("all"),children:"All"}),e.jsx(f,{onClick:()=>R("Milan"),children:"Milan"}),e.jsx(f,{onClick:()=>R("Napoli"),children:"Napoli"})]})]}),e.jsxs(V,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(G,{style:{color:"white"},children:Te}),e.jsxs($,{children:[e.jsx(f,{onClick:()=>xe("all"),children:"All"}),Ne.map((s,t)=>e.jsx(f,{onClick:()=>xe(s.id,s.name),children:s.name},t))]})]}),e.jsxs(V,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(G,{style:{color:"white"},children:Pe}),e.jsxs($,{children:[e.jsx(f,{onClick:()=>fe("all"),children:"All"}),Be.map((s,t)=>e.jsx(f,{onClick:()=>fe(s._id,s.name),children:s.name},t))]})]}),e.jsx(ss,{style:{marginTop:"1%"},className:"bg-body-tertiary",children:e.jsx(p,{type:"text",placeholder:"Search by Driver id, name, surname, email and contact",style:{width:450,marginLeft:"0%"},value:B,onChange:s=>ke(s.target.value)})}),De?e.jsx(Oe,{}):e.jsxs(ts,{children:[e.jsx(as,{children:e.jsxs(be,{children:[e.jsx(n,{scope:"col",children:"#"}),e.jsx(n,{scope:"col",children:"Id"}),e.jsx(n,{scope:"col",children:"First Name"}),e.jsx(n,{scope:"col",children:"Last Name"}),e.jsx(n,{scope:"col",children:"Email"}),e.jsx(n,{scope:"col",children:"Phone"}),e.jsx(n,{scope:"col",children:"City"}),e.jsx(n,{scope:"col",children:"Country"}),e.jsx(n,{scope:"col",children:"Employee ID"}),e.jsx(n,{scope:"col",children:"Language"}),e.jsx(n,{scope:"col",children:"Group"}),e.jsx(n,{scope:"col",children:"Edit"}),e.jsx(n,{scope:"col",children:"Edit Status"}),e.jsx(n,{scope:"col",children:"Action"})]})}),e.jsx(rs,{children:A.map((s,t)=>e.jsxs(be,{children:[e.jsx(d,{children:t+1}),e.jsx(d,{children:s.code}),e.jsx(d,{children:s.name}),e.jsx(d,{children:s.surname}),e.jsx(d,{children:s.email}),e.jsx(d,{children:s.contact}),e.jsx(d,{children:s.city}),e.jsx(d,{children:s.country==="it"||s.country==="Italy"?"Italy":s.country}),e.jsx(d,{children:s.employeeId?s.employeeId:e.jsx(we,{color:"warning",children:"Not Provide"})}),e.jsx(d,{children:s.language==="en"?"English":s.language==="it"?"Italy":s.language==="es"?"Spanish":s.language}),e.jsx(d,{children:s.groups.map((a,x)=>e.jsx("div",{children:a.name},x))}),e.jsx(d,{children:e.jsx(Ce,{children:e.jsx(ve,{icon:ls,size:"xl",onClick:()=>Ye(s)})})}),e.jsx(d,{children:s.activate?e.jsx(h,{size:"sm",onClick:()=>je(s.id,!1),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Deactivate"}):e.jsx(h,{size:"sm",onClick:()=>je(s.id,!0),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Activate"})}),e.jsx(d,{children:e.jsx(h,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>Je(s.id),children:e.jsx(ve,{icon:os,size:"lg",style:{color:"white"}})})})]},t))})]}),e.jsxs(D,{alignment:"center",visible:Fe,scrollable:!0,size:"sm",onClose:()=>z(!1),children:[e.jsx(k,{closeButton:!0,children:e.jsx(S,{children:"Update Password"})}),e.jsxs(E,{children:[e.jsx(c,{md:12,children:e.jsx(p,{id:"password",label:"Enter New Password",type:"password",onChange:s=>Ge(s.target.value)})}),e.jsx("br",{}),e.jsx(c,{md:12,children:e.jsx(p,{id:"repassword",label:"Re Enter Password",type:"password",onChange:s=>$e(s.target.value)})})]}),e.jsx(is,{children:e.jsx(h,{type:"submit",style:{marginBottom:"3%",backgroundColor:"#ff4d4d",color:"white"},onClick:()=>{We(u.id)},children:"Update"})})]}),e.jsxs(D,{alignment:"center",visible:U,scrollable:!0,size:"sm",onClose:()=>C(!1),children:[e.jsx(k,{closeButton:!1,children:e.jsx(S,{children:"Confirmation"})}),e.jsxs(E,{children:[e.jsx("a",{children:"Are you sure you want to delete this driver?"}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[e.jsx(h,{onClick:()=>Ke(Re),style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),e.jsx(h,{onClick:()=>C(!1),style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]}),e.jsxs(D,{alignment:"center",visible:F,scrollable:!0,size:"sm",onClose:()=>y(!1),children:[e.jsx(k,{closeButton:!1,children:e.jsx(S,{children:"Confirmation"})}),e.jsxs(E,{children:[e.jsxs("a",{children:["Are you sure you want to ",L?"activate":"deactivate"," this driver?"]}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[e.jsx(h,{onClick:()=>_e(),style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),e.jsx(h,{onClick:()=>y(!1),style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]}),e.jsxs(D,{visible:se,scrollable:!0,size:"lg",onClose:()=>j(!1),children:[e.jsx(k,{closeButton:!0,children:e.jsx(S,{children:"Edit Driver Information"})}),e.jsx(E,{children:e.jsxs("div",{className:"row g-3",children:[e.jsx(c,{md:6,children:e.jsx(p,{id:"name",label:"Firt Name",defaultValue:u.name,onChange:s=>ae(s.target.value)})}),e.jsx(c,{md:6,children:e.jsx(p,{id:"surname",label:"LastName",defaultValue:u.surname,onChange:s=>le(s.target.value)})}),e.jsx(c,{md:6,children:e.jsx(p,{id:"address",label:"Address",defaultValue:u.address,onChange:s=>ge(s.target.value)})}),e.jsx(c,{md:6,children:e.jsx(p,{id:"email",label:"Email",defaultValue:u.email,onChange:s=>ie(s.target.value)})}),e.jsx(c,{md:6,children:e.jsx(p,{id:"phone",label:"Contact Number",defaultValue:u.contact,onChange:s=>de(s.target.value)})}),e.jsx(c,{md:6,children:e.jsx(p,{id:"iban",label:"IBAN",defaultValue:u.iban,onChange:s=>ue(s.target.value)})}),e.jsx(c,{md:6,children:e.jsx(p,{id:"vat",label:"Vat",defaultValue:u.vat,onChange:s=>pe(s.target.value)})}),e.jsx(c,{md:6,children:e.jsxs(ns,{id:"inputState",label:"City",value:N,onChange:s=>he(s.target.value),children:[e.jsx("option",{children:u.city}),e.jsx("option",{children:"Milano"}),e.jsx("option",{children:"Napoli"})]})}),e.jsx(c,{xs:6,children:e.jsx(h,{style:{marginBottom:"3%",width:"200px",backgroundColor:"#ff4d4d",color:"white"},onClick:()=>qe(),children:"Update Rider"})}),e.jsx(c,{xs:6,children:e.jsx("span",{style:{fontSize:15,color:"red",cursor:"pointer",marginLeft:"64%",marginTop:"10%"},onClick:()=>Qe(),children:"Change Password"})})]})})]})]})};export{ks as default};
