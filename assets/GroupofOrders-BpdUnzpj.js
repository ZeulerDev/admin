import{y as xs,r as a,A as i,j as e,h as Pe,L as De,m as Be}from"./index-Bsn8dk4K.js";import{a as f}from"./axios-Cm0UX6qg.js";/* empty css               */import{B as m}from"./config-CAsDK75y.js";import{b as js,a as p}from"./CContainer-AV4JspaL.js";import{C as A,a as P,b as D,d as B,e as n}from"./DefaultLayout-FA2rmZWX.js";import{C as Ee}from"./CNavbar-5ERL6Uil.js";import{D as fs}from"./index-D7RGkDRW.js";import{C as b}from"./CFormInput--iaGGot-.js";import{C as Ge,a as Te,b as E,c as l,d as ze,e as r}from"./CTable-CwbSrcrF.js";import{c as ms}from"./cil-pencil-m516yCOw.js";import{c as ys}from"./cil-info-CmGCY32x.js";import{C as Cs,a as Me}from"./CPaginationItem-TLWytmzh.js";import{C as G,a as T,b as z,c as M}from"./CModalTitle-BnZCXL7j.js";import{C as _}from"./CModalFooter-ylOqhqYb.js";import{C as ks}from"./CRow-DDazsrmf.js";import{C as U}from"./CFormLabel-iOJk5yzm.js";import{C as Q}from"./CCol-S6pnG2SN.js";import{f as Le}from"./index-PqYCJD3r.js";import"./inheritsLoose-BR9xv5Kf.js";import"./typeof-QjJsDpFa.js";const Vs=()=>{var be,Se,we;const[{user:y,token:d},c]=xs(),[j,S]=a.useState([]),[ve,L]=a.useState(!1),[x,v]=a.useState(""),[Ie,Y]=a.useState(x),[C,W]=a.useState(0),[q,I]=a.useState(!1),[Ne,Fe]=a.useState(""),[J,K]=a.useState(""),[N,X]=a.useState(""),[Re,He]=a.useState([]),[$e,Oe]=a.useState([]),[Z,ee]=a.useState(""),[se,te]=a.useState(""),[ae,oe]=a.useState(""),[le,re]=a.useState(""),[Ve,ne]=a.useState("All Cities"),[_e,ce]=a.useState("All Status"),[Ue,ie]=a.useState("All Market Groups"),[Qe,de]=a.useState("All Chains"),[Ye,We]=a.useState([]),[qe,ue]=a.useState(!1),[F,R]=a.useState(!1),[k,Je]=a.useState([]),[he,H]=a.useState(!1),[Ke,Xe]=a.useState(""),[pe,Ze]=a.useState(""),[es,ss]=a.useState(""),[ge,w]=a.useState(!1),[xe,je]=a.useState([]),[ts,fe]=a.useState(!0);a.useEffect(()=>{const s=setTimeout(()=>{c({type:i,payload:{status:!0,title:"Data Loading",message:"Data loading error: Timeout exceeded",color:"warning"}}),L(!1)},2e4);return y&&d&&$(0,s),()=>{clearTimeout(s)}},[y,d,Ie,se,xe]),a.useEffect(()=>{const s=setTimeout(()=>{(x.length>=3||x.length===0)&&Y(x)},500);return()=>{clearTimeout(s)}},[x]);const $=(s,t)=>{L(!0),f.get(m+"assistant/grocery/group/"+s+"?rider="+x+"&status="+se+"&date="+xe,{headers:{Authorization:`Bearer ${d}`}}).then(o=>{console.log("data"),o.status===200?(S(o.data),console.log("dataaaaaaa"),L(!1),clearTimeout(t),o.data.length<50?(fe(!0),console.log("ok")):o.data.length>49&&fe(!1)):o.status===204?c({type:i,payload:{status:!0,title:"Grocery groups loading error",message:o.data.message}}):o.status===500&&c({type:i,payload:{status:!0,title:"Grocery groups error",message:o.data.message}})}).catch(o=>{console.error("Error:",o)})},as=()=>{console.log(C);const s=C+50;console.log(s),W(s),$(s,!0)},os=()=>{const s=C-50;console.log(s),W(s),$(s,!1)},ls=(s,t=null)=>{I(!q),Fe(s),t!==null?K(t):console.log("Bonus number not provided")},rs=()=>{const s={bonus:J};console.log(s),y&&d&&f.put(m+"assistant/grocery/group/bonus/"+Ne,s,{headers:{Authorization:`Bearer ${d}`}}).then(t=>{if(t.status===200){console.log("updated"),I(!1);const o=t.data,h=j.find(u=>u.id===o._id);h&&(h.bonus=o.bonus),S([...j])}else t.status===203?(console.log("203"),c({type:i,payload:{status:!0,title:"Bonus Update error",message:t.data.message}})):t.status===204?(console.log("204"),c({type:i,payload:{status:!0,title:"Bonus Update error",message:t.data.message}})):t.status===500&&c({type:i,payload:{status:!0,title:"Bonus Update error",message:t.data.message}})}).catch(t=>{console.error(t)})};a.useEffect(()=>{ns(),cs()},[]);const ns=()=>{d&&f.get(m+"market/groups/dropdown/fetch",{headers:{Authorization:`Bearer ${d}`}}).then(s=>{s.status===200?He(s.data):s.status===500&&c({type:i,payload:{status:!0,title:"Market Group Loading error",message:s.data.message}})}).catch(s=>{console.error("Error: ",s)})},cs=()=>{d&&f.get(m+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${d}`}}).then(s=>{s.status===200?Oe(s.data):s.status===500&&c({type:i,payload:{status:!0,title:"Chain Loading error",message:s.data.message}})}).catch(s=>{console.error("Error: ",s)})},O=s=>{s==="all"?(ee(""),ne("All Cities")):(ee(s),ne(s))},g=s=>{s==="all"?(te(""),ce("All Status"),v("")):(te(s),ce(s),v(""))},me=(s,t)=>{s==="all"?(oe(""),ie("All Market Groups")):(oe(s),ie(t))},ye=(s,t)=>{s==="all"?(re(""),de("All Chains")):(re(s),de(t))};a.useEffect(()=>{is()},[Z,ae,le,alert]);const is=()=>{y&&d&&(ue(!0),f.get(m+`assistant/shoppers/:skip?city=${Z}&group=${ae}&chain=${le}`,{headers:{Authorization:`Bearer ${d}`}}).then(s=>{s.status===200?(We(s.data),ue(!1)):s.status===500&&c({type:i,payload:{status:!0,title:"Error",message:s.data.message,color:"warning"}})}).catch(s=>{console.error("Error:",s)}))},ds=(s,t,o)=>{R(!F),console.log("Grocery ID",s),Je(o),X(t)},Ce=(s,t,o)=>{H(!he),console.log("picker id",s),console.log("Grocery id",o),X(t),Ze(o),Xe(s)},ke=(s,t,o)=>{console.log("bid",s,"PID",t,o);const h={pickerId:t,status:o};console.log(h),y&&d&&f.put(m+"assistant/grocery/group/picker/"+s,h,{headers:{Authorization:`Bearer ${d}`}}).then(u=>{if(u.status===200){console.log("updated",u.data),F&&R(!1),H(!1);const V=u.data,gs=j.map(Ae=>Ae.id===V._id?(console.log("matched"),V):Ae);console.log("update obj",V),S([...gs]),c({type:i,payload:{status:!0,title:"Picker Assign ",message:"Successfully picker assigned to the grocery group",color:"success"}})}else u.status===203?(console.log("203"),c({type:i,payload:{status:!0,title:"Picker Assign error",message:u.data.message}})):u.status===204?(console.log("204"),c({type:i,payload:{status:!0,title:"Picker Assign error",message:u.data.message}})):u.status===500&&c({type:i,payload:{status:!0,title:"Picker Assign error",message:u.data.message}})}).catch(u=>{console.error(u)})},us=s=>{w(!ge),ss(s)},hs=s=>{console.log("status",s),y&&d&&f.put(m+"assistant/grocery/group/status/"+s,{},{headers:{Authorization:`Bearer ${d}`}}).then(t=>{if(t.status===200){console.log("updated",t.data),w(!1);const o=t.data,h=j.find(u=>u.id===o._id);h&&(console.log("done",h),h.status=o.status),S([...j])}else t.status===203?(console.log("203"),c({type:i,payload:{status:!0,title:"Status update error",message:t.data.message}})):t.status===204?(console.log("204"),c({type:i,payload:{status:!0,title:"Status update error",message:t.data.message}})):t.status===500&&c({type:i,payload:{status:!0,title:"Status update error",message:t.data.message}})}).catch(t=>{console.error(t)})},ps=s=>{if(s){const t=Le(s[0],"MM/dd/yyyy HH:mm"),o=Le(s[1],"MM/dd/yyyy HH:mm");je([t,o])}else je([])};return e.jsxs(js,{children:[e.jsx(A,{style:{marginLeft:"76%"},color:"secondary",children:"Filter by"}),e.jsxs(P,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[e.jsx(D,{style:{color:"white"},children:_e}),e.jsxs(B,{children:[e.jsx(n,{onClick:()=>g("all"),children:"All Status"}),e.jsx(n,{onClick:()=>g("created"),children:"Created"}),e.jsx(n,{onClick:()=>g("ready"),children:"Ready"}),e.jsx(n,{onClick:()=>g("finalized"),children:"Finalized"}),e.jsx(n,{onClick:()=>g("freeze"),children:"Freeze"}),e.jsx(n,{onClick:()=>g("forced"),children:"Forced"}),e.jsx(n,{onClick:()=>g("open"),children:"Open"}),e.jsx(n,{onClick:()=>g("completed"),children:"Completed"}),e.jsx(n,{onClick:()=>g("waiting"),children:"Waiting"}),e.jsx(n,{onClick:()=>g("paid "),children:"Paid "})]})]}),e.jsxs(Ee,{style:{marginTop:"1%"},className:"bg-body-tertiary",children:[e.jsx(fs,{style:{marginLeft:1},format:"MM/dd/yyyy HH:mm",onChange:ps}),e.jsx(b,{type:"text",placeholder:"Search By Rider Assign No",style:{width:300,marginLeft:"5%"},value:x,onChange:s=>v(s.target.value)})]}),ve?e.jsx(Pe,{}):e.jsxs(Ge,{children:[e.jsx(Te,{children:e.jsxs(E,{children:[e.jsx(l,{scope:"col",children:"#"}),e.jsx(l,{scope:"col",children:"No"}),e.jsx(l,{scope:"col",children:"Rider Assign No"}),e.jsx(l,{scope:"col",children:"Rider Status"}),e.jsx(l,{scope:"col",children:"Duration"}),e.jsx(l,{scope:"col",children:"Status"}),e.jsx(l,{scope:"col",children:"Date"}),e.jsx(l,{scope:"col",children:"Bonus"}),e.jsx(l,{scope:"col",children:"Amount"}),e.jsx(l,{scope:"col",children:"Hour"}),e.jsx(l,{scope:"col",children:"Rank"}),e.jsx(l,{scope:"col",children:"Start"}),e.jsx(l,{scope:"col",children:"End"}),e.jsx(l,{scope:"col",children:"Picker"}),e.jsx(l,{scope:"col",children:"Order"}),e.jsx(l,{scope:"col",children:"Order Details"})]})}),e.jsx(ze,{children:j.length===0?e.jsx(e.Fragment,{children:e.jsx("span",{style:{textAlign:"center"},children:"No date to show"})}):j.map((s,t)=>e.jsxs(E,{children:[e.jsx(r,{children:C+t+1}),e.jsx(r,{children:s.no}),e.jsx(r,{children:s.ridersAssigningNo}),e.jsx(r,{children:e.jsx(A,{style:{width:80},color:"info",children:s.ridersAssigningStatus})}),e.jsxs(r,{children:[s.duration," min"]}),e.jsx(r,{children:e.jsx(A,{style:{width:80},color:"warning",children:s.status})}),e.jsx(r,{children:s.date}),e.jsxs(r,{children:[s.bonus!=null?s.bonus.toFixed(2):0," ",e.jsx(De,{to:"",children:e.jsx(Be,{icon:ms,size:"sm",onClick:()=>ls(s.id,s.bonus)})})," "]}),e.jsx(r,{children:s.amount}),e.jsx(r,{children:s.hour}),e.jsx(r,{children:s.rank+1}),e.jsx(r,{children:s.start}),e.jsx(r,{children:s.end}),e.jsx(r,{children:s.shopper?e.jsx(p,{onClick:()=>ds(s.id,s.status,s),size:"sm",style:{width:80,backgroundColor:"#ff4d4d",color:"white"},children:"View"}):e.jsx(p,{onClick:()=>Ce(s.accepted,s.status,s.id),size:"sm",style:{width:80,backgroundColor:"#ff4d4d",color:"white"},children:"Add"})}),e.jsx(r,{children:s.status==="complete"?e.jsx(p,{size:"sm",disabled:!0,style:{width:80,backgroundColor:"#ff4d4d",color:"white"},children:"Cancel"}):s.status==="canceled"?e.jsx(p,{size:"sm",disabled:!0,style:{width:80,backgroundColor:"#ff4d4d",color:"white"},children:"Cancel"}):e.jsx(p,{onClick:()=>us(s.id),size:"sm",style:{width:80,backgroundColor:"#ff4d4d",color:"white"},children:"Cancel"})}),e.jsx(r,{children:e.jsx(De,{to:`/order/grocerygroup/orders/${s.id}`,children:e.jsx(Be,{icon:ys,size:"xl"})})})]},t))})]}),e.jsxs(Cs,{"aria-label":"Page navigation example",children:[e.jsx(Me,{disabled:C<=50,onClick:os,children:"Previous"}),e.jsx(Me,{disabled:ts===!0,onClick:as,children:"Next"})]}),e.jsxs(G,{alignment:"center",visible:q,scrollable:!0,size:"sm",onClose:()=>I(!1),children:[e.jsx(T,{closeButton:!0,children:e.jsx(z,{children:"Confirmation"})}),e.jsxs(M,{children:[e.jsx("a",{children:"Enter Bonus Amount"}),e.jsx("br",{}),e.jsx(b,{type:"text",placeholder:"Bonus",value:J,onChange:s=>K(s.target.value)})]}),e.jsx(_,{children:e.jsx(p,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>rs(),children:"Save changes"})})]}),e.jsxs(G,{alignment:"center",visible:F,scrollable:!0,size:"lg",onClose:()=>R(!1),children:[e.jsx(T,{closeButton:!0,children:e.jsx(z,{children:"Picker Information"})}),e.jsx(M,{style:{overflowY:"auto",maxHeight:"70vh",display:"flex",justifyContent:"center"},children:e.jsx("div",{children:e.jsxs(ks,{className:"mb-3",children:[e.jsx(U,{htmlFor:"staticEmail",className:"col-sm-2 col-form-label",children:"Name"}),e.jsx(Q,{sm:10,children:e.jsx(b,{type:"text",defaultValue:(be=k.shopper)==null?void 0:be.name,readOnly:!0,plainText:!0})}),e.jsx(U,{htmlFor:"staticEmail",className:"col-sm-2 col-form-label",children:"Email"}),e.jsx(Q,{sm:10,children:e.jsx(b,{type:"text",defaultValue:(Se=k.shopper)==null?void 0:Se.email,readOnly:!0,plainText:!0})}),e.jsx(U,{htmlFor:"staticEmail",className:"col-sm-2 col-form-label",children:"Contact"}),e.jsx(Q,{sm:10,children:e.jsx(b,{type:"text",defaultValue:(we=k.shopper)==null?void 0:we.contact,readOnly:!0,plainText:!0})})]})})}),e.jsx(_,{children:e.jsx(p,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>{var s;return Ce((s=k.shopper)==null?void 0:s.id,N,k.id)},children:"Change"})})]}),e.jsxs(G,{alignment:"center",visible:he,scrollable:!0,size:"xl",onClose:()=>H(!1),children:[e.jsx(T,{closeButton:!0,children:e.jsx(z,{children:"Picker Assing to the Grocery Batch"})}),e.jsxs(M,{children:[e.jsx(A,{style:{marginLeft:"37%"},color:"secondary",children:"Filter by"}),e.jsxs(P,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[e.jsx(D,{style:{color:"white"},children:Ve}),e.jsxs(B,{children:[e.jsx(n,{onClick:()=>O("all"),children:"All"}),e.jsx(n,{onClick:()=>O("Milan"),children:"Milan"}),e.jsx(n,{onClick:()=>O("Napoli"),children:"Napoli"})]})]}),e.jsxs(P,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[e.jsx(D,{style:{color:"white"},children:Qe}),e.jsxs(B,{children:[e.jsx(n,{onClick:()=>ye("all"),children:"All"}),$e.map((s,t)=>e.jsx(n,{onClick:()=>ye(s.id,s.name),children:s.name},t))]})]}),e.jsxs(P,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[e.jsx(D,{style:{color:"white"},children:Ue}),e.jsxs(B,{children:[e.jsx(n,{onClick:()=>me("all"),children:"All"}),Re.map((s,t)=>e.jsx(n,{onClick:()=>me(s._id,s.name),children:s.name},t))]})]}),e.jsx(Ee,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),qe?e.jsx(Pe,{}):e.jsxs(Ge,{children:[e.jsx(Te,{children:e.jsxs(E,{children:[e.jsx(l,{scope:"col",children:"#"}),e.jsx(l,{scope:"col",children:"First Name"}),e.jsx(l,{scope:"col",children:"Last Name"}),e.jsx(l,{scope:"col",children:"Email"}),e.jsx(l,{scope:"col",children:"Phone"}),e.jsx(l,{scope:"col",children:"Country"}),e.jsx(l,{scope:"col",children:"City"}),e.jsx(l,{scope:"col",children:"Language"}),e.jsx(l,{scope:"col",children:"Market"}),e.jsx(l,{scope:"col",children:"Action"})]})}),e.jsx(ze,{children:Ye.map((s,t)=>{var o,h;return e.jsxs(E,{children:[e.jsx(r,{children:t+1}),e.jsx(r,{children:s.name}),e.jsx(r,{children:s.surname}),e.jsx(r,{children:s.email}),e.jsx(r,{children:s.contact}),e.jsx(r,{children:s.country==="it"||s.country==="Italy"?"Italy":s.country}),e.jsx(r,{children:s.city}),e.jsx(r,{children:s.language==="en"?"English":s.language==="it"?"Italy":s.language==="es"?"Spanish":s.language}),e.jsxs(r,{children:[(h=(o=s.market)==null?void 0:o.chain)==null?void 0:h.name," - ",s.market.address]}),e.jsx(r,{children:s.id===Ke?e.jsx(p,{size:"sm",onClick:()=>ke(pe,s.id,N),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Assigned"}):e.jsx(p,{size:"sm",onClick:()=>ke(pe,s.id,N),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Add"})})]},t)})})]})]}),e.jsx(_,{})]}),e.jsxs(G,{alignment:"center",visible:ge,scrollable:!0,size:"sm",onClose:()=>w(!1),children:[e.jsx(T,{closeButton:!0,children:e.jsx(z,{children:"Confirmation"})}),e.jsxs(M,{children:[e.jsx("a",{children:"Are you sure you want to cancel this grocery group order?"}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[e.jsx(p,{onClick:()=>hs(es),style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),e.jsx(p,{onClick:()=>w(!1),style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]})]})};export{Vs as default};
