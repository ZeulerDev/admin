import{y as ne,r as o,l as ce,A as l,j as a,L as de,h as ue,m as he}from"./index-CUWfyW-O.js";import{a as p}from"./axios-Cm0UX6qg.js";import{B as m}from"./config-HOLfLxHr.js";import{b as pe,a as k}from"./CContainer-BItPl6AZ.js";import{C as me,a as F,b as V,d as Y,e as g}from"./DefaultLayout-DhMnxolp.js";import{C as ge}from"./CNavbar-DtbDRkDL.js";import{C as Ce,a as xe,b as S,c,d as fe,e as i}from"./CTable-DCkylyCt.js";import{C as y}from"./CFormCheck-BasxRHeg.js";import{c as ke}from"./cil-trash-CBbKHhHb.js";import{C as ye,a as P}from"./CPaginationItem-H7icVTj5.js";import{C as je,a as be,b as ve,c as Me}from"./CModalTitle-CVe0vSxH.js";import"./CFormLabel-D70FFWaS.js";const _e=()=>{const[{user:A,token:d},r]=ne(),[q,G]=o.useState([]),[j,J]=o.useState([]),[T,w]=o.useState(""),[N,L]=o.useState(""),[C,b]=o.useState(0),[K,B]=o.useState("All Cities"),[O,E]=o.useState("All Chains");o.useState();const[Q,v]=o.useState(!1),[W,R]=o.useState(!0);ce();const[z,x]=o.useState(!1),[X,Z]=o.useState(""),[ee,ae]=o.useState(0),[f,M]=o.useState(1);o.useEffect(()=>{d&&p.get(m+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${d}`}}).then(e=>{e.status===200?G(e.data):e.status===500&&r({type:l,payload:{status:!0,title:"Chain Loading error",message:e.data.message}})}).catch(e=>{console.error("Error: ",e)})},[]),o.useEffect(()=>{const e=setTimeout(()=>{r({type:l,payload:{status:!0,title:"Data Loading",message:"Data loading error: Timeout exceeded",color:"warning"}}),v(!1)},2e4);return A&&d&&u(0,e),()=>{clearTimeout(e)}},[T,N,A]);const u=(e,t)=>{v(!0),p.get(m+`assistant/market/locations/${e}?brand=${T}&city=${N}`,{headers:{Authorization:`Bearer ${d}`}}).then(s=>{s.status===200?(J(s.data.data),ae(s.data.count),v(!1),clearTimeout(t),s.data.data.length<20?(R(!0),console.log("ok")):s.data.data.length>19&&R(!1)):s.status===500&&r({type:l,payload:{status:!0,title:"Market Loading error",message:s.data.message}})}).catch(s=>{console.error("Error: ",s)})},te=()=>{M(f+1);const e=C+20;b(e),u(e,!0)},se=()=>{M(f-1);const e=C-20;console.log(e),b(e),u(e,!0)},$=(e,t)=>{e==="all"?(w(""),E("All Chains")):(w(e),E(t))},D=e=>{e==="all"?(L(""),B("All Cities")):(L(e),B(e))},_=(e,t,s)=>{console.log(e),console.log(j),s==="delivery"?(U({market:e,service:s}),console.log("add delivery")):s==="pickup"&&(U({market:e,service:s}),console.log("add pickup"))},I=(e,t,s)=>{s==="delivery"?(H({market:e,service:s}),console.log("remove delivery")):s==="pickup"&&(H({market:e,service:s}),console.log("remove pickup"))},U=e=>{p.post(m+"assistant/markets/add/services",e,{headers:{Authorization:`Bearer ${d}`}}).then(t=>{t.status===200?console.log("Updated add service"):t.status===203?r({type:l,payload:{status:!0,title:"Market Updated error",message:t.data.message}}):t.status===204?r({type:l,payload:{status:!0,title:"Market Updated error",message:t.data.message}}):t.status===500&&r({type:l,payload:{status:!0,title:"Market Updated error",message:t.data.message}})}).catch(t=>{console.error("Error:",t)})},H=e=>{p.post(m+"assistant/markets/remove/services",e,{headers:{Authorization:`Bearer ${d}`}}).then(t=>{t.status===200?console.log("Updated remove service"):t.status===203?r({type:l,payload:{status:!0,title:"Market remove error",message:t.data.message}}):t.status===204?r({type:l,payload:{status:!0,title:"Market remove error",message:t.data.message}}):t.status===500&&r({type:l,payload:{status:!0,title:"Market remove error",message:t.data.message}})}).catch(t=>{console.error("Error:",t)})},oe=e=>{x(!z),Z(e)},re=e=>{console.log(e),p.delete(m+"market/"+e,{headers:{Authorization:`Bearer ${d}`}}).then(t=>{t.status===200?(r({type:l,payload:{status:!0,title:"Market Delete",message:"Market Remove Success",color:"success"}}),x(!1),u(0,!0),console.log("Remove Market")):t.status===404?r({type:l,payload:{status:!0,title:"Market remove error",message:t.data.message}}):t.status===500&&r({type:l,payload:{status:!0,title:"Market remove error",message:t.data.message}})}).catch(t=>{console.error("Error:",t)})},le=e=>{M(e);const t=(e-1)*20;b(t),u(t,!0)},ie=()=>{const e=Math.ceil(ee/20),t=[];for(let n=1;n<=e;n++)t.push(n);const s=Math.max(f-2,1),h=Math.min(s+4,e);return t.slice(s-1,h).map(n=>a.jsx(P,{active:f===n,onClick:()=>le(n),children:n},n))};return a.jsxs(pe,{children:[a.jsx(de,{to:"/markets/addmarket",children:a.jsx(k,{style:{marginLeft:"0%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Add New Market"})}),a.jsx(me,{style:{marginLeft:"39.5%"},color:"secondary",children:"Filter by"}),a.jsxs(F,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[a.jsx(V,{style:{color:"white"},children:K}),a.jsxs(Y,{children:[a.jsx(g,{onClick:()=>D("all"),children:"All"}),a.jsx(g,{onClick:()=>D("Milano"),children:"Milano"}),a.jsx(g,{onClick:()=>D("Napoli"),children:"Napoli"})]})]}),a.jsxs(F,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[a.jsx(V,{style:{color:"white"},children:O}),a.jsxs(Y,{children:[a.jsx(g,{onClick:()=>$("all"),children:"All"}),q.map((e,t)=>a.jsx(g,{onClick:()=>$(e.id,e.name),children:e.name},t))]})]}),a.jsx(ge,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),Q?a.jsx("div",{className:"d-flex justify-content-center",children:a.jsx(ue,{style:{marginTop:"15%"}})}):a.jsxs(Ce,{children:[a.jsx(xe,{children:a.jsxs(S,{children:[a.jsx(c,{scope:"col",children:"#"}),a.jsx(c,{scope:"col",children:"Name"}),a.jsx(c,{scope:"col",children:"Address"}),a.jsx(c,{scope:"col",children:"City"}),a.jsx(c,{scope:"col",children:"Delivery"}),a.jsx(c,{scope:"col",children:"Pickup"}),a.jsx(c,{scope:"col",children:"Scraped"}),a.jsx(c,{scope:"col",children:"Remove"})]})}),a.jsx(fe,{children:j.length===0?a.jsx(S,{children:a.jsx(i,{colSpan:"8",style:{textAlign:"center",backgroundColor:"white"},children:a.jsx("h6",{style:{marginTop:"1%"},children:"No Data"})})}):j.map((e,t)=>{var s;return a.jsxs(S,{children:[a.jsx(i,{children:C+t+1}),a.jsx(i,{children:(s=e.chain)==null?void 0:s.name}),a.jsx(i,{children:e.address}),a.jsx(i,{children:e.city}),a.jsx(i,{children:e.services.includes("delivery")?a.jsx(y,{id:"flexCheckChecked",label:"",defaultChecked:!0,onChange:()=>I(e._id,!0,"delivery")}):a.jsx(y,{id:"flexCheckChecked",label:"",onChange:()=>_(e._id,!0,"delivery")})}),a.jsx(i,{children:e.services.includes("pickup")?a.jsx(y,{id:"flexCheckChecked",label:"",defaultChecked:!0,onChange:()=>I(e._id,!0,"pickup")}):a.jsx(y,{id:"flexCheckChecked",label:"",onChange:()=>_(e._id,!0,"pickup")})}),a.jsx(i,{children:e.scraped}),a.jsx(i,{children:a.jsx(k,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>oe(e._id),children:a.jsx(he,{icon:ke,size:"lg",style:{color:"white"}})})})]},t)})})]}),a.jsxs(ye,{"aria-label":"Page navigation example",children:[a.jsx(P,{disabled:C<=0,onClick:se,children:"Previous"}),ie(),a.jsx(P,{disabled:W===!0,onClick:te,children:"Next"})]}),a.jsxs(je,{alignment:"center",visible:z,scrollable:!0,size:"sm",onClose:()=>x(!1),children:[a.jsx(be,{closeButton:!1,children:a.jsx(ve,{children:"Confirmation"})}),a.jsxs(Me,{children:[a.jsx("a",{children:"Are you sure you want to delete this market?"}),a.jsx("br",{}),a.jsx("br",{}),a.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[a.jsx(k,{onClick:()=>re(X),style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),a.jsx(k,{onClick:()=>x(!1),style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]})]})};export{_e as default};
