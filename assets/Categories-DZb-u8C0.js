import{y as Ke,r as s,A as n,j as a,h as We,L as Xe,m as Ye}from"./index-Dr2bAMPU.js";import{a as p}from"./axios-Cm0UX6qg.js";import{B as m}from"./config-HOLfLxHr.js";import{b as Ze,a as le}from"./CContainer-u87GNtez.js";import{C as ea,a as P,b as D,d as I,e as h}from"./DefaultLayout-B2Nh7q8u.js";import{C as aa}from"./CNavbar-B7PVcNkl.js";import{C as ne}from"./CFormInput-BN0BKVRX.js";import{C as ta,a as sa,b as ce,c as i,d as ra,e as C}from"./CTable-Bfn_R52F.js";import{C as ie}from"./CCardImage-CGnGRqbq.js";import{c as oa}from"./cil-pencil-m516yCOw.js";import{C as la,a as V}from"./CPaginationItem-DP1tcg58.js";import{C as de,a as ue,b as ge,c as he}from"./CModalTitle-DKRx84Yh.js";import{C as pe}from"./CModalFooter-op4IeWM8.js";import"./CFormLabel-BwWU-nc5.js";const ka=()=>{const[{user:j,token:o},l]=Ke(),[me,f]=s.useState(!1),[Ce,fe]=s.useState([]),[y,A]=s.useState(0),[xe,S]=s.useState(!0),[je,ye]=s.useState([]),[Se,w]=s.useState("All Chains"),[E,b]=s.useState("All market"),[_,L]=s.useState(""),[O,k]=s.useState(""),[be,q]=s.useState([]),[d,c]=s.useState(""),[ke,G]=s.useState(d),[Me,N]=s.useState(!1),[Pe,J]=s.useState(""),[U,K]=s.useState(""),[De,W]=s.useState(""),[Ie,Ae]=s.useState(0),[M,B]=s.useState(1);s.useState("NAME");const[X,v]=s.useState(!1),[we,Y]=s.useState(""),[Ee,T]=s.useState("All Main Categories"),[na,$]=s.useState(""),[Le,Ne]=s.useState([]),[Ue,z]=s.useState(""),[Be,R]=s.useState("Select Main Categories"),[Z,F]=s.useState(""),[ve,Q]=s.useState([]);s.useEffect(()=>{j&&o&&x(0)},[j,o,O,ke,Z,_]),s.useEffect(()=>{const e=setTimeout(()=>{(d.length>=3||d.length===0)&&G(d)},500);return()=>{clearTimeout(e)}},[d]),s.useEffect(()=>{o&&p.get(m+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${o}`}}).then(e=>{e.status===200?ye(e.data):e.status===500&&l({type:n,payload:{status:!0,title:"Chain Loading error",message:e.data.message}})}).catch(e=>{console.error("Error: ",e)})},[]),s.useEffect(()=>{o&&p.get(m+"product/categories",{headers:{Authorization:`Bearer ${o}`}}).then(e=>{e.status===200?(console.log(e.data[1]),Ne(e.data)):e.status===500&&l({type:n,payload:{status:!0,title:"Main Category Loading error",message:"Main Category loading error"}})}).catch(e=>{console.error("Error: ",e)})},[]);const Te=e=>{p.get(m+`assistant/market/locations?brand=${e}`,{headers:{Authorization:`Bearer ${o}`}}).then(t=>{t.status===200?(q(t.data.data),t.data.data.length<20?(S(!0),console.log("ok")):t.data.data.length>19&&S(!1)):t.status===500&&l({type:n,payload:{status:!0,title:"Market Loading error",message:t.data.message}})}).catch(t=>{console.error("Error: ",t)})},x=(e,t)=>{f(!0),p.get(m+`product/category/all/${e}?marketId=${O}&name=${d}&category=${Z}&mainCategory=${Ue}&chainId=${_}`,{headers:{Authorization:`Bearer ${o}`}}).then(r=>{r.status===200?(fe(r.data.list),Ae(r.data.count),f(!1),r.data.list.length<20?(S(!0),console.log("ok")):r.data.list.length>19&&S(!1)):r.status===203?(f(!1),l({type:n,payload:{status:!0,title:"product loading error error",message:r.data.message}})):r.status===204?(f(!1),l({type:n,payload:{status:!0,title:"No Products",message:"No products found in this market address",color:"info"}})):r.status===500&&(f(!1),l({type:n,payload:{status:!0,title:"product loading error error",message:r.data.message}}))}).catch(r=>{f(!1),console.error("Error:",r)})},ee=(e,t)=>{e==="all"?($(""),T("All Main Categories"),F(""),R("Select Main Categories"),z(""),c(""),Q([])):($(e),$e(e),T(t),z(e),c(""))},$e=e=>{o&&p.get(m+"product/categories/sub/"+e,{headers:{Authorization:`Bearer ${o}`}}).then(t=>{t.status===200?Q(t.data):t.status===500&&l({type:n,payload:{status:!0,title:"Sub Category Loading",message:"Sub Category loading error"}})}).catch(t=>{console.error("Error: ",t)})},ae=(e,t)=>{e==="all"?(F(""),R("Select Main Categories"),$(""),T("All Main Categories"),Q([]),z(""),c("")):(console.log("index",e),F(e),R(t),c(""))},te=(e,t)=>{e==="all"?(L(""),w("All Chains"),k(""),b("All Markets"),c("")):(L(e),Te(e),w(t),k(""),b("All Markets"),c(""))},se=(e,t)=>{e==="all"?(k(""),b("All Markets"),L(""),w("All Chains"),q([]),c("")):(k(e),b(t),c(""))},ze=()=>{B(M+1);const e=y+50;A(e),x(e)},Re=()=>{B(M-1);const e=y-50;console.log(e),A(e),x(e)},Fe=(e,t)=>{N(!0),J(e),W(t)},Qe=()=>{console.log("called"),U==""?l({type:n,payload:{status:!0,title:"Alert",message:"Please enter the price",color:"warning"}}):_e(Pe)},He=e=>{B(e);const t=(e-1)*50;A(t),x(t)},Ve=()=>{const e=Math.ceil(Ie/50),t=[];for(let g=1;g<=e;g++)t.push(g);const r=Math.max(M-2,1),u=Math.min(r+4,e);return t.slice(r-1,u).map(g=>a.jsx(V,{active:M===g,onClick:()=>He(g),children:g},g))},_e=e=>{if(e){let t={price:U+" â‚¬"};j&&o&&p.put(m+"product/update/price/"+e,t,{headers:{Authorization:`Bearer ${o}`}}).then(r=>{r.status===200?(l({type:n,payload:{status:!0,title:"Product Details Update",message:"Product price update Success",color:"success"}}),J(""),K(""),x(0),N(!1),W("")):r.status===204?l({type:n,payload:{status:!0,title:"Product Details Update error",message:r.data.message,color:"danger"}}):r.status===500&&l({type:n,payload:{status:!0,title:"Product Details Update error",message:r.data.message,color:"danger"}})}).catch(r=>{console.error("Error:",r)})}else alert("Please Check the Fields!")},Oe=e=>{v(!X),Y(e)},[qe,H]=s.useState(null),[re,oe]=s.useState(null),Ge=e=>{console.log(e),oe(URL.createObjectURL(e)),H(e)},Je=async(e,t)=>{if(console.log(e,t),j&&o){const r=new FormData;r.append("image",t),r.append("id",e),p.post(m+"test/product/image/update",r,{headers:{Authorization:`Bearer ${o}`}}).then(u=>{u.status===200?(v(!1),Y(""),H(null),console.log("response",u.data),l({type:n,payload:{status:!0,title:"Image upload ",message:"Image upload success",color:"success"}}),x(0)):u.status===500&&l({type:n,payload:{status:!0,title:"Image upload error",message:u.data.message,color:"danger"}})}).catch(u=>{console.error("Error:",u)})}};return a.jsxs(Ze,{children:[a.jsx(ea,{style:{marginLeft:"14%"},color:"secondary",children:"Filter by"}),a.jsxs(P,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d"},children:[a.jsx(D,{children:Se}),a.jsxs(I,{children:[a.jsx(h,{onClick:()=>te("all"),children:"All"}),je.map((e,t)=>a.jsx(h,{onClick:()=>te(e.id,e.name),children:e.name},t))]})]}),a.jsxs(P,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d"},children:[a.jsx(D,{children:E.length>15?`${E.substring(0,15)}...`:E}),a.jsxs(I,{children:[a.jsx(h,{onClick:()=>se("all"),children:"Select the Chain"}),be.map((e,t)=>a.jsx(h,{onClick:()=>se(e._id,e.address),children:a.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[a.jsx("span",{children:e.address.substring(0,e.address.length/2)}),a.jsx("span",{children:e.address.substring(e.address.length/2)})]})},t))]})]}),a.jsxs(P,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d"},children:[a.jsx(D,{children:Ee}),a.jsxs(I,{children:[a.jsx(h,{onClick:()=>ee("all"),children:"All Main Category"}),Le.map((e,t)=>a.jsx(h,{onClick:()=>ee(t,e),children:e},t))]})]}),a.jsxs(P,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d"},children:[a.jsx(D,{children:Be}),a.jsxs(I,{children:[a.jsx(h,{onClick:()=>ae("all"),children:"Clear Category"}),ve.map((e,t)=>a.jsx(h,{onClick:()=>ae(t,e),children:e},t))]})]}),a.jsx(aa,{style:{marginTop:"1%"},className:"bg-body-tertiary",children:a.jsx(ne,{type:"text",placeholder:"Search products by name, brand name and product id",style:{width:450,marginRight:"50%"},value:d,onChange:e=>c(e.target.value)})}),me?a.jsx(We,{}):a.jsxs(ta,{children:[a.jsx(sa,{children:a.jsxs(ce,{children:[a.jsx(i,{scope:"col",children:"#"}),a.jsx(i,{scope:"col",children:"Product Id"}),a.jsx(i,{scope:"col",children:"Photo"}),a.jsx(i,{scope:"col",children:"Name"}),a.jsx(i,{scope:"col",children:"Price"}),a.jsx(i,{scope:"col",children:"Brand"}),a.jsx(i,{scope:"col",children:"Chain"}),a.jsx(i,{scope:"col",children:"Market Address"})]})}),a.jsx(ra,{children:Ce.map((e,t)=>a.jsxs(ce,{children:[a.jsx(C,{children:y+t+1}),a.jsx(C,{children:e.pid}),a.jsx(i,{onClick:()=>{Oe(e.productId)},children:a.jsx(ie,{style:{width:"50px",height:"50px"},src:"https://api.zeuler.com/image/"+e.image})}),a.jsx(C,{children:e.name}),a.jsxs(C,{children:[e.price,a.jsx(Xe,{to:"",children:a.jsx(Ye,{icon:oa,size:"sm",onClick:()=>Fe(e.productId,e.price)})})]}),a.jsx(C,{children:e.brand}),a.jsx(C,{children:e.chainName}),a.jsx(C,{children:e.marketAddress})]},t))})]}),a.jsxs(la,{"aria-label":"Page navigation example",children:[a.jsx(V,{disabled:y<=0,onClick:Re,children:"Previous"}),Ve(),a.jsx(V,{disabled:xe===!0,onClick:ze,children:"Next"})]}),a.jsxs(de,{alignment:"center",visible:Me,scrollable:!0,size:"sm",onClose:()=>N(!1),children:[a.jsx(ue,{closeButton:!0,children:a.jsx(ge,{children:"Change Price"})}),a.jsxs(he,{children:[a.jsx("a",{children:"Enter New Name"}),a.jsx("br",{}),a.jsx(ne,{type:"text",placeholder:De,value:U,onChange:e=>K(e.target.value)})]}),a.jsx(pe,{children:a.jsx(le,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>Qe(),children:"Save changes"})})]}),a.jsxs(de,{alignment:"center",visible:X,scrollable:!0,size:"lg",onClose:()=>{v(!1),H(null),oe(null)},children:[a.jsx(ue,{closeButton:!0,children:a.jsx(ge,{children:"Image Uploader"})}),a.jsxs(he,{children:[re&&a.jsx(ie,{style:{width:"100px",height:"100px"},src:re,alt:"Uploaded Image"}),a.jsx("input",{style:{marginLeft:"5%"},type:"file",accept:".jpg, .jpeg, .png",onChange:e=>Ge(e.target.files[0])})]}),a.jsx(pe,{children:a.jsx(le,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>{Je(we,qe)},children:"Upload Image"})})]})]})};export{ka as default};
