import{B as at,r,y as ot,A as c,j as e,h as ne,L as rt,m as de}from"./index-Dr2bAMPU.js";import{B as j}from"./config-HOLfLxHr.js";import{a as y}from"./axios-Cm0UX6qg.js";/* empty css               */import{b as lt,a as P}from"./CContainer-u87GNtez.js";import{C as ie}from"./CNavbar-B7PVcNkl.js";import{C as D}from"./CFormInput-BN0BKVRX.js";import{C as ue,a as pe,b as T,c as n,d as he,e as i}from"./CTable-Bfn_R52F.js";import{C as ge}from"./CCardImage-CGnGRqbq.js";import{c as ct}from"./cil-pencil-m516yCOw.js";import{c as nt}from"./cil-trash-CBbKHhHb.js";import{C as me,a as b}from"./CPaginationItem-DP1tcg58.js";import{C as _,a as Q,b as U,c as H}from"./CModalTitle-DKRx84Yh.js";import{C as dt,a as it,b as ut,d as pt,e as xe}from"./DefaultLayout-B2Nh7q8u.js";import{C as O}from"./CModalFooter-op4IeWM8.js";import"./CFormLabel-BwWU-nc5.js";const Nt=()=>{const{id:p}=at();r.useState([]);const[fe,C]=r.useState(!1),[{user:m,token:u},l]=ot(),[je,M]=r.useState(!1),[ye,k]=r.useState(!1);r.useState("All Cities");const[Pe,q]=r.useState("All Markets");r.useState(""),r.useState(""),r.useState(""),r.useState("All Cities"),r.useState(""),r.useState("All Chains"),r.useState([]),r.useState([]),r.useState([]);const[Ce,ke]=r.useState([{_id:"",name:""}]),[be,G]=r.useState(!0),[A,v]=r.useState(0),[Se,J]=r.useState(0),[w,I]=r.useState(1),[Me,Ae]=r.useState(0),[N,z]=r.useState(1),[ve,K]=r.useState(!0),[B,E]=r.useState(0),[W,X]=r.useState([]),[we,Ie]=r.useState([]),[Ne,Be]=r.useState([]),[S,Y]=r.useState(""),[g,De]=r.useState(""),[Te,Z]=r.useState(g),[$,ee]=r.useState(""),[ze,te]=r.useState(!1),[Ee,F]=r.useState(!1),[$e,se]=r.useState(""),[L,ae]=r.useState(""),[Fe,oe]=r.useState(""),[Le,R]=r.useState(!1),[V,re]=r.useState(""),[ht,Re]=r.useState("");r.useEffect(()=>{console.log("id",p),x(p,0)},[Te]),r.useEffect(()=>{const t=setTimeout(()=>{(g.length>=3||g.length===0)&&Z(g)},500);return()=>{clearTimeout(t)}},[g]);const x=(t,a)=>{t?(console.log("id",t),m&&u?(C(!0),y.get(j+`promotion/products/${a}?promotionId=${t}&name=${g}`,{headers:{Authorization:`Bearer ${u}`}}).then(s=>{s.status===200?(console.log("products",s.data.list),X(s.data.list),J(s.data.count),Be(s.data.list.map(o=>o.productId)),C(!1),s.data.list.length<50?(G(!0),console.log("ok")):s.data.list.length>49&&G(!1)):s.status===203?(console.log("products 203"),C(!1),l({type:c,payload:{status:!0,title:" Products loading error",message:s.data.message}})):s.status===204?(console.log("products 204"),C(!1),l({type:c,payload:{status:!0,title:" Products loading error",message:"No products found",color:"info"}})):s.status===500&&(console.log("products 500"),C(!1),l({type:c,payload:{status:!0,title:" Products loading error",message:s.data.message}}))})):(console.log("products non"),C(!1))):l({type:c,payload:{status:!0,title:" markets loading error",message:"No id found"}})},Ve=()=>{M(!0)},_e=(t,a)=>{if(console.log("promotionId",t,"pId",a),a&&t){const s={productId:a};u&&m&&u&&y.patch(j+"promotion/add/product/"+t,s,{headers:{Authorization:`Bearer ${u}`}}).then(o=>{o.status===200?(M(!1),x(t),l({type:c,payload:{status:!0,title:"Product Assign",message:"successfully Product assigned to the promotion",color:"success"}})):o.status===400?l({type:c,payload:{status:!0,title:"Product Assign error",message:o.data.message,color:"warning"}}):o.status===404?l({type:c,payload:{status:!0,title:"Product Assign error",message:o.data.message,color:"warning"}}):o.status===500&&l({type:c,payload:{status:!0,title:"Product Assign error",message:o.data.message,color:"warning"}})}).catch(o=>{console.error("Error:",o)})}else l({type:c,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},le=(t,a)=>{if(console.log("promotionId",t,"pid",a),a&&t){const s={productId:a};u&&m&&u&&y.patch(j+"promotion/remove/product/"+t,s,{headers:{Authorization:`Bearer ${u}`}}).then(o=>{o.status===200?(x(t),M(!1),l({type:c,payload:{status:!0,title:"Market Assign",message:"successfully Market removed from the promotion",color:"success"}})):o.status===204?l({type:c,payload:{status:!0,title:"Market remove error",message:o.data.message,color:"warning"}}):o.status===500&&l({type:c,payload:{status:!0,title:"Market remove error",message:o.data.message,color:"warning"}})}).catch(o=>{console.error("Error:",o)})}else l({type:c,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},Qe=()=>{I(w+1);const t=A+50;v(t),x(p,t)},Ue=()=>{I(w-1);const t=A-50;console.log(t),v(t),x(p,t)},He=t=>{I(t);const a=(t-1)*50;v(a),x(p,a)},Oe=()=>{const t=Math.ceil(Se/50),a=[];for(let d=1;d<=t;d++)a.push(d);const s=Math.max(w-2,1),o=Math.min(s+4,t);return a.slice(s-1,o).map(d=>e.jsx(b,{active:w===d,onClick:()=>He(d),children:d},d))},qe=t=>{t?(console.log("id",t),m&&u?y.get(j+"promotion/all/markets/"+t,{headers:{Authorization:`Bearer ${u}`}}).then(a=>{a.status===200?(console.log("market",a.data.market),a.data.market.length===0&&(k(!1),l({type:c,payload:{status:!0,title:"Products loading",message:"No Market found",color:"info"}})),ke(a.data.market.map(s=>({_id:s._id,name:s.address})))):a.status===203?l({type:c,payload:{status:!0,title:" markets loading error",message:a.data.message}}):a.status===500&&l({type:c,payload:{status:!0,title:" markets loading error",message:a.data.message}})}):l({type:c,payload:{status:!0,title:" markets loading error",message:"No user or token found"}})):l({type:c,payload:{status:!0,title:" markets loading error",message:"No id found"}})},ce=(t,a)=>{a==="all"?(Y(""),q("All Markets"),f(0,"",p),console.log("all")):(console.log("selected",t),Y(t),q(a),f(0,t,p))};r.useEffect(()=>{ze&&f(0,S,p)},[$]);const f=(t,a,s)=>{m&&u?(k(!0),y.get(j+`promotion/all/markets/products/${t}?marketId=${a}&promoId=${s}&name=${$}`,{headers:{Authorization:`Bearer ${u}`}}).then(o=>{o.status===200?(console.log("market",o.data.list),Ie(o.data.list),Ae(o.data.count),k(!1),te(!0),o.data.list.length<20?(K(!0),console.log("ok")):o.data.list.length>19&&K(!1)):o.status===203?(k(!1),l({type:c,payload:{status:!0,title:" Products loading error",message:o.data.message}})):o.status===500&&(k(!1),l({type:c,payload:{status:!0,title:" Products loading error",message:o.data.message}}))})):(k(!1),l({type:c,payload:{status:!0,title:" Products loading error",message:"No user or token found"}}))},Ge=()=>{z(N+1);const t=B+50;E(t),f(t,S,p)},Je=()=>{z(N-1);const t=B-50;console.log(t),E(t),f(t,S,p)},Ke=t=>{z(t);const a=(t-1)*50;E(a),f(a,S,p)},We=()=>{const t=Math.ceil(Me/50),a=[];for(let d=1;d<=t;d++)a.push(d);const s=Math.max(N-2,1),o=Math.min(s+4,t);return a.slice(s-1,o).map(d=>e.jsx(b,{active:N===d,onClick:()=>Ke(d),children:d},d))},Xe=(t,a)=>{F(!0),se(t),oe(a)},Ye=()=>{console.log("called"),L==""?l({type:c,payload:{status:!0,title:"Alert",message:"Please enter the promotion price",color:"warning"}}):Ze($e)},Ze=t=>{if(console.log("product Id",t),t){const a={value:L};console.log("formData",a),u&&m&&u&&y.patch(j+"promotion/update/promo/value/"+t,a,{headers:{Authorization:`Bearer ${u}`}}).then(s=>{if(s.status===200){l({type:c,payload:{status:!0,title:"Product Details Update",message:"Product promotion price update Success",color:"success"}}),se(""),ae(""),F(!1),oe("");const o=s.data,h=W.map(d=>(d.productId===o.productId&&(d.promo_value=o.promo_value),d));X([...h])}else s.status===400?l({type:c,payload:{status:!0,title:"Product update error",message:s.data.message,color:"warning"}}):s.status===404?l({type:c,payload:{status:!0,title:"Product update error",message:s.data.message,color:"warning"}}):s.status===500&&l({type:c,payload:{status:!0,title:"Product update error",message:s.data.message,color:"warning"}})}).catch(s=>{console.error("Error:",s)})}else l({type:c,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},et=()=>{R(!0)},tt=()=>{console.log("called"),V==""?l({type:c,payload:{status:!0,title:"Alert",message:"Please enter the promotion price",color:"warning"}}):st(p)},st=t=>{if(console.log("promotion Id",t),t){const a={value:V};console.log("formData",a),u&&m&&u&&y.patch(j+"promotion/update/promo/all/value/"+t,a,{headers:{Authorization:`Bearer ${u}`}}).then(s=>{s.status===200?(l({type:c,payload:{status:!0,title:"Product Details Update",message:"Product promotion price update Success",color:"success"}}),re(""),R(!1),Re(""),x(t,0)):s.status===400?l({type:c,payload:{status:!0,title:"Product update error",message:s.data.message,color:"warning"}}):s.status===404?l({type:c,payload:{status:!0,title:"Product update error",message:s.data.message,color:"warning"}}):s.status===500&&l({type:c,payload:{status:!0,title:"Product update error",message:s.data.message,color:"warning"}})}).catch(s=>{console.error("Error:",s)})}else l({type:c,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})};return e.jsxs(lt,{children:[e.jsx(P,{onClick:()=>{Ve(),qe(p),f(0,S,p)},style:{marginLeft:"0%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Add Products"}),e.jsxs(ie,{style:{justifyContent:"flex-start"},className:"bg-body-tertiary",children:[e.jsx(D,{type:"text",placeholder:"Search products by name",style:{width:450,marginRight:"0%"},value:g,onChange:t=>De(t.target.value)}),e.jsx(P,{onClick:()=>{et()},style:{marginLeft:"44%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Apply All"})]}),fe?e.jsx(ne,{}):e.jsxs(ue,{children:[e.jsx(pe,{children:e.jsxs(T,{children:[e.jsx(n,{scope:"col",children:"#"}),e.jsx(n,{scope:"col",children:"Product Id"}),e.jsx(n,{scope:"col",children:"Photo"}),e.jsx(n,{scope:"col",children:"Name"}),e.jsx(n,{scope:"col",children:"Base Price"}),e.jsx(n,{scope:"col",children:"Markup Percentage "}),e.jsx(n,{scope:"col",children:"Markup"}),e.jsx(n,{scope:"col",children:"Tax"}),e.jsx(n,{scope:"col",children:"Total"}),e.jsx(n,{scope:"col",children:"Promotion Value"}),e.jsx(n,{scope:"col",children:"Brand"}),e.jsx(n,{scope:"col",children:"Chain"}),e.jsx(n,{scope:"col",children:"Market Address"}),e.jsx(n,{scope:"col",children:"Remove"})]})}),e.jsx(he,{children:W.map((t,a)=>{var s,o,h,d;return e.jsxs(T,{children:[e.jsx(i,{children:A+a+1}),e.jsx(i,{children:t.pid}),e.jsx(n,{onClick:()=>{},children:e.jsx(ge,{style:{width:"50px",height:"50px"},src:"https://api.zeuler.com/image/"+t.image})}),e.jsx(i,{children:t.name}),e.jsxs(i,{children:[" ",(((s=t.price)==null?void 0:s.basePrice)??0).toFixed(2)," "]}),e.jsxs(i,{children:[t.price.percentage,"%"]}),e.jsx(i,{children:(((o=t.price)==null?void 0:o.markup)??0).toFixed(2)}),e.jsx(i,{children:(((h=t.price)==null?void 0:h.tax)??0).toFixed(2)}),e.jsx(i,{children:(((d=t.price)==null?void 0:d.total)??0).toFixed(2)}),e.jsxs(i,{children:[t.promo_value," €",e.jsx(rt,{to:"",children:e.jsx(de,{icon:ct,size:"sm",onClick:()=>Xe(t.productId,t.promo_value)})})]}),e.jsx(i,{children:t.brand}),e.jsx(i,{children:t.chainName}),e.jsx(i,{children:t.marketAddress}),e.jsx(i,{children:e.jsx(P,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>{le(p,t.productId)},children:e.jsx(de,{icon:nt,size:"lg",style:{color:"white"}})})})]},a)})})]}),e.jsxs(me,{"aria-label":"Page navigation example",children:[e.jsx(b,{disabled:A<=0,onClick:Ue,children:"Previous"}),Oe(),e.jsx(b,{disabled:be===!0,onClick:Qe,children:"Next"})]}),e.jsxs(_,{visible:je,scrollable:!0,size:"xl",onClose:()=>{te(!1),M(!1),ee(""),J(0),v(0),I(1)},children:[e.jsx(Q,{closeButton:!0,children:e.jsx(U,{children:"Products assign view"})}),e.jsxs(H,{children:[e.jsx(dt,{style:{marginLeft:"64%"},color:"secondary",children:"Filter by"}),e.jsxs(it,{style:{marginLeft:"2%",width:"28%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(ut,{style:{color:"white"},children:Pe}),e.jsxs(pt,{children:[e.jsx(xe,{onClick:()=>ce(null,"all"),children:"All"}),Ce.map((t,a)=>e.jsx(xe,{onClick:()=>ce(t._id,t.name),children:t.name},a))]})]}),e.jsx(ie,{style:{marginTop:"1%"},className:"bg-body-tertiary",children:e.jsx(D,{type:"text",placeholder:"Search products by name",style:{width:450,marginRight:"60%"},value:$,onChange:t=>ee(t.target.value)})}),ye?e.jsx(ne,{}):e.jsxs(ue,{children:[e.jsx(pe,{children:e.jsxs(T,{children:[e.jsx(n,{scope:"col",children:"#"}),e.jsx(n,{scope:"col",children:"Product Id"}),e.jsx(n,{scope:"col",children:"Photo"}),e.jsx(n,{scope:"col",children:"Name"}),e.jsx(n,{scope:"col",children:"Base Price"}),e.jsx(n,{scope:"col",children:"Markup Percentage "}),e.jsx(n,{scope:"col",children:"Markup"}),e.jsx(n,{scope:"col",children:"Tax"}),e.jsx(n,{scope:"col",children:"Total"}),e.jsx(n,{scope:"col",children:"Brand"}),e.jsx(n,{scope:"col",children:"Chain"}),e.jsx(n,{scope:"col",children:"Market Address"}),e.jsx(n,{scope:"col",children:"Action"})]})}),e.jsx(he,{children:we.map((t,a)=>{var s,o,h,d;return e.jsxs(T,{children:[e.jsx(i,{children:B+a+1}),e.jsx(i,{children:t.pid}),e.jsx(n,{children:e.jsx(ge,{style:{width:"50px",height:"50px"},src:"https://api.zeuler.com/image/"+t.image})}),e.jsx(i,{children:t.name}),e.jsxs(i,{children:[" ",(((s=t.price)==null?void 0:s.basePrice)??0).toFixed(2)," "]}),e.jsxs(i,{children:[t.price.percentage,"%"]}),e.jsx(i,{children:(((o=t.price)==null?void 0:o.markup)??0).toFixed(2)}),e.jsx(i,{children:(((h=t.price)==null?void 0:h.tax)??0).toFixed(2)}),e.jsx(i,{children:(((d=t.price)==null?void 0:d.total)??0).toFixed(2)}),e.jsx(i,{children:t.brand}),e.jsx(i,{children:t.chainName}),e.jsx(i,{children:t.marketAddress}),e.jsx(i,{children:Ne.includes(t.productId)?e.jsx(P,{size:"sm",onClick:()=>{le(p,t.productId)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Remove"}):e.jsx(P,{size:"sm",onClick:()=>{_e(p,t.productId)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Add"})})]},a)})})]}),e.jsx(O,{children:e.jsxs(me,{"aria-label":"Page navigation example",children:[e.jsx(b,{disabled:B<=0,onClick:Je,children:"Previous"}),We(),e.jsx(b,{disabled:ve===!0,onClick:Ge,children:"Next"})]})})]})]}),e.jsxs(_,{alignment:"center",visible:Ee,scrollable:!0,size:"sm",onClose:()=>F(!1),children:[e.jsx(Q,{closeButton:!0,children:e.jsx(U,{children:"Change Promotion Value"})}),e.jsxs(H,{children:[e.jsx("a",{children:"Add Promotion Value"}),e.jsx("br",{}),e.jsx(D,{type:"text",placeholder:Fe,value:L,onChange:t=>ae(t.target.value)})]}),e.jsx(O,{children:e.jsx(P,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>Ye(),children:"Save changes"})})]}),e.jsxs(_,{alignment:"center",visible:Le,scrollable:!0,size:"sm",onClose:()=>R(!1),children:[e.jsx(Q,{closeButton:!0,children:e.jsx(U,{children:"Add promotion value to all products"})}),e.jsxs(H,{children:[e.jsx("a",{children:"Add Promotion Value"}),e.jsx("br",{}),e.jsx(D,{type:"text",value:V,onChange:t=>re(t.target.value)})]}),e.jsx(O,{children:e.jsx(P,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>tt(),children:"Save changes"})})]})]})};export{Nt as default};
