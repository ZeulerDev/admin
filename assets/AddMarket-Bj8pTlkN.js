import{A as xe,r as t,x as Ce,z as i,j as e,h as H,m as je}from"./index-DY5Equgr.js";import{B as f}from"./config-HOLfLxHr.js";import{a as x}from"./axios-B4uVmeYG.js";import{b as ke,a as M}from"./CContainer-_Gzt09pj.js";import{C as F}from"./CNavbar-CMesnh0F.js";import{C as U,a as V,b as u,c as d,d as q,e as n}from"./CTable-CB8lfHH6.js";import{c as ye}from"./cil-trash-CBbKHhHb.js";import{C as Me,a as be,b as Ae,c as Se}from"./CModalTitle-D62UeRY4.js";import{C as we,a as G,b as J,d as K,e as C}from"./DefaultLayout-DEOfvUp4.js";import{C as De}from"./CModalFooter-gOE1ccD7.js";import{C as Pe,a as T}from"./CPaginationItem-CXS2fp0b.js";const qe=()=>{const{id:m}=xe(),[E,O]=t.useState([]),[Q,g]=t.useState(!1),[{user:p,token:c},l]=Ce(),[W,j]=t.useState(!1),[X,B]=t.useState(!1),[Y,b]=t.useState("All Cities"),[Z,A]=t.useState("All Chains"),[z,S]=t.useState(""),[L,w]=t.useState("");t.useState(""),t.useState("All Cities"),t.useState(""),t.useState("All Chains");const[Ne,ee]=t.useState([]),[ae,se]=t.useState([]),[$,te]=t.useState([]),[ve,R]=t.useState(!0);t.useState(0);const[oe,re]=t.useState([]),[le,Te]=t.useState(!0),[k,D]=t.useState(0),[ie,ne]=t.useState(0),[y,P]=t.useState(1);t.useEffect(()=>{console.log("id",m),N(m)},[]);const N=a=>{a?(console.log("id",a),p&&c?(g(!0),x.get(f+"promotion/all/markets/"+a,{headers:{Authorization:`Bearer ${c}`}}).then(s=>{s.status===200?(console.log("market",s.data.market),O(s.data.market),re(s.data.market.map(o=>o._id)),g(!1)):s.status===203?(g(!1),l({type:i,payload:{status:!0,title:" markets loading error",message:s.data.message}})):s.status===500&&(g(!1),l({type:i,payload:{status:!0,title:" markets loading error",message:s.data.message}}))})):(g(!1),l({type:i,payload:{status:!0,title:" markets loading error",message:"No user or token found"}}))):l({type:i,payload:{status:!0,title:" markets loading error",message:"No id found"}})};t.useEffect(()=>{ce()},[]);const ce=()=>{c&&x.get(f+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${c}`}}).then(a=>{a.status===200?(ee(a.data),se(a.data)):a.status===500&&l({type:i,payload:{status:!0,title:"Chain Loading error",message:a.data.message}})}).catch(a=>{console.error("Error: ",a)})},v=(a,s)=>{a==="all"?(w(""),b("All Cities")):(w(a),b(a))},_=(a,s,o)=>{a==="all"?(S(""),A("All Chains")):(S(a),A(s))};t.useEffect(()=>{p&&c&&de(0)},[z,L,p]);const de=(a,s)=>{B(!0),x.get(f+`assistant/market/locations/${a}?brand=${z}&city=${L}`,{headers:{Authorization:`Bearer ${c}`}}).then(o=>{o.status===200?(te(o.data.data),ne(o.data.count),console.log("data market"),B(!1),o.data.data.length<20?(R(!0),console.log("ok")):o.data.data.length>19&&R(!1)):o.status===500&&l({type:i,payload:{status:!0,title:"Market Loading error",message:o.data.message}})}).catch(o=>{console.error("Error: ",o)})},he=()=>{P(y+1);const a=k+20;D(a),loadDataMarket(a,!0)},ue=()=>{P(y-1);const a=k-20;console.log(a),D(a),loadDataMarket(a,!0)},me=a=>{P(a);const s=(a-1)*20;D(s),loadDataMarket(s,!0)},ge=()=>{const a=Math.ceil(ie/20),s=[];for(let h=1;h<=a;h++)s.push(h);const o=Math.max(y-2,1),r=Math.min(o+4,a);return s.slice(o-1,r).map(h=>e.jsx(T,{active:y===h,onClick:()=>me(h),children:h},h))},pe=()=>{j(!0)},fe=(a,s)=>{if(s&&a){const o={marketId:s};c&&p&&c&&x.patch(f+"promotion/add/market/"+a,o,{headers:{Authorization:`Bearer ${c}`}}).then(r=>{r.status===200?(j(!1),N(a),l({type:i,payload:{status:!0,title:"Market Assign",message:"successfully Market assigned to the promotion",color:"success"}})):r.status===400?l({type:i,payload:{status:!0,title:"Market Assign error",message:r.data.message,color:"warning"}}):r.status===404?l({type:i,payload:{status:!0,title:"Market Assign error",message:r.data.message,color:"warning"}}):r.status===500&&l({type:i,payload:{status:!0,title:"Market Assign error",message:r.data.message,color:"warning"}})}).catch(r=>{console.error("Error:",r)})}else l({type:i,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},I=(a,s)=>{if(s&&a){const o={marketId:s};c&&p&&c&&x.patch(f+"promotion/remove/market/"+a,o,{headers:{Authorization:`Bearer ${c}`}}).then(r=>{r.status===200?(N(a),j(!1),l({type:i,payload:{status:!0,title:"Market Assign",message:"successfully Market removed from the promotion",color:"success"}})):r.status===204?l({type:i,payload:{status:!0,title:"Market remove error",message:r.data.message,color:"warning"}}):r.status===500&&l({type:i,payload:{status:!0,title:"Market remove error",message:r.data.message,color:"warning"}})}).catch(r=>{console.error("Error:",r)})}else l({type:i,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})};return e.jsxs(ke,{children:[e.jsx(M,{onClick:()=>{pe()},style:{marginLeft:"0%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Add Market"}),e.jsx(F,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),Q?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(H,{})}):e.jsxs(U,{children:[e.jsx(V,{children:e.jsxs(u,{children:[e.jsx(d,{scope:"col",children:"#"}),e.jsx(d,{scope:"col",children:"Name"}),e.jsx(d,{scope:"col",children:"Address"}),e.jsx(d,{scope:"col",children:"City"}),e.jsx(d,{scope:"col",children:"Remove Market "})]})}),e.jsx(q,{children:E.length===0?e.jsx(u,{children:e.jsx(n,{colSpan:"5",style:{textAlign:"center",backgroundColor:"white"},children:e.jsx("h6",{style:{marginTop:"1%"},children:"No Data"})})}):E.map((a,s)=>e.jsxs(u,{children:[e.jsx(n,{children:s+1}),e.jsx(n,{children:a.chain.name}),e.jsx(n,{children:a.address}),e.jsx(n,{children:a.city}),e.jsx(n,{children:e.jsx(M,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>{I(m,a._id)},children:e.jsx(je,{icon:ye,size:"lg",style:{color:"white"}})})})]},s))})]}),e.jsxs(Me,{visible:W,scrollable:!0,size:"xl",onClose:()=>{j(!1),A("All Chains"),b("All Cities"),S(""),w("")},children:[e.jsx(be,{closeButton:!0,children:e.jsx(Ae,{children:"Market assign view"})}),e.jsxs(Se,{children:[e.jsx(we,{style:{marginLeft:"54%"},color:"secondary",children:"Filter by"}),e.jsxs(G,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(J,{style:{color:"white"},children:Y}),e.jsxs(K,{children:[e.jsx(C,{onClick:()=>v("all"),children:"All"}),e.jsx(C,{onClick:()=>v("Milano"),children:"Milano"}),e.jsx(C,{onClick:()=>v("Napoli"),children:"Napoli"})]})]}),e.jsxs(G,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(J,{style:{color:"white"},children:Z}),e.jsxs(K,{children:[e.jsx(C,{onClick:()=>_("all",null),children:"All"}),ae.map((a,s)=>e.jsx(C,{onClick:()=>_(a.id,a.name),children:a.name},s))]})]}),e.jsx(F,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),X?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(H,{style:{marginTop:"15%"}})}):e.jsxs(U,{children:[e.jsx(V,{children:e.jsxs(u,{children:[e.jsx(d,{scope:"col",children:"#"}),e.jsx(d,{scope:"col",children:"Name"}),e.jsx(d,{scope:"col",children:"Address"}),e.jsx(d,{scope:"col",children:"City"}),e.jsx(d,{scope:"col",children:"Measurement"}),e.jsx(d,{scope:"col"})]})}),e.jsx(q,{children:$.length===0?e.jsx(u,{children:e.jsx(n,{colSpan:"6",style:{textAlign:"center",backgroundColor:"white"},children:e.jsx("h6",{style:{marginTop:"1%"},children:"No Data"})})}):$.map((a,s)=>e.jsxs(u,{children:[e.jsx(n,{children:k+s+1}),e.jsx(n,{children:a.chain.name}),e.jsx(n,{children:a.address}),e.jsx(n,{children:a.city}),e.jsx(n,{children:a.scraped}),e.jsx(n,{children:oe.includes(a._id)?e.jsx(M,{size:"sm",onClick:()=>I(m,a._id),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Remove"}):e.jsx(M,{size:"sm",onClick:()=>fe(m,a._id),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Add"})})]},s))})]}),e.jsx(De,{children:e.jsxs(Pe,{"aria-label":"Page navigation example",children:[e.jsx(T,{disabled:k<=0,onClick:ue,children:"Previous"}),ge(),e.jsx(T,{disabled:le===!0,onClick:he,children:"Next"})]})})]})]})]})};export{qe as default};
