import{B as tt,r,y as st,A as c,j as e,h as le,L as at,m as ce}from"./index-AJjCLhjn.js";import{B as x}from"./config-HOLfLxHr.js";import{a as f}from"./axios-Cm0UX6qg.js";/* empty css               */import{b as ot,a as j}from"./CContainer-BIxJfy9n.js";import{C as de}from"./CNavbar-CsCVrAvW.js";import{C as w}from"./CFormInput-Cu0cu3ai.js";import{C as ne,a as ie,b as I,c as d,d as ue,e as i}from"./CTable-4WO2OKTT.js";import{C as pe}from"./CCardImage-B4bp51Ek.js";import{c as rt}from"./cil-pencil-m516yCOw.js";import{c as lt}from"./cil-trash-CBbKHhHb.js";import{C as he,a as k}from"./CPaginationItem-B1DiQdIa.js";import{C as _,a as U,b as Q,c as H}from"./CModalTitle-Bqyt-URh.js";import{C as ct,a as dt,b as nt,c as it,d as ge}from"./DefaultLayout-CU242EN2.js";import{C as O}from"./CModalFooter-1YoKlFAU.js";import"./CFormLabel-BHjIlkbJ.js";const wt=()=>{const{id:p}=tt();r.useState([]);const[me,y]=r.useState(!1),[{user:g,token:u},l]=st(),[xe,S]=r.useState(!1),[fe,P]=r.useState(!1);r.useState("All Cities");const[je,q]=r.useState("All Markets");r.useState(""),r.useState(""),r.useState(""),r.useState("All Cities"),r.useState(""),r.useState("All Chains"),r.useState([]),r.useState([]),r.useState([]);const[ye,Pe]=r.useState([{_id:"",name:""}]),[Ce,G]=r.useState(!0),[N,B]=r.useState(0),[ke,be]=r.useState(0),[M,D]=r.useState(1),[Se,Me]=r.useState(0),[A,T]=r.useState(1),[Ae,J]=r.useState(!0),[b,z]=r.useState(0),[K,W]=r.useState([]),[ve,we]=r.useState([]),[Ie,Ne]=r.useState([]),[v,X]=r.useState(""),[E,Be]=r.useState(""),[$,Y]=r.useState(""),[De,Z]=r.useState(!1),[Te,F]=r.useState(!1),[ze,ee]=r.useState(""),[L,te]=r.useState(""),[Ee,se]=r.useState(""),[$e,R]=r.useState(!1),[V,ae]=r.useState(""),[ut,Fe]=r.useState("");r.useEffect(()=>{console.log("id",p),m(p,0)},[E]);const m=(t,a)=>{t?(console.log("id",t),g&&u?(y(!0),f.get(x+`promotion/products/${a}?promotionId=${t}&name=${E}`,{headers:{Authorization:`Bearer ${u}`}}).then(s=>{s.status===200?(console.log("products",s.data.list),W(s.data.list),be(s.data.count),Ne(s.data.list.map(o=>o.productId)),y(!1),s.data.list.length<50?(G(!0),console.log("ok")):s.data.list.length>49&&G(!1)):s.status===203?(console.log("products 203"),y(!1),l({type:c,payload:{status:!0,title:" Products loading error",message:s.data.message}})):s.status===204?(console.log("products 204"),y(!1),l({type:c,payload:{status:!0,title:" Products loading error",message:"No products found",color:"info"}})):s.status===500&&(console.log("products 500"),y(!1),l({type:c,payload:{status:!0,title:" Products loading error",message:s.data.message}}))})):(console.log("products non"),y(!1))):l({type:c,payload:{status:!0,title:" markets loading error",message:"No id found"}})},Le=()=>{S(!0)},Re=(t,a)=>{if(console.log("promotionId",t,"pId",a),a&&t){const s={productId:a};u&&g&&u&&f.patch(x+"promotion/add/product/"+t,s,{headers:{Authorization:`Bearer ${u}`}}).then(o=>{o.status===200?(S(!1),m(t),l({type:c,payload:{status:!0,title:"Product Assign",message:"successfully Product assigned to the promotion",color:"success"}})):o.status===400?l({type:c,payload:{status:!0,title:"Product Assign error",message:o.data.message,color:"warning"}}):o.status===404?l({type:c,payload:{status:!0,title:"Product Assign error",message:o.data.message,color:"warning"}}):o.status===500&&l({type:c,payload:{status:!0,title:"Product Assign error",message:o.data.message,color:"warning"}})}).catch(o=>{console.error("Error:",o)})}else l({type:c,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},oe=(t,a)=>{if(console.log("promotionId",t,"pid",a),a&&t){const s={productId:a};u&&g&&u&&f.patch(x+"promotion/remove/product/"+t,s,{headers:{Authorization:`Bearer ${u}`}}).then(o=>{o.status===200?(m(t),S(!1),l({type:c,payload:{status:!0,title:"Market Assign",message:"successfully Market removed from the promotion",color:"success"}})):o.status===204?l({type:c,payload:{status:!0,title:"Market remove error",message:o.data.message,color:"warning"}}):o.status===500&&l({type:c,payload:{status:!0,title:"Market remove error",message:o.data.message,color:"warning"}})}).catch(o=>{console.error("Error:",o)})}else l({type:c,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},Ve=()=>{D(M+1);const t=N+50;B(t),m(p,t)},_e=()=>{D(M-1);const t=N-50;console.log(t),B(t),m(p,t)},Ue=t=>{D(t);const a=(t-1)*50;B(a),m(p,a)},Qe=()=>{const t=Math.ceil(ke/50),a=[];for(let n=1;n<=t;n++)a.push(n);const s=Math.max(M-2,1),o=Math.min(s+4,t);return a.slice(s-1,o).map(n=>e.jsx(k,{active:M===n,onClick:()=>Ue(n),children:n},n))},He=t=>{t?(console.log("id",t),g&&u?f.get(x+"promotion/all/markets/"+t,{headers:{Authorization:`Bearer ${u}`}}).then(a=>{a.status===200?(console.log("market",a.data.market),a.data.market.length===0&&(P(!1),l({type:c,payload:{status:!0,title:"Products loading",message:"No Market found",color:"info"}})),Pe(a.data.market.map(s=>({_id:s._id,name:s.address})))):a.status===203?l({type:c,payload:{status:!0,title:" markets loading error",message:a.data.message}}):a.status===500&&l({type:c,payload:{status:!0,title:" markets loading error",message:a.data.message}})}):l({type:c,payload:{status:!0,title:" markets loading error",message:"No user or token found"}})):l({type:c,payload:{status:!0,title:" markets loading error",message:"No id found"}})},re=(t,a)=>{a==="all"?(X(""),q("All Markets"),C(0,"",p),console.log("all")):(console.log("selected",t),X(t),q(a),C(0,t,p))};r.useEffect(()=>{De&&C(0,v,p)},[$]);const C=(t,a,s)=>{g&&u?(P(!0),f.get(x+`promotion/all/markets/products/${t}?marketId=${a}&promoId=${s}&name=${$}`,{headers:{Authorization:`Bearer ${u}`}}).then(o=>{o.status===200?(we(o.data.list),Me(o.data.count),P(!1),Z(!0),o.data.list.length<20?(J(!0),console.log("ok")):o.data.list.length>19&&J(!1)):o.status===203?(P(!1),l({type:c,payload:{status:!0,title:" Products loading error",message:o.data.message}})):o.status===500&&(P(!1),l({type:c,payload:{status:!0,title:" Products loading error",message:o.data.message}}))})):(P(!1),l({type:c,payload:{status:!0,title:" Products loading error",message:"No user or token found"}}))},Oe=()=>{T(A+1);const t=b+50;z(t),C(t,v,p)},qe=()=>{T(A-1);const t=b-50;console.log(t),z(t),C(t,v,p)},Ge=t=>{T(t);const a=(t-1)*50;z(a),loadData(a,!0)},Je=()=>{const t=Math.ceil(Se/50),a=[];for(let n=1;n<=t;n++)a.push(n);const s=Math.max(A-2,1),o=Math.min(s+4,t);return a.slice(s-1,o).map(n=>e.jsx(k,{active:A===n,onClick:()=>Ge(n),children:n},n))},Ke=(t,a)=>{F(!0),ee(t),se(a)},We=()=>{console.log("called"),L==""?l({type:c,payload:{status:!0,title:"Alert",message:"Please enter the promotion price",color:"warning"}}):Xe(ze)},Xe=t=>{if(console.log("product Id",t),t){const a={value:L};console.log("formData",a),u&&g&&u&&f.patch(x+"promotion/update/promo/value/"+t,a,{headers:{Authorization:`Bearer ${u}`}}).then(s=>{if(s.status===200){l({type:c,payload:{status:!0,title:"Product Details Update",message:"Product promotion price update Success",color:"success"}}),ee(""),te(""),F(!1),se("");const o=s.data,h=K.map(n=>(n.productId===o.productId&&(n.promo_value=o.promo_value),n));W([...h])}else s.status===400?l({type:c,payload:{status:!0,title:"Product update error",message:s.data.message,color:"warning"}}):s.status===404?l({type:c,payload:{status:!0,title:"Product update error",message:s.data.message,color:"warning"}}):s.status===500&&l({type:c,payload:{status:!0,title:"Product update error",message:s.data.message,color:"warning"}})}).catch(s=>{console.error("Error:",s)})}else l({type:c,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},Ye=()=>{R(!0)},Ze=()=>{console.log("called"),V==""?l({type:c,payload:{status:!0,title:"Alert",message:"Please enter the promotion price",color:"warning"}}):et(p)},et=t=>{if(console.log("promotion Id",t),t){const a={value:V};console.log("formData",a),u&&g&&u&&f.patch(x+"promotion/update/promo/all/value/"+t,a,{headers:{Authorization:`Bearer ${u}`}}).then(s=>{s.status===200?(l({type:c,payload:{status:!0,title:"Product Details Update",message:"Product promotion price update Success",color:"success"}}),ae(""),R(!1),Fe(""),m(t,0)):s.status===400?l({type:c,payload:{status:!0,title:"Product update error",message:s.data.message,color:"warning"}}):s.status===404?l({type:c,payload:{status:!0,title:"Product update error",message:s.data.message,color:"warning"}}):s.status===500&&l({type:c,payload:{status:!0,title:"Product update error",message:s.data.message,color:"warning"}})}).catch(s=>{console.error("Error:",s)})}else l({type:c,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})};return e.jsxs(ot,{children:[e.jsx(j,{onClick:()=>{Le(),He(p),C(0,v,p)},style:{marginLeft:"0%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Add Products"}),e.jsxs(de,{style:{justifyContent:"flex-start"},className:"bg-body-tertiary",children:[e.jsx(w,{type:"text",placeholder:"Search products by name",style:{width:450,marginRight:"0%"},value:E,onChange:t=>Be(t.target.value)}),e.jsx(j,{onClick:()=>{Ye()},style:{marginLeft:"44%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Apply All"})]}),me?e.jsx(le,{}):e.jsxs(ne,{children:[e.jsx(ie,{children:e.jsxs(I,{children:[e.jsx(d,{scope:"col",children:"#"}),e.jsx(d,{scope:"col",children:"Product Id"}),e.jsx(d,{scope:"col",children:"Photo"}),e.jsx(d,{scope:"col",children:"Name"}),e.jsx(d,{scope:"col",children:"Base Price"}),e.jsx(d,{scope:"col",children:"Tax"}),e.jsx(d,{scope:"col",children:"Markup Percentage "}),e.jsx(d,{scope:"col",children:"Markup"}),e.jsx(d,{scope:"col",children:"Total"}),e.jsx(d,{scope:"col",children:"Promotion Value"}),e.jsx(d,{scope:"col",children:"Brand"}),e.jsx(d,{scope:"col",children:"Chain"}),e.jsx(d,{scope:"col",children:"Market Address"}),e.jsx(d,{scope:"col",children:"Remove"})]})}),e.jsx(ue,{children:K.map((t,a)=>{var s,o,h,n;return e.jsxs(I,{children:[e.jsx(i,{children:b+a+1}),e.jsx(i,{children:t.pid}),e.jsx(d,{onClick:()=>{},children:e.jsx(pe,{style:{width:"50px",height:"50px"},src:"https://api.zeuler.com/image/"+t.image})}),e.jsx(i,{children:t.name}),e.jsxs(i,{children:[" ",(((s=t.price)==null?void 0:s.basePrice)??0).toFixed(2)," "]}),e.jsx(i,{children:(((o=t.price)==null?void 0:o.tax)??0).toFixed(2)}),e.jsxs(i,{children:[t.price.percentage,"%"]}),e.jsx(i,{children:(((h=t.price)==null?void 0:h.markup)??0).toFixed(2)}),e.jsx(i,{children:(((n=t.price)==null?void 0:n.total)??0).toFixed(2)}),e.jsxs(i,{children:[t.promo_value," €",e.jsx(at,{to:"",children:e.jsx(ce,{icon:rt,size:"sm",onClick:()=>Ke(t.productId,t.promo_value)})})]}),e.jsx(i,{children:t.brand}),e.jsx(i,{children:t.chainName}),e.jsx(i,{children:t.marketAddress}),e.jsx(i,{children:e.jsx(j,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>{oe(p,t.productId)},children:e.jsx(ce,{icon:lt,size:"lg",style:{color:"white"}})})})]},a)})})]}),e.jsxs(he,{"aria-label":"Page navigation example",children:[e.jsx(k,{disabled:N<=0,onClick:_e,children:"Previous"}),Qe(),e.jsx(k,{disabled:Ce===!0,onClick:Ve,children:"Next"})]}),e.jsxs(_,{visible:xe,scrollable:!0,size:"xl",onClose:()=>{Z(!1),S(!1),Y("")},children:[e.jsx(U,{closeButton:!0,children:e.jsx(Q,{children:"Products assign view"})}),e.jsxs(H,{children:[e.jsx(ct,{style:{marginLeft:"64%"},color:"secondary",children:"Filter by"}),e.jsxs(dt,{style:{marginLeft:"2%",width:"28%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(nt,{style:{color:"white"},children:je}),e.jsxs(it,{children:[e.jsx(ge,{onClick:()=>re(null,"all"),children:"All"}),ye.map((t,a)=>e.jsx(ge,{onClick:()=>re(t._id,t.name),children:t.name},a))]})]}),e.jsx(de,{style:{marginTop:"1%"},className:"bg-body-tertiary",children:e.jsx(w,{type:"text",placeholder:"Search products by name",style:{width:450,marginRight:"60%"},value:$,onChange:t=>Y(t.target.value)})}),fe?e.jsx(le,{}):e.jsxs(ne,{children:[e.jsx(ie,{children:e.jsxs(I,{children:[e.jsx(d,{scope:"col",children:"#"}),e.jsx(d,{scope:"col",children:"Product Id"}),e.jsx(d,{scope:"col",children:"Photo"}),e.jsx(d,{scope:"col",children:"Name"}),e.jsx(d,{scope:"col",children:"Base Price"}),e.jsx(d,{scope:"col",children:"Tax"}),e.jsx(d,{scope:"col",children:"Markup Percentage "}),e.jsx(d,{scope:"col",children:"Markup"}),e.jsx(d,{scope:"col",children:"Total"}),e.jsx(d,{scope:"col",children:"Brand"}),e.jsx(d,{scope:"col",children:"Chain"}),e.jsx(d,{scope:"col",children:"Market Address"}),e.jsx(d,{scope:"col",children:"Action"})]})}),e.jsx(ue,{children:ve.map((t,a)=>{var s,o,h,n;return e.jsxs(I,{children:[e.jsx(i,{children:b+a+1}),e.jsx(i,{children:t.pid}),e.jsx(d,{children:e.jsx(pe,{style:{width:"50px",height:"50px"},src:"https://api.zeuler.com/image/"+t.image})}),e.jsx(i,{children:t.name}),e.jsxs(i,{children:[" ",(((s=t.price)==null?void 0:s.basePrice)??0).toFixed(2)," "]}),e.jsx(i,{children:(((o=t.price)==null?void 0:o.tax)??0).toFixed(2)}),e.jsxs(i,{children:[t.price.percentage,"%"]}),e.jsx(i,{children:(((h=t.price)==null?void 0:h.markup)??0).toFixed(2)}),e.jsx(i,{children:(((n=t.price)==null?void 0:n.total)??0).toFixed(2)}),e.jsx(i,{children:t.brand}),e.jsx(i,{children:t.chainName}),e.jsx(i,{children:t.marketAddress}),e.jsx(i,{children:Ie.includes(t.productId)?e.jsx(j,{size:"sm",onClick:()=>{oe(p,t.productId)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Remove"}):e.jsx(j,{size:"sm",onClick:()=>{Re(p,t.productId)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Add"})})]},a)})})]}),e.jsx(O,{children:e.jsxs(he,{"aria-label":"Page navigation example",children:[e.jsx(k,{disabled:b<=0,onClick:qe,children:"Previous"}),Je(),e.jsx(k,{disabled:Ae===!0,onClick:Oe,children:"Next"})]})})]})]}),e.jsxs(_,{alignment:"center",visible:Te,scrollable:!0,size:"sm",onClose:()=>F(!1),children:[e.jsx(U,{closeButton:!0,children:e.jsx(Q,{children:"Change Promotion Value"})}),e.jsxs(H,{children:[e.jsx("a",{children:"Add Promotion Value"}),e.jsx("br",{}),e.jsx(w,{type:"text",placeholder:Ee,value:L,onChange:t=>te(t.target.value)})]}),e.jsx(O,{children:e.jsx(j,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>We(),children:"Save changes"})})]}),e.jsxs(_,{alignment:"center",visible:$e,scrollable:!0,size:"sm",onClose:()=>R(!1),children:[e.jsx(U,{closeButton:!0,children:e.jsx(Q,{children:"Add promotion value to all products"})}),e.jsxs(H,{children:[e.jsx("a",{children:"Add Promotion Value"}),e.jsx("br",{}),e.jsx(w,{type:"text",value:V,onChange:t=>ae(t.target.value)})]}),e.jsx(O,{children:e.jsx(j,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>Ze(),children:"Save changes"})})]})]})};export{wt as default};
