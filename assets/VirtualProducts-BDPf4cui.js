import{y as Oe,r,A as c,j as t,h as D,L as Ye,m as qe}from"./index-AJjCLhjn.js";import{a as f}from"./axios-Cm0UX6qg.js";import{B as m}from"./config-HOLfLxHr.js";import{b as Ge,a as u}from"./CContainer-BIxJfy9n.js";import{C as ne,a as de,b as ie,c as ue,d as I}from"./DefaultLayout-CU242EN2.js";import{C as Je}from"./CNavbar-CsCVrAvW.js";import{C as pe}from"./CFormInput-Cu0cu3ai.js";import{C as Ke,a as We,b as he,c as i,d as Xe,e as x}from"./CTable-4WO2OKTT.js";import{C as ge}from"./CCardImage-B4bp51Ek.js";import{c as Ze}from"./cil-pencil-m516yCOw.js";import{C as et,a as $}from"./CPaginationItem-B1DiQdIa.js";import{C as R,a as F,b as V,c as H}from"./CModalTitle-Bqyt-URh.js";import{C as fe}from"./CModalFooter-1YoKlFAU.js";import"./CFormLabel-BHjIlkbJ.js";const mt=()=>{const[{user:y,token:n},o]=Oe(),[me,C]=r.useState(!1),[_,j]=r.useState(!1);r.useState(!1);const[xe,P]=r.useState(!1),[Q,O]=r.useState([]),[S,v]=r.useState(0),[ye,b]=r.useState(!0),[Ce,je]=r.useState([]),[Pe,w]=r.useState("All Chains"),[U,Y]=r.useState("All market"),[tt,M]=r.useState(""),[k,q]=r.useState(""),[ke,G]=r.useState([]),[z,Se]=r.useState(""),[be,L]=r.useState(!1),[Ae,J]=r.useState(""),[N,K]=r.useState(""),[De,W]=r.useState(""),[Ie,ve]=r.useState(0),[A,B]=r.useState(1);r.useState("NAME");const[X,E]=r.useState(!1),[we,Z]=r.useState(""),[Ue,p]=r.useState(!1),[Me,ee]=r.useState(!1);r.useEffect(()=>{y&&n&&h(0)},[y,n,k,z]),r.useEffect(()=>{n&&f.get(m+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${n}`}}).then(e=>{e.status===200?je(e.data):e.status===500&&o({type:c,payload:{status:!0,title:"Chain Loading error",message:e.data.message}})}).catch(e=>{console.error("Error: ",e)})},[]);const ze=e=>{f.get(m+`assistant/reference/market/locations?brand=${e}`,{headers:{Authorization:`Bearer ${n}`}}).then(s=>{s.status===200?(G(s.data.data),s.data.data.length<20?(b(!0),console.log("ok")):s.data.data.length>19&&b(!1)):s.status===500&&o({type:c,payload:{status:!0,title:"Market Loading error",message:s.data.message}})}).catch(s=>{console.error("Error: ",s)})},h=(e,s)=>{C(!0),f.get(m+`virtual/product/all/${e}?marketId=${k}&name=${z}`,{headers:{Authorization:`Bearer ${n}`}}).then(a=>{a.status===200?(O(a.data.list),ve(a.data.count),console.log(a.data.count),C(!1),a.data.list.length<20?(b(!0),console.log("ok")):a.data.list.length>19&&b(!1)):a.status===203?(C(!1),o({type:c,payload:{status:!0,title:"product loading error error",message:a.data.message}})):a.status===204?(C(!1),o({type:c,payload:{status:!0,title:"No Products",message:"No products found in this market address",color:"info"}})):a.status===500&&(C(!1),o({type:c,payload:{status:!0,title:"product loading error error",message:a.data.message}}))}).catch(a=>{C(!1),console.error("Error:",a)})},te=(e,s)=>{e==="all"?(M(""),w("All Chains")):(M(e),ze(e),w(s))},se=(e,s)=>{e==="all"?(q(""),Y("All Markets"),M(""),w("All Chains"),G([])):(q(e),Y(s))},Le=()=>{B(A+1);const e=S+50;v(e),h(e)},Ne=()=>{B(A-1);const e=S-50;console.log(e),v(e),h(e)},Be=(e,s)=>{L(!0),J(e),W(s)},Ee=()=>{console.log("called"),N==""?o({type:c,payload:{status:!0,title:"Alert",message:"Please enter the price",color:"warning"}}):Re(Ae)},Te=e=>{B(e);const s=(e-1)*50;v(s),h(s)},$e=()=>{const e=Math.ceil(Ie/50),s=[];for(let d=1;d<=e;d++)s.push(d);const a=Math.max(A-2,1),l=Math.min(a+4,e);return s.slice(a-1,l).map(d=>t.jsx($,{active:A===d,onClick:()=>Te(d),children:d},d))},Re=e=>{if(e){let s={price:N+" â‚¬"};y&&n&&f.put(m+"product/update/price/"+e,s,{headers:{Authorization:`Bearer ${n}`}}).then(a=>{if(a.status===200){const l=a.data,g=Q.map(d=>(d.productId===l.productId&&(d.price.basePrice=l.price.basePrice,d.price.tax=l.price.tax,d.price.markup=l.price.markup,d.price.total=l.price.total),d));O([...g]),o({type:c,payload:{status:!0,title:"Product Details Update",message:"Product price update Success",color:"success"}}),J(""),K(""),L(!1),W("")}else a.status===204?o({type:c,payload:{status:!0,title:"Product Details Update error",message:a.data.message,color:"danger"}}):a.status===500&&o({type:c,payload:{status:!0,title:"Product Details Update error",message:a.data.message,color:"danger"}})}).catch(a=>{console.error("Error:",a)})}else alert("Please Check the Fields!")},Fe=e=>{E(!X),Z(e)},[Ve,T]=r.useState(null),[ae,re]=r.useState(null),He=e=>{console.log(e),re(URL.createObjectURL(e)),T(e)},_e=async(e,s)=>{if(console.log(e,s),y&&n){const a=new FormData;a.append("image",s),a.append("id",e),f.post(m+"test/product/image/update",a,{headers:{Authorization:`Bearer ${n}`}}).then(l=>{l.status===200?(E(!1),Z(""),T(null),console.log("response",l.data),o({type:c,payload:{status:!0,title:"Image upload ",message:"Image upload success",color:"success"}}),h(0)):l.status===500&&o({type:c,payload:{status:!0,title:"Image upload error",message:l.data.message,color:"danger"}})}).catch(l=>{console.error("Error:",l)})}},le=(e,s)=>{if(e){let a={status:s};y&&n&&f.put(m+"product/update/status/"+e,a,{headers:{Authorization:`Bearer ${n}`}}).then(l=>{l.status===200?(o({type:c,payload:{status:!0,title:"Product Status Update",message:"Product status update Success",color:"success"}}),h(0)):l.status===204?o({type:c,payload:{status:!0,title:"Product Details Update error",message:"Product status update error",color:"danger"}}):l.status===500&&o({type:c,payload:{status:!0,title:"Product Details Update error",message:"Product status update error",color:"danger"}})}).catch(l=>{console.error("Error:",l)})}else alert("Please Check the Fields!")},oe=e=>{p(!0),e==="active"?ee(!0):e==="deactive"&&ee(!1)},ce=(e,s)=>{j(!0);let a;if(e==="1"?a=!0:e==="0"&&(a=!1),s){let l={status:a,mid:s};console.log("data",l),y&&n&&f.put(m+"product/update/all",l,{headers:{Authorization:`Bearer ${n}`}}).then(g=>{g.status===200?(o({type:c,payload:{status:!0,title:"Product Status Update",message:"Product status update Success",color:"success"}}),h(0),j(!1),p(!1)):g.status===204?(o({type:c,payload:{status:!0,title:"Product Details Update",message:"No products found in this market address to update",color:"info"}}),j(!1),p(!1)):g.status===500&&(o({type:c,payload:{status:!0,title:"Product Details Update error",message:"Product status update error",color:"danger"}}),j(!1),p(!1))}).catch(g=>{console.error("Error:",g),j(!1),p(!1)})}else o({type:c,payload:{status:!0,title:"Alert",message:"Please select the market",color:"danger"}}),P(!1),j(!1),p(!1)},Qe=e=>{P(!0),console.log("mid",e),y&&n&&(e?(console.log("data"),f.put(m+"product/sync/all/"+e,{},{headers:{Authorization:`Bearer ${n}`}}).then(s=>{s.status===200?(o({type:c,payload:{status:!0,title:"Product Sync",message:"Product sync Success",color:"success"}}),h(0),P(!1)):s.status===204?(o({type:c,payload:{status:!0,title:"Product Sync error",message:"Product sync error",color:"danger"}}),P(!1)):s.status===500&&(o({type:c,payload:{status:!0,title:"Product Sync error",message:"Product sync error",color:"danger"}}),P(!1))}).catch(s=>{console.error("Error:",s),P(!1)})):o({type:c,payload:{status:!0,title:"Alert",message:"Please select the market",color:"danger"}}))};return t.jsxs(Ge,{children:[t.jsx(ne,{style:{marginLeft:"0%"},color:"secondary",children:"Action "}),t.jsx(u,{size:"sm",onClick:()=>{oe("active")},style:{backgroundColor:"#ff4d4d",marginLeft:"2%",width:120,color:"white"},children:_?t.jsx(D,{size:"sm"}):"Activate All"}),t.jsx(u,{size:"sm",onClick:()=>{oe("deactive")},style:{backgroundColor:"#ff4d4d",marginLeft:"2%",width:120,color:"white"},children:_?t.jsx(D,{size:"sm"}):"Deactivate All"}),t.jsx(u,{size:"sm",onClick:()=>{Qe(k)},style:{backgroundColor:"#ff4d4d",marginLeft:"2%",width:120,color:"white"},children:xe?t.jsx(D,{size:"sm"}):"Sync"}),t.jsx(ne,{style:{marginLeft:"15%"},color:"secondary",children:"Filter by"}),t.jsxs(de,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[t.jsx(ie,{children:Pe}),t.jsxs(ue,{children:[t.jsx(I,{onClick:()=>te("all"),children:"All"}),Ce.map((e,s)=>t.jsx(I,{onClick:()=>te(e.id,e.name),children:e.name},s))]})]}),t.jsxs(de,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[t.jsx(ie,{children:U.length>15?`${U.substring(0,15)}...`:U}),t.jsxs(ue,{children:[t.jsx(I,{onClick:()=>se("all"),children:"Select the Chain"}),ke.map((e,s)=>t.jsx(I,{onClick:()=>se(e._id,e.address),children:t.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[t.jsx("span",{children:e.address.substring(0,e.address.length/2)}),t.jsx("span",{children:e.address.substring(e.address.length/2)})]})},s))]})]}),t.jsx(Je,{style:{marginTop:"1%"},className:"bg-body-tertiary",children:t.jsx(pe,{type:"text",placeholder:"Search products by name, brand name and product id",style:{width:450,marginRight:"50%"},value:z,onChange:e=>Se(e.target.value)})}),me?t.jsx(D,{}):t.jsxs(Ke,{children:[t.jsx(We,{children:t.jsxs(he,{children:[t.jsx(i,{scope:"col",children:"#"}),t.jsx(i,{scope:"col",children:"Product Id"}),t.jsx(i,{scope:"col",children:"Photo"}),t.jsx(i,{scope:"col",children:"Name"}),t.jsx(i,{scope:"col",children:"Price"}),t.jsx(i,{scope:"col",children:"Brand"}),t.jsx(i,{scope:"col",children:"Chain"}),t.jsx(i,{scope:"col",children:"Market Address"}),t.jsx(i,{scope:"col",children:"Action"})]})}),t.jsx(Xe,{children:Q.map((e,s)=>t.jsxs(he,{children:[t.jsx(x,{children:S+s+1}),t.jsx(x,{children:e.pid}),t.jsx(i,{onClick:()=>{Fe(e.productId)},children:t.jsx(ge,{style:{width:"50px",height:"50px"},src:"https://api.zeuler.com/image/"+e.image})}),t.jsx(x,{children:e.name}),t.jsxs(x,{children:[e.price.basePrice,t.jsx(Ye,{to:"",children:t.jsx(qe,{icon:Ze,size:"sm",onClick:()=>Be(e.productId,e.price.basePrice)})})]}),t.jsx(x,{children:e.brand}),t.jsx(x,{children:e.chainName}),t.jsx(x,{children:e.marketAddress}),t.jsx(x,{children:e.status?t.jsx(u,{size:"sm",onClick:()=>{le(e.productId,!1)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Deactivate"}):t.jsx(u,{size:"sm",onClick:()=>{le(e.productId,!0)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Activate"})})]},s))})]}),t.jsxs(et,{"aria-label":"Page navigation example",children:[t.jsx($,{disabled:S<=0,onClick:Ne,children:"Previous"}),$e(),t.jsx($,{disabled:ye===!0,onClick:Le,children:"Next"})]}),t.jsxs(R,{alignment:"center",visible:Ue,scrollable:!0,size:"sm",onClose:()=>p(!1),children:[t.jsx(F,{closeButton:!1,children:t.jsx(V,{children:"Confirmation"})}),t.jsxs(H,{children:[t.jsx("a",{children:"Are you sure you want to change the status of all these products?"}),t.jsx("br",{}),t.jsx("br",{}),t.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[t.jsx(u,{onClick:()=>{ce(Me?"1":"0",k)},style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),t.jsx(u,{onClick:()=>{p(!1)},style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]}),t.jsxs(R,{alignment:"center",visible:be,scrollable:!0,size:"sm",onClose:()=>L(!1),children:[t.jsx(F,{closeButton:!0,children:t.jsx(V,{children:"Change Price"})}),t.jsxs(H,{children:[t.jsx("a",{children:"Enter New Name"}),t.jsx("br",{}),t.jsx(pe,{type:"text",placeholder:De,value:N,onChange:e=>K(e.target.value)})]}),t.jsx(fe,{children:t.jsx(u,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>Ee(),children:"Save changes"})})]}),t.jsxs(R,{alignment:"center",visible:X,scrollable:!0,size:"lg",onClose:()=>{E(!1),T(null),re(null)},children:[t.jsx(F,{closeButton:!0,children:t.jsx(V,{children:"Image Uploader"})}),t.jsxs(H,{children:[ae&&t.jsx(ge,{style:{width:"100px",height:"100px"},src:ae,alt:"Uploaded Image"}),t.jsx("input",{style:{marginLeft:"5%"},type:"file",accept:".jpg, .jpeg, .png",onChange:e=>He(e.target.files[0])})]}),t.jsx(fe,{children:t.jsx(u,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>{_e(we,Ve)},children:"Upload Image"})})]})]})};export{mt as default};
