import{r as a,y as ve,A as r,j as e,h as Te,L as ze,m as L}from"./index-yStlV239.js";import{a as C}from"./axios-Cm0UX6qg.js";import{E as Ee}from"./leaflet.draw-BWfjJN_C.js";import{M as Be,T as Ie,P as Fe}from"./leaflet-CcVPK71n.js";import{B as k}from"./config-HOLfLxHr.js";import{b as Re,a as d}from"./CContainer-DhkLMVU5.js";import{d as Y,C as Z,a as q,b as J,c as f}from"./DefaultLayout-CZyVa7B9.js";import{C as K}from"./CNavbar-DO7GSnGJ.js";import{C as _e,a as $e,b as Q,c as p,d as Ve,e as u}from"./CTable-BohCcCUg.js";import{c as Ge}from"./cil-pencil-m516yCOw.js";import{c as He}from"./cil-trash-CBbKHhHb.js";import{C as Ue,a as X}from"./CPaginationItem-BzOrz1h2.js";import{C as D,a as N,b as v,c as T}from"./CModalTitle-BlY3Ysnn.js";import{M as We}from"./Marker-B_zzFHJb.js";import{c as Oe}from"./cil-info-CmGCY32x.js";import{P as ee,F as Ye}from"./Polygon-BKAgnFYA.js";import{C as se}from"./CModalFooter-BE_b0pLY.js";import{C as Ze}from"./CFormInput-DWOaSip4.js";import"./index-CPG_dsLe.js";import"./CFormLabel-CiFYDw8K.js";const gs=()=>{const te=a.useRef(null),[{user:h,token:c},l]=ve(),[ae,oe]=a.useState([]),[z,E]=a.useState(""),[x,B]=a.useState(0),[le,I]=a.useState("All Cities"),[re,F]=a.useState(!1),[ie,R]=a.useState(!0),[ne,b]=a.useState(!1),[ce,P]=a.useState(!1),[de,pe]=a.useState([]),[A,ue]=a.useState("Napoli"),[_,he]=a.useState([]),[w,me]=a.useState([]),[S,M]=a.useState(""),[y,$]=a.useState(""),[ge,V]=a.useState(""),[G,j]=a.useState(!1),[fe,xe]=a.useState(!1),[H,ye]=a.useState([]),[je,U]=a.useState([]);a.useEffect(()=>{h&&c&&m(0)},[z,h]);const m=s=>{F(!0),C.get(k+`pickups/areas/${s}?city=${z}`,{headers:{Authorization:`Bearer ${c}`}}).then(t=>{if(t.status===200){oe(t.data);const o=t.data.map(g=>g.geometry.coordinates),n=Ce(o);ye(n),F(!1),t.data.length<20?R(!0):t.data.length>19&&R(!1)}else t.status===500&&l({type:r,payload:{status:!0,title:"Market Loading error",message:t.data.message}})}).catch(t=>{console.error("Error: ",t)})};function Ce(s){return s.map(t=>t.map(o=>o.map(n=>({lng:n[0],lat:n[1]}))))}const ke=()=>{const s=x+20;B(s),m(s)},be=()=>{const s=x-20;console.log(s),B(s),m(s)},i=s=>{s==="all"?(E(""),I("All Cities")):(E(s),I(s),ue(s))},Pe=(s,t,o)=>{b(!0),o==="Milano"?(U([45.4666507,9.1823022]),i("Milano")):o==="Napoli"&&(U([40.85631,14.24641]),i("Napoli"));const n=Ae(s);he(n),M(t)};function Ae(s){return s.map(t=>t.map(o=>({lng:o[0],lat:o[1]})))}const we=(s,t)=>{P(!0),M(s),V(t),console.log(t)};a.useEffect(()=>{h&&c&&C.get(k+`assistant/markets/groups/locations/pickup/${A}`,{headers:{Authorization:`Bearer ${c}`}}).then(s=>{s.status===200?pe(s.data):s.status===500&&l({type:r,payload:{status:!0,title:"Market Group loading error",message:s.data.message}})}).catch(s=>{console.error("Error:",s)})},[h,A]);const Se=s=>{const t=s.layer;console.log("layer",t._latlngs);const o=t._latlngs.map(n=>{const g=n.map(O=>[O.lng,O.lat]);return g.push(g[0]),g});console.log(o),me(o)},W=s=>{if(s){let t={};w&&(t={area:w}),y&&(t={name:y}),console.log(t,s),h&&c&&C.put(k+"pickup/area/update/"+s,t,{headers:{Authorization:`Bearer ${c}`}}).then(o=>{o.status===200?(l({type:r,payload:{status:!0,title:"Pickup Area Update",message:"Pick up area update Success",color:"success"}}),M(""),$(""),m(0),b(!1),P(!1),V("")):o.status===204?l({type:r,payload:{status:!0,title:"Pick up area update  error",message:o.data.message,color:"danger"}}):o.status===500&&l({type:r,payload:{status:!0,title:"Pick up area update  error",message:o.data.message,color:"danger"}})}).catch(o=>{console.error("Error:",o)})}else alert("Please Check the Fields!")},Me=()=>{w==""?l({type:r,payload:{status:!0,title:"Alert",message:"Please select the area",color:"danger"}}):W(S)},Le=()=>{y==""&&S==""?l({type:r,payload:{status:!0,title:"Alert",message:"Please Name",color:"danger"}}):W(S)},De=s=>{j(!G),xe(s)},Ne=s=>{console.log(s),C.delete(k+"pickup/area/delete/"+s,{headers:{Authorization:`Bearer ${c}`}}).then(t=>{t.status===200?(l({type:r,payload:{status:!0,title:"Pickup Area Delete",message:"Pick up area deleted Successfully",color:"success"}}),j(!1),m(0)):t.status===204?l({type:r,payload:{status:!0,title:"Pickup Area Delete",message:t.data.message,color:"warning"}}):t.status===500&&l({type:r,payload:{status:!0,title:"Pickup Area Delete",message:t.data.message,color:"warning"}})}).catch(t=>{console.error("Error:",t)})};return e.jsxs(Re,{children:[e.jsx(Y,{style:{marginLeft:"75.5%"},color:"secondary",children:"Filter by"}),e.jsxs(Z,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[e.jsx(q,{style:{color:"white"},children:le}),e.jsxs(J,{children:[e.jsx(f,{onClick:()=>i("all"),children:"All"}),e.jsx(f,{onClick:()=>i("Milano"),children:"Milano"}),e.jsx(f,{onClick:()=>i("Napoli"),children:"Napoli"})]})]}),e.jsx(K,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),re?e.jsx(Te,{}):e.jsxs(_e,{children:[e.jsx($e,{children:e.jsxs(Q,{children:[e.jsx(p,{scope:"col",children:"#"}),e.jsx(p,{scope:"col",children:"Name"}),e.jsx(p,{scope:"col",children:"Type"}),e.jsx(p,{scope:"col",children:"City"}),e.jsx(p,{scope:"col",children:"View"}),e.jsx(p,{scope:"col",children:"Action"})]})}),e.jsx(Ve,{children:ae.map((s,t)=>e.jsxs(Q,{children:[e.jsx(u,{children:x+t+1}),e.jsxs(u,{children:[e.jsx("span",{children:s.name}),e.jsx(ze,{to:"",children:e.jsx(L,{style:{marginLeft:20,float:"right"},icon:Ge,size:"sm",onClick:()=>we(s._id,s.name)})})]}),e.jsx(u,{children:s.geometry.type}),e.jsx(u,{children:s.city}),e.jsx(u,{children:e.jsx(d,{size:"sm",style:{backgroundColor:"#ff4d4d",color:"white"},variant:"outline",onClick:()=>Pe(s.geometry.coordinates,s._id,s.city),children:"View map"})}),e.jsx(u,{children:e.jsx(d,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>De(s._id),children:e.jsx(L,{icon:He,size:"lg",style:{color:"white"}})})})]},t))})]}),e.jsxs(Ue,{"aria-label":"Page navigation example",children:[e.jsx(X,{disabled:x<=0,onClick:be,children:"Previous"}),e.jsx(X,{disabled:ie===!0,onClick:ke,children:"Next"})]}),e.jsxs(D,{alignment:"center",visible:ne,scrollable:!0,size:"xl",onClose:()=>{b(!1),i("all")},children:[e.jsx(N,{closeButton:!0,children:e.jsx(v,{children:"Map View"})}),e.jsxs(T,{children:[e.jsx(Y,{style:{marginLeft:"81.5%"},color:"secondary",children:"Filter by"}),e.jsxs(Z,{style:{marginLeft:"2%",width:"10%",backgroundColor:"#ff4d4d"},children:[e.jsx(q,{style:{color:"white"},children:A}),e.jsxs(J,{children:[e.jsx(f,{onClick:()=>i("Milano"),children:"Milano"}),e.jsx(f,{onClick:()=>i("Napoli"),children:"Napoli"})]})]}),e.jsx(K,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),e.jsxs(Be,{dragging:!0,center:je,zoom:13,scrollWheelZoom:!0,style:{height:"500px",width:"100%"},children:[e.jsx(Ie,{attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),de.map((s,t)=>e.jsx(We,{position:[s.lat,s.lng],children:e.jsx(Fe,{children:e.jsxs("div",{children:[e.jsx(L,{icon:Oe,size:"lg",style:{marginLeft:"10px"}})," ",e.jsx("span",{children:s.address})]})})},t)),_.length>0&&e.jsx(ee,{strokeColor:"yellow",strokeWidth:2,fillColor:"red",positions:_}),H.length>0&&e.jsx(ee,{positions:H}),e.jsx(Ye,{ref:te,children:e.jsx(Ee,{position:"topright",onCreated:Se,draw:{polygon:!0,circle:!0,polyline:!0,marker:!1,circlemarker:!1}})})]})]}),e.jsx(se,{children:e.jsx(d,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>Me(),children:"Save updated area"})})]}),e.jsxs(D,{alignment:"center",visible:ce,scrollable:!0,size:"sm",onClose:()=>P(!1),children:[e.jsx(N,{closeButton:!0,children:e.jsx(v,{children:"Change Name"})}),e.jsxs(T,{children:[e.jsx("a",{children:"Enter New Name"}),e.jsx("br",{}),e.jsx(Ze,{type:"text",placeholder:ge,value:y,onChange:s=>$(s.target.value)})]}),e.jsx(se,{children:e.jsx(d,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>Le(),children:"Save changes"})})]}),e.jsxs(D,{alignment:"center",visible:G,scrollable:!0,size:"sm",onClose:()=>j(!1),children:[e.jsx(N,{closeButton:!1,children:e.jsx(v,{children:"Confirmation"})}),e.jsxs(T,{children:[e.jsx("a",{children:"Are you sure you want to delete this pickup area?"}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[e.jsx(d,{onClick:()=>Ne(fe),style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),e.jsx(d,{onClick:()=>j(!1),style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]})]})};export{gs as default};
