import{r as a,y as We,A as o,j as e,L as Ce,h as Xe,m as ke}from"./index-CHsjmxnU.js";import{a as m}from"./axios-Cm0UX6qg.js";/* empty css               */import{B as g}from"./config-HOLfLxHr.js";import{b as Ze,a as h}from"./CContainer-Dw7-AxLW.js";import{C as Oe,a as N,b as z,c as I,d as f}from"./DefaultLayout-BwrjnTfX.js";import{C as es}from"./CNavbar-DS_VKVWT.js";import{C as p}from"./CFormInput-B5rC6iFB.js";import{C as ss,a as ts,b as we,c as n,d as as,e as c}from"./CTable-CpDj-LAf.js";import{c as rs}from"./cil-pencil-m516yCOw.js";import{c as ls}from"./cil-trash-CBbKHhHb.js";import{C as b,a as P,b as S,c as v}from"./CModalTitle-BgBN8Bxw.js";import{C as d}from"./CCol-CbSCCw0e.js";import{C as os}from"./CModalFooter-CZIgj7cX.js";import{C as is}from"./CFormSelect-CWO72E95.js";import"./CFormLabel-BmodjjyT.js";const Ps=()=>{const[V,j]=a.useState(!1),[G,C]=a.useState(!1),[{user:k,token:i},l]=We(),[$,R]=a.useState([]),[be,A]=a.useState(!1),[F,U]=a.useState(""),[H,_]=a.useState(""),[Y,q]=a.useState(""),[E,Pe]=a.useState(""),[J,K]=a.useState(!1),[Q,W]=a.useState(""),[Se,X]=a.useState(!1),[ve,Z]=a.useState("All Cities"),[Ae,O]=a.useState("All Market Groups"),[Ee,ee]=a.useState("All Chains"),[De,Te]=a.useState([]),[Be,Le]=a.useState([]),[se,x]=a.useState(!1),[u,Me]=a.useState([]),[te,ae]=a.useState(),[re,le]=a.useState(),[oe,ie]=a.useState(),[ne,ce]=a.useState(),[de,ue]=a.useState(),[D,he]=a.useState(),[Ne,pe]=a.useState(),[me,ge]=a.useState(),[ze,Ie]=a.useState(),[w,Ve]=a.useState(""),[T,Ge]=a.useState(""),[$e,B]=a.useState(!1);a.useEffect(()=>{Re(),Fe()},[]);const Re=()=>{i&&m.get(g+"market/groups/dropdown/fetch",{headers:{Authorization:`Bearer ${i}`}}).then(s=>{s.status===200?Te(s.data):s.status===500&&l({type:o,payload:{status:!0,title:"Market Group Loading error",message:s.data.message}})}).catch(s=>{console.error("Error: ",s)})},Fe=()=>{i&&m.get(g+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${i}`}}).then(s=>{s.status===200?Le(s.data):s.status===500&&l({type:o,payload:{status:!0,title:"Chain Loading error",message:s.data.message}})}).catch(s=>{console.error("Error: ",s)})};a.useEffect(()=>{const s=setTimeout(()=>{l({type:o,payload:{status:!0,title:"Data Loading",message:"Data loading error: Timeout exceeded",color:"warning"}}),A(!1)},2e4);return L(s),()=>{clearTimeout(s)}},[F,H,Y,E,Se]);const L=s=>{if(k&&i){A(!0);let t=g+`assistant/shoppers/0?city=${F}&group=${H}&chain=${Y}&code=${E}`;m.get(t,{headers:{Authorization:`Bearer ${i}`}}).then(r=>{r.status===200?(R(r.data),A(!1),X(!1),clearTimeout(s)):r.status===500&&l({type:o,payload:{status:!0,title:"Error",message:r.data.message,color:"warning"}})}).catch(r=>{console.error("Error:",r)})}},M=s=>{s==="all"?(U(""),Z("All Cities")):(U(s),Z(s))},fe=(s,t)=>{s==="all"?(_(""),O("All Market Groups")):(_(s),O(t))},xe=(s,t)=>{s==="all"?(q(""),ee("All Chains")):(q(s),ee(t))},ye=(s,t)=>{j(!V),K(t),W(s)},Ue=()=>{x(!1),B(!0)},He=()=>{const s={status:J};console.log(Q,s),k&&i&&m.patch(g+"assistant/shopper/status/"+Q,s,{headers:{Authorization:`Bearer ${i}`}}).then(t=>{t.status===200?(console.log("updated"),j(!1),K(""),W(""),X(!0),l({type:o,payload:{status:!0,title:"Picker status update",message:"Picker status updated successfully",color:"success"}})):t.status===203?l({type:o,payload:{status:!0,title:"Picker status update error",message:t.data.message}}):t.status===204?l({type:o,payload:{status:!0,title:"Picker status update error",message:t.data.message}}):t.status===500&&l({type:o,payload:{status:!0,title:"Picker status update error",message:t.data.message}})}).catch(t=>{console.error(t)})},_e=s=>{console.log(s),x(!se),Me(s),ae(s.name),le(s.surname),ie(s.email),ce(s.contact),ue(s.iban),he(s.city),ge(s.address),pe(s.vat)},Ye=()=>{if(te&&re&&oe&&ne&&de&&D&&me){const s={name:te,surname:re,email:oe,contact:ne,iban:de,city:D,vat:Ne,address:me},t=u.id;i&&k&&i&&m.patch(g+"assistant/shopper/update/"+t,s,{headers:{Authorization:`Bearer ${i}`}}).then(r=>{if(r.status===200){console.log(r.data),x(!1);const y=r.data,Qe=$.map(je=>je.id===y.id?(console.log("update obj"),y):je);R([...Qe]),L(),l({type:o,payload:{status:!0,title:"Picker update",message:"Picker updated successfully",color:"success"}})}else r.status===203?l({type:o,payload:{status:!0,title:"Picker update error",message:"Email already exists",color:"warning"}}):r.status===204?l({type:o,payload:{status:!0,title:"Picker update error",message:r.data.message,color:"warning"}}):r.status===404?l({type:o,payload:{status:!0,title:"Picker update error",message:"Missing required fields",color:"warning"}}):r.status===500&&l({type:o,payload:{status:!0,title:"Picker update error",message:r.data.message,color:"warning"}})}).catch(r=>{console.error("Error:",r)})}else l({type:o,payload:{status:!0,title:"Error!",message:"Picker update error, Please Check the input fields",color:"warning"}})},qe=s=>{C(!G),Ie(s)},Je=s=>{m.delete(g+"assistant/shopper/delete/"+s,{headers:{Authorization:`Bearer ${i}`}}).then(t=>{t.status===200?(l({type:o,payload:{status:!0,title:"Picker Delete",message:"Picker deleted successfully",color:"success"}}),C(!1),L()):t.status===404?l({type:o,payload:{status:!0,title:"Picker remove error",message:t.data.message}}):t.status===500&&l({type:o,payload:{status:!0,title:"Picker remove error",message:t.data.message}})}).catch(t=>{console.error("Error:",t)})},Ke=s=>{if(w===""||T==="")l({type:o,payload:{status:!0,title:"Password update error",message:"Check the input fields",color:"warning"}});else if(w===T){const t={passcode:w};console.log(t,s),k&&i&&m.patch(g+"assistant/shopper/update/"+s,t,{headers:{Authorization:`Bearer ${i}`}}).then(r=>{r.status===200?(B(!1),l({type:o,payload:{status:!0,title:"Password update",message:"Password updated successfully",color:"success"}}),x(!0)):r.status===204?l({type:o,payload:{status:!0,title:"Password update error",message:r.data.message}}):r.status===404?l({type:o,payload:{status:!0,title:"Password update error",message:r.data.message}}):r.status===500&&l({type:o,payload:{status:!0,title:"Password update error",message:r.data.message}})}).catch(r=>{console.error(r)})}else l(w!==T?{type:o,payload:{status:!0,title:"Password update error",message:"Password does not match",color:"warning"}}:{type:o,payload:{status:!0,title:"Password update error",message:"Password update error or check the input fields",color:"warning"}})};return e.jsxs(Ze,{children:[e.jsx(Ce,{to:"/picker/addpicker",className:"picker-link",children:e.jsx(h,{style:{marginLeft:"0%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Add Picker"})}),e.jsx(Oe,{style:{marginLeft:"20%"},color:"secondary",children:"Filter by"}),e.jsxs(N,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(z,{style:{color:"white"},children:ve}),e.jsxs(I,{children:[e.jsx(f,{onClick:()=>M("all"),children:"All"}),e.jsx(f,{onClick:()=>M("Milan"),children:"Milan"}),e.jsx(f,{onClick:()=>M("Napoli"),children:"Napoli"})]})]}),e.jsxs(N,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(z,{style:{color:"white"},children:Ee}),e.jsxs(I,{children:[e.jsx(f,{onClick:()=>xe("all"),children:"All"}),Be.map((s,t)=>e.jsx(f,{onClick:()=>xe(s.id,s.name),children:s.name},t))]})]}),e.jsxs(N,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(z,{style:{color:"white"},children:Ae}),e.jsxs(I,{children:[e.jsx(f,{onClick:()=>fe("all"),children:"All"}),De.map((s,t)=>e.jsx(f,{onClick:()=>fe(s._id,s.name),children:s.name},t))]})]}),e.jsx(es,{style:{marginTop:"1%"},className:"bg-body-tertiary",children:e.jsx(p,{type:"text",placeholder:"Search by Picker by picker Id, name, surname, email and contact",className:"picker-input",value:E,style:{width:480,marginLeft:"0%"},onChange:s=>Pe(s.target.value)})}),be?e.jsx(Xe,{}):e.jsxs(ss,{children:[e.jsx(ts,{children:e.jsxs(we,{children:[e.jsx(n,{scope:"col",children:"#"}),e.jsx(n,{scope:"col",children:"Id"}),e.jsx(n,{scope:"col",children:"First Name"}),e.jsx(n,{scope:"col",children:"Last Name"}),e.jsx(n,{scope:"col",children:"Email"}),e.jsx(n,{scope:"col",children:"Phone"}),e.jsx(n,{scope:"col",children:"Country"}),e.jsx(n,{scope:"col",children:"City"}),e.jsx(n,{scope:"col",children:"Language"}),e.jsx(n,{scope:"col",children:"Market"}),e.jsx(n,{scope:"col",children:"Edit"}),e.jsx(n,{scope:"col",children:"Edit Status"}),e.jsx(n,{scope:"col",children:"Action"})]})}),e.jsx(as,{children:$.map((s,t)=>{var r,y;return e.jsxs(we,{children:[e.jsx(c,{children:t+1}),e.jsx(c,{children:s.code}),e.jsx(c,{children:s.name}),e.jsx(c,{children:s.surname}),e.jsx(c,{children:s.email}),e.jsx(c,{children:s.contact}),e.jsx(c,{children:s.country==="it"||s.country==="Italy"?"Italy":s.country}),e.jsx(c,{children:s.city}),e.jsx(c,{children:s.language==="en"?"English":s.language==="it"?"Italy":s.language==="es"?"Spanish":s.language}),e.jsxs(c,{children:[(y=(r=s.market)==null?void 0:r.chain)==null?void 0:y.name," - ",s.market.address]}),e.jsx(c,{children:e.jsx(Ce,{children:e.jsx(ke,{icon:rs,size:"xl",onClick:()=>_e(s)})})}),e.jsx(c,{children:s.activate?e.jsx(h,{size:"sm",onClick:()=>ye(s.id,!1),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Deactivate"}):e.jsx(h,{size:"sm",onClick:()=>ye(s.id,!0),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Activate"})}),e.jsx(c,{children:e.jsx(h,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>qe(s.id),children:e.jsx(ke,{icon:ls,size:"lg",style:{color:"white"}})})})]},t)})})]}),e.jsxs(b,{alignment:"center",visible:$e,scrollable:!0,size:"sm",onClose:()=>B(!1),children:[e.jsx(P,{closeButton:!0,children:e.jsx(S,{children:"Update Password"})}),e.jsxs(v,{children:[e.jsx(d,{md:12,children:e.jsx(p,{id:"password",label:"Enter New Password",type:"password",onChange:s=>Ve(s.target.value)})}),e.jsx("br",{}),e.jsx(d,{md:12,children:e.jsx(p,{id:"repassword",label:"Re Enter Password",type:"password",onChange:s=>Ge(s.target.value)})})]}),e.jsx(os,{children:e.jsx(h,{type:"submit",style:{marginBottom:"3%",backgroundColor:"#ff4d4d",color:"white"},onClick:()=>{Ke(u.id)},children:"Update"})})]}),e.jsxs(b,{alignment:"center",visible:G,scrollable:!0,size:"sm",onClose:()=>C(!1),children:[e.jsx(P,{closeButton:!1,children:e.jsx(S,{children:"Confirmation"})}),e.jsxs(v,{children:[e.jsx("a",{children:"Are you sure you want to delete this picker?"}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[e.jsx(h,{onClick:()=>Je(ze),style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),e.jsx(h,{onClick:()=>C(!1),style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]}),e.jsxs(b,{alignment:"center",visible:V,scrollable:!0,size:"sm",onClose:()=>j(!1),children:[e.jsx(P,{closeButton:!1,children:e.jsx(S,{children:"Confirmation"})}),e.jsxs(v,{children:[e.jsxs("a",{children:["Are you sure you want to ",J?"activate":"deactivate"," this picker?"]}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[e.jsx(h,{onClick:()=>He(),style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),e.jsx(h,{onClick:()=>j(!1),style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]}),e.jsxs(b,{visible:se,scrollable:!0,size:"lg",onClose:()=>x(!1),children:[e.jsx(P,{closeButton:!0,children:e.jsx(S,{children:"Edit Picker Information"})}),e.jsx(v,{children:e.jsxs("div",{className:"row g-3",children:[e.jsx(d,{md:6,children:e.jsx(p,{id:"name",label:"Firt Name",defaultValue:u.name,onChange:s=>ae(s.target.value)})}),e.jsx(d,{md:6,children:e.jsx(p,{id:"surname",label:"LastName",defaultValue:u.surname,onChange:s=>le(s.target.value)})}),e.jsx(d,{md:6,children:e.jsx(p,{id:"address",label:"Address",defaultValue:u.address,onChange:s=>ge(s.target.value)})}),e.jsx(d,{md:6,children:e.jsx(p,{id:"email",label:"Email",defaultValue:u.email,onChange:s=>ie(s.target.value)})}),e.jsx(d,{md:6,children:e.jsx(p,{id:"phone",label:"Contact Number",defaultValue:u.contact,onChange:s=>ce(s.target.value)})}),e.jsx(d,{md:6,children:e.jsx(p,{id:"iban",label:"IBAN",defaultValue:u.iban,onChange:s=>ue(s.target.value)})}),e.jsx(d,{md:6,children:e.jsx(p,{id:"vat",label:"Vat",defaultValue:u.vat,onChange:s=>pe(s.target.value)})}),e.jsx(d,{md:6,children:e.jsxs(is,{id:"inputState",label:"City",value:D,onChange:s=>he(s.target.value),children:[e.jsx("option",{children:u.city}),e.jsx("option",{children:"Milano"}),e.jsx("option",{children:"Napoli"})]})}),e.jsx(d,{xs:6,children:e.jsx(h,{type:"submit",style:{marginBottom:"3%",width:"200px",backgroundColor:"#ff4d4d",color:"white"},onClick:()=>Ye(),children:"Update Picker"})}),e.jsx(d,{xs:6,children:e.jsx("span",{style:{fontSize:15,color:"red",cursor:"pointer",marginLeft:"64%",marginTop:"10%"},onClick:()=>Ue(),children:"Change Password"})})]})})]})]})};export{Ps as default};
