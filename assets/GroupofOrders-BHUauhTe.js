import{y as xs,r as a,A as i,j as e,h as Pe,L as Be,m as Te}from"./index-UGMi1yYD.js";import{a as f}from"./axios-Cm0UX6qg.js";/* empty css               */import{B as m}from"./config-HOLfLxHr.js";import{b as js,a as p}from"./CContainer-DyKYeaQQ.js";import{C as D,a as P,b as B,d as T,e as n}from"./DefaultLayout-CzLgNllg.js";import{C as Ee}from"./CNavbar-CJm5RN47.js";import{D as fs}from"./index-D7PEuFUY.js";import{C as S}from"./CFormInput-CxPGKAGO.js";import{C as Ge,a as ze,b as C,c as r,d as Me,e as l}from"./CTable-Bh49LxGZ.js";import{c as ms}from"./cil-pencil-m516yCOw.js";import{c as ys}from"./cil-info-CmGCY32x.js";import{C as Cs,a as Ne}from"./CPaginationItem-2Xn3uQKT.js";import{C as E,a as G,b as z,c as M}from"./CModalTitle-Cj2x-Lbp.js";import{C as _}from"./CModalFooter-iKJhetg6.js";import{C as ks}from"./CRow-Ng7ko5ri.js";import{C as U}from"./CFormLabel-CaVfy1Ba.js";import{C as Q}from"./CCol-BiiKwAZ6.js";import{f as ve}from"./index-PqYCJD3r.js";import"./inheritsLoose-BR9xv5Kf.js";import"./typeof-QjJsDpFa.js";const Vs=()=>{var Se,we,Ae;const[{user:y,token:d},c]=xs(),[j,w]=a.useState([]),[Le,N]=a.useState(!1),[x,v]=a.useState(""),[Ie,Y]=a.useState(x),[k,W]=a.useState(0),[q,L]=a.useState(!1),[Fe,Re]=a.useState(""),[J,K]=a.useState(""),[I,X]=a.useState(""),[He,$e]=a.useState([]),[Oe,Ve]=a.useState([]),[Z,ee]=a.useState(""),[se,te]=a.useState(""),[ae,oe]=a.useState(""),[le,re]=a.useState(""),[_e,ne]=a.useState("All Cities"),[Ue,ce]=a.useState("All Status"),[Qe,ie]=a.useState("All Market Groups"),[Ye,de]=a.useState("All Chains"),[ue,We]=a.useState([]),[qe,he]=a.useState(!1),[F,R]=a.useState(!1),[b,Je]=a.useState([]),[pe,H]=a.useState(!1),[Ke,Xe]=a.useState(""),[ge,Ze]=a.useState(""),[es,ss]=a.useState(""),[xe,A]=a.useState(!1),[je,fe]=a.useState([]),[ts,me]=a.useState(!0);a.useEffect(()=>{const s=setTimeout(()=>{c({type:i,payload:{status:!0,title:"Data Loading",message:"Data loading error: Timeout exceeded",color:"warning"}}),N(!1)},2e4);return y&&d&&$(0,s),()=>{clearTimeout(s)}},[y,d,Ie,se,je]),a.useEffect(()=>{const s=setTimeout(()=>{(x.length>=3||x.length===0)&&Y(x)},500);return()=>{clearTimeout(s)}},[x]);const $=(s,t)=>{N(!0),f.get(m+"assistant/grocery/group/"+s+"?rider="+x+"&status="+se+"&date="+je,{headers:{Authorization:`Bearer ${d}`}}).then(o=>{console.log("data"),o.status===200?(w(o.data),console.log("dataaaaaaa"),N(!1),clearTimeout(t),o.data.length<50?(me(!0),console.log("ok")):o.data.length>49&&me(!1)):o.status===204?c({type:i,payload:{status:!0,title:"Grocery groups loading error",message:o.data.message}}):o.status===500&&c({type:i,payload:{status:!0,title:"Grocery groups error",message:o.data.message}})}).catch(o=>{console.error("Error:",o)})},as=()=>{console.log(k);const s=k+50;console.log(s),W(s),$(s,!0)},os=()=>{const s=k-50;console.log(s),W(s),$(s,!1)},ls=(s,t=null)=>{L(!q),Re(s),t!==null?K(t):console.log("Bonus number not provided")},rs=()=>{const s={bonus:J};console.log(s),y&&d&&f.put(m+"assistant/grocery/group/bonus/"+Fe,s,{headers:{Authorization:`Bearer ${d}`}}).then(t=>{if(t.status===200){console.log("updated"),L(!1);const o=t.data,h=j.find(u=>u.id===o._id);h&&(h.bonus=o.bonus),w([...j])}else t.status===203?(console.log("203"),c({type:i,payload:{status:!0,title:"Bonus Update error",message:t.data.message}})):t.status===204?(console.log("204"),c({type:i,payload:{status:!0,title:"Bonus Update error",message:t.data.message}})):t.status===500&&c({type:i,payload:{status:!0,title:"Bonus Update error",message:t.data.message}})}).catch(t=>{console.error(t)})};a.useEffect(()=>{ns(),cs()},[]);const ns=()=>{d&&f.get(m+"market/groups/dropdown/fetch",{headers:{Authorization:`Bearer ${d}`}}).then(s=>{s.status===200?$e(s.data):s.status===500&&c({type:i,payload:{status:!0,title:"Market Group Loading error",message:s.data.message}})}).catch(s=>{console.error("Error: ",s)})},cs=()=>{d&&f.get(m+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${d}`}}).then(s=>{s.status===200?Ve(s.data):s.status===500&&c({type:i,payload:{status:!0,title:"Chain Loading error",message:s.data.message}})}).catch(s=>{console.error("Error: ",s)})},O=s=>{s==="all"?(ee(""),ne("All Cities")):(ee(s),ne(s))},g=s=>{s==="all"?(te(""),ce("All Status"),v("")):(te(s),ce(s),v(""))},ye=(s,t)=>{s==="all"?(oe(""),ie("All Market Groups")):(oe(s),ie(t))},Ce=(s,t)=>{s==="all"?(re(""),de("All Chains")):(re(s),de(t))};a.useEffect(()=>{is()},[Z,ae,le,alert]);const is=()=>{y&&d&&(he(!0),f.get(m+`assistant/shoppers/:skip?city=${Z}&group=${ae}&chain=${le}`,{headers:{Authorization:`Bearer ${d}`}}).then(s=>{s.status===200?(We(s.data),he(!1)):s.status===500&&c({type:i,payload:{status:!0,title:"Error",message:s.data.message,color:"warning"}})}).catch(s=>{console.error("Error:",s)}))},ds=(s,t,o)=>{R(!F),console.log("Grocery ID",s),Je(o),X(t)},ke=(s,t,o)=>{H(!pe),console.log("picker id",s),console.log("Grocery id",o),X(t),Ze(o),Xe(s)},be=(s,t,o)=>{console.log("bid",s,"PID",t,o);const h={pickerId:t,status:o};console.log(h),y&&d&&f.put(m+"assistant/grocery/group/picker/"+s,h,{headers:{Authorization:`Bearer ${d}`}}).then(u=>{if(u.status===200){console.log("updated",u.data),F&&R(!1),H(!1);const V=u.data,gs=j.map(De=>De.id===V._id?(console.log("matched"),V):De);console.log("update obj",V),w([...gs]),c({type:i,payload:{status:!0,title:"Picker Assign ",message:"Successfully picker assigned to the grocery group",color:"success"}})}else u.status===203?(console.log("203"),c({type:i,payload:{status:!0,title:"Picker Assign error",message:u.data.message}})):u.status===204?(console.log("204"),c({type:i,payload:{status:!0,title:"Picker Assign error",message:u.data.message}})):u.status===500&&c({type:i,payload:{status:!0,title:"Picker Assign error",message:u.data.message}})}).catch(u=>{console.error(u)})},us=s=>{A(!xe),ss(s)},hs=s=>{console.log("status",s),y&&d&&f.put(m+"assistant/grocery/group/status/"+s,{},{headers:{Authorization:`Bearer ${d}`}}).then(t=>{if(t.status===200){console.log("updated",t.data),A(!1);const o=t.data,h=j.find(u=>u.id===o._id);h&&(console.log("done",h),h.status=o.status),w([...j])}else t.status===203?(console.log("203"),c({type:i,payload:{status:!0,title:"Status update error",message:t.data.message}})):t.status===204?(console.log("204"),c({type:i,payload:{status:!0,title:"Status update error",message:t.data.message}})):t.status===500&&c({type:i,payload:{status:!0,title:"Status update error",message:t.data.message}})}).catch(t=>{console.error(t)})},ps=s=>{if(s){const t=ve(s[0],"MM/dd/yyyy HH:mm"),o=ve(s[1],"MM/dd/yyyy HH:mm");fe([t,o])}else fe([])};return e.jsxs(js,{children:[e.jsx(D,{style:{marginLeft:"76%"},color:"secondary",children:"Filter by"}),e.jsxs(P,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[e.jsx(B,{style:{color:"white"},children:Ue}),e.jsxs(T,{children:[e.jsx(n,{onClick:()=>g("all"),children:"All Status"}),e.jsx(n,{onClick:()=>g("created"),children:"Created"}),e.jsx(n,{onClick:()=>g("ready"),children:"Ready"}),e.jsx(n,{onClick:()=>g("finalized"),children:"Finalized"}),e.jsx(n,{onClick:()=>g("freeze"),children:"Freeze"}),e.jsx(n,{onClick:()=>g("forced"),children:"Forced"}),e.jsx(n,{onClick:()=>g("open"),children:"Open"}),e.jsx(n,{onClick:()=>g("completed"),children:"Completed"}),e.jsx(n,{onClick:()=>g("waiting"),children:"Waiting"}),e.jsx(n,{onClick:()=>g("paid "),children:"Paid "})]})]}),e.jsxs(Ee,{style:{marginTop:"1%"},className:"bg-body-tertiary",children:[e.jsx(fs,{style:{marginLeft:1},format:"MM/dd/yyyy HH:mm",onChange:ps}),e.jsx(S,{type:"text",placeholder:"Search By Rider Assign No",style:{width:300,marginLeft:"5%"},value:x,onChange:s=>v(s.target.value)})]}),Le?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(Pe,{style:{marginTop:"15%"}})}):e.jsxs(Ge,{children:[e.jsx(ze,{children:e.jsxs(C,{children:[e.jsx(r,{scope:"col",children:"#"}),e.jsx(r,{scope:"col",children:"No"}),e.jsx(r,{scope:"col",children:"Rider Assign No"}),e.jsx(r,{scope:"col",children:"Rider Status"}),e.jsx(r,{scope:"col",children:"Duration"}),e.jsx(r,{scope:"col",children:"Status"}),e.jsx(r,{scope:"col",children:"Date"}),e.jsx(r,{scope:"col",children:"Bonus"}),e.jsx(r,{scope:"col",children:"Amount"}),e.jsx(r,{scope:"col",children:"Hour"}),e.jsx(r,{scope:"col",children:"Rank"}),e.jsx(r,{scope:"col",children:"Start"}),e.jsx(r,{scope:"col",children:"End"}),e.jsx(r,{scope:"col",children:"Picker"}),e.jsx(r,{scope:"col",children:"Order"}),e.jsx(r,{scope:"col",children:"Order Details"})]})}),e.jsx(Me,{children:j.length===0?e.jsx(C,{children:e.jsx(l,{colSpan:"16",style:{textAlign:"center",backgroundColor:"white"},children:e.jsx("h6",{style:{marginTop:"1%"},children:"No Data"})})}):j.map((s,t)=>e.jsxs(C,{children:[e.jsx(l,{children:k+t+1}),e.jsx(l,{children:s.no}),e.jsx(l,{children:s.ridersAssigningNo}),e.jsx(l,{children:e.jsx(D,{style:{width:80},color:"info",children:s.ridersAssigningStatus})}),e.jsxs(l,{children:[s.duration," min"]}),e.jsx(l,{children:e.jsx(D,{style:{width:80},color:"warning",children:s.status})}),e.jsx(l,{children:s.date}),e.jsxs(l,{children:[s.bonus!=null?s.bonus.toFixed(2):0," ",e.jsx(Be,{to:"",children:e.jsx(Te,{icon:ms,size:"sm",onClick:()=>ls(s.id,s.bonus)})})," "]}),e.jsx(l,{children:s.amount}),e.jsx(l,{children:s.hour}),e.jsx(l,{children:s.rank+1}),e.jsx(l,{children:s.start}),e.jsx(l,{children:s.end}),e.jsx(l,{children:s.shopper?e.jsx(p,{onClick:()=>ds(s.id,s.status,s),size:"sm",style:{width:80,backgroundColor:"#ff4d4d",color:"white"},children:"View"}):e.jsx(p,{onClick:()=>ke(s.accepted,s.status,s.id),size:"sm",style:{width:80,backgroundColor:"#ff4d4d",color:"white"},children:"Add"})}),e.jsx(l,{children:s.status==="complete"?e.jsx(p,{size:"sm",disabled:!0,style:{width:80,backgroundColor:"#ff4d4d",color:"white"},children:"Cancel"}):s.status==="canceled"?e.jsx(p,{size:"sm",disabled:!0,style:{width:80,backgroundColor:"#ff4d4d",color:"white"},children:"Cancel"}):e.jsx(p,{onClick:()=>us(s.id),size:"sm",style:{width:80,backgroundColor:"#ff4d4d",color:"white"},children:"Cancel"})}),e.jsx(l,{children:e.jsx(Be,{to:`/order/grocerygroup/orders/${s.id}`,children:e.jsx(Te,{icon:ys,size:"xl"})})})]},t))})]}),e.jsxs(Cs,{"aria-label":"Page navigation example",children:[e.jsx(Ne,{disabled:k<=50,onClick:os,children:"Previous"}),e.jsx(Ne,{disabled:ts===!0,onClick:as,children:"Next"})]}),e.jsxs(E,{alignment:"center",visible:q,scrollable:!0,size:"sm",onClose:()=>L(!1),children:[e.jsx(G,{closeButton:!0,children:e.jsx(z,{children:"Confirmation"})}),e.jsxs(M,{children:[e.jsx("a",{children:"Enter Bonus Amount"}),e.jsx("br",{}),e.jsx(S,{type:"text",placeholder:"Bonus",value:J,onChange:s=>K(s.target.value)})]}),e.jsx(_,{children:e.jsx(p,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>rs(),children:"Save changes"})})]}),e.jsxs(E,{alignment:"center",visible:F,scrollable:!0,size:"lg",onClose:()=>R(!1),children:[e.jsx(G,{closeButton:!0,children:e.jsx(z,{children:"Picker Information"})}),e.jsx(M,{style:{overflowY:"auto",maxHeight:"70vh",display:"flex",justifyContent:"center"},children:e.jsx("div",{children:e.jsxs(ks,{className:"mb-3",children:[e.jsx(U,{htmlFor:"staticEmail",className:"col-sm-2 col-form-label",children:"Name"}),e.jsx(Q,{sm:10,children:e.jsx(S,{type:"text",defaultValue:(Se=b.shopper)==null?void 0:Se.name,readOnly:!0,plainText:!0})}),e.jsx(U,{htmlFor:"staticEmail",className:"col-sm-2 col-form-label",children:"Email"}),e.jsx(Q,{sm:10,children:e.jsx(S,{type:"text",defaultValue:(we=b.shopper)==null?void 0:we.email,readOnly:!0,plainText:!0})}),e.jsx(U,{htmlFor:"staticEmail",className:"col-sm-2 col-form-label",children:"Contact"}),e.jsx(Q,{sm:10,children:e.jsx(S,{type:"text",defaultValue:(Ae=b.shopper)==null?void 0:Ae.contact,readOnly:!0,plainText:!0})})]})})}),e.jsx(_,{children:e.jsx(p,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>{var s;return ke((s=b.shopper)==null?void 0:s.id,I,b.id)},children:"Change"})})]}),e.jsxs(E,{alignment:"center",visible:pe,scrollable:!0,size:"xl",onClose:()=>H(!1),children:[e.jsx(G,{closeButton:!0,children:e.jsx(z,{children:"Picker Assing to the Grocery Batch"})}),e.jsxs(M,{children:[e.jsx(D,{style:{marginLeft:"37%"},color:"secondary",children:"Filter by"}),e.jsxs(P,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[e.jsx(B,{style:{color:"white"},children:_e}),e.jsxs(T,{children:[e.jsx(n,{onClick:()=>O("all"),children:"All"}),e.jsx(n,{onClick:()=>O("Milan"),children:"Milan"}),e.jsx(n,{onClick:()=>O("Napoli"),children:"Napoli"})]})]}),e.jsxs(P,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[e.jsx(B,{style:{color:"white"},children:Ye}),e.jsxs(T,{children:[e.jsx(n,{onClick:()=>Ce("all"),children:"All"}),Oe.map((s,t)=>e.jsx(n,{onClick:()=>Ce(s.id,s.name),children:s.name},t))]})]}),e.jsxs(P,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[e.jsx(B,{style:{color:"white"},children:Qe}),e.jsxs(T,{children:[e.jsx(n,{onClick:()=>ye("all"),children:"All"}),He.map((s,t)=>e.jsx(n,{onClick:()=>ye(s._id,s.name),children:s.name},t))]})]}),e.jsx(Ee,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),qe?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(Pe,{style:{marginTop:"15%"}})}):e.jsxs(Ge,{children:[e.jsx(ze,{children:e.jsxs(C,{children:[e.jsx(r,{scope:"col",children:"#"}),e.jsx(r,{scope:"col",children:"First Name"}),e.jsx(r,{scope:"col",children:"Last Name"}),e.jsx(r,{scope:"col",children:"Email"}),e.jsx(r,{scope:"col",children:"Phone"}),e.jsx(r,{scope:"col",children:"Country"}),e.jsx(r,{scope:"col",children:"City"}),e.jsx(r,{scope:"col",children:"Language"}),e.jsx(r,{scope:"col",children:"Market"}),e.jsx(r,{scope:"col",children:"Action"})]})}),e.jsx(Me,{children:ue.length===0?e.jsx(C,{children:e.jsx(l,{colSpan:"10",style:{textAlign:"center",backgroundColor:"white"},children:e.jsx("h6",{style:{marginTop:"1%"},children:"No Data"})})}):ue.map((s,t)=>{var o,h;return e.jsxs(C,{children:[e.jsx(l,{children:t+1}),e.jsx(l,{children:s.name}),e.jsx(l,{children:s.surname}),e.jsx(l,{children:s.email}),e.jsx(l,{children:s.contact}),e.jsx(l,{children:s.country==="it"||s.country==="Italy"?"Italy":s.country}),e.jsx(l,{children:s.city}),e.jsx(l,{children:s.language==="en"?"English":s.language==="it"?"Italy":s.language==="es"?"Spanish":s.language}),e.jsxs(l,{children:[(h=(o=s.market)==null?void 0:o.chain)==null?void 0:h.name," - ",s.market.address]}),e.jsx(l,{children:s.id===Ke?e.jsx(p,{size:"sm",onClick:()=>be(ge,s.id,I),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Assigned"}):e.jsx(p,{size:"sm",onClick:()=>be(ge,s.id,I),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Add"})})]},t)})})]})]}),e.jsx(_,{})]}),e.jsxs(E,{alignment:"center",visible:xe,scrollable:!0,size:"sm",onClose:()=>A(!1),children:[e.jsx(G,{closeButton:!0,children:e.jsx(z,{children:"Confirmation"})}),e.jsxs(M,{children:[e.jsx("a",{children:"Are you sure you want to cancel this grocery group order?"}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[e.jsx(p,{onClick:()=>hs(es),style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),e.jsx(p,{onClick:()=>A(!1),style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]})]})};export{Vs as default};
