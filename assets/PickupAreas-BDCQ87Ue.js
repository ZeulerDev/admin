import{r as t,y as ge,A as n,j as e,i as xe,L as fe,m as F}from"./index-D57LfKhM.js";import{a as S}from"./axios-Cm0UX6qg.js";import{F as Ce,E as ye}from"./leaflet.draw--EgSj_yb.js";import{c as je,l as be,b as ke,e as Pe,M as Se,T as we,a as Me,P as Ne}from"./leaflet-DglrQg5c.js";import{B as w}from"./config-HOLfLxHr.js";import{b as Ae,a as M}from"./CContainer-BtQ2t7b-.js";import{d as R,C as _,a as $,b as G,c as d}from"./DefaultLayout-DwIbSn6R.js";import{C as V}from"./CNavbar-BnBXOJLU.js";import{C as De,a as ve,b as H,c as m,d as Le,e as g}from"./CTable-CoFhlMIc.js";import{c as Te}from"./cil-pencil-m516yCOw.js";import{C as Ee,a as U}from"./CPaginationItem-i-eaqhFP.js";import{C as O,a as W,b as Z,c as q}from"./CModalTitle-w8bCTZR7.js";import{c as Be}from"./cil-info-CmGCY32x.js";import{C as J}from"./CModalFooter-CCBv7jOZ.js";import{C as ze}from"./CFormInput-DLdREMBa.js";import"./index-B_vnaIPa.js";import"./CFormLabel-UW7-bZhj.js";const Ie=je(function({positions:i,...r},l){const p=new be.Polygon(i,r);return ke(p,Pe(l,{overlayContainer:p}))},function(i,r,l){r.positions!==l.positions&&i.setLatLngs(r.positions)}),ea=()=>{const x=t.useRef(null),[{user:i,token:r},l]=ge(),[p,K]=t.useState([]),[N,A]=t.useState(""),[f,D]=t.useState(0),[Q,v]=t.useState("All Cities"),[X,L]=t.useState(!1),[Y,T]=t.useState(!0),[ee,C]=t.useState(!1),[ae,y]=t.useState(!1),[te,se]=t.useState([]),[j,oe]=t.useState("Napoli"),[E,re]=t.useState([]),[b,le]=t.useState([]),[k,P]=t.useState(""),[u,B]=t.useState(""),[ie,z]=t.useState("");t.useEffect(()=>{i&&r&&h(0)},[N,i]);const h=(a,s)=>{L(!0),S.get(w+`pickups/areas/${a}?city=${N}`,{headers:{Authorization:`Bearer ${r}`}}).then(o=>{o.status===200?(K(o.data),L(!1),o.data.length<20?(T(!0),console.log("ok")):o.data.length>19&&T(!1)):o.status===500&&l({type:n,payload:{status:!0,title:"Market Loading error",message:o.data.message}})}).catch(o=>{console.error("Error: ",o)})},ne=()=>{const a=f+20;D(a),h(a)},ce=()=>{const a=f-20;console.log(a),D(a),h(a)},c=a=>{a==="all"?(A(""),v("All Cities")):(A(a),v(a),oe(a))},de=(a,s)=>{C(!0),re(a),P(s),console.log(a)},pe=(a,s)=>{y(!0),P(a),z(s),console.log(s)};t.useEffect(()=>{i&&r&&S.get(w+`assistant/markets/groups/locations/pickup/${j}`,{headers:{Authorization:`Bearer ${r}`}}).then(a=>{a.status===200?se(a.data):a.status===500&&l({type:n,payload:{status:!0,title:"Market Group loading error",message:a.data.message}})}).catch(a=>{console.error("Error:",a)})},[i,j]);const ue=a=>{const s=a.layer;console.log("layer",s._latlngs),le(s._latlngs)},I=a=>{if(a){let s={};b&&(s={area:b}),u&&(s={name:u}),console.log(s,a),i&&r&&S.put(w+"pickup/area/update/"+a,s,{headers:{Authorization:`Bearer ${r}`}}).then(o=>{o.status===200?(l({type:n,payload:{status:!0,title:"Pickup Area Update",message:"Pick up area update Success",color:"success"}}),P(""),B(""),h(0),C(!1),y(!1),z("")):o.status===204?l({type:n,payload:{status:!0,title:"Pick up area update  error",message:o.data.message,color:"danger"}}):o.status===500&&l({type:n,payload:{status:!0,title:"Pick up area update  error",message:o.data.message,color:"danger"}})}).catch(o=>{console.error("Error:",o)})}else alert("Please Check the Fields!")},he=()=>{b==""?l({type:n,payload:{status:!0,title:"Alert",message:"Please select the area",color:"danger"}}):I(k)},me=()=>{u==""&&k==""?l({type:n,payload:{status:!0,title:"Alert",message:"Please Name",color:"danger"}}):I(k)};return e.jsxs(Ae,{children:[e.jsx(R,{style:{marginLeft:"75.5%"},color:"secondary",children:"Filter by"}),e.jsxs(_,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[e.jsx($,{style:{color:"white"},children:Q}),e.jsxs(G,{children:[e.jsx(d,{onClick:()=>c("all"),children:"All"}),e.jsx(d,{onClick:()=>c("Milano"),children:"Milano"}),e.jsx(d,{onClick:()=>c("Napoli"),children:"Napoli"})]})]}),e.jsx(V,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),X?e.jsx(xe,{}):e.jsxs(De,{children:[e.jsx(ve,{children:e.jsxs(H,{children:[e.jsx(m,{scope:"col",children:"Name"}),e.jsx(m,{scope:"col",children:"Type"}),e.jsx(m,{scope:"col",children:"City"}),e.jsx(m,{scope:"col",children:"View"})]})}),e.jsx(Le,{children:p.map((a,s)=>e.jsxs(H,{children:[e.jsxs(g,{children:[a.name," ",e.jsx(fe,{to:"",children:e.jsx(F,{icon:Te,size:"sm",onClick:()=>pe(a._id,a.name)})})," "]}),e.jsx(g,{children:a.geometry.type}),e.jsx(g,{children:a.city}),e.jsx(g,{children:e.jsx(M,{size:"sm",style:{backgroundColor:"#ff4d4d",color:"white"},variant:"outline",onClick:()=>de(a.geometry.coordinate,a._id),children:"View map"})})]},s))})]}),e.jsxs(Ee,{"aria-label":"Page navigation example",children:[e.jsx(U,{disabled:f<=0,onClick:ce,children:"Previous"}),e.jsx(U,{disabled:Y===!0,onClick:ne,children:"Next"})]}),e.jsxs(O,{alignment:"center",visible:ee,scrollable:!0,size:"xl",onClose:()=>C(!1),children:[e.jsx(W,{closeButton:!0,children:e.jsx(Z,{children:"Map View"})}),e.jsxs(q,{children:[e.jsx(R,{style:{marginLeft:"81.5%"},color:"secondary",children:"Filter by"}),e.jsxs(_,{style:{marginLeft:"2%",width:"10%",backgroundColor:"#ff4d4d"},children:[e.jsx($,{style:{color:"white"},children:j}),e.jsxs(G,{children:[e.jsx(d,{onClick:()=>c("Milano"),children:"Milano"}),e.jsx(d,{onClick:()=>c("Napoli"),children:"Napoli"})]})]}),e.jsx(V,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),e.jsxs(Se,{dragging:!0,center:[40.85631,14.24641],zoom:13,scrollWheelZoom:!0,style:{height:"500px",width:"100%"},children:[e.jsx(we,{attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),te.map((a,s)=>e.jsx(Me,{position:[a.lat,a.lng],children:e.jsx(Ne,{children:e.jsxs("div",{children:[e.jsx(F,{icon:Be,size:"lg",style:{marginLeft:"10px"}})," ",e.jsx("span",{children:a.address})]})})},s)),E.length>0&&e.jsx(Ie,{positions:E}),e.jsx(Ce,{ref:x,children:e.jsx(ye,{position:"topright",onCreated:ue,draw:{polygon:!0,circle:!0,polyline:!0,marker:!1,circlemarker:!1}})})]})]}),e.jsx(J,{children:e.jsx(M,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>he(),children:"Save updated area"})})]}),e.jsxs(O,{alignment:"center",visible:ae,scrollable:!0,size:"sm",onClose:()=>y(!1),children:[e.jsx(W,{closeButton:!0,children:e.jsx(Z,{children:"Change Name"})}),e.jsxs(q,{children:[e.jsx("a",{children:"Enter New Name"}),e.jsx("br",{}),e.jsx(ze,{type:"text",placeholder:ie,value:u,onChange:a=>B(a.target.value)})]}),e.jsx(J,{children:e.jsx(M,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>me(),children:"Save changes"})})]})]})};export{ea as default};
