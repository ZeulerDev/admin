import{y as Ke,r as s,A as n,j as a,h as We,L as Xe,m as Ye}from"./index-B08OXeWv.js";import{a as h}from"./axios-Cm0UX6qg.js";import{B as p}from"./config-HOLfLxHr.js";import{b as Ze,a as oe}from"./CContainer-Bcycrjrg.js";import{C as ea,a as P,b as M,c as D,d as g}from"./DefaultLayout-ZVM7TRL_.js";import{C as aa}from"./CNavbar-CI1ooECg.js";import{C as le}from"./CFormInput-BdPiiS44.js";import{C as ta,a as sa,b as ne,c,d as ra,e as m}from"./CTable-isbk2Vch.js";import{C as ce}from"./CCardImage-BV2__KTV.js";import{c as oa}from"./cil-pencil-m516yCOw.js";import{C as la,a as R}from"./CPaginationItem-BtMnBLEs.js";import{C as ie,a as de,b as ue,c as ge}from"./CModalTitle-BEzJ5tl5.js";import{C as he}from"./CModalFooter-CT0DeHo_.js";import"./CFormLabel-SAczgcRM.js";const ka=()=>{const[{user:x,token:o},l]=Ke(),[pe,C]=s.useState(!1),[me,Ce]=s.useState([]),[j,I]=s.useState(0),[fe,y]=s.useState(!0),[xe,je]=s.useState([]),[ye,A]=s.useState("All Chains"),[w,b]=s.useState("All market"),[F,E]=s.useState(""),[Q,S]=s.useState(""),[be,H]=s.useState([]),[i,Se]=s.useState(""),[ke,V]=s.useState(i),[Pe,L]=s.useState(!1),[Me,_]=s.useState(""),[N,O]=s.useState(""),[De,q]=s.useState(""),[Ie,Ae]=s.useState(0),[k,U]=s.useState(1);s.useState("NAME");const[G,B]=s.useState(!1),[we,J]=s.useState(""),[Ee,v]=s.useState("All Main Categories"),[na,T]=s.useState(""),[Le,Ne]=s.useState([]),[Ue,$]=s.useState(""),[Be,K]=s.useState("Select Main Categories"),[W,X]=s.useState(""),[ve,Y]=s.useState([]);s.useEffect(()=>{x&&o&&f(0)},[x,o,Q,ke,W,F]),s.useEffect(()=>{const e=setTimeout(()=>{(i.length>=3||i.length===0)&&V(i)},500);return()=>{clearTimeout(e)}},[i]),s.useEffect(()=>{o&&h.get(p+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${o}`}}).then(e=>{e.status===200?je(e.data):e.status===500&&l({type:n,payload:{status:!0,title:"Chain Loading error",message:e.data.message}})}).catch(e=>{console.error("Error: ",e)})},[]),s.useEffect(()=>{o&&h.get(p+"product/categories",{headers:{Authorization:`Bearer ${o}`}}).then(e=>{e.status===200?(console.log(e.data[1]),Ne(e.data)):e.status===500&&l({type:n,payload:{status:!0,title:"Main Category Loading error",message:"Main Category loading error"}})}).catch(e=>{console.error("Error: ",e)})},[]);const Te=e=>{h.get(p+`assistant/market/locations?brand=${e}`,{headers:{Authorization:`Bearer ${o}`}}).then(t=>{t.status===200?(H(t.data.data),t.data.data.length<20?(y(!0),console.log("ok")):t.data.data.length>19&&y(!1)):t.status===500&&l({type:n,payload:{status:!0,title:"Market Loading error",message:t.data.message}})}).catch(t=>{console.error("Error: ",t)})},f=(e,t)=>{C(!0),h.get(p+`product/category/all/${e}?marketId=${Q}&name=${i}&category=${W}&mainCategory=${Ue}&chainId=${F}`,{headers:{Authorization:`Bearer ${o}`}}).then(r=>{r.status===200?(Ce(r.data.list),Ae(r.data.count),C(!1),r.data.list.length<20?(y(!0),console.log("ok")):r.data.list.length>19&&y(!1)):r.status===203?(C(!1),l({type:n,payload:{status:!0,title:"product loading error error",message:r.data.message}})):r.status===204?(C(!1),l({type:n,payload:{status:!0,title:"No Products",message:"No products found in this market address",color:"info"}})):r.status===500&&(C(!1),l({type:n,payload:{status:!0,title:"product loading error error",message:r.data.message}}))}).catch(r=>{C(!1),console.error("Error:",r)})},Z=(e,t)=>{e==="all"?(T(""),v("All Main Categories"),$("")):(T(e),$e(e),v(t),$(e))},$e=e=>{o&&h.get(p+"product/categories/sub/"+e,{headers:{Authorization:`Bearer ${o}`}}).then(t=>{t.status===200?Y(t.data):t.status===500&&l({type:n,payload:{status:!0,title:"Sub Category Loading",message:"Sub Category loading error"}})}).catch(t=>{console.error("Error: ",t)})},ee=(e,t)=>{e==="all"?(X(""),K("Select Main Categories"),T(""),v("All Main Categories"),Y([]),$("")):(console.log("index",e),X(e),K(t))},ae=(e,t)=>{e==="all"?(E(""),A("All Chains"),S(""),b("All Markets")):(E(e),Te(e),A(t),S(""),b("All Markets"))},te=(e,t)=>{e==="all"?(S(""),b("All Markets"),E(""),A("All Chains"),H([])):(S(e),b(t))},ze=()=>{U(k+1);const e=j+50;I(e),f(e)},Re=()=>{U(k-1);const e=j-50;console.log(e),I(e),f(e)},Fe=(e,t)=>{L(!0),_(e),q(t)},Qe=()=>{console.log("called"),N==""?l({type:n,payload:{status:!0,title:"Alert",message:"Please enter the price",color:"warning"}}):_e(Me)},He=e=>{U(e);const t=(e-1)*50;I(t),f(t)},Ve=()=>{const e=Math.ceil(Ie/50),t=[];for(let u=1;u<=e;u++)t.push(u);const r=Math.max(k-2,1),d=Math.min(r+4,e);return t.slice(r-1,d).map(u=>a.jsx(R,{active:k===u,onClick:()=>He(u),children:u},u))},_e=e=>{if(e){let t={price:N+" â‚¬"};x&&o&&h.put(p+"product/update/price/"+e,t,{headers:{Authorization:`Bearer ${o}`}}).then(r=>{r.status===200?(l({type:n,payload:{status:!0,title:"Product Details Update",message:"Product price update Success",color:"success"}}),_(""),O(""),f(0),L(!1),q("")):r.status===204?l({type:n,payload:{status:!0,title:"Product Details Update error",message:r.data.message,color:"danger"}}):r.status===500&&l({type:n,payload:{status:!0,title:"Product Details Update error",message:r.data.message,color:"danger"}})}).catch(r=>{console.error("Error:",r)})}else alert("Please Check the Fields!")},Oe=e=>{B(!G),J(e)},[qe,z]=s.useState(null),[se,re]=s.useState(null),Ge=e=>{console.log(e),re(URL.createObjectURL(e)),z(e)},Je=async(e,t)=>{if(console.log(e,t),x&&o){const r=new FormData;r.append("image",t),r.append("id",e),h.post(p+"test/product/image/update",r,{headers:{Authorization:`Bearer ${o}`}}).then(d=>{d.status===200?(B(!1),J(""),z(null),console.log("response",d.data),l({type:n,payload:{status:!0,title:"Image upload ",message:"Image upload success",color:"success"}}),f(0)):d.status===500&&l({type:n,payload:{status:!0,title:"Image upload error",message:d.data.message,color:"danger"}})}).catch(d=>{console.error("Error:",d)})}};return a.jsxs(Ze,{children:[a.jsx(ea,{style:{marginLeft:"14%"},color:"secondary",children:"Filter by"}),a.jsxs(P,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d"},children:[a.jsx(M,{children:Ee}),a.jsxs(D,{children:[a.jsx(g,{onClick:()=>Z("all"),children:"All Main Category"}),Le.map((e,t)=>a.jsx(g,{onClick:()=>Z(t,e),children:e},t))]})]}),a.jsxs(P,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d"},children:[a.jsx(M,{children:Be}),a.jsxs(D,{children:[a.jsx(g,{onClick:()=>ee("all"),children:"Clear Category"}),ve.map((e,t)=>a.jsx(g,{onClick:()=>ee(t,e),children:e},t))]})]}),a.jsxs(P,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d"},children:[a.jsx(M,{children:ye}),a.jsxs(D,{children:[a.jsx(g,{onClick:()=>ae("all"),children:"All"}),xe.map((e,t)=>a.jsx(g,{onClick:()=>ae(e.id,e.name),children:e.name},t))]})]}),a.jsxs(P,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d"},children:[a.jsx(M,{children:w.length>15?`${w.substring(0,15)}...`:w}),a.jsxs(D,{children:[a.jsx(g,{onClick:()=>te("all"),children:"Select the Chain"}),be.map((e,t)=>a.jsx(g,{onClick:()=>te(e._id,e.address),children:a.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[a.jsx("span",{children:e.address.substring(0,e.address.length/2)}),a.jsx("span",{children:e.address.substring(e.address.length/2)})]})},t))]})]}),a.jsx(aa,{style:{marginTop:"1%"},className:"bg-body-tertiary",children:a.jsx(le,{type:"text",placeholder:"Search products by name, brand name and product id",style:{width:450,marginRight:"50%"},value:i,onChange:e=>Se(e.target.value)})}),pe?a.jsx(We,{}):a.jsxs(ta,{children:[a.jsx(sa,{children:a.jsxs(ne,{children:[a.jsx(c,{scope:"col",children:"#"}),a.jsx(c,{scope:"col",children:"Product Id"}),a.jsx(c,{scope:"col",children:"Photo"}),a.jsx(c,{scope:"col",children:"Name"}),a.jsx(c,{scope:"col",children:"Price"}),a.jsx(c,{scope:"col",children:"Brand"}),a.jsx(c,{scope:"col",children:"Chain"}),a.jsx(c,{scope:"col",children:"Market Address"})]})}),a.jsx(ra,{children:me.map((e,t)=>a.jsxs(ne,{children:[a.jsx(m,{children:j+t+1}),a.jsx(m,{children:e.pid}),a.jsx(c,{onClick:()=>{Oe(e.productId)},children:a.jsx(ce,{style:{width:"50px",height:"50px"},src:"https://api.zeuler.com/image/"+e.image})}),a.jsx(m,{children:e.name}),a.jsxs(m,{children:[e.price,a.jsx(Xe,{to:"",children:a.jsx(Ye,{icon:oa,size:"sm",onClick:()=>Fe(e.productId,e.price)})})]}),a.jsx(m,{children:e.brand}),a.jsx(m,{children:e.chainName}),a.jsx(m,{children:e.marketAddress})]},t))})]}),a.jsxs(la,{"aria-label":"Page navigation example",children:[a.jsx(R,{disabled:j<=0,onClick:Re,children:"Previous"}),Ve(),a.jsx(R,{disabled:fe===!0,onClick:ze,children:"Next"})]}),a.jsxs(ie,{alignment:"center",visible:Pe,scrollable:!0,size:"sm",onClose:()=>L(!1),children:[a.jsx(de,{closeButton:!0,children:a.jsx(ue,{children:"Change Price"})}),a.jsxs(ge,{children:[a.jsx("a",{children:"Enter New Name"}),a.jsx("br",{}),a.jsx(le,{type:"text",placeholder:De,value:N,onChange:e=>O(e.target.value)})]}),a.jsx(he,{children:a.jsx(oe,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>Qe(),children:"Save changes"})})]}),a.jsxs(ie,{alignment:"center",visible:G,scrollable:!0,size:"lg",onClose:()=>{B(!1),z(null),re(null)},children:[a.jsx(de,{closeButton:!0,children:a.jsx(ue,{children:"Image Uploader"})}),a.jsxs(ge,{children:[se&&a.jsx(ce,{style:{width:"100px",height:"100px"},src:se,alt:"Uploaded Image"}),a.jsx("input",{style:{marginLeft:"5%"},type:"file",accept:".jpg, .jpeg, .png",onChange:e=>Ge(e.target.files[0])})]}),a.jsx(he,{children:a.jsx(oe,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>{Je(we,qe)},children:"Upload Image"})})]})]})};export{ka as default};
