import{r as s,y as De,A as i,j as e,L as b,h as ke,m as P}from"./index-D3QfJGEc.js";import{a as S}from"./axios-Cm0UX6qg.js";/* empty css               */import{B as D}from"./config-HOLfLxHr.js";import{b as ve,a as d}from"./CContainer-SkiLYL4n.js";import{C as we}from"./CNavbar-DrnOaIAd.js";import{C as f}from"./CFormInput-kbUX0XsV.js";import{C as Ae,a as Te,b as L,c as u,d as Le,e as n}from"./CTable-0Zi6KOL_.js";import{c as Ee}from"./cil-pencil-m516yCOw.js";import{c as Ne}from"./cil-trash-CBbKHhHb.js";import{C as ze,a as E}from"./CPaginationItem-WVPg8jye.js";import{C as N,a as z,b as M,c as _}from"./CModalTitle-CePgAe4s.js";import{C as k}from"./CCol-DHqhZLst.js";import"./CFormLabel-WCNlfVmk.js";import"./DefaultLayout-D1JUfsyf.js";var ie=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M245.151,168a88,88,0,1,0,88,88A88.1,88.1,0,0,0,245.151,168Zm0,144a56,56,0,1,1,56-56A56.063,56.063,0,0,1,245.151,312Z' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M464.7,322.319l-31.77-26.153a193.081,193.081,0,0,0,0-80.332l31.77-26.153a19.941,19.941,0,0,0,4.606-25.439l-32.612-56.483a19.936,19.936,0,0,0-24.337-8.73l-38.561,14.447a192.038,192.038,0,0,0-69.54-40.192L297.49,32.713A19.936,19.936,0,0,0,277.762,16H212.54a19.937,19.937,0,0,0-19.728,16.712L186.05,73.284a192.03,192.03,0,0,0-69.54,40.192L77.945,99.027a19.937,19.937,0,0,0-24.334,8.731L21,164.245a19.94,19.94,0,0,0,4.61,25.438l31.767,26.151a193.081,193.081,0,0,0,0,80.332l-31.77,26.153A19.942,19.942,0,0,0,21,347.758l32.612,56.483a19.937,19.937,0,0,0,24.337,8.73l38.562-14.447a192.03,192.03,0,0,0,69.54,40.192l6.762,40.571A19.937,19.937,0,0,0,212.54,496h65.222a19.936,19.936,0,0,0,19.728-16.712l6.763-40.572a192.038,192.038,0,0,0,69.54-40.192l38.564,14.449a19.938,19.938,0,0,0,24.334-8.731L469.3,347.755A19.939,19.939,0,0,0,464.7,322.319Zm-50.636,57.12-48.109-18.024-7.285,7.334a159.955,159.955,0,0,1-72.625,41.973l-10,2.636L267.6,464h-44.89l-8.442-50.642-10-2.636a159.955,159.955,0,0,1-72.625-41.973l-7.285-7.334L76.241,379.439,53.8,340.562l39.629-32.624-2.7-9.973a160.9,160.9,0,0,1,0-83.93l2.7-9.972L53.8,171.439l22.446-38.878,48.109,18.024,7.285-7.334a159.955,159.955,0,0,1,72.625-41.973l10-2.636L222.706,48H267.6l8.442,50.642,10,2.636a159.955,159.955,0,0,1,72.625,41.973l7.285,7.334,48.109-18.024,22.447,38.877-39.629,32.625,2.7,9.972a160.9,160.9,0,0,1,0,83.93l-2.7,9.973,39.629,32.623Z' class='ci-primary'/>"];const Je=()=>{var oe,le;const[B,x]=s.useState(!1),[I,j]=s.useState(!1),[{user:y,token:h},l]=De(),[v,$]=s.useState([]),[ne,w]=s.useState(!1);s.useState(""),s.useState(""),s.useState("");const[m,ce]=s.useState(""),[de,R]=s.useState(m),[V,H]=s.useState(!1),[Q,Z]=s.useState("");s.useState("All Cities"),s.useState("All Market Groups"),s.useState("All Chains"),s.useState([]),s.useState([]);const[U,A]=s.useState(!1),[p,ue]=s.useState([]),[Y,q]=s.useState(),[F,G]=s.useState(),[J,K]=s.useState(),[W,X]=s.useState();s.useState(""),s.useState(""),s.useState(!1);const[he,O]=s.useState(!0),[me,pe]=s.useState(0),[C,ee]=s.useState(1),[T,te]=s.useState(0),[ge,se]=s.useState("");s.useEffect(()=>{const t=setTimeout(()=>{l({type:i,payload:{status:!0,title:"Data Loading",message:"Data loading error: Timeout exceeded",color:"warning"}}),w(!1)},2e4);return g(0,t),()=>{clearTimeout(t)}},[de]),s.useEffect(()=>{const t=setTimeout(()=>{(m.length>=3||m.length===0)&&R(m)},500);return()=>{clearTimeout(t)}},[m]);const g=(t,a)=>{if(y&&h){w(!0);let o=D+`promotion/all/${t}?name=${m}`;S.get(o,{headers:{Authorization:`Bearer ${h}`}}).then(r=>{r.status===200?($(r.data.list),console.log("result",r.data.list),pe(r.data.count),w(!1),clearTimeout(a),r.data.list.length<20?(O(!0),console.log("ok")):r.data.list.length>19&&O(!1)):r.status===500&&l({type:i,payload:{status:!0,title:"Error",message:r.data.message,color:"warning"}})}).catch(r=>{console.error("Error:",r)})}},fe=()=>{ee(C+1);const t=T+50;te(t),g(t,!0)},xe=()=>{ee(C-1);const t=T-50;console.log(t),te(t),g(t,!1)},je=()=>{const t=Math.ceil(me/20),a=[];for(let c=1;c<=t;c++)a.push(c);const o=Math.max(C-2,1),r=Math.min(o+4,t);return a.slice(o-1,r).map(c=>e.jsx(E,{active:C===c,onClick:()=>handlePages(c),children:c},c))},ae=(t,a)=>{x(!B),H(a),Z(t)},ye=()=>{const t={status:V};console.log(Q,t),y&&h&&S.patch(D+"promotion/update/status/"+Q,t,{headers:{Authorization:`Bearer ${h}`}}).then(a=>{a.status===200?(console.log("updated"),x(!1),H(""),Z(""),g(0),l({type:i,payload:{status:!0,title:"Promotion status update",message:"Promotion status updated successfully",color:"success"}})):a.status===404?l({type:i,payload:{status:!0,title:"Promotion status update error",message:a.data.message}}):a.status===400?l({type:i,payload:{status:!0,title:"Promotion status update error",message:a.data.message}}):a.status===500&&l({type:i,payload:{status:!0,title:"Picker status update error",message:a.data.message}})}).catch(a=>{console.error(a)})},Ce=t=>{console.log(t),ue(t),A(!U),q(t.name),G(t.startDate),K(t.endDate),X(t.promo_id)},be=()=>{if(Y&&F&&J&&W){const t={name:Y,startDate:F,endDate:J,promo_id:W},a=p._id;console.log(t,a),h&&y&&h&&S.put(D+"promotion/update/"+a,t,{headers:{Authorization:`Bearer ${h}`}}).then(o=>{if(o.status===200){console.log(o.data),A(!1);const r=o.data,re=v.map(c=>c._id===r._id?(console.log("update obj"),r):c);$([...re]),l({type:i,payload:{status:!0,title:"Promotion update",message:"Promotion details updated successfully",color:"success"}})}else o.status===404?l({type:i,payload:{status:!0,title:"Promotion update error",message:"Missing required fields",color:"warning"}}):o.status===400?l({type:i,payload:{status:!0,title:"Promotion update error",message:o.data.message,color:"warning"}}):o.status===500&&l({type:i,payload:{status:!0,title:"Promotion update error",message:o.data.message,color:"warning"}})}).catch(o=>{console.error("Error:",o)})}else l({type:i,payload:{status:!0,title:"Error!",message:"Picker update error, Please Check the input fields",color:"warning"}})},Pe=t=>{j(!I),se(t)},Se=t=>{const a={disabled:!0};console.log(t,a),y&&h&&S.patch(D+"promotion/delete/"+t,a,{headers:{Authorization:`Bearer ${h}`}}).then(o=>{o.status===200?(console.log("updated"),j(!1),se(""),g(),l({type:i,payload:{status:!0,title:"Promotion Delete",message:"Promotion delete successfully",color:"success"}})):o.status===404?l({type:i,payload:{status:!0,title:"Promotion delete error",message:o.data.message}}):o.status===400?l({type:i,payload:{status:!0,title:"Promotion delete error",message:o.data.message}}):o.status===500&&l({type:i,payload:{status:!0,title:"Picker delete error",message:o.data.message}})}).catch(o=>{console.error(o)})};return e.jsxs(ve,{children:[e.jsx(b,{to:"/promotions/add/promotion",className:"picker-link",children:e.jsx(d,{style:{marginLeft:"0%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Add Promotion"})}),e.jsx(we,{style:{marginTop:"1%"},className:"bg-body-tertiary",children:e.jsx(f,{type:"text",placeholder:"Search by Promotion by name",className:"picker-input",value:m,style:{width:480,marginLeft:"0%"},onChange:t=>ce(t.target.value)})}),ne?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(ke,{style:{marginTop:"15%"}})}):e.jsxs(Ae,{children:[e.jsx(Te,{children:e.jsxs(L,{children:[e.jsx(u,{scope:"col",children:"#"}),e.jsx(u,{scope:"col",children:"Promotion Id"}),e.jsx(u,{scope:"col",children:"Name"}),e.jsx(u,{scope:"col",children:"Start Date"}),e.jsx(u,{scope:"col",children:"End Date"}),e.jsx(u,{scope:"col",children:"Status"}),e.jsx(u,{scope:"col",children:"Manage Markets"}),e.jsx(u,{scope:"col",children:"Manage Products"}),e.jsx(u,{scope:"col",children:"Edit"}),e.jsx(u,{scope:"col",children:"Edit Status"}),e.jsx(u,{scope:"col",children:"Action"})]})}),e.jsx(Le,{children:v.length===0?e.jsx(L,{children:e.jsx(n,{colSpan:"11",style:{textAlign:"center",backgroundColor:"white"},children:e.jsx("h6",{style:{marginTop:"1%"},children:"No Data"})})}):v.map((t,a)=>e.jsxs(L,{children:[e.jsx(n,{children:a+1}),e.jsx(n,{children:t.promo_id}),e.jsx(n,{children:t.name}),e.jsx(n,{children:new Date(t.startDate).toLocaleDateString()}),e.jsx(n,{children:new Date(t.endDate).toLocaleDateString()}),e.jsx(n,{children:t.status===!0?"Active":"Deactive"}),e.jsx(n,{children:e.jsx(b,{to:`/promotions/market/${t._id}`,children:e.jsx(d,{size:"sm",style:{backgroundColor:"#ff4d4d",color:"white"},variant:"outline",children:e.jsx(P,{icon:ie,size:"lg",style:{color:"white"}})})})}),e.jsx(n,{children:e.jsx(b,{to:`/promotions/products/${t._id}`,children:e.jsx(d,{size:"sm",style:{backgroundColor:"#ff4d4d",color:"white"},variant:"outline",children:e.jsx(P,{icon:ie,size:"lg",style:{color:"white"}})})})}),e.jsx(n,{children:e.jsx(b,{children:e.jsx(P,{icon:Ee,size:"xl",onClick:()=>Ce(t)})})}),e.jsx(n,{children:t.status?e.jsx(d,{size:"sm",onClick:()=>ae(t._id,!1),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Deactivate"}):e.jsx(d,{size:"sm",onClick:()=>ae(t._id,!0),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Activate"})}),e.jsx(n,{children:e.jsx(d,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>Pe(t._id),children:e.jsx(P,{icon:Ne,size:"lg",style:{color:"white"}})})})]},a))})]}),e.jsxs(ze,{"aria-label":"Page navigation example",children:[e.jsx(E,{disabled:T<=0,onClick:xe,children:"Previous"}),je(),e.jsx(E,{disabled:he===!0,onClick:fe,children:"Next"})]}),e.jsxs(N,{alignment:"center",visible:I,scrollable:!0,size:"sm",onClose:()=>j(!1),children:[e.jsx(z,{closeButton:!1,children:e.jsx(M,{children:"Confirmation"})}),e.jsxs(_,{children:[e.jsx("a",{children:"Are you sure you want to delete this promotion?"}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[e.jsx(d,{onClick:()=>Se(ge),style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),e.jsx(d,{onClick:()=>j(!1),style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]}),e.jsxs(N,{alignment:"center",visible:B,scrollable:!0,size:"sm",onClose:()=>x(!1),children:[e.jsx(z,{closeButton:!1,children:e.jsx(M,{children:"Confirmation"})}),e.jsxs(_,{children:[e.jsxs("a",{children:["Are you sure you want to ",V?"activate":"deactivate"," this promotion?"]}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[e.jsx(d,{onClick:()=>ye(),style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),e.jsx(d,{onClick:()=>x(!1),style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]}),e.jsxs(N,{visible:U,scrollable:!0,size:"lg",onClose:()=>A(!1),children:[e.jsx(z,{closeButton:!0,children:e.jsx(M,{children:"Edit Promotion Information"})}),e.jsx(_,{children:e.jsxs("div",{className:"row g-3",children:[e.jsx(k,{md:6,children:e.jsx(f,{id:"name",label:"Promotion Name",defaultValue:p.name,onChange:t=>q(t.target.value)})}),e.jsx(k,{md:6,children:e.jsx(f,{id:"startDate",label:"Start Date",type:"date",defaultValue:((oe=p.startDate)==null?void 0:oe.split("T")[0])||"",onChange:t=>G(t.target.value)})}),e.jsx(k,{md:6,children:e.jsx(f,{id:"endDate",label:"End Date",type:"date",defaultValue:((le=p.endDate)==null?void 0:le.split("T")[0])||"",onChange:t=>K(t.target.value)})}),e.jsx(k,{md:6,children:e.jsx(f,{id:"promotionid",label:"Promotion ID",readOnly:!0,defaultValue:p.promo_id,onChange:t=>X(t.target.value)})}),e.jsx(d,{type:"submit",style:{marginBottom:"3%",width:"200px",backgroundColor:"#ff4d4d",color:"white"},onClick:()=>be(),children:"Update Promotion"})]})})]})]})};export{Je as default};
