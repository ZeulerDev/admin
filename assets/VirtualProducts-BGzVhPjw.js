import{y as qe,r,A as c,j as t,h as I,L as Ge,m as Je}from"./index-B08OXeWv.js";import{a as m}from"./axios-Cm0UX6qg.js";import{B as x}from"./config-HOLfLxHr.js";import{b as Ke,a as u}from"./CContainer-Bcycrjrg.js";import{C as de,a as ie,b as ue,c as pe,d as v}from"./DefaultLayout-ZVM7TRL_.js";import{C as We}from"./CNavbar-CI1ooECg.js";import{C as he}from"./CFormInput-BdPiiS44.js";import{C as Xe,a as Ze,b as ge,c as i,d as et,e as y}from"./CTable-isbk2Vch.js";import{C as fe}from"./CCardImage-BV2__KTV.js";import{c as tt}from"./cil-pencil-m516yCOw.js";import{C as st,a as $}from"./CPaginationItem-BtMnBLEs.js";import{C as R,a as F,b as V,c as Q}from"./CModalTitle-BEzJ5tl5.js";import{C as me}from"./CModalFooter-CT0DeHo_.js";import"./CFormLabel-SAczgcRM.js";const yt=()=>{const[{user:C,token:n},o]=qe(),[xe,P]=r.useState(!1),[H,k]=r.useState(!1);r.useState(!1);const[ye,j]=r.useState(!1),[_,O]=r.useState([]),[b,w]=r.useState(0),[Ce,A]=r.useState(!0),[je,Pe]=r.useState([]),[ke,U]=r.useState("All Chains"),[M,Y]=r.useState("All market"),[at,z]=r.useState(""),[S,q]=r.useState(""),[Se,G]=r.useState([]),[p,be]=r.useState(""),[Ae,J]=r.useState(p),[De,L]=r.useState(!1),[Ie,K]=r.useState(""),[E,W]=r.useState(""),[ve,X]=r.useState(""),[we,Ue]=r.useState(0),[D,N]=r.useState(1);r.useState("NAME");const[Z,B]=r.useState(!1),[Me,ee]=r.useState(""),[ze,h]=r.useState(!1),[Le,te]=r.useState(!1);r.useEffect(()=>{C&&n&&g(0)},[C,n,S,Ae]),r.useEffect(()=>{const e=setTimeout(()=>{(p.length>=3||p.length===0)&&J(p)},500);return()=>{clearTimeout(e)}},[p]),r.useEffect(()=>{n&&m.get(x+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${n}`}}).then(e=>{e.status===200?Pe(e.data):e.status===500&&o({type:c,payload:{status:!0,title:"Chain Loading error",message:e.data.message}})}).catch(e=>{console.error("Error: ",e)})},[]);const Ee=e=>{m.get(x+`assistant/reference/market/locations?brand=${e}`,{headers:{Authorization:`Bearer ${n}`}}).then(s=>{s.status===200?(G(s.data.data),s.data.data.length<20?(A(!0),console.log("ok")):s.data.data.length>19&&A(!1)):s.status===500&&o({type:c,payload:{status:!0,title:"Market Loading error",message:s.data.message}})}).catch(s=>{console.error("Error: ",s)})},g=(e,s)=>{P(!0),m.get(x+`virtual/product/all/${e}?marketId=${S}&name=${p}`,{headers:{Authorization:`Bearer ${n}`}}).then(a=>{a.status===200?(O(a.data.list),Ue(a.data.count),console.log(a.data.count),P(!1),a.data.list.length<20?(A(!0),console.log("ok")):a.data.list.length>19&&A(!1)):a.status===203?(P(!1),o({type:c,payload:{status:!0,title:"product loading error error",message:a.data.message}})):a.status===204?(P(!1),o({type:c,payload:{status:!0,title:"No Products",message:"No products found in this market address",color:"info"}})):a.status===500&&(P(!1),o({type:c,payload:{status:!0,title:"product loading error error",message:a.data.message}}))}).catch(a=>{P(!1),console.error("Error:",a)})},se=(e,s)=>{e==="all"?(z(""),U("All Chains")):(z(e),Ee(e),U(s))},ae=(e,s)=>{e==="all"?(q(""),Y("All Markets"),z(""),U("All Chains"),G([])):(q(e),Y(s))},Ne=()=>{N(D+1);const e=b+50;w(e),g(e)},Be=()=>{N(D-1);const e=b-50;console.log(e),w(e),g(e)},Te=(e,s)=>{L(!0),K(e),X(s)},$e=()=>{console.log("called"),E==""?o({type:c,payload:{status:!0,title:"Alert",message:"Please enter the price",color:"warning"}}):Ve(Ie)},Re=e=>{N(e);const s=(e-1)*50;w(s),g(s)},Fe=()=>{const e=Math.ceil(we/50),s=[];for(let d=1;d<=e;d++)s.push(d);const a=Math.max(D-2,1),l=Math.min(a+4,e);return s.slice(a-1,l).map(d=>t.jsx($,{active:D===d,onClick:()=>Re(d),children:d},d))},Ve=e=>{if(e){let s={price:E+" â‚¬"};C&&n&&m.put(x+"product/update/price/"+e,s,{headers:{Authorization:`Bearer ${n}`}}).then(a=>{if(a.status===200){const l=a.data,f=_.map(d=>(d.productId===l.productId&&(d.price.basePrice=l.price.basePrice,d.price.tax=l.price.tax,d.price.markup=l.price.markup,d.price.total=l.price.total),d));O([...f]),o({type:c,payload:{status:!0,title:"Product Details Update",message:"Product price update Success",color:"success"}}),K(""),W(""),L(!1),X("")}else a.status===204?o({type:c,payload:{status:!0,title:"Product Details Update error",message:a.data.message,color:"danger"}}):a.status===500&&o({type:c,payload:{status:!0,title:"Product Details Update error",message:a.data.message,color:"danger"}})}).catch(a=>{console.error("Error:",a)})}else alert("Please Check the Fields!")},Qe=e=>{B(!Z),ee(e)},[He,T]=r.useState(null),[re,le]=r.useState(null),_e=e=>{console.log(e),le(URL.createObjectURL(e)),T(e)},Oe=async(e,s)=>{if(console.log(e,s),C&&n){const a=new FormData;a.append("image",s),a.append("id",e),m.post(x+"test/product/image/update",a,{headers:{Authorization:`Bearer ${n}`}}).then(l=>{l.status===200?(B(!1),ee(""),T(null),console.log("response",l.data),o({type:c,payload:{status:!0,title:"Image upload ",message:"Image upload success",color:"success"}}),g(0)):l.status===500&&o({type:c,payload:{status:!0,title:"Image upload error",message:l.data.message,color:"danger"}})}).catch(l=>{console.error("Error:",l)})}},oe=(e,s)=>{if(e){let a={status:s};C&&n&&m.put(x+"product/update/status/"+e,a,{headers:{Authorization:`Bearer ${n}`}}).then(l=>{l.status===200?(o({type:c,payload:{status:!0,title:"Product Status Update",message:"Product status update Success",color:"success"}}),g(0)):l.status===204?o({type:c,payload:{status:!0,title:"Product Details Update error",message:"Product status update error",color:"danger"}}):l.status===500&&o({type:c,payload:{status:!0,title:"Product Details Update error",message:"Product status update error",color:"danger"}})}).catch(l=>{console.error("Error:",l)})}else alert("Please Check the Fields!")},ce=e=>{h(!0),e==="active"?te(!0):e==="deactive"&&te(!1)},ne=(e,s)=>{k(!0);let a;if(e==="1"?a=!0:e==="0"&&(a=!1),s){let l={status:a,mid:s};console.log("data",l),C&&n&&m.put(x+"product/update/all",l,{headers:{Authorization:`Bearer ${n}`}}).then(f=>{f.status===200?(o({type:c,payload:{status:!0,title:"Product Status Update",message:"Product status update Success",color:"success"}}),g(0),k(!1),h(!1)):f.status===204?(o({type:c,payload:{status:!0,title:"Product Details Update",message:"No products found in this market address to update",color:"info"}}),k(!1),h(!1)):f.status===500&&(o({type:c,payload:{status:!0,title:"Product Details Update error",message:"Product status update error",color:"danger"}}),k(!1),h(!1))}).catch(f=>{console.error("Error:",f),k(!1),h(!1)})}else o({type:c,payload:{status:!0,title:"Alert",message:"Please select the market",color:"danger"}}),j(!1),k(!1),h(!1)},Ye=e=>{j(!0),console.log("mid",e),C&&n&&(e?(console.log("data"),m.put(x+"product/sync/all/"+e,{},{headers:{Authorization:`Bearer ${n}`}}).then(s=>{s.status===200?(o({type:c,payload:{status:!0,title:"Product Sync",message:"Product sync Success",color:"success"}}),g(0),j(!1)):s.status===204?(o({type:c,payload:{status:!0,title:"Product Sync error",message:"Product sync error",color:"danger"}}),j(!1)):s.status===500&&(o({type:c,payload:{status:!0,title:"Product Sync error",message:"Product sync error",color:"danger"}}),j(!1))}).catch(s=>{console.error("Error:",s),j(!1)})):(j(!1),o({type:c,payload:{status:!0,title:"Alert",message:"Please select the market",color:"danger"}})))};return t.jsxs(Ke,{children:[t.jsx(de,{style:{marginLeft:"0%"},color:"secondary",children:"Action "}),t.jsx(u,{size:"sm",onClick:()=>{ce("active")},style:{backgroundColor:"#ff4d4d",marginLeft:"2%",width:120,color:"white"},children:H?t.jsx(I,{size:"sm"}):"Activate All"}),t.jsx(u,{size:"sm",onClick:()=>{ce("deactive")},style:{backgroundColor:"#ff4d4d",marginLeft:"2%",width:120,color:"white"},children:H?t.jsx(I,{size:"sm"}):"Deactivate All"}),t.jsx(u,{size:"sm",onClick:()=>{Ye(S)},style:{backgroundColor:"#ff4d4d",marginLeft:"2%",width:120,color:"white"},children:ye?t.jsx(I,{size:"sm"}):"Sync"}),t.jsx(de,{style:{marginLeft:"15%"},color:"secondary",children:"Filter by"}),t.jsxs(ie,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[t.jsx(ue,{children:ke}),t.jsxs(pe,{children:[t.jsx(v,{onClick:()=>se("all"),children:"All"}),je.map((e,s)=>t.jsx(v,{onClick:()=>se(e.id,e.name),children:e.name},s))]})]}),t.jsxs(ie,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[t.jsx(ue,{children:M.length>15?`${M.substring(0,15)}...`:M}),t.jsxs(pe,{children:[t.jsx(v,{onClick:()=>ae("all"),children:"Select the Chain"}),Se.map((e,s)=>t.jsx(v,{onClick:()=>ae(e._id,e.address),children:t.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[t.jsx("span",{children:e.address.substring(0,e.address.length/2)}),t.jsx("span",{children:e.address.substring(e.address.length/2)})]})},s))]})]}),t.jsx(We,{style:{marginTop:"1%"},className:"bg-body-tertiary",children:t.jsx(he,{type:"text",placeholder:"Search products by name, brand name and product id",style:{width:450,marginRight:"50%"},value:p,onChange:e=>be(e.target.value)})}),xe?t.jsx(I,{}):t.jsxs(Xe,{children:[t.jsx(Ze,{children:t.jsxs(ge,{children:[t.jsx(i,{scope:"col",children:"#"}),t.jsx(i,{scope:"col",children:"Product Id"}),t.jsx(i,{scope:"col",children:"Photo"}),t.jsx(i,{scope:"col",children:"Name"}),t.jsx(i,{scope:"col",children:"Price"}),t.jsx(i,{scope:"col",children:"Brand"}),t.jsx(i,{scope:"col",children:"Chain"}),t.jsx(i,{scope:"col",children:"Market Address"}),t.jsx(i,{scope:"col",children:"Action"})]})}),t.jsx(et,{children:_.map((e,s)=>t.jsxs(ge,{children:[t.jsx(y,{children:b+s+1}),t.jsx(y,{children:e.pid}),t.jsx(i,{onClick:()=>{Qe(e.productId)},children:t.jsx(fe,{style:{width:"50px",height:"50px"},src:"https://api.zeuler.com/image/"+e.image})}),t.jsx(y,{children:e.name}),t.jsxs(y,{children:[e.price.basePrice,t.jsx(Ge,{to:"",children:t.jsx(Je,{icon:tt,size:"sm",onClick:()=>Te(e.productId,e.price.basePrice)})})]}),t.jsx(y,{children:e.brand}),t.jsx(y,{children:e.chainName}),t.jsx(y,{children:e.marketAddress}),t.jsx(y,{children:e.status?t.jsx(u,{size:"sm",onClick:()=>{oe(e.productId,!1)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Deactivate"}):t.jsx(u,{size:"sm",onClick:()=>{oe(e.productId,!0)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Activate"})})]},s))})]}),t.jsxs(st,{"aria-label":"Page navigation example",children:[t.jsx($,{disabled:b<=0,onClick:Be,children:"Previous"}),Fe(),t.jsx($,{disabled:Ce===!0,onClick:Ne,children:"Next"})]}),t.jsxs(R,{alignment:"center",visible:ze,scrollable:!0,size:"sm",onClose:()=>h(!1),children:[t.jsx(F,{closeButton:!1,children:t.jsx(V,{children:"Confirmation"})}),t.jsxs(Q,{children:[t.jsx("a",{children:"Are you sure you want to change the status of all these products?"}),t.jsx("br",{}),t.jsx("br",{}),t.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[t.jsx(u,{onClick:()=>{ne(Le?"1":"0",S)},style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),t.jsx(u,{onClick:()=>{h(!1)},style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]}),t.jsxs(R,{alignment:"center",visible:De,scrollable:!0,size:"sm",onClose:()=>L(!1),children:[t.jsx(F,{closeButton:!0,children:t.jsx(V,{children:"Change Price"})}),t.jsxs(Q,{children:[t.jsx("a",{children:"Enter New Name"}),t.jsx("br",{}),t.jsx(he,{type:"text",placeholder:ve,value:E,onChange:e=>W(e.target.value)})]}),t.jsx(me,{children:t.jsx(u,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>$e(),children:"Save changes"})})]}),t.jsxs(R,{alignment:"center",visible:Z,scrollable:!0,size:"lg",onClose:()=>{B(!1),T(null),le(null)},children:[t.jsx(F,{closeButton:!0,children:t.jsx(V,{children:"Image Uploader"})}),t.jsxs(Q,{children:[re&&t.jsx(fe,{style:{width:"100px",height:"100px"},src:re,alt:"Uploaded Image"}),t.jsx("input",{style:{marginLeft:"5%"},type:"file",accept:".jpg, .jpeg, .png",onChange:e=>_e(e.target.files[0])})]}),t.jsx(me,{children:t.jsx(u,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>{Oe(Me,He)},children:"Upload Image"})})]})]})};export{yt as default};
