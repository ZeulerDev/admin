import{B as ss,r,y as ts,A as c,j as e,h as le,L as as,m as ce}from"./index-CWrNKnUn.js";import{B as x}from"./config-HOLfLxHr.js";import{a as f}from"./axios-Cm0UX6qg.js";/* empty css               */import{b as os,a as j}from"./CContainer-rLvsNxDy.js";import{C as de}from"./CNavbar-DgcRwyXb.js";import{C as v}from"./CFormInput-BFhklKIl.js";import{C as ne,a as ie,b as w,c as d,d as ue,e as i}from"./CTable-BefVuclu.js";import{C as pe}from"./CCardImage-SO2Y-hc9.js";import{c as rs}from"./cil-pencil-m516yCOw.js";import{c as ls}from"./cil-trash-CBbKHhHb.js";import{C as he,a as C}from"./CPaginationItem-Cuw6EKc4.js";import{C as V,a as _,b as U,c as Q}from"./CModalTitle-KQ4EoNH0.js";import{C as cs,a as ds,b as ns,c as is,d as ge}from"./DefaultLayout-Dl-jL1Ob.js";import{C as H}from"./CModalFooter-Ndk1GWoC.js";import"./CFormLabel-DxUs0q6J.js";const ws=()=>{const{id:p}=ss();r.useState([]);const[me,y]=r.useState(!1),[{user:g,token:u},l]=ts(),[xe,b]=r.useState(!1),[fe,O]=r.useState(!1);r.useState("All Cities");const[je,q]=r.useState("All Markets");r.useState(""),r.useState(""),r.useState(""),r.useState("All Cities"),r.useState(""),r.useState("All Chains"),r.useState([]),r.useState([]),r.useState([]);const[ye,Pe]=r.useState([{_id:"",name:""}]),[Ce,G]=r.useState(!0),[I,N]=r.useState(0),[ke,be]=r.useState(0),[S,B]=r.useState(1),[Se,Me]=r.useState(0),[M,D]=r.useState(1),[Ae,J]=r.useState(!0),[k,T]=r.useState(0),[K,W]=r.useState([]),[ve,we]=r.useState([]),[Ie,Ne]=r.useState([]),[A,X]=r.useState(""),[z,Be]=r.useState(""),[E,Y]=r.useState(""),[De,Z]=r.useState(!1),[Te,$]=r.useState(!1),[ze,ee]=r.useState(""),[F,se]=r.useState(""),[Ee,te]=r.useState(""),[$e,L]=r.useState(!1),[R,ae]=r.useState(""),[us,Fe]=r.useState("");r.useEffect(()=>{console.log("id",p),m(p,0)},[z]);const m=(s,a)=>{s?(console.log("id",s),g&&u?(y(!0),f.get(x+`promotion/products/${a}?promotionId=${s}&name=${z}`,{headers:{Authorization:`Bearer ${u}`}}).then(t=>{t.status===200?(console.log("products",t.data.list),W(t.data.list),be(t.data.count),Ne(t.data.list.map(o=>o.productId)),y(!1),t.data.list.length<50?(G(!0),console.log("ok")):t.data.list.length>49&&G(!1)):t.status===203?(console.log("products 203"),y(!1),l({type:c,payload:{status:!0,title:" Products loading error",message:t.data.message}})):t.status===204?(console.log("products 204"),y(!1),l({type:c,payload:{status:!0,title:" Products loading error",message:"No products found",color:"info"}})):t.status===500&&(console.log("products 500"),y(!1),l({type:c,payload:{status:!0,title:" Products loading error",message:t.data.message}}))})):(console.log("products non"),y(!1))):l({type:c,payload:{status:!0,title:" markets loading error",message:"No id found"}})},Le=()=>{b(!0)},Re=(s,a)=>{if(console.log("promotionId",s,"pId",a),a&&s){const t={productId:a};u&&g&&u&&f.patch(x+"promotion/add/product/"+s,t,{headers:{Authorization:`Bearer ${u}`}}).then(o=>{o.status===200?(b(!1),m(s),l({type:c,payload:{status:!0,title:"Product Assign",message:"successfully Product assigned to the promotion",color:"success"}})):o.status===400?l({type:c,payload:{status:!0,title:"Product Assign error",message:o.data.message,color:"warning"}}):o.status===404?l({type:c,payload:{status:!0,title:"Product Assign error",message:o.data.message,color:"warning"}}):o.status===500&&l({type:c,payload:{status:!0,title:"Product Assign error",message:o.data.message,color:"warning"}})}).catch(o=>{console.error("Error:",o)})}else l({type:c,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},oe=(s,a)=>{if(console.log("promotionId",s,"pid",a),a&&s){const t={productId:a};u&&g&&u&&f.patch(x+"promotion/remove/product/"+s,t,{headers:{Authorization:`Bearer ${u}`}}).then(o=>{o.status===200?(m(s),b(!1),l({type:c,payload:{status:!0,title:"Market Assign",message:"successfully Market removed from the promotion",color:"success"}})):o.status===204?l({type:c,payload:{status:!0,title:"Market remove error",message:o.data.message,color:"warning"}}):o.status===500&&l({type:c,payload:{status:!0,title:"Market remove error",message:o.data.message,color:"warning"}})}).catch(o=>{console.error("Error:",o)})}else l({type:c,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},Ve=()=>{B(S+1);const s=I+50;N(s),m(p,s)},_e=()=>{B(S-1);const s=I-50;console.log(s),N(s),m(p,s)},Ue=s=>{B(s);const a=(s-1)*50;N(a),m(p,a)},Qe=()=>{const s=Math.ceil(ke/50),a=[];for(let n=1;n<=s;n++)a.push(n);const t=Math.max(S-2,1),o=Math.min(t+4,s);return a.slice(t-1,o).map(n=>e.jsx(C,{active:S===n,onClick:()=>Ue(n),children:n},n))},He=s=>{s?(console.log("id",s),g&&u?f.get(x+"promotion/all/markets/"+s,{headers:{Authorization:`Bearer ${u}`}}).then(a=>{a.status===200?(console.log("market",a.data.market),Pe(a.data.market.map(t=>({_id:t._id,name:t.address})))):a.status===203?l({type:c,payload:{status:!0,title:" markets loading error",message:a.data.message}}):a.status===500&&l({type:c,payload:{status:!0,title:" markets loading error",message:a.data.message}})}):l({type:c,payload:{status:!0,title:" markets loading error",message:"No user or token found"}})):l({type:c,payload:{status:!0,title:" markets loading error",message:"No id found"}})},re=(s,a)=>{a==="all"?(X(""),q("All Markets"),P(0,"",p),console.log("all")):(console.log("selected",s),X(s),q(a),P(0,s,p))};r.useEffect(()=>{De&&P(0,A,p)},[E]);const P=(s,a,t)=>{g&&u?(O(!0),f.get(x+`promotion/all/markets/products/${s}?marketId=${a}&promoId=${t}&name=${E}`,{headers:{Authorization:`Bearer ${u}`}}).then(o=>{o.status===200?(we(o.data.list),Me(o.data.count),O(!1),Z(!0),o.data.list.length<20?(J(!0),console.log("ok")):o.data.list.length>19&&J(!1)):o.status===203?l({type:c,payload:{status:!0,title:" Products loading error",message:o.data.message}}):o.status===500&&l({type:c,payload:{status:!0,title:" Products loading error",message:o.data.message}})})):l({type:c,payload:{status:!0,title:" Products loading error",message:"No user or token found"}})},Oe=()=>{D(M+1);const s=k+50;T(s),P(s,A,p)},qe=()=>{D(M-1);const s=k-50;console.log(s),T(s),P(s,A,p)},Ge=s=>{D(s);const a=(s-1)*50;T(a),loadData(a,!0)},Je=()=>{const s=Math.ceil(Se/50),a=[];for(let n=1;n<=s;n++)a.push(n);const t=Math.max(M-2,1),o=Math.min(t+4,s);return a.slice(t-1,o).map(n=>e.jsx(C,{active:M===n,onClick:()=>Ge(n),children:n},n))},Ke=(s,a)=>{$(!0),ee(s),te(a)},We=()=>{console.log("called"),F==""?l({type:c,payload:{status:!0,title:"Alert",message:"Please enter the promotion price",color:"warning"}}):Xe(ze)},Xe=s=>{if(console.log("product Id",s),s){const a={value:F};console.log("formData",a),u&&g&&u&&f.patch(x+"promotion/update/promo/value/"+s,a,{headers:{Authorization:`Bearer ${u}`}}).then(t=>{if(t.status===200){l({type:c,payload:{status:!0,title:"Product Details Update",message:"Product promotion price update Success",color:"success"}}),ee(""),se(""),$(!1),te("");const o=t.data,h=K.map(n=>(n.productId===o.productId&&(n.promo_value=o.promo_value),n));W([...h])}else t.status===400?l({type:c,payload:{status:!0,title:"Product update error",message:t.data.message,color:"warning"}}):t.status===404?l({type:c,payload:{status:!0,title:"Product update error",message:t.data.message,color:"warning"}}):t.status===500&&l({type:c,payload:{status:!0,title:"Product update error",message:t.data.message,color:"warning"}})}).catch(t=>{console.error("Error:",t)})}else l({type:c,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},Ye=()=>{L(!0)},Ze=()=>{console.log("called"),R==""?l({type:c,payload:{status:!0,title:"Alert",message:"Please enter the promotion price",color:"warning"}}):es(p)},es=s=>{if(console.log("promotion Id",s),s){const a={value:R};console.log("formData",a),u&&g&&u&&f.patch(x+"promotion/update/promo/all/value/"+s,a,{headers:{Authorization:`Bearer ${u}`}}).then(t=>{t.status===200?(l({type:c,payload:{status:!0,title:"Product Details Update",message:"Product promotion price update Success",color:"success"}}),ae(""),L(!1),Fe(""),m(s,0)):t.status===400?l({type:c,payload:{status:!0,title:"Product update error",message:t.data.message,color:"warning"}}):t.status===404?l({type:c,payload:{status:!0,title:"Product update error",message:t.data.message,color:"warning"}}):t.status===500&&l({type:c,payload:{status:!0,title:"Product update error",message:t.data.message,color:"warning"}})}).catch(t=>{console.error("Error:",t)})}else l({type:c,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})};return e.jsxs(os,{children:[e.jsx(j,{onClick:()=>{Le(),He(p),P(0,A,p)},style:{marginLeft:"0%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Add Products"}),e.jsxs(de,{style:{justifyContent:"flex-start"},className:"bg-body-tertiary",children:[e.jsx(v,{type:"text",placeholder:"Search products by name",style:{width:450,marginRight:"0%"},value:z,onChange:s=>Be(s.target.value)}),e.jsx(j,{onClick:()=>{Ye()},style:{marginLeft:"44%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Apply All"})]}),me?e.jsx(le,{}):e.jsxs(ne,{children:[e.jsx(ie,{children:e.jsxs(w,{children:[e.jsx(d,{scope:"col",children:"#"}),e.jsx(d,{scope:"col",children:"Product Id"}),e.jsx(d,{scope:"col",children:"Photo"}),e.jsx(d,{scope:"col",children:"Name"}),e.jsx(d,{scope:"col",children:"Base Price"}),e.jsx(d,{scope:"col",children:"Tax"}),e.jsx(d,{scope:"col",children:"Markup Percentage "}),e.jsx(d,{scope:"col",children:"Markup"}),e.jsx(d,{scope:"col",children:"Total"}),e.jsx(d,{scope:"col",children:"Promotion Value"}),e.jsx(d,{scope:"col",children:"Brand"}),e.jsx(d,{scope:"col",children:"Chain"}),e.jsx(d,{scope:"col",children:"Market Address"}),e.jsx(d,{scope:"col",children:"Remove"})]})}),e.jsx(ue,{children:K.map((s,a)=>{var t,o,h,n;return e.jsxs(w,{children:[e.jsx(i,{children:k+a+1}),e.jsx(i,{children:s.pid}),e.jsx(d,{onClick:()=>{},children:e.jsx(pe,{style:{width:"50px",height:"50px"},src:"https://api.zeuler.com/image/"+s.image})}),e.jsx(i,{children:s.name}),e.jsxs(i,{children:[" ",(((t=s.price)==null?void 0:t.basePrice)??0).toFixed(2)," "]}),e.jsx(i,{children:(((o=s.price)==null?void 0:o.tax)??0).toFixed(2)}),e.jsxs(i,{children:[s.price.percentage,"%"]}),e.jsx(i,{children:(((h=s.price)==null?void 0:h.markup)??0).toFixed(2)}),e.jsx(i,{children:(((n=s.price)==null?void 0:n.total)??0).toFixed(2)}),e.jsxs(i,{children:[s.promo_value," €",e.jsx(as,{to:"",children:e.jsx(ce,{icon:rs,size:"sm",onClick:()=>Ke(s.productId,s.promo_value)})})]}),e.jsx(i,{children:s.brand}),e.jsx(i,{children:s.chainName}),e.jsx(i,{children:s.marketAddress}),e.jsx(i,{children:e.jsx(j,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>{oe(p,s.productId)},children:e.jsx(ce,{icon:ls,size:"lg",style:{color:"white"}})})})]},a)})})]}),e.jsxs(he,{"aria-label":"Page navigation example",children:[e.jsx(C,{disabled:I<=0,onClick:_e,children:"Previous"}),Qe(),e.jsx(C,{disabled:Ce===!0,onClick:Ve,children:"Next"})]}),e.jsxs(V,{visible:xe,scrollable:!0,size:"xl",onClose:()=>{Z(!1),b(!1),Y("")},children:[e.jsx(_,{closeButton:!0,children:e.jsx(U,{children:"Products assign view"})}),e.jsxs(Q,{children:[e.jsx(cs,{style:{marginLeft:"64%"},color:"secondary",children:"Filter by"}),e.jsxs(ds,{style:{marginLeft:"2%",width:"28%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(ns,{style:{color:"white"},children:je}),e.jsxs(is,{children:[e.jsx(ge,{onClick:()=>re(null,"all"),children:"All"}),ye.map((s,a)=>e.jsx(ge,{onClick:()=>re(s._id,s.name),children:s.name},a))]})]}),e.jsx(de,{style:{marginTop:"1%"},className:"bg-body-tertiary",children:e.jsx(v,{type:"text",placeholder:"Search products by name",style:{width:450,marginRight:"60%"},value:E,onChange:s=>Y(s.target.value)})}),fe?e.jsx(le,{}):e.jsxs(ne,{children:[e.jsx(ie,{children:e.jsxs(w,{children:[e.jsx(d,{scope:"col",children:"#"}),e.jsx(d,{scope:"col",children:"Product Id"}),e.jsx(d,{scope:"col",children:"Photo"}),e.jsx(d,{scope:"col",children:"Name"}),e.jsx(d,{scope:"col",children:"Base Price"}),e.jsx(d,{scope:"col",children:"Tax"}),e.jsx(d,{scope:"col",children:"Markup Percentage "}),e.jsx(d,{scope:"col",children:"Markup"}),e.jsx(d,{scope:"col",children:"Total"}),e.jsx(d,{scope:"col",children:"Brand"}),e.jsx(d,{scope:"col",children:"Chain"}),e.jsx(d,{scope:"col",children:"Market Address"}),e.jsx(d,{scope:"col",children:"Action"})]})}),e.jsx(ue,{children:ve.map((s,a)=>{var t,o,h,n;return e.jsxs(w,{children:[e.jsx(i,{children:k+a+1}),e.jsx(i,{children:s.pid}),e.jsx(d,{children:e.jsx(pe,{style:{width:"50px",height:"50px"},src:"https://api.zeuler.com/image/"+s.image})}),e.jsx(i,{children:s.name}),e.jsxs(i,{children:[" ",(((t=s.price)==null?void 0:t.basePrice)??0).toFixed(2)," "]}),e.jsx(i,{children:(((o=s.price)==null?void 0:o.tax)??0).toFixed(2)}),e.jsxs(i,{children:[s.price.percentage,"%"]}),e.jsx(i,{children:(((h=s.price)==null?void 0:h.markup)??0).toFixed(2)}),e.jsx(i,{children:(((n=s.price)==null?void 0:n.total)??0).toFixed(2)}),e.jsx(i,{children:s.brand}),e.jsx(i,{children:s.chainName}),e.jsx(i,{children:s.marketAddress}),e.jsx(i,{children:Ie.includes(s.productId)?e.jsx(j,{size:"sm",onClick:()=>{oe(p,s.productId)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Remove"}):e.jsx(j,{size:"sm",onClick:()=>{Re(p,s.productId)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Add"})})]},a)})})]}),e.jsx(H,{children:e.jsxs(he,{"aria-label":"Page navigation example",children:[e.jsx(C,{disabled:k<=0,onClick:qe,children:"Previous"}),Je(),e.jsx(C,{disabled:Ae===!0,onClick:Oe,children:"Next"})]})})]})]}),e.jsxs(V,{alignment:"center",visible:Te,scrollable:!0,size:"sm",onClose:()=>$(!1),children:[e.jsx(_,{closeButton:!0,children:e.jsx(U,{children:"Change Promotion Value"})}),e.jsxs(Q,{children:[e.jsx("a",{children:"Add Promotion Value"}),e.jsx("br",{}),e.jsx(v,{type:"text",placeholder:Ee,value:F,onChange:s=>se(s.target.value)})]}),e.jsx(H,{children:e.jsx(j,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>We(),children:"Save changes"})})]}),e.jsxs(V,{alignment:"center",visible:$e,scrollable:!0,size:"sm",onClose:()=>L(!1),children:[e.jsx(_,{closeButton:!0,children:e.jsx(U,{children:"Add promotion value to all products"})}),e.jsxs(Q,{children:[e.jsx("a",{children:"Add Promotion Value"}),e.jsx("br",{}),e.jsx(v,{type:"text",value:R,onChange:s=>ae(s.target.value)})]}),e.jsx(H,{children:e.jsx(j,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>Ze(),children:"Save changes"})})]})]})};export{ws as default};
