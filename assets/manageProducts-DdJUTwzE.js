import{B as st,r as o,y as at,A as c,j as e,h as le,L as ce,m as ne}from"./index-CShjmuOF.js";import{B as m}from"./config-HOLfLxHr.js";import{a as f}from"./axios-Cm0UX6qg.js";/* empty css               */import{b as ot,a as x}from"./CContainer-CVoz0lw8.js";import{C as de}from"./CNavbar-DcUJdaz_.js";import{C as v}from"./CFormInput-DOUuhL0C.js";import{C as ie,a as ue,b as M,c as d,d as pe,e as u}from"./CTable-CODcAIUx.js";import{C as ge}from"./CCardImage-D1wifuZ4.js";import{c as rt}from"./cil-pencil-m516yCOw.js";import{c as lt}from"./cil-trash-CBbKHhHb.js";import{C as he,a as P}from"./CPaginationItem-CBp1JQ3-.js";import{C as _,a as U,b as Q,c as F}from"./CModalTitle-BOOtbGl6.js";import{C as ct,a as nt,b as dt,c as it,d as me}from"./DefaultLayout-fJjJN1jI.js";import{C as H}from"./CModalFooter-GJGNinqB.js";import"./CFormLabel-D-0hojWZ.js";const wt=()=>{const{id:p}=st();o.useState([]);const[fe,y]=o.useState(!1),[{user:g,token:i},l]=at(),[xe,k]=o.useState(!1),[ye,O]=o.useState(!1);o.useState("All Cities");const[je,q]=o.useState("All Markets");o.useState(""),o.useState(""),o.useState(""),o.useState("All Cities"),o.useState(""),o.useState("All Chains"),o.useState([]),o.useState([]),o.useState([]);const[Pe,Ce]=o.useState([{_id:"",name:""}]),[ke,G]=o.useState(!0),[w,I]=o.useState(0),[be,Se]=o.useState(0),[b,N]=o.useState(1),[Ae,ve]=o.useState(0),[S,D]=o.useState(1),[Me,J]=o.useState(!0),[C,B]=o.useState(0),[K,W]=o.useState([]),[we,Ie]=o.useState([]),[Ne,De]=o.useState([]),[A,X]=o.useState(""),[z,Be]=o.useState(""),[E,Y]=o.useState(""),[ze,Z]=o.useState(!1),[Ee,T]=o.useState(!1),[Te,ee]=o.useState(""),[$,te]=o.useState(""),[$e,se]=o.useState(""),[Le,L]=o.useState(!1),[R,ae]=o.useState(""),[ut,Re]=o.useState("");o.useEffect(()=>{console.log("id",p),h(p,0)},[z]);const h=(t,s)=>{t?(console.log("id",t),g&&i?(y(!0),f.get(m+`promotion/products/${s}?promotionId=${t}&name=${z}`,{headers:{Authorization:`Bearer ${i}`}}).then(a=>{a.status===200?(console.log("products",a.data.list),W(a.data.list),Se(a.data.count),De(a.data.list.map(r=>r.productId)),y(!1),a.data.list.length<50?(G(!0),console.log("ok")):a.data.list.length>49&&G(!1)):a.status===203?(console.log("products 203"),y(!1),l({type:c,payload:{status:!0,title:" Products loading error",message:a.data.message}})):a.status===204?(console.log("products 204"),y(!1),l({type:c,payload:{status:!0,title:" Products loading error",message:"No products found",color:"info"}})):a.status===500&&(console.log("products 500"),y(!1),l({type:c,payload:{status:!0,title:" Products loading error",message:a.data.message}}))})):(console.log("products non"),y(!1))):l({type:c,payload:{status:!0,title:" markets loading error",message:"No id found"}})},Ve=()=>{k(!0)},_e=(t,s)=>{if(console.log("promotionId",t,"pId",s),s&&t){const a={productId:s};i&&g&&i&&f.patch(m+"promotion/add/product/"+t,a,{headers:{Authorization:`Bearer ${i}`}}).then(r=>{r.status===200?(k(!1),h(t),l({type:c,payload:{status:!0,title:"Product Assign",message:"successfully Product assigned to the promotion",color:"success"}})):r.status===400?l({type:c,payload:{status:!0,title:"Product Assign error",message:r.data.message,color:"warning"}}):r.status===404?l({type:c,payload:{status:!0,title:"Product Assign error",message:r.data.message,color:"warning"}}):r.status===500&&l({type:c,payload:{status:!0,title:"Product Assign error",message:r.data.message,color:"warning"}})}).catch(r=>{console.error("Error:",r)})}else l({type:c,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},oe=(t,s)=>{if(console.log("promotionId",t,"pid",s),s&&t){const a={productId:s};i&&g&&i&&f.patch(m+"promotion/remove/product/"+t,a,{headers:{Authorization:`Bearer ${i}`}}).then(r=>{r.status===200?(h(t),k(!1),l({type:c,payload:{status:!0,title:"Market Assign",message:"successfully Market removed from the promotion",color:"success"}})):r.status===204?l({type:c,payload:{status:!0,title:"Market remove error",message:r.data.message,color:"warning"}}):r.status===500&&l({type:c,payload:{status:!0,title:"Market remove error",message:r.data.message,color:"warning"}})}).catch(r=>{console.error("Error:",r)})}else l({type:c,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},Ue=()=>{N(b+1);const t=w+50;I(t),h(p,t)},Qe=()=>{N(b-1);const t=w-50;console.log(t),I(t),h(p,t)},Fe=t=>{N(t);const s=(t-1)*50;I(s),h(p,s)},He=()=>{const t=Math.ceil(be/50),s=[];for(let n=1;n<=t;n++)s.push(n);const a=Math.max(b-2,1),r=Math.min(a+4,t);return s.slice(a-1,r).map(n=>e.jsx(P,{active:b===n,onClick:()=>Fe(n),children:n},n))},Oe=t=>{t?(console.log("id",t),g&&i?f.get(m+"promotion/all/markets/"+t,{headers:{Authorization:`Bearer ${i}`}}).then(s=>{s.status===200?(console.log("market",s.data.market),Ce(s.data.market.map(a=>({_id:a._id,name:a.address})))):s.status===203?l({type:c,payload:{status:!0,title:" markets loading error",message:s.data.message}}):s.status===500&&l({type:c,payload:{status:!0,title:" markets loading error",message:s.data.message}})}):l({type:c,payload:{status:!0,title:" markets loading error",message:"No user or token found"}})):l({type:c,payload:{status:!0,title:" markets loading error",message:"No id found"}})},re=(t,s)=>{s==="all"?(X(""),q("All Markets"),j(0,"",p),console.log("all")):(console.log("selected",t),X(t),q(s),j(0,t,p))};o.useEffect(()=>{ze&&j(0,A,p)},[E]);const j=(t,s,a)=>{g&&i?(O(!0),f.get(m+`promotion/all/markets/products/${t}?marketId=${s}&promoId=${a}&name=${E}`,{headers:{Authorization:`Bearer ${i}`}}).then(r=>{r.status===200?(Ie(r.data.list),ve(r.data.count),O(!1),Z(!0),r.data.list.length<20?(J(!0),console.log("ok")):r.data.list.length>19&&J(!1)):r.status===203?l({type:c,payload:{status:!0,title:" Products loading error",message:r.data.message}}):r.status===500&&l({type:c,payload:{status:!0,title:" Products loading error",message:r.data.message}})})):l({type:c,payload:{status:!0,title:" Products loading error",message:"No user or token found"}})},qe=()=>{D(S+1);const t=C+50;B(t),j(t,A,p)},Ge=()=>{D(S-1);const t=C-50;console.log(t),B(t),j(t,A,p)},Je=t=>{D(t);const s=(t-1)*50;B(s),loadData(s,!0)},Ke=()=>{const t=Math.ceil(Ae/50),s=[];for(let n=1;n<=t;n++)s.push(n);const a=Math.max(S-2,1),r=Math.min(a+4,t);return s.slice(a-1,r).map(n=>e.jsx(P,{active:S===n,onClick:()=>Je(n),children:n},n))},We=(t,s)=>{T(!0),ee(t),se(s)},Xe=()=>{console.log("called"),$==""?l({type:c,payload:{status:!0,title:"Alert",message:"Please enter the promotion price",color:"warning"}}):Ye(Te)},Ye=t=>{if(console.log("product Id",t),t){const s={value:$};console.log("formData",s),i&&g&&i&&f.patch(m+"promotion/update/promo/value/"+t,s,{headers:{Authorization:`Bearer ${i}`}}).then(a=>{if(a.status===200){l({type:c,payload:{status:!0,title:"Product Details Update",message:"Product promotion price update Success",color:"success"}}),ee(""),te(""),T(!1),se("");const r=a.data,V=K.map(n=>(n.productId===r.productId&&(n.promo_value=r.promo_value),n));W([...V])}else a.status===400?l({type:c,payload:{status:!0,title:"Product update error",message:a.data.message,color:"warning"}}):a.status===404?l({type:c,payload:{status:!0,title:"Product update error",message:a.data.message,color:"warning"}}):a.status===500&&l({type:c,payload:{status:!0,title:"Product update error",message:a.data.message,color:"warning"}})}).catch(a=>{console.error("Error:",a)})}else l({type:c,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},Ze=()=>{L(!0)},et=()=>{console.log("called"),R==""?l({type:c,payload:{status:!0,title:"Alert",message:"Please enter the promotion price",color:"warning"}}):tt(p)},tt=t=>{if(console.log("promotion Id",t),t){const s={value:R};console.log("formData",s),i&&g&&i&&f.patch(m+"promotion/update/promo/all/value/"+t,s,{headers:{Authorization:`Bearer ${i}`}}).then(a=>{a.status===200?(l({type:c,payload:{status:!0,title:"Product Details Update",message:"Product promotion price update Success",color:"success"}}),ae(""),L(!1),Re(""),h(t,0)):a.status===400?l({type:c,payload:{status:!0,title:"Product update error",message:a.data.message,color:"warning"}}):a.status===404?l({type:c,payload:{status:!0,title:"Product update error",message:a.data.message,color:"warning"}}):a.status===500&&l({type:c,payload:{status:!0,title:"Product update error",message:a.data.message,color:"warning"}})}).catch(a=>{console.error("Error:",a)})}else l({type:c,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})};return e.jsxs(ot,{children:[e.jsx(x,{onClick:()=>{Ve(),Oe(p),j(0,A,p)},style:{marginLeft:"0%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Add Products"}),e.jsxs(de,{style:{justifyContent:"flex-start"},className:"bg-body-tertiary",children:[e.jsx(v,{type:"text",placeholder:"Search products by name",style:{width:450,marginRight:"0%"},value:z,onChange:t=>Be(t.target.value)}),e.jsx(x,{onClick:()=>{Ze()},style:{marginLeft:"44%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Apply All"})]}),fe?e.jsx(le,{}):e.jsxs(ie,{children:[e.jsx(ue,{children:e.jsxs(M,{children:[e.jsx(d,{scope:"col",children:"#"}),e.jsx(d,{scope:"col",children:"Product Id"}),e.jsx(d,{scope:"col",children:"Photo"}),e.jsx(d,{scope:"col",children:"Name"}),e.jsx(d,{scope:"col",children:"Price"}),e.jsx(d,{scope:"col",children:"Promotion Value"}),e.jsx(d,{scope:"col",children:"Brand"}),e.jsx(d,{scope:"col",children:"Chain"}),e.jsx(d,{scope:"col",children:"Market Address"}),e.jsx(d,{scope:"col",children:"Remove"})]})}),e.jsx(pe,{children:K.map((t,s)=>e.jsxs(M,{children:[e.jsx(u,{children:C+s+1}),e.jsx(u,{children:t.pid}),e.jsx(d,{onClick:()=>{},children:e.jsx(ge,{style:{width:"50px",height:"50px"},src:"https://api.zeuler.com/image/"+t.image})}),e.jsx(u,{children:t.name}),e.jsx(u,{children:t.price}),e.jsxs(u,{children:[t.promo_value," â‚¬",e.jsx(ce,{to:"",children:e.jsx(ne,{icon:rt,size:"sm",onClick:()=>We(t.productId,t.promo_value)})})]}),e.jsx(u,{children:t.brand}),e.jsx(u,{children:t.chainName}),e.jsx(u,{children:t.marketAddress}),e.jsx(u,{children:e.jsx(x,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>{oe(p,t.productId)},children:e.jsx(ne,{icon:lt,size:"lg",style:{color:"white"}})})})]},s))})]}),e.jsxs(he,{"aria-label":"Page navigation example",children:[e.jsx(P,{disabled:w<=0,onClick:Qe,children:"Previous"}),He(),e.jsx(P,{disabled:ke===!0,onClick:Ue,children:"Next"})]}),e.jsxs(_,{visible:xe,scrollable:!0,size:"xl",onClose:()=>{Z(!1),k(!1),Y("")},children:[e.jsx(U,{closeButton:!0,children:e.jsx(Q,{children:"Products assign view"})}),e.jsxs(F,{children:[e.jsx(ct,{style:{marginLeft:"64%"},color:"secondary",children:"Filter by"}),e.jsxs(nt,{style:{marginLeft:"2%",width:"28%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(dt,{style:{color:"white"},children:je}),e.jsxs(it,{children:[e.jsx(me,{onClick:()=>re(null,"all"),children:"All"}),Pe.map((t,s)=>e.jsx(me,{onClick:()=>re(t._id,t.name),children:t.name},s))]})]}),e.jsx(de,{style:{marginTop:"1%"},className:"bg-body-tertiary",children:e.jsx(v,{type:"text",placeholder:"Search products by name",style:{width:450,marginRight:"60%"},value:E,onChange:t=>Y(t.target.value)})}),ye?e.jsx(le,{}):e.jsxs(ie,{children:[e.jsx(ue,{children:e.jsxs(M,{children:[e.jsx(d,{scope:"col",children:"#"}),e.jsx(d,{scope:"col",children:"Product Id"}),e.jsx(d,{scope:"col",children:"Photo"}),e.jsx(d,{scope:"col",children:"Name"}),e.jsx(d,{scope:"col",children:"Price"}),e.jsx(d,{scope:"col",children:"Brand"}),e.jsx(d,{scope:"col",children:"Chain"}),e.jsx(d,{scope:"col",children:"Market Address"}),e.jsx(d,{scope:"col",children:"Action"})]})}),e.jsx(pe,{children:we.map((t,s)=>e.jsxs(M,{children:[e.jsx(u,{children:C+s+1}),e.jsx(u,{children:t.pid}),e.jsx(d,{children:e.jsx(ge,{style:{width:"50px",height:"50px"},src:"https://api.zeuler.com/image/"+t.image})}),e.jsx(u,{children:t.name}),e.jsxs(u,{children:[t.price,e.jsx(ce,{to:""})]}),e.jsx(u,{children:t.brand}),e.jsx(u,{children:t.chainName}),e.jsx(u,{children:t.marketAddress}),e.jsx(u,{children:Ne.includes(t.productId)?e.jsx(x,{size:"sm",onClick:()=>{oe(p,t.productId)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Remove"}):e.jsx(x,{size:"sm",onClick:()=>{_e(p,t.productId)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Add"})})]},s))})]}),e.jsx(H,{children:e.jsxs(he,{"aria-label":"Page navigation example",children:[e.jsx(P,{disabled:C<=0,onClick:Ge,children:"Previous"}),Ke(),e.jsx(P,{disabled:Me===!0,onClick:qe,children:"Next"})]})})]})]}),e.jsxs(_,{alignment:"center",visible:Ee,scrollable:!0,size:"sm",onClose:()=>T(!1),children:[e.jsx(U,{closeButton:!0,children:e.jsx(Q,{children:"Change Promotion Value"})}),e.jsxs(F,{children:[e.jsx("a",{children:"Add Promotion Value"}),e.jsx("br",{}),e.jsx(v,{type:"text",placeholder:$e,value:$,onChange:t=>te(t.target.value)})]}),e.jsx(H,{children:e.jsx(x,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>Xe(),children:"Save changes"})})]}),e.jsxs(_,{alignment:"center",visible:Le,scrollable:!0,size:"sm",onClose:()=>L(!1),children:[e.jsx(U,{closeButton:!0,children:e.jsx(Q,{children:"Add promotion value to all products"})}),e.jsxs(F,{children:[e.jsx("a",{children:"Add Promotion Value"}),e.jsx("br",{}),e.jsx(v,{type:"text",value:R,onChange:t=>ae(t.target.value)})]}),e.jsx(H,{children:e.jsx(x,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>et(),children:"Save changes"})})]})]})};export{wt as default};
