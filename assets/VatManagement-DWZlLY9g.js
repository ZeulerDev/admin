import{r as o,y as O,A as d,j as e,h as W}from"./index-D8W7eoM5.js";import{a as N}from"./axios-Cm0UX6qg.js";import{B}from"./config-HOLfLxHr.js";import{b as X,a as T}from"./CContainer-EQGOw-z2.js";import{C as Z}from"./CNavbar-bbh6w27I.js";import{C as M}from"./CFormInput-uSeXsJ0R.js";import{C as ee,a as se,b as z,c as n,d as te,e as i}from"./CTable-jf2tizix.js";import{C as g}from"./DefaultLayout-CwPF-zRq.js";import{C as ae,a as D}from"./CPaginationItem-D4fVq3gA.js";import{C as oe,a as re,b as le,c as ne}from"./CModalTitle-DXUyO86j.js";import{C as ie}from"./CModalFooter-VrnOxKGp.js";import"./CFormLabel-Dh9Dcp0z.js";const ve=()=>{const[S,m]=o.useState(!1),[{user:f,token:h},c]=O(),[j,I]=o.useState([]),[L,C]=o.useState(!1),[R,Q]=o.useState(""),[P,A]=o.useState(""),[r,H]=o.useState(""),[$,V]=o.useState(r),[F,U]=o.useState(0),[p,y]=o.useState(1),[v,b]=o.useState(0),[Y,w]=o.useState(!0);o.useEffect(()=>{const s=setTimeout(()=>{c({type:d,payload:{status:!0,title:"Data Loading",message:"Data loading error: Timeout exceeded",color:"warning"}}),C(!1)},2e4);return f&&h&&x(0,s),()=>{clearTimeout(s)}},[$]),o.useEffect(()=>{const s=setTimeout(()=>{(r.length>=3||r.length===0)&&V(r)},500);return()=>{clearTimeout(s)}},[r]);const x=(s,t)=>{f&&h&&(C(!0),N.get(B+`assistant/vat/riders/${s}?search=`+r,{headers:{Authorization:`Bearer ${h}`}}).then(a=>{a.status===200?(I(a.data.list),U(a.data.count),C(!1),console.log("done"),clearTimeout(t),a.data.list.length<50?(w(!0),console.log("ok")):a.data.list.length>49&&w(!1)):a.status===204?c({type:d,payload:{status:!0,title:"Error",message:a.data.message,color:"warning"}}):a.status===500&&c({type:d,payload:{status:!0,title:"Error",message:a.data.message,color:"warning"}})}).catch(a=>{console.error("Error:",a)}))},_=()=>{y(p+1);const s=v+50;b(s),x(s,!0)},G=()=>{y(p-1);const s=v-50;console.log(s),b(s),x(s,!1)},E=(s,t=null)=>{m(!S),Q(s),t!==null?A(t):console.log("VAT DID not provided"),console.log(s)},q=()=>{const s={vat:P};f&&h&&N.patch(B+"assistant/rider/vat/"+R,s,{headers:{Authorization:`Bearer ${h}`}}).then(t=>{if(t.status===200){console.log("updated"),m(!1);const a=t.data,u=j.find(k=>k.id===a.id);u&&(u.vat=a.vat),I([...j]),c({type:d,payload:{status:!0,title:"Driver VAT Id ",message:"VAT Id updated successfully"}})}else t.status===203?(console.log("203"),c({type:d,payload:{status:!0,title:"Driver VAT Id error",message:t.data.message}})):t.status===204?(console.log("204"),c({type:d,payload:{status:!0,title:"Driver VAT Id error",message:t.data.message}})):t.status===500&&c({type:d,payload:{status:!0,title:"Driver VAT Id update error",message:t.data.message}})}).catch(t=>{console.error(t)})},J=s=>{y(s);const t=(s-1)*50;b(t),x(t,!0)},K=()=>{const s=Math.ceil(F/50),t=[];for(let l=1;l<=s;l++)t.push(l);const a=Math.max(p-2,1),u=Math.min(a+4,s);return t.slice(a-1,u).map(l=>e.jsx(D,{active:p===l,onClick:()=>J(l),children:l},l))};return e.jsxs(X,{children:[e.jsx(Z,{className:"bg-body-tertiary",children:e.jsx(M,{type:"text",placeholder:"Search by name",style:{width:450,marginLeft:"0%"},value:r,onChange:s=>H(s.target.value)})}),L?e.jsx(W,{}):e.jsxs(ee,{children:[e.jsx(se,{children:e.jsxs(z,{children:[e.jsx(n,{scope:"col",children:"#"}),e.jsx(n,{scope:"col",children:"Name"}),e.jsx(n,{scope:"col",children:"City"}),e.jsx(n,{scope:"col",children:"Vat"}),e.jsx(n,{scope:"col",children:"Activate"}),e.jsx(n,{scope:"col",children:"Disabled"}),e.jsx(n,{scope:"col",children:"Groups"}),e.jsx(n,{scope:"col",children:"Action"})]})}),e.jsx(te,{children:j.map((s,t)=>e.jsxs(z,{children:[e.jsx(i,{children:t+1}),e.jsx(i,{children:s.name}),e.jsx(i,{children:s.city}),e.jsx(i,{children:s.vat?s.vat:e.jsx(g,{color:"warning",children:"Null"})}),e.jsx(i,{children:s.activate?e.jsx(g,{color:"success",children:"Yes"}):e.jsx(g,{color:"warning",children:"No"})}),e.jsx(i,{children:s.disabled?e.jsx(g,{color:"success",children:"No"}):e.jsx(g,{color:"warning",children:"Yes"})}),e.jsx(i,{children:s.groups.map((a,u)=>e.jsx("div",{children:a.name},u))}),e.jsx(i,{children:s.vat===""?e.jsx(T,{size:"sm",style:{backgroundColor:"#ff4d4d",width:70,color:"white"},onClick:()=>E(s.id,s.vat),children:"Insert "}):e.jsx(T,{size:"sm",style:{backgroundColor:"#ff4d4d",width:70,color:"white"},onClick:()=>E(s.id,s.vat),children:"Edit "})})]},t))})]}),e.jsxs(ae,{"aria-label":"Page navigation example",children:[e.jsx(D,{disabled:v<=0,onClick:G,children:"Previous"}),K(),e.jsx(D,{disabled:Y===!0,onClick:_,children:"Next"})]}),e.jsxs(oe,{alignment:"center",visible:S,scrollable:!0,size:"sm",onClose:()=>m(!1),children:[e.jsx(re,{closeButton:!0,children:e.jsx(le,{children:"Confirmation"})}),e.jsxs(ne,{children:[e.jsx("a",{children:"Enter Driver's VAT id here"}),e.jsx("br",{}),e.jsx(M,{type:"text",placeholder:"Vat id",value:P,onChange:s=>A(s.target.value)})]}),e.jsx(ie,{children:e.jsx(T,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>q(),children:"Save changes"})})]})]})};export{ve as default};
