import{y as jt,r as l,A as r,j as e,L as k,h as q,m as y}from"./index-BbIMGn6I.js";import{a as h}from"./axios-Cm0UX6qg.js";import{B as g}from"./config-HOLfLxHr.js";import{b as Ct,a as u}from"./CContainer-DW1l_mtt.js";import{d as Se,C as J,a as K,b as O,c as p}from"./DefaultLayout-DAj23qfB.js";import{C as Pe}from"./CNavbar-CaFAFoGR.js";import{C as Q,a as W,b as C,c as n,d as X,e as c}from"./CTable-Bo3KO6JA.js";import{c as kt}from"./cil-pencil-m516yCOw.js";import{c as yt}from"./cil-trash-CBbKHhHb.js";import{c as Mt}from"./cil-map-dAArMthr.js";import{C as De,a as B}from"./CPaginationItem-Cm1VX4Uo.js";import{C as M,a as b,b as w,c as A}from"./CModalTitle-BlxPdlJz.js";import{C as Z}from"./CFormInput-CYaLtnDR.js";import{C as ee}from"./CModalFooter-Bw9Pc4Sk.js";import{C as Le}from"./CCol-n25nGd7N.js";import"./CFormLabel-0HkVgzW6.js";var ze=["512 512","<polygon fill='var(--ci-primary-color, currentColor)' points='440 240 272 240 272 72 240 72 240 240 72 240 72 272 240 272 240 440 272 440 272 272 440 272 440 240' class='ci-primary'/>"];const Vt=()=>{const[{user:m,token:d},o]=jt(),[te,v]=l.useState(""),[Ee,S]=l.useState("All Cities"),[P,T]=l.useState([]),[D,se]=l.useState(0),[Ne,ae]=l.useState(!0),[Be,G]=l.useState(!1),[le,L]=l.useState(!1),[Te,Ge]=l.useState(""),[$e,$]=l.useState(!1),[_e,oe]=l.useState(""),[z,re]=l.useState(""),[Ie,ie]=l.useState(""),[Re,_]=l.useState(!1),[ne,x]=l.useState(""),[Ve,Fe]=l.useState([]),[He,ce]=l.useState(!1),[Ue,I]=l.useState(!1),[Ye,qe]=l.useState([]),[de,ue]=l.useState(""),[Je,he]=l.useState("All Cities"),[bt,ge]=l.useState(""),[me,pe]=l.useState(""),[Ke,fe]=l.useState("All Chains"),[wt,xe]=l.useState("All Chains"),[Oe,je]=l.useState(!1),[Qe,We]=l.useState([]),[Xe,Ce]=l.useState(!0),[E,R]=l.useState(0),[ke,ye]=l.useState(""),[j,Me]=l.useState([]),[Ze,V]=l.useState(!1),[F,be]=l.useState(""),[we,Ae]=l.useState(""),H=t=>{t==="all"?(v(""),S("All Cities")):(v(t),S(t))};l.useEffect(()=>{const t=setTimeout(()=>{o({type:r,payload:{status:!0,title:"Data Loading",message:"Data loading error: Timeout exceeded",color:"warning"}}),G(!1)},2e4);return m&&d&&N(0,t),()=>{clearTimeout(t)}},[m,te]);const N=(t,s)=>{G(!0),h.get(g+`market/groups/fetch/${t}?city=${te}`,{headers:{Authorization:`Bearer ${d}`}}).then(a=>{console.log(a.status),a.status===200?(T(a.data),G(!1),clearTimeout(s),a.data.length<20?(ae(!0),console.log("ok")):a.data.length>19&&ae(!1)):a.status===500&&o({type:r,payload:{status:!0,title:"Makrket Group loading error",message:a.data.message}})}).catch(a=>{console.error("Error:",a)})},et=()=>{const t=D+20;se(t),N(t,!0)},tt=()=>{const t=D-20;console.log(t),se(t),N(t,!1)},st=t=>{L(!le),Ge(t)},at=t=>{console.log(t),h.delete(g+"marketgroup/"+t,{headers:{Authorization:`Bearer ${d}`}}).then(s=>{s.status===200?(o({type:r,payload:{status:!0,title:"Market Group Delete",message:"Market Group Delete Success",color:"success"}}),L(!1),N(0,!0),console.log("Remove Market Group")):s.status===203?o({type:r,payload:{status:!0,title:"Market Group Delete",message:s.data.message,color:"warning"}}):s.status===404?o({type:r,payload:{status:!0,title:"Market Group Delete",message:s.data.message,color:"warning"}}):s.status===500&&o({type:r,payload:{status:!0,title:"Market Group Delete",message:s.data.message,color:"warning"}})}).catch(s=>{console.error("Error:",s)})},lt=(t,s)=>{$(!0),oe(t),ie(s),console.log(s)},ot=()=>{console.log("name",z),z==""?o({type:r,payload:{status:!0,title:"Alert",message:"Please Enter Name",color:"danger"}}):rt(_e)},rt=t=>{if(t){let s={name:z};console.log(s,t),m&&d&&h.put(g+"marketgroup/update/"+t,s,{headers:{Authorization:`Bearer ${d}`}}).then(a=>{if(a.status===200){const i=a.data,f=P.find(xt=>xt.id===i.id);f&&(f.name=i.name),T([...P]),o({type:r,payload:{status:!0,title:"Market Group Update",message:"Market group name updated successfully",color:"success"}}),oe(""),re(""),$(!1),ie("")}else a.status===204?o({type:r,payload:{status:!0,title:"Pick up area update  error",message:a.data.message,color:"danger"}}):a.status===500&&o({type:r,payload:{status:!0,title:"Pick up area update  error",message:a.data.message,color:"danger"}})}).catch(a=>{console.error("Error:",a)})}else alert("Please Check the Fields!")},it=t=>{console.log("markets",t),_(!0),x(t),nt(t)},nt=t=>{ce(!0),h.get(g+`marketgroup/markets/${t}`,{headers:{Authorization:`Bearer ${d}`}}).then(s=>{s.status===200?(Fe(s.data),console.log("data market",s.data),ce(!1)):s.status===204?o({type:r,payload:{status:!0,title:"Market Loading error",message:s.data.message}}):s.status===500&&o({type:r,payload:{status:!0,title:"Market Loading error",message:s.data.message}})}).catch(s=>{console.error("Error: ",s)})},ct=t=>{console.log("markets group",t),x(t),I(!0)},U=(t,s)=>{s==="view"?t==="all"?(v(""),S("All Cities")):(v(t),S(t)):s==="modal"&&(t==="all"?(ue(""),he("All Cities")):(ue(t),he(t)))},ve=(t,s,a)=>{a==="view"?t==="all"?(ge(""),xe("All Chains")):(ge(t),xe(s)):a==="modal"&&(t==="all"?(pe(""),fe("All Chains")):(pe(t),fe(s)))};l.useEffect(()=>{dt()},[]);const dt=()=>{d&&h.get(g+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${d}`}}).then(t=>{t.status===200?qe(t.data):t.status===500&&o({type:r,payload:{status:!0,title:"Chain Loading error",message:t.data.message}})}).catch(t=>{console.error("Error: ",t)})};l.useEffect(()=>{m&&d&&Y(0)},[me,de,m]);const Y=(t,s)=>{je(!0),h.get(g+`assistant/market/add/${t}?brand=${me}&city=${de}`,{headers:{Authorization:`Bearer ${d}`}}).then(a=>{a.status===200?(We(a.data.data),console.log("data market"),je(!1),a.data.data.length<20?(Ce(!0),console.log("ok")):a.data.data.length>19&&Ce(!1)):a.status===500&&o({type:r,payload:{status:!0,title:"Market Loading error",message:a.data.message}})}).catch(a=>{console.error("Error: ",a)})},ut=()=>{const t=E+20;R(t),Y(t)},ht=()=>{const t=E-20;console.log(t),R(t),Y(t)},gt=(t,s)=>{if(s&&t){const a={marketId:s};d&&m&&d&&h.patch(g+"marketgroup/add/market/"+t,a,{headers:{Authorization:`Bearer ${d}`}}).then(i=>{i.status===200?(I(!1),x(""),o({type:r,payload:{status:!0,title:"Market Assign",message:"successfully Market assigned to the market group",color:"success"}})):i.status===400?o({type:r,payload:{status:!0,title:"Market Assign error",message:i.data.message,color:"warning"}}):i.status===404?o({type:r,payload:{status:!0,title:"Market Assign error",message:i.data.message,color:"warning"}}):i.status===500&&o({type:r,payload:{status:!0,title:"Market Assign error",message:i.data.message,color:"warning"}})}).catch(i=>{console.error("Error:",i)})}else o({type:r,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},mt=(t,s)=>{if(s&&t){const a={marketId:s};d&&m&&d&&h.patch(g+"marketgroup/remove/market/"+t,a,{headers:{Authorization:`Bearer ${d}`}}).then(i=>{i.status===200?(_(!1),x(""),o({type:r,payload:{status:!0,title:"Market Assign",message:"successfully Market remove from the market group",color:"success"}})):i.status===400?o({type:r,payload:{status:!0,title:"Market remove error",message:i.data.message,color:"warning"}}):i.status===404?o({type:r,payload:{status:!0,title:"Market remove error",message:i.data.message,color:"warning"}}):i.status===500&&o({type:r,payload:{status:!0,title:"Market remove error",message:i.data.message,color:"warning"}})}).catch(i=>{console.error("Error:",i)})}else o({type:r,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},pt=(t,s)=>{s&&(V(!0),Me(t),Ae(t.lat),be(t.lng),ye(s))},ft=()=>{if(F){console.log("center",ke,we,F);const t={lat:we,lng:F};d&&m&&d&&h.patch(g+"marketgroup/update/center/"+ke,t,{headers:{Authorization:`Bearer ${d}`}}).then(s=>{if(s.status===200){V(!1),ye(""),Me([]);const a=s.data,i=P.map(f=>(f._id===a._id&&(f.center=a.center),f));T([...i]),o({type:r,payload:{status:!0,title:"Manage Center Point",message:"successfully center point assigned to the market group",color:"success"}})}else s.status===400?o({type:r,payload:{status:!0,title:"Manage Center Point",message:s.data.message,color:"warning"}}):s.status===404?o({type:r,payload:{status:!0,title:"Manage Center Point",message:s.data.message,color:"warning"}}):s.status===500&&o({type:r,payload:{status:!0,title:"Manage Center Point",message:s.data.message,color:"warning"}})}).catch(s=>{console.error("Error:",s)})}else o({type:r,payload:{status:!0,title:"Error!",message:"check fields again",color:"warning"}})};return e.jsxs(Ct,{children:[e.jsx(k,{to:"/marketgroups/marketmap",children:e.jsx(u,{style:{marginLeft:"0%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Add Market"})}),e.jsx(k,{to:"/marketgroups/createmarketgroup",children:e.jsx(u,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Create Market Group"})}),e.jsx(Se,{style:{marginLeft:"39%"},color:"secondary",children:"Filter by"}),e.jsxs(J,{style:{marginLeft:"2%",width:"17%",marginRight:"5px",backgroundColor:"#ff4d4d"},children:[e.jsx(K,{style:{color:"white"},children:Ee}),e.jsxs(O,{children:[e.jsx(p,{onClick:()=>H("all"),children:"All"}),e.jsx(p,{onClick:()=>H("Milano"),children:"Milano"}),e.jsx(p,{onClick:()=>H("Napoli"),children:"Napoli"})]})]}),e.jsx(Pe,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),Be?e.jsx(q,{}):e.jsxs(Q,{children:[e.jsx(W,{children:e.jsxs(C,{children:[e.jsx(n,{scope:"col",children:"#"}),e.jsx(n,{scope:"col",children:"Name"}),e.jsx(n,{scope:"col",children:"City"}),e.jsx(n,{scope:"col",children:"Assigned Market"}),e.jsx(n,{scope:"col",children:"Location"}),e.jsx(n,{scope:"col",children:"Action"}),e.jsx(n,{scope:"col",children:"Add Markets"}),e.jsx(n,{scope:"col",children:"Add Center Point"}),e.jsx(n,{scope:"col",children:"View Map"})]})}),e.jsx(X,{children:P.map((t,s)=>e.jsxs(C,{children:[e.jsx(c,{children:D+s+1}),e.jsxs(c,{children:[e.jsx("span",{children:t.name}),e.jsx(k,{to:"",children:e.jsx(y,{style:{marginLeft:20,float:"right"},icon:kt,size:"sm",onClick:()=>lt(t._id,t.name)})})]}),e.jsx(c,{children:t.city}),e.jsx(c,{children:e.jsx(u,{onClick:()=>{it(t._id)},size:"sm",style:{backgroundColor:"#ff4d4d",marginLeft:"5px",color:"white"},children:"view"})}),e.jsx(c,{children:e.jsx(k,{to:`/marketgroups/marketdistance/${t._id}`,children:e.jsx(u,{size:"sm",style:{backgroundColor:"#ff4d4d",marginLeft:"5px",color:"white"},children:"view"})})}),e.jsx(c,{children:e.jsx(u,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>st(t._id),children:e.jsx(y,{icon:yt,size:"lg",style:{color:"white"}})})}),e.jsx(c,{children:e.jsx(u,{onClick:()=>{ct(t._id)},size:"sm",style:{backgroundColor:"#ff4d4d",color:"white"},variant:"outline",children:e.jsx(y,{icon:ze,size:"lg",style:{color:"white"}})})}),e.jsx(c,{children:e.jsx(u,{onClick:()=>{pt(t.center,t._id)},size:"sm",style:{backgroundColor:"#ff4d4d",color:"white"},variant:"outline",children:e.jsx(y,{icon:ze,size:"lg",style:{color:"white"}})})}),e.jsx(c,{children:e.jsx(k,{to:`/marketgroups/view/map/${t._id}`,children:e.jsx(u,{size:"sm",style:{backgroundColor:"#ff4d4d",color:"white"},variant:"outline",children:e.jsx(y,{icon:Mt,size:"lg",style:{color:"white"}})})})})]},s))})]}),e.jsxs(De,{"aria-label":"Page navigation example",children:[e.jsx(B,{disabled:D<=0,onClick:tt,children:"Previous"}),e.jsx(B,{disabled:Ne===!0,onClick:et,children:"Next"})]}),e.jsxs(M,{alignment:"center",visible:$e,scrollable:!0,size:"sm",onClose:()=>$(!1),children:[e.jsx(b,{closeButton:!0,children:e.jsx(w,{children:"Change Name"})}),e.jsxs(A,{children:[e.jsx("a",{children:"Enter New Name"}),e.jsx("br",{}),e.jsx(Z,{type:"text",placeholder:Ie,value:z,onChange:t=>re(t.target.value)})]}),e.jsx(ee,{children:e.jsx(u,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>ot(),children:"Save changes"})})]}),e.jsxs(M,{alignment:"center",visible:le,scrollable:!0,size:"sm",onClose:()=>L(!1),children:[e.jsx(b,{closeButton:!1,children:e.jsx(w,{children:"Confirmation"})}),e.jsxs(A,{children:[e.jsx("a",{children:"Are you sure you want to delete this market group?"}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[e.jsx(u,{onClick:()=>at(Te),style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),e.jsx(u,{onClick:()=>L(!1),style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]}),e.jsxs(M,{alignment:"center",visible:Re,scrollable:!0,size:"lg",onClose:()=>{_(!1),x("")},children:[e.jsx(b,{closeButton:!0,children:e.jsx(w,{children:"All Assign Markets details"})}),e.jsx(A,{children:He?e.jsx(q,{}):e.jsxs(Q,{children:[e.jsx(W,{children:e.jsxs(C,{children:[e.jsx(n,{scope:"col",children:"#"}),e.jsx(n,{scope:"col",children:"Chain Name"}),e.jsx(n,{scope:"col",children:"Address"}),e.jsx(n,{scope:"col",children:"City"}),e.jsx(n,{scope:"col",children:"Remove"})]})}),e.jsx(X,{children:Ve.map((t,s)=>e.jsxs(C,{children:[e.jsx(c,{children:s+1}),e.jsx(c,{children:t.chain.name}),e.jsx(c,{children:t.address}),e.jsx(c,{children:t.city}),e.jsx(c,{children:e.jsx(u,{size:"sm",onClick:()=>mt(ne,t._id),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Remove"})})]},s))})]})}),e.jsx(ee,{})]}),e.jsxs(M,{visible:Ue,scrollable:!0,size:"xl",onClose:()=>{I(!1),R(0),x("")},children:[e.jsx(b,{closeButton:!0,children:e.jsx(w,{children:"Market assign view"})}),e.jsxs(A,{children:[e.jsx(Se,{style:{marginLeft:"54%"},color:"secondary",children:"Filter by"}),e.jsxs(J,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(K,{style:{color:"white"},children:Je}),e.jsxs(O,{children:[e.jsx(p,{onClick:()=>U("all","modal"),children:"All"}),e.jsx(p,{onClick:()=>U("Milano","modal"),children:"Milano"}),e.jsx(p,{onClick:()=>U("Napoli","modal"),children:"Napoli"})]})]}),e.jsxs(J,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(K,{style:{color:"white"},children:Ke}),e.jsxs(O,{children:[e.jsx(p,{onClick:()=>ve("all",null,"modal"),children:"All"}),Ye.map((t,s)=>e.jsx(p,{onClick:()=>ve(t.id,t.name,"modal"),children:t.name},s))]})]}),e.jsx(Pe,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),Oe?e.jsx(q,{}):e.jsxs(Q,{children:[e.jsx(W,{children:e.jsxs(C,{children:[e.jsx(n,{scope:"col",children:"#"}),e.jsx(n,{scope:"col",children:"Name"}),e.jsx(n,{scope:"col",children:"Address"}),e.jsx(n,{scope:"col",children:"City"}),e.jsx(n,{scope:"col",children:"Measurement"}),e.jsx(n,{scope:"col"})]})}),e.jsx(X,{children:Qe.map((t,s)=>e.jsxs(C,{children:[e.jsx(c,{children:E+s+1}),e.jsx(c,{children:t.chain.name}),e.jsx(c,{children:t.address}),e.jsx(c,{children:t.city}),e.jsx(c,{children:t.scraped}),e.jsx(c,{children:e.jsx(u,{size:"sm",onClick:()=>gt(ne,t._id),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Add"})})]},s))})]}),e.jsx(ee,{children:e.jsxs(De,{"aria-label":"Page navigation example",children:[e.jsx(B,{disabled:E<=0,onClick:ht,children:"Previous"}),e.jsx(B,{disabled:Xe===!0,onClick:ut,children:"Next"})]})})]})]}),e.jsxs(M,{visible:Ze,scrollable:!0,size:"lg",onClose:()=>V(!1),children:[e.jsx(b,{closeButton:!0,children:e.jsx(w,{children:"Manage Center Point"})}),e.jsx(A,{children:e.jsxs("div",{className:"row g-3",children:[e.jsx(Le,{md:6,children:e.jsx(Z,{id:"lat",label:"Latitude",defaultValue:j==null?void 0:j.lat,onChange:t=>Ae(t.target.value)})}),e.jsx(Le,{md:6,children:e.jsx(Z,{id:"lng",label:"Longitude",defaultValue:j==null?void 0:j.lng,onChange:t=>be(t.target.value)})}),e.jsx(u,{type:"submit",style:{marginBottom:"3%",width:"200px",backgroundColor:"#ff4d4d",color:"white"},onClick:()=>ft(),children:"Add Center Point"})]})})]})]})};export{Vt as default};
