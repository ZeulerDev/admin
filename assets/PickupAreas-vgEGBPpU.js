import{r as t,y as ge,A as n,j as e,i as me,L as xe,m as I}from"./index-C8F1u8CX.js";import{a as w}from"./axios-Cm0UX6qg.js";import{F as fe,E as Ce}from"./leaflet.draw-Cp79dvoX.js";import{c as ye,l as je,b as be,e as ke,M as Pe,T as we,a as Me,P as Se}from"./leaflet-t_zjCIWi.js";import{b as Ne,a as M}from"./CContainer-DGCNzwc5.js";import{d as F,C as $,a as G,b as R,c as d}from"./DefaultLayout-jNl_aC8n.js";import{C as V}from"./CNavbar-B2OifdOO.js";import{C as De,a as ve,b as _,c as g,d as Ae,e as m}from"./CTable-BJLMS1s4.js";import{c as Te}from"./cil-pencil-m516yCOw.js";import{C as Le,a as H}from"./CPaginationItem-BNKz4DJr.js";import{C as O,a as U,b as W,c as Z}from"./CModalTitle-rmQfqbIh.js";import{c as Ee}from"./cil-info-CmGCY32x.js";import{C as q}from"./CModalFooter-Cn6o4B9y.js";import{C as ze}from"./CFormInput-CWbnBQfn.js";import"./index-DTZuUkTI.js";import"./CFormLabel-DOcGNSP8.js";const Be=ye(function({positions:i,...l},r){const p=new je.Polygon(i,l);return be(p,ke(r,{overlayContainer:p}))},function(i,l,r){l.positions!==r.positions&&i.setLatLngs(l.positions)}),Xe=()=>{const x=t.useRef(null),[{user:i,token:l},r]=ge(),[p,J]=t.useState([]),[S,N]=t.useState(""),[f,D]=t.useState(0),[K,v]=t.useState("All Cities"),[Q,A]=t.useState(!1),[X,T]=t.useState(!0),[Y,C]=t.useState(!1),[ee,y]=t.useState(!1),[ae,te]=t.useState([]),[j,se]=t.useState("Napoli"),[L,oe]=t.useState([]),[b,le]=t.useState([]),[k,P]=t.useState(""),[u,E]=t.useState(""),[re,z]=t.useState("");t.useEffect(()=>{i&&l&&h(0)},[S,i]);const h=(a,s)=>{A(!0),w.get(`http://localhost:8003/pickups/areas/${a}?city=${S}`,{headers:{Authorization:`Bearer ${l}`}}).then(o=>{o.status===200?(J(o.data),A(!1),o.data.length<20?(T(!0),console.log("ok")):o.data.length>19&&T(!1)):o.status===500&&r({type:n,payload:{status:!0,title:"Market Loading error",message:o.data.message}})}).catch(o=>{console.error("Error: ",o)})},ie=()=>{const a=f+20;D(a),h(a)},ne=()=>{const a=f-20;console.log(a),D(a),h(a)},c=a=>{a==="all"?(N(""),v("All Cities")):(N(a),v(a),se(a))},ce=(a,s)=>{C(!0),oe(a),P(s),console.log(a)},de=(a,s)=>{y(!0),P(a),z(s),console.log(s)};t.useEffect(()=>{i&&l&&w.get(`http://localhost:8003/assistant/markets/groups/locations/pickup/${j}`,{headers:{Authorization:`Bearer ${l}`}}).then(a=>{a.status===200?te(a.data):a.status===500&&r({type:n,payload:{status:!0,title:"Market Group loading error",message:a.data.message}})}).catch(a=>{console.error("Error:",a)})},[i,j]);const pe=a=>{const s=a.layer;console.log("layer",s._latlngs),le(s._latlngs)},B=a=>{if(a){let s={};b&&(s={area:b}),u&&(s={name:u}),console.log(s,a),i&&l&&w.put("http://localhost:8003/pickup/area/update/"+a,s,{headers:{Authorization:`Bearer ${l}`}}).then(o=>{o.status===200?(r({type:n,payload:{status:!0,title:"Pickup Area Update",message:"Pick up area update Success",color:"success"}}),P(""),E(""),h(0),C(!1),y(!1),z("")):o.status===204?r({type:n,payload:{status:!0,title:"Pick up area update  error",message:o.data.message,color:"danger"}}):o.status===500&&r({type:n,payload:{status:!0,title:"Pick up area update  error",message:o.data.message,color:"danger"}})}).catch(o=>{console.error("Error:",o)})}else alert("Please Check the Fields!")},ue=()=>{b==""?r({type:n,payload:{status:!0,title:"Alert",message:"Please select the area",color:"danger"}}):B(k)},he=()=>{u==""&&k==""?r({type:n,payload:{status:!0,title:"Alert",message:"Please Name",color:"danger"}}):B(k)};return e.jsxs(Ne,{children:[e.jsx(F,{style:{marginLeft:"75.5%"},color:"secondary",children:"Filter by"}),e.jsxs($,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[e.jsx(G,{style:{color:"white"},children:K}),e.jsxs(R,{children:[e.jsx(d,{onClick:()=>c("all"),children:"All"}),e.jsx(d,{onClick:()=>c("Milano"),children:"Milano"}),e.jsx(d,{onClick:()=>c("Napoli"),children:"Napoli"})]})]}),e.jsx(V,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),Q?e.jsx(me,{}):e.jsxs(De,{children:[e.jsx(ve,{children:e.jsxs(_,{children:[e.jsx(g,{scope:"col",children:"Name"}),e.jsx(g,{scope:"col",children:"Type"}),e.jsx(g,{scope:"col",children:"City"}),e.jsx(g,{scope:"col",children:"View"})]})}),e.jsx(Ae,{children:p.map((a,s)=>e.jsxs(_,{children:[e.jsxs(m,{children:[a.name," ",e.jsx(xe,{to:"",children:e.jsx(I,{icon:Te,size:"sm",onClick:()=>de(a._id,a.name)})})," "]}),e.jsx(m,{children:a.geometry.type}),e.jsx(m,{children:a.city}),e.jsx(m,{children:e.jsx(M,{size:"sm",style:{backgroundColor:"#ff4d4d",color:"white"},variant:"outline",onClick:()=>ce(a.geometry.coordinate,a._id),children:"View map"})})]},s))})]}),e.jsxs(Le,{"aria-label":"Page navigation example",children:[e.jsx(H,{disabled:f<=0,onClick:ne,children:"Previous"}),e.jsx(H,{disabled:X===!0,onClick:ie,children:"Next"})]}),e.jsxs(O,{alignment:"center",visible:Y,scrollable:!0,size:"xl",onClose:()=>C(!1),children:[e.jsx(U,{closeButton:!0,children:e.jsx(W,{children:"Map View"})}),e.jsxs(Z,{children:[e.jsx(F,{style:{marginLeft:"81.5%"},color:"secondary",children:"Filter by"}),e.jsxs($,{style:{marginLeft:"2%",width:"10%",backgroundColor:"#ff4d4d"},children:[e.jsx(G,{style:{color:"white"},children:j}),e.jsxs(R,{children:[e.jsx(d,{onClick:()=>c("Milano"),children:"Milano"}),e.jsx(d,{onClick:()=>c("Napoli"),children:"Napoli"})]})]}),e.jsx(V,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),e.jsxs(Pe,{dragging:!0,center:[40.85631,14.24641],zoom:13,scrollWheelZoom:!0,style:{height:"500px",width:"100%"},children:[e.jsx(we,{attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),ae.map((a,s)=>e.jsx(Me,{position:[a.lat,a.lng],children:e.jsx(Se,{children:e.jsxs("div",{children:[e.jsx(I,{icon:Ee,size:"lg",style:{marginLeft:"10px"}})," ",e.jsx("span",{children:a.address})]})})},s)),L.length>0&&e.jsx(Be,{positions:L}),e.jsx(fe,{ref:x,children:e.jsx(Ce,{position:"topright",onCreated:pe,draw:{polygon:!0,circle:!0,polyline:!0,marker:!1,circlemarker:!1}})})]})]}),e.jsx(q,{children:e.jsx(M,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>ue(),children:"Save updated area"})})]}),e.jsxs(O,{alignment:"center",visible:ee,scrollable:!0,size:"sm",onClose:()=>y(!1),children:[e.jsx(U,{closeButton:!0,children:e.jsx(W,{children:"Change Name"})}),e.jsxs(Z,{children:[e.jsx("a",{children:"Enter New Name"}),e.jsx("br",{}),e.jsx(ze,{type:"text",placeholder:re,value:u,onChange:a=>E(a.target.value)})]}),e.jsx(q,{children:e.jsx(M,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>he(),children:"Save changes"})})]})]})};export{Xe as default};
