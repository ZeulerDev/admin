import{x as jt,r as a,z as o,j as e,L as C,h as K,m as M}from"./index-DaboRuf6.js";import{a as h}from"./axios-B4uVmeYG.js";import{B as g}from"./config-HOLfLxHr.js";import{b as yt,a as u}from"./CContainer-2x7Z1Exw.js";import{C as De,a as O,b as Q,d as W,e as x}from"./DefaultLayout-C7qb2XTq.js";import{C as Pe}from"./CNavbar-C5whDHHf.js";import{C as X,a as Z,b as p,c,d as ee,e as n}from"./CTable-HWQYIuPu.js";import{c as kt}from"./cil-pencil-m516yCOw.js";import{c as Ct}from"./cil-trash-CBbKHhHb.js";import{c as Ne}from"./cil-plus-D8mtC-W5.js";import{c as Mt}from"./cil-map-dAArMthr.js";import{C as ze,a as L}from"./CPaginationItem-Cr8xW1LR.js";import{C as b,a as w,b as A,c as S}from"./CModalTitle-Dr1SToxo.js";import{C as te}from"./CFormInput-BbE4b3UF.js";import{C as se}from"./CModalFooter-C0lTLyiC.js";import{C as Le}from"./CCol-nxyYJw1m.js";import"./CFormLabel-DqqYeAmW.js";const Rt=()=>{const[{user:m,token:d},r]=jt(),[ae,le]=a.useState(""),[Te,re]=a.useState("All Cities"),[k,T]=a.useState([]),[v,oe]=a.useState(0),[Ee,ie]=a.useState(!0),[Be,E]=a.useState(!1),[ne,D]=a.useState(!1),[Ge,$e]=a.useState(""),[_e,B]=a.useState(!1),[Ie,ce]=a.useState(""),[P,de]=a.useState(""),[Re,ue]=a.useState(""),[Ve,G]=a.useState(!1),[he,j]=a.useState(""),[ge,Fe]=a.useState([]),[He,pe]=a.useState(!1),[Ue,$]=a.useState(!1),[Ye,qe]=a.useState([]),[me,_]=a.useState(""),[Je,I]=a.useState("All Cities");a.useState("");const[xe,R]=a.useState(""),[Ke,V]=a.useState("All Chains");a.useState("All Chains");const[Oe,fe]=a.useState(!1),[je,Qe]=a.useState([]),[We,ye]=a.useState(!0),[N,F]=a.useState(0),[ke,Ce]=a.useState(""),[y,Me]=a.useState([]),[Xe,H]=a.useState(!1),[U,be]=a.useState(""),[we,Ae]=a.useState(""),[Se,Ze]=a.useState(""),Y=t=>{t==="all"?(le(""),re("All Cities")):(le(t),re(t))};a.useEffect(()=>{const t=setTimeout(()=>{r({type:o,payload:{status:!0,title:"Data Loading",message:"Data loading error: Timeout exceeded",color:"warning"}}),E(!1)},2e4);return m&&d&&z(0,t),()=>{clearTimeout(t)}},[m,ae]);const z=(t,s)=>{E(!0),h.get(g+`market/groups/fetch/${t}?city=${ae}`,{headers:{Authorization:`Bearer ${d}`}}).then(l=>{l.status===200?(T(l.data),E(!1),clearTimeout(s),l.data.length<20?ie(!0):l.data.length>19&&ie(!1)):l.status===500&&r({type:o,payload:{status:!0,title:"Makrket Group loading error",message:l.data.message}})}).catch(l=>{console.error("Error:",l)})},et=()=>{const t=v+20;oe(t),z(t,!0)},tt=()=>{const t=v-20;console.log(t),oe(t),z(t,!1)},st=t=>{D(!ne),$e(t)},at=t=>{console.log(t),h.delete(g+"marketgroup/"+t,{headers:{Authorization:`Bearer ${d}`}}).then(s=>{s.status===200?(r({type:o,payload:{status:!0,title:"Market Group Delete",message:"Market Group Delete Success",color:"success"}}),D(!1),z(0,!0),console.log("Remove Market Group")):s.status===203?r({type:o,payload:{status:!0,title:"Market Group Delete",message:s.data.message,color:"warning"}}):s.status===404?r({type:o,payload:{status:!0,title:"Market Group Delete",message:s.data.message,color:"warning"}}):s.status===500&&r({type:o,payload:{status:!0,title:"Market Group Delete",message:s.data.message,color:"warning"}})}).catch(s=>{console.error("Error:",s)})},lt=(t,s)=>{B(!0),ce(t),ue(s),console.log(s)},rt=()=>{console.log("name",P),P==""?r({type:o,payload:{status:!0,title:"Alert",message:"Please Enter Name",color:"danger"}}):ot(Ie)},ot=t=>{if(t){let s={name:P};console.log(s,t),m&&d&&h.put(g+"marketgroup/update/"+t,s,{headers:{Authorization:`Bearer ${d}`}}).then(l=>{if(l.status===200){const i=l.data,f=k.find(ft=>ft.id===i.id);f&&(f.name=i.name),T([...k]),r({type:o,payload:{status:!0,title:"Market Group Update",message:"Market group name updated successfully",color:"success"}}),ce(""),de(""),B(!1),ue("")}else l.status===204?r({type:o,payload:{status:!0,title:"Pick up area update  error",message:l.data.message,color:"danger"}}):l.status===500&&r({type:o,payload:{status:!0,title:"Pick up area update  error",message:l.data.message,color:"danger"}})}).catch(l=>{console.error("Error:",l)})}else alert("Please Check the Fields!")},it=t=>{console.log("markets",t),G(!0),j(t),nt(t)},nt=t=>{pe(!0),h.get(g+`marketgroup/markets/${t}`,{headers:{Authorization:`Bearer ${d}`}}).then(s=>{s.status===200?(Fe(s.data),console.log("data market",s.data),pe(!1)):s.status===204?r({type:o,payload:{status:!0,title:"Market Loading error",message:s.data.message}}):s.status===500&&r({type:o,payload:{status:!0,title:"Market Loading error",message:s.data.message}})}).catch(s=>{console.error("Error: ",s)})},ct=t=>{console.log("markets group",t),j(t),$(!0),Ze(t)},q=(t,s)=>{t==="all"?(_(""),I("All Cities")):(_(t),I(t))},ve=(t,s,l)=>{t==="all"?(R(""),V("All Chains")):(R(t),V(s))};a.useEffect(()=>{dt()},[]);const dt=()=>{d&&h.get(g+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${d}`}}).then(t=>{t.status===200?qe(t.data):t.status===500&&r({type:o,payload:{status:!0,title:"Chain Loading error",message:t.data.message}})}).catch(t=>{console.error("Error: ",t)})};a.useEffect(()=>{m&&d&&J(0)},[xe,me,m,Se]);const J=(t,s)=>{fe(!0),h.get(g+`assistant/market/add/group/${t}?brand=${xe}&city=${me}&gid=${Se}`,{headers:{Authorization:`Bearer ${d}`}}).then(l=>{l.status===200?(Qe(l.data.data),fe(!1),l.data.data.length<20?ye(!0):l.data.data.length>19&&ye(!1)):l.status===500&&r({type:o,payload:{status:!0,title:"Market Loading error",message:l.data.message}})}).catch(l=>{console.error("Error: ",l)})},ut=()=>{const t=N+20;F(t),J(t)},ht=()=>{const t=N-20;console.log(t),F(t),J(t)},gt=(t,s)=>{if(s&&t){const l={marketId:s};d&&m&&d&&h.patch(g+"marketgroup/add/market/"+t,l,{headers:{Authorization:`Bearer ${d}`}}).then(i=>{i.status===200?($(!1),j(""),r({type:o,payload:{status:!0,title:"Market Assign",message:"successfully Market assigned to the market group",color:"success"}})):i.status===400?r({type:o,payload:{status:!0,title:"Market Assign error",message:i.data.message,color:"warning"}}):i.status===404?r({type:o,payload:{status:!0,title:"Market Assign error",message:i.data.message,color:"warning"}}):i.status===500&&r({type:o,payload:{status:!0,title:"Market Assign error",message:i.data.message,color:"warning"}})}).catch(i=>{console.error("Error:",i)})}else r({type:o,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},pt=(t,s)=>{if(s&&t){const l={marketId:s};d&&m&&d&&h.patch(g+"marketgroup/remove/market/"+t,l,{headers:{Authorization:`Bearer ${d}`}}).then(i=>{i.status===200?(G(!1),j(""),r({type:o,payload:{status:!0,title:"Market Assign",message:"successfully Market remove from the market group",color:"success"}})):i.status===400?r({type:o,payload:{status:!0,title:"Market remove error",message:i.data.message,color:"warning"}}):i.status===404?r({type:o,payload:{status:!0,title:"Market remove error",message:i.data.message,color:"warning"}}):i.status===500&&r({type:o,payload:{status:!0,title:"Market remove error",message:i.data.message,color:"warning"}})}).catch(i=>{console.error("Error:",i)})}else r({type:o,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},mt=(t,s)=>{s&&(H(!0),Me(t),Ae(t.lat),be(t.lng),Ce(s))},xt=()=>{if(U){console.log("center",ke,we,U);const t={lat:we,lng:U};d&&m&&d&&h.patch(g+"marketgroup/update/center/"+ke,t,{headers:{Authorization:`Bearer ${d}`}}).then(s=>{if(s.status===200){H(!1),Ce(""),Me([]);const l=s.data,i=k.map(f=>(f._id===l._id&&(f.center=l.center),f));T([...i]),r({type:o,payload:{status:!0,title:"Manage Center Point",message:"successfully center point assigned to the market group",color:"success"}})}else s.status===400?r({type:o,payload:{status:!0,title:"Manage Center Point",message:s.data.message,color:"warning"}}):s.status===404?r({type:o,payload:{status:!0,title:"Manage Center Point",message:s.data.message,color:"warning"}}):s.status===500&&r({type:o,payload:{status:!0,title:"Manage Center Point",message:s.data.message,color:"warning"}})}).catch(s=>{console.error("Error:",s)})}else r({type:o,payload:{status:!0,title:"Error!",message:"check fields again",color:"warning"}})};return e.jsxs(yt,{children:[e.jsx(C,{to:"/marketgroups/marketmap",children:e.jsx(u,{style:{marginLeft:"0%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Add Market"})}),e.jsx(C,{to:"/marketgroups/createmarketgroup",children:e.jsx(u,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Create Market Group"})}),e.jsx(De,{style:{marginLeft:"39%"},color:"secondary",children:"Filter by"}),e.jsxs(O,{style:{marginLeft:"2%",width:"17%",marginRight:"5px",backgroundColor:"#ff4d4d"},children:[e.jsx(Q,{style:{color:"white"},children:Te}),e.jsxs(W,{children:[e.jsx(x,{onClick:()=>Y("all"),children:"All"}),e.jsx(x,{onClick:()=>Y("Milano"),children:"Milano"}),e.jsx(x,{onClick:()=>Y("Napoli"),children:"Napoli"})]})]}),e.jsx(Pe,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),Be?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(K,{style:{marginTop:"15%"}})}):e.jsxs(X,{children:[e.jsx(Z,{children:e.jsxs(p,{children:[e.jsx(c,{scope:"col",children:"#"}),e.jsx(c,{scope:"col",children:"Name"}),e.jsx(c,{scope:"col",children:"City"}),e.jsx(c,{scope:"col",children:"Assigned Market"}),e.jsx(c,{scope:"col",children:"Location"}),e.jsx(c,{scope:"col",children:"Action"}),e.jsx(c,{scope:"col",children:"Add Markets"}),e.jsx(c,{scope:"col",children:"Add Center Point"}),e.jsx(c,{scope:"col",children:"View Map"})]})}),e.jsx(ee,{children:k.length===0?e.jsx(p,{children:e.jsx(n,{colSpan:"9",style:{textAlign:"center",backgroundColor:"white"},children:e.jsx("h6",{style:{marginTop:"1%"},children:"No Data"})})}):k.map((t,s)=>e.jsxs(p,{children:[e.jsx(n,{children:v+s+1}),e.jsxs(n,{children:[e.jsx("span",{children:t.name}),e.jsx(C,{to:"",children:e.jsx(M,{style:{marginLeft:20,float:"right"},icon:kt,size:"sm",onClick:()=>lt(t._id,t.name)})})]}),e.jsx(n,{children:t.city}),e.jsx(n,{children:e.jsx(u,{onClick:()=>{it(t._id)},size:"sm",style:{backgroundColor:"#ff4d4d",marginLeft:"5px",color:"white"},children:"view"})}),e.jsx(n,{children:e.jsx(C,{to:`/marketgroups/marketdistance/${t._id}`,children:e.jsx(u,{size:"sm",style:{backgroundColor:"#ff4d4d",marginLeft:"5px",color:"white"},children:"view"})})}),e.jsx(n,{children:e.jsx(u,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>st(t._id),children:e.jsx(M,{icon:Ct,size:"lg",style:{color:"white"}})})}),e.jsx(n,{children:e.jsx(u,{onClick:()=>{ct(t._id)},size:"sm",style:{backgroundColor:"#ff4d4d",color:"white"},variant:"outline",children:e.jsx(M,{icon:Ne,size:"lg",style:{color:"white"}})})}),e.jsx(n,{children:e.jsx(u,{onClick:()=>{mt(t.center,t._id)},size:"sm",style:{backgroundColor:"#ff4d4d",color:"white"},variant:"outline",children:e.jsx(M,{icon:Ne,size:"lg",style:{color:"white"}})})}),e.jsx(n,{children:e.jsx(C,{to:`/marketgroups/view/map/${t._id}`,children:e.jsx(u,{size:"sm",style:{backgroundColor:"#ff4d4d",color:"white"},variant:"outline",children:e.jsx(M,{icon:Mt,size:"lg",style:{color:"white"}})})})})]},s))})]}),e.jsxs(ze,{"aria-label":"Page navigation example",children:[e.jsx(L,{disabled:v<=0,onClick:tt,children:"Previous"}),e.jsx(L,{disabled:Ee===!0,onClick:et,children:"Next"})]}),e.jsxs(b,{alignment:"center",visible:_e,scrollable:!0,size:"sm",onClose:()=>B(!1),children:[e.jsx(w,{closeButton:!0,children:e.jsx(A,{children:"Change Name"})}),e.jsxs(S,{children:[e.jsx("a",{children:"Enter New Name"}),e.jsx("br",{}),e.jsx(te,{type:"text",placeholder:Re,value:P,onChange:t=>de(t.target.value)})]}),e.jsx(se,{children:e.jsx(u,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>rt(),children:"Save changes"})})]}),e.jsxs(b,{alignment:"center",visible:ne,scrollable:!0,size:"sm",onClose:()=>D(!1),children:[e.jsx(w,{closeButton:!1,children:e.jsx(A,{children:"Confirmation"})}),e.jsxs(S,{children:[e.jsx("a",{children:"Are you sure you want to delete this market group?"}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[e.jsx(u,{onClick:()=>at(Ge),style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),e.jsx(u,{onClick:()=>D(!1),style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]}),e.jsxs(b,{alignment:"center",visible:Ve,scrollable:!0,size:"lg",onClose:()=>{G(!1),j("")},children:[e.jsx(w,{closeButton:!0,children:e.jsx(A,{children:"All Assign Markets details"})}),e.jsx(S,{children:He?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(K,{style:{marginTop:"15%"}})}):e.jsxs(X,{children:[e.jsx(Z,{children:e.jsxs(p,{children:[e.jsx(c,{scope:"col",children:"#"}),e.jsx(c,{scope:"col",children:"Chain Name"}),e.jsx(c,{scope:"col",children:"Address"}),e.jsx(c,{scope:"col",children:"City"}),e.jsx(c,{scope:"col",children:"Remove"})]})}),e.jsx(ee,{children:ge.length===0?e.jsx(p,{children:e.jsx(n,{colSpan:"5",style:{textAlign:"center",backgroundColor:"white"},children:e.jsx("h6",{style:{marginTop:"1%"},children:"No Data"})})}):ge.map((t,s)=>e.jsxs(p,{children:[e.jsx(n,{children:s+1}),e.jsx(n,{children:t.chain.name}),e.jsx(n,{children:t.address}),e.jsx(n,{children:t.city}),e.jsx(n,{children:e.jsx(u,{size:"sm",onClick:()=>pt(he,t._id),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Remove"})})]},s))})]})}),e.jsx(se,{})]}),e.jsxs(b,{visible:Ue,scrollable:!0,size:"xl",onClose:()=>{$(!1),F(0),j(""),_(""),R(""),I("All Cities"),V("All Chains")},children:[e.jsx(w,{closeButton:!0,children:e.jsx(A,{children:"Market assign view"})}),e.jsxs(S,{children:[e.jsx(De,{style:{marginLeft:"54%"},color:"secondary",children:"Filter by"}),e.jsxs(O,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(Q,{style:{color:"white"},children:Je}),e.jsxs(W,{children:[e.jsx(x,{onClick:()=>q("all"),children:"All"}),e.jsx(x,{onClick:()=>q("Milano"),children:"Milano"}),e.jsx(x,{onClick:()=>q("Napoli"),children:"Napoli"})]})]}),e.jsxs(O,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(Q,{style:{color:"white"},children:Ke}),e.jsxs(W,{children:[e.jsx(x,{onClick:()=>ve("all",null),children:"All"}),Ye.map((t,s)=>e.jsx(x,{onClick:()=>ve(t.id,t.name),children:t.name},s))]})]}),e.jsx(Pe,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),Oe?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(K,{style:{marginTop:"15%"}})}):e.jsxs(X,{children:[e.jsx(Z,{children:e.jsxs(p,{children:[e.jsx(c,{scope:"col",children:"#"}),e.jsx(c,{scope:"col",children:"Name"}),e.jsx(c,{scope:"col",children:"Address"}),e.jsx(c,{scope:"col",children:"City"}),e.jsx(c,{scope:"col",children:"Scraped"}),e.jsx(c,{scope:"col"})]})}),e.jsx(ee,{children:je.length===0?e.jsx(p,{children:e.jsx(n,{colSpan:"6",style:{textAlign:"center",backgroundColor:"white"},children:e.jsx("h6",{style:{marginTop:"1%"},children:"No Data"})})}):je.map((t,s)=>e.jsxs(p,{children:[e.jsx(n,{children:N+s+1}),e.jsx(n,{children:t.chain.name}),e.jsx(n,{children:t.address}),e.jsx(n,{children:t.city}),e.jsx(n,{children:t.scraped}),e.jsx(n,{children:e.jsx(u,{size:"sm",onClick:()=>gt(he,t._id),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Add"})})]},s))})]}),e.jsx(se,{children:e.jsxs(ze,{"aria-label":"Page navigation example",children:[e.jsx(L,{disabled:N<=0,onClick:ht,children:"Previous"}),e.jsx(L,{disabled:We===!0,onClick:ut,children:"Next"})]})})]})]}),e.jsxs(b,{visible:Xe,scrollable:!0,size:"lg",onClose:()=>H(!1),children:[e.jsx(w,{closeButton:!0,children:e.jsx(A,{children:"Manage Center Point"})}),e.jsx(S,{children:e.jsxs("div",{className:"row g-3",children:[e.jsx(Le,{md:6,children:e.jsx(te,{id:"lat",label:"Latitude",defaultValue:y==null?void 0:y.lat,onChange:t=>Ae(t.target.value)})}),e.jsx(Le,{md:6,children:e.jsx(te,{id:"lng",label:"Longitude",defaultValue:y==null?void 0:y.lng,onChange:t=>be(t.target.value)})}),e.jsx(u,{type:"submit",style:{marginBottom:"3%",width:"200px",backgroundColor:"#ff4d4d",color:"white"},onClick:()=>xt(),children:"Add Center Point"})]})})]})]})};export{Rt as default};
