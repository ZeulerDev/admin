import{A as at,r,x as ot,z as c,j as e,h as ie,L as rt,m as de}from"./index-Dy30eiM6.js";import{B as j}from"./config-HOLfLxHr.js";import{a as y}from"./axios-B4uVmeYG.js";/* empty css               */import{b as lt,a as P}from"./CContainer-PswvU4of.js";import{C as ue}from"./CNavbar-DSEUJjHx.js";import{C as B}from"./CFormInput-C4Xof77t.js";import{C as pe,a as he,b,c as n,d as ge,e as d}from"./CTable-2kSvDEKq.js";import{C as me}from"./CCardImage-BhaXftd9.js";import{c as ct}from"./cil-pencil-m516yCOw.js";import{c as nt}from"./cil-trash-CBbKHhHb.js";import{C as xe,a as S}from"./CPaginationItem-CIVwLBfW.js";import{C as Q,a as U,b as H,c as O}from"./CModalTitle-CFHTVTiy.js";import{C as it,a as dt,b as ut,d as pt,e as fe}from"./DefaultLayout-E8F3KeA2.js";import{C as q}from"./CModalFooter-BrzcW4v0.js";import"./CFormLabel-CXmS8KuA.js";const Nt=()=>{const{id:p}=at();r.useState([]);const[je,C]=r.useState(!1),[{user:m,token:u},l]=ot(),[ye,M]=r.useState(!1),[Pe,k]=r.useState(!1);r.useState("All Cities");const[Ce,G]=r.useState("All Markets");r.useState(""),r.useState(""),r.useState(""),r.useState("All Cities"),r.useState(""),r.useState("All Chains"),r.useState([]),r.useState([]),r.useState([]);const[ke,be]=r.useState([{_id:"",name:""}]),[Se,J]=r.useState(!0),[v,w]=r.useState(0),[Ae,K]=r.useState(0),[I,N]=r.useState(1),[Me,ve]=r.useState(0),[T,z]=r.useState(1),[we,W]=r.useState(!0),[D,E]=r.useState(0),[$,X]=r.useState([]),[Y,Ie]=r.useState([]),[Ne,Te]=r.useState([]),[A,Z]=r.useState(""),[g,De]=r.useState(""),[Be,ee]=r.useState(g),[F,te]=r.useState(""),[ze,se]=r.useState(!1),[Ee,L]=r.useState(!1),[$e,ae]=r.useState(""),[R,oe]=r.useState(""),[Fe,re]=r.useState(""),[Le,V]=r.useState(!1),[_,le]=r.useState(""),[ht,Re]=r.useState("");r.useEffect(()=>{console.log("id",p),x(p,0)},[Be]),r.useEffect(()=>{const t=setTimeout(()=>{(g.length>=3||g.length===0)&&ee(g)},500);return()=>{clearTimeout(t)}},[g]);const x=(t,a)=>{t?(console.log("id",t),m&&u?(C(!0),y.get(j+`promotion/products/${a}?promotionId=${t}&name=${g}`,{headers:{Authorization:`Bearer ${u}`}}).then(s=>{s.status===200?(console.log("products",s.data.list),X(s.data.list),K(s.data.count),Te(s.data.list.map(o=>o.productId)),C(!1),s.data.list.length<50?(J(!0),console.log("ok")):s.data.list.length>49&&J(!1)):s.status===203?(console.log("products 203"),C(!1),l({type:c,payload:{status:!0,title:" Products loading error",message:s.data.message}})):s.status===204?C(!1):s.status===500&&(console.log("products 500"),C(!1),l({type:c,payload:{status:!0,title:" Products loading error",message:s.data.message}}))})):(console.log("products non"),C(!1))):l({type:c,payload:{status:!0,title:" markets loading error",message:"No id found"}})},Ve=()=>{M(!0)},_e=(t,a)=>{if(console.log("promotionId",t,"pId",a),a&&t){const s={productId:a};u&&m&&u&&y.patch(j+"promotion/add/product/"+t,s,{headers:{Authorization:`Bearer ${u}`}}).then(o=>{o.status===200?(M(!1),x(t),l({type:c,payload:{status:!0,title:"Product Assign",message:"successfully Product assigned to the promotion",color:"success"}})):o.status===400?l({type:c,payload:{status:!0,title:"Product Assign error",message:o.data.message,color:"warning"}}):o.status===404?l({type:c,payload:{status:!0,title:"Product Assign error",message:o.data.message,color:"warning"}}):o.status===500&&l({type:c,payload:{status:!0,title:"Product Assign error",message:o.data.message,color:"warning"}})}).catch(o=>{console.error("Error:",o)})}else l({type:c,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},ce=(t,a)=>{if(console.log("promotionId",t,"pid",a),a&&t){const s={productId:a};u&&m&&u&&y.patch(j+"promotion/remove/product/"+t,s,{headers:{Authorization:`Bearer ${u}`}}).then(o=>{o.status===200?(x(t),M(!1),l({type:c,payload:{status:!0,title:"Market Assign",message:"successfully Market removed from the promotion",color:"success"}})):o.status===204?l({type:c,payload:{status:!0,title:"Market remove error",message:o.data.message,color:"warning"}}):o.status===500&&l({type:c,payload:{status:!0,title:"Market remove error",message:o.data.message,color:"warning"}})}).catch(o=>{console.error("Error:",o)})}else l({type:c,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},Qe=()=>{N(I+1);const t=v+50;w(t),x(p,t)},Ue=()=>{N(I-1);const t=v-50;console.log(t),w(t),x(p,t)},He=t=>{N(t);const a=(t-1)*50;w(a),x(p,a)},Oe=()=>{const t=Math.ceil(Ae/50),a=[];for(let i=1;i<=t;i++)a.push(i);const s=Math.max(I-2,1),o=Math.min(s+4,t);return a.slice(s-1,o).map(i=>e.jsx(S,{active:I===i,onClick:()=>He(i),children:i},i))},qe=t=>{t?(console.log("id",t),m&&u?y.get(j+"promotion/all/markets/"+t,{headers:{Authorization:`Bearer ${u}`}}).then(a=>{a.status===200?(console.log("market",a.data.market),a.data.market.length===0&&(k(!1),l({type:c,payload:{status:!0,title:"Products loading",message:"No Market found",color:"info"}})),be(a.data.market.map(s=>({_id:s._id,name:s.address})))):a.status===203?l({type:c,payload:{status:!0,title:" markets loading error",message:a.data.message}}):a.status===500&&l({type:c,payload:{status:!0,title:" markets loading error",message:a.data.message}})}):l({type:c,payload:{status:!0,title:" markets loading error",message:"No user or token found"}})):l({type:c,payload:{status:!0,title:" markets loading error",message:"No id found"}})},ne=(t,a)=>{a==="all"?(Z(""),G("All Markets"),f(0,"",p),console.log("all")):(console.log("selected",t),Z(t),G(a),f(0,t,p))};r.useEffect(()=>{ze&&f(0,A,p)},[F]);const f=(t,a,s)=>{m&&u?(k(!0),y.get(j+`promotion/all/markets/products/${t}?marketId=${a}&promoId=${s}&name=${F}`,{headers:{Authorization:`Bearer ${u}`}}).then(o=>{o.status===200?(console.log("market",o.data.list),Ie(o.data.list),ve(o.data.count),k(!1),se(!0),o.data.list.length<20?(W(!0),console.log("ok")):o.data.list.length>19&&W(!1)):o.status===203?(k(!1),l({type:c,payload:{status:!0,title:" Products loading error",message:o.data.message}})):o.status===500&&(k(!1),l({type:c,payload:{status:!0,title:" Products loading error",message:o.data.message}}))})):(k(!1),l({type:c,payload:{status:!0,title:" Products loading error",message:"No user or token found"}}))},Ge=()=>{z(T+1);const t=D+50;E(t),f(t,A,p)},Je=()=>{z(T-1);const t=D-50;console.log(t),E(t),f(t,A,p)},Ke=t=>{z(t);const a=(t-1)*50;E(a),f(a,A,p)},We=()=>{const t=Math.ceil(Me/50),a=[];for(let i=1;i<=t;i++)a.push(i);const s=Math.max(T-2,1),o=Math.min(s+4,t);return a.slice(s-1,o).map(i=>e.jsx(S,{active:T===i,onClick:()=>Ke(i),children:i},i))},Xe=(t,a)=>{L(!0),ae(t),re(a)},Ye=()=>{console.log("called"),R==""?l({type:c,payload:{status:!0,title:"Alert",message:"Please enter the promotion price",color:"warning"}}):Ze($e)},Ze=t=>{if(console.log("product Id",t),t){const a={value:R};console.log("formData",a),u&&m&&u&&y.patch(j+"promotion/update/promo/value/"+t,a,{headers:{Authorization:`Bearer ${u}`}}).then(s=>{if(s.status===200){l({type:c,payload:{status:!0,title:"Product Details Update",message:"Product promotion price update Success",color:"success"}}),ae(""),oe(""),L(!1),re("");const o=s.data,h=$.map(i=>(i.productId===o.productId&&(i.promo_value=o.promo_value),i));X([...h])}else s.status===400?l({type:c,payload:{status:!0,title:"Product update error",message:s.data.message,color:"warning"}}):s.status===404?l({type:c,payload:{status:!0,title:"Product update error",message:s.data.message,color:"warning"}}):s.status===500&&l({type:c,payload:{status:!0,title:"Product update error",message:s.data.message,color:"warning"}})}).catch(s=>{console.error("Error:",s)})}else l({type:c,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},et=()=>{V(!0)},tt=()=>{console.log("called"),_==""?l({type:c,payload:{status:!0,title:"Alert",message:"Please enter the promotion price",color:"warning"}}):st(p)},st=t=>{if(console.log("promotion Id",t),t){const a={value:_};console.log("formData",a),u&&m&&u&&y.patch(j+"promotion/update/promo/all/value/"+t,a,{headers:{Authorization:`Bearer ${u}`}}).then(s=>{s.status===200?(l({type:c,payload:{status:!0,title:"Product Details Update",message:"Product promotion price update Success",color:"success"}}),le(""),V(!1),Re(""),x(t,0)):s.status===400?l({type:c,payload:{status:!0,title:"Product update error",message:s.data.message,color:"warning"}}):s.status===404?l({type:c,payload:{status:!0,title:"Product update error",message:s.data.message,color:"warning"}}):s.status===500&&l({type:c,payload:{status:!0,title:"Product update error",message:s.data.message,color:"warning"}})}).catch(s=>{console.error("Error:",s)})}else l({type:c,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})};return e.jsxs(lt,{children:[e.jsx(P,{onClick:()=>{Ve(),qe(p),f(0,A,p)},style:{marginLeft:"0%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Add Products"}),e.jsxs(ue,{style:{justifyContent:"flex-start"},className:"bg-body-tertiary",children:[e.jsx(B,{type:"text",placeholder:"Search products by name",style:{width:450,marginRight:"0%"},value:g,onChange:t=>De(t.target.value)}),e.jsx(P,{onClick:()=>{et()},style:{marginLeft:"44%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Apply All"})]}),je?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(ie,{style:{marginTop:"15%"}})}):e.jsxs(pe,{children:[e.jsx(he,{children:e.jsxs(b,{children:[e.jsx(n,{scope:"col",children:"#"}),e.jsx(n,{scope:"col",children:"Product Id"}),e.jsx(n,{scope:"col",children:"Photo"}),e.jsx(n,{scope:"col",children:"Name"}),e.jsx(n,{scope:"col",children:"Base Price"}),e.jsx(n,{scope:"col",children:"Markup Percentage "}),e.jsx(n,{scope:"col",children:"Markup"}),e.jsx(n,{scope:"col",children:"Tax"}),e.jsx(n,{scope:"col",children:"Total"}),e.jsx(n,{scope:"col",children:"Promotion Value"}),e.jsx(n,{scope:"col",children:"Brand"}),e.jsx(n,{scope:"col",children:"Chain"}),e.jsx(n,{scope:"col",children:"Market Address"}),e.jsx(n,{scope:"col",children:"Remove"})]})}),e.jsx(ge,{children:$.length===0?e.jsx(b,{children:e.jsx(d,{colSpan:"14",style:{textAlign:"center",backgroundColor:"white"},children:e.jsx("h6",{style:{marginTop:"1%"},children:"No Data"})})}):$.map((t,a)=>{var s,o,h,i;return e.jsxs(b,{children:[e.jsx(d,{children:v+a+1}),e.jsx(d,{children:t.pid}),e.jsx(n,{onClick:()=>{},children:e.jsx(me,{style:{width:"50px",height:"50px"},src:"https://api.zeuler.com/image/"+t.image})}),e.jsx(d,{children:t.name}),e.jsxs(d,{children:[" ",(((s=t.price)==null?void 0:s.basePrice)??0).toFixed(2)," "]}),e.jsxs(d,{children:[t.price.percentage,"%"]}),e.jsx(d,{children:(((o=t.price)==null?void 0:o.markup)??0).toFixed(2)}),e.jsx(d,{children:(((h=t.price)==null?void 0:h.tax)??0).toFixed(2)}),e.jsx(d,{children:(((i=t.price)==null?void 0:i.total)??0).toFixed(2)}),e.jsxs(d,{children:[t.promo_value," €",e.jsx(rt,{to:"",children:e.jsx(de,{icon:ct,size:"sm",onClick:()=>Xe(t.productId,t.promo_value)})})]}),e.jsx(d,{children:t.brand}),e.jsx(d,{children:t.chainName}),e.jsx(d,{children:t.marketAddress}),e.jsx(d,{children:e.jsx(P,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>{ce(p,t.productId)},children:e.jsx(de,{icon:nt,size:"lg",style:{color:"white"}})})})]},a)})})]}),e.jsxs(xe,{"aria-label":"Page navigation example",children:[e.jsx(S,{disabled:v<=0,onClick:Ue,children:"Previous"}),Oe(),e.jsx(S,{disabled:Se===!0,onClick:Qe,children:"Next"})]}),e.jsxs(Q,{visible:ye,scrollable:!0,size:"xl",onClose:()=>{se(!1),M(!1),te(""),K(0),w(0),N(1)},children:[e.jsx(U,{closeButton:!0,children:e.jsx(H,{children:"Products assign view"})}),e.jsxs(O,{children:[e.jsx(it,{style:{marginLeft:"64%"},color:"secondary",children:"Filter by"}),e.jsxs(dt,{style:{marginLeft:"2%",width:"28%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(ut,{style:{color:"white"},children:Ce}),e.jsxs(pt,{children:[e.jsx(fe,{onClick:()=>ne(null,"all"),children:"All"}),ke.map((t,a)=>e.jsx(fe,{onClick:()=>ne(t._id,t.name),children:t.name},a))]})]}),e.jsx(ue,{style:{marginTop:"1%"},className:"bg-body-tertiary",children:e.jsx(B,{type:"text",placeholder:"Search products by name",style:{width:450,marginRight:"60%"},value:F,onChange:t=>te(t.target.value)})}),Pe?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(ie,{style:{marginTop:"15%"}})}):e.jsxs(pe,{children:[e.jsx(he,{children:e.jsxs(b,{children:[e.jsx(n,{scope:"col",children:"#"}),e.jsx(n,{scope:"col",children:"Product Id"}),e.jsx(n,{scope:"col",children:"Photo"}),e.jsx(n,{scope:"col",children:"Name"}),e.jsx(n,{scope:"col",children:"Base Price"}),e.jsx(n,{scope:"col",children:"Markup Percentage "}),e.jsx(n,{scope:"col",children:"Markup"}),e.jsx(n,{scope:"col",children:"Tax"}),e.jsx(n,{scope:"col",children:"Total"}),e.jsx(n,{scope:"col",children:"Brand"}),e.jsx(n,{scope:"col",children:"Chain"}),e.jsx(n,{scope:"col",children:"Market Address"}),e.jsx(n,{scope:"col",children:"Action"})]})}),e.jsx(ge,{children:Y.length===0?e.jsx(b,{children:e.jsx(d,{colSpan:"13",style:{textAlign:"center",backgroundColor:"white"},children:e.jsx("h6",{style:{marginTop:"1%"},children:"No Data"})})}):Y.map((t,a)=>{var s,o,h,i;return e.jsxs(b,{children:[e.jsx(d,{children:D+a+1}),e.jsx(d,{children:t.pid}),e.jsx(n,{children:e.jsx(me,{style:{width:"50px",height:"50px"},src:"https://api.zeuler.com/image/"+t.image})}),e.jsx(d,{children:t.name}),e.jsxs(d,{children:[" ",(((s=t.price)==null?void 0:s.basePrice)??0).toFixed(2)," "]}),e.jsxs(d,{children:[t.price.percentage,"%"]}),e.jsx(d,{children:(((o=t.price)==null?void 0:o.markup)??0).toFixed(2)}),e.jsx(d,{children:(((h=t.price)==null?void 0:h.tax)??0).toFixed(2)}),e.jsx(d,{children:(((i=t.price)==null?void 0:i.total)??0).toFixed(2)}),e.jsx(d,{children:t.brand}),e.jsx(d,{children:t.chainName}),e.jsx(d,{children:t.marketAddress}),e.jsx(d,{children:Ne.includes(t.productId)?e.jsx(P,{size:"sm",onClick:()=>{ce(p,t.productId)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Remove"}):e.jsx(P,{size:"sm",onClick:()=>{_e(p,t.productId)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Add"})})]},a)})})]}),e.jsx(q,{children:e.jsxs(xe,{"aria-label":"Page navigation example",children:[e.jsx(S,{disabled:D<=0,onClick:Je,children:"Previous"}),We(),e.jsx(S,{disabled:we===!0,onClick:Ge,children:"Next"})]})})]})]}),e.jsxs(Q,{alignment:"center",visible:Ee,scrollable:!0,size:"sm",onClose:()=>L(!1),children:[e.jsx(U,{closeButton:!0,children:e.jsx(H,{children:"Change Promotion Value"})}),e.jsxs(O,{children:[e.jsx("a",{children:"Add Promotion Value"}),e.jsx("br",{}),e.jsx(B,{type:"text",placeholder:Fe,value:R,onChange:t=>oe(t.target.value)})]}),e.jsx(q,{children:e.jsx(P,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>Ye(),children:"Save changes"})})]}),e.jsxs(Q,{alignment:"center",visible:Le,scrollable:!0,size:"sm",onClose:()=>V(!1),children:[e.jsx(U,{closeButton:!0,children:e.jsx(H,{children:"Add promotion value to all products"})}),e.jsxs(O,{children:[e.jsx("a",{children:"Add Promotion Value"}),e.jsx("br",{}),e.jsx(B,{type:"text",value:_,onChange:t=>le(t.target.value)})]}),e.jsx(q,{children:e.jsx(P,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>tt(),children:"Save changes"})})]})]})};export{Nt as default};
