import{r as l,y as we,l as Te,A as p,j as e,h as W}from"./index-BbIMGn6I.js";import{a as m}from"./axios-Cm0UX6qg.js";import{B as C}from"./config-HOLfLxHr.js";import{b as ve,a as X}from"./CContainer-DW1l_mtt.js";import{C as E}from"./CNavbar-CaFAFoGR.js";import{C as y,a as b,b as M,c as n,d as Y}from"./DefaultLayout-DAj23qfB.js";import{C as Ge}from"./CFormInput-CYaLtnDR.js";import{C as Z,a as ee,b as P,c as o,d as se,e as i}from"./CTable-Bo3KO6JA.js";import{C as $e}from"./CCardImage-D6kN_Ugx.js";import{C as ae,a as g}from"./CPaginationItem-Cm1VX4Uo.js";import"./CFormLabel-0HkVgzW6.js";const Ke=()=>{const[t,D]=l.useState("all"),[{user:N,token:d},h]=we(),[B,u]=l.useState(!1),[me,Ce]=l.useState([]),[x,F]=l.useState(0),[I,f]=l.useState(!0),[te,ye]=l.useState([]),[re,R]=l.useState("All Chains"),[z,le]=l.useState("All market"),[oe,_]=l.useState(""),[ie,ne]=l.useState(""),[ce,Q]=l.useState([]),[j,H]=l.useState(""),[be,de]=l.useState(j);l.useState(!1),l.useState(""),l.useState(""),l.useState("");const[he,ue]=l.useState(0),[w,U]=l.useState(1),Me=Te(),[Pe,T]=l.useState(!1),[Se,Ee]=l.useState(""),[q,xe]=l.useState(""),[pe,fe]=l.useState("All Cities"),[Ae,Le]=l.useState([]);l.useEffect(()=>{Pe&&(t==="Market"?A(0):t==="Market Group"&&L(0))},[N,q,oe]),l.useEffect(()=>{t==="Product"&&N&&d&&S(0)},[N,d,ie,be]),l.useEffect(()=>{if(t==="Product"){const s=setTimeout(()=>{(j.length>=3||j.length===0)&&de(j)},500);return()=>{clearTimeout(s)}}},[j]);const v=s=>{s==="all"?(D("All"),T(!1)):s==="Product"?(S(0),je(),D(s),T(!0)):s==="Market"?(A(0),je(),D(s),T(!0)):s==="Market Group"&&(L(0),D(s),T(!0))},S=(s,a)=>{u(!0),m.get(C+`product/all/${s}?marketId=${ie}&name=${j}`,{headers:{Authorization:`Bearer ${d}`}}).then(r=>{r.status===200?(Ce(r.data.list),ue(r.data.count),u(!1),r.data.list.length<20?(f(!0),console.log("ok")):r.data.list.length>19&&f(!1)):r.status===203?(u(!1),h({type:p,payload:{status:!0,title:"product loading error error",message:r.data.message}})):r.status===204?(u(!1),h({type:p,payload:{status:!0,title:"No Products",message:"No products found in this market address",color:"info"}})):r.status===500&&(u(!1),h({type:p,payload:{status:!0,title:"product loading error error",message:r.data.message}}))}).catch(r=>{u(!1),console.error("Error:",r)})},je=()=>{d&&m.get(C+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${d}`}}).then(s=>{s.status===200?ye(s.data):s.status===500&&h({type:p,payload:{status:!0,title:"Chain Loading error",message:s.data.message}})}).catch(s=>{console.error("Error: ",s)})},G=(s,a)=>{s==="all"?(_(""),R("All Chains")):(_(s),t==="Product"&&De(s),R(a))},De=s=>{m.get(C+`assistant/market/locations?brand=${s}`,{headers:{Authorization:`Bearer ${d}`}}).then(a=>{a.status===200?(Q(a.data.data),a.data.data.length<20?(f(!0),console.log("ok")):a.data.data.length>19&&f(!1)):a.status===500&&h({type:p,payload:{status:!0,title:"Market Loading error",message:a.data.message}})}).catch(a=>{console.error("Error: ",a)})},ge=(s,a)=>{s==="all"?(ne(""),le("All Markets"),_(""),R("All Chains"),Q([]),H("")):(ne(s),le(a),H(""))},Ne=s=>{U(s);let a;t==="Product"?a=(s-1)*50:(t==="Market"||t==="Market Group")&&(a=(s-1)*20),F(a),t==="Product"?S(a):t==="Market"?A(a):t==="Market Group"&&L(a)},ke=()=>{let s;t==="Product"?s=Math.ceil(he/50):(t==="Market"||t==="Market Group")&&(s=Math.ceil(he/20));const a=[];for(let c=1;c<=s;c++)a.push(c);const r=Math.max(w-2,1),$=Math.min(r+4,s);return a.slice(r-1,$).map(c=>e.jsx(g,{active:w===c,onClick:()=>Ne(c),children:c},c))},J=()=>{U(w+1);let s;t==="Product"?s=x+50:(t==="Market"||t==="Market Group")&&(s=x+20),F(s),t==="Product"?S(s):t==="Market"?A(s):t==="Market Group"&&L(s)},K=()=>{U(w-1);let s;t==="Product"?s=x-50:(t==="Market"||t==="Market Group")&&(s=x-20),F(s),t==="Product"?S(s):t==="Market"?A(s):t==="Market Group"&&L(s)},k=s=>{s==="all"?(xe(""),fe("All Cities")):(xe(s),fe(s))},A=s=>{u(!0),m.get(C+`assistant/market/locations/${s}?brand=${oe}&city=${q}`,{headers:{Authorization:`Bearer ${d}`}}).then(a=>{a.status===200?(Q(a.data.data),ue(a.data.count),u(!1),a.data.data.length<20?(f(!0),console.log("ok")):a.data.data.length>19&&f(!1)):a.status===500&&h({type:p,payload:{status:!0,title:"Market Loading error",message:a.data.message}})}).catch(a=>{console.error("Error: ",a)})},L=s=>{u(!0),m.get(C+`market/groups/fetch/${s}?city=${q}`,{headers:{Authorization:`Bearer ${d}`}}).then(a=>{console.log(a.status),a.status===200?(Le(a.data),u(!1),a.data.length<20?(f(!0),console.log("ok")):a.data.length>19&&f(!1)):a.status===500&&h({type:p,payload:{status:!0,title:"Makrket Group loading error",message:a.data.message}})}).catch(a=>{console.error("Error:",a)})},O=s=>{if(console.log(t,Se),t&&s){const a={type:t,id:s};console.log(a),N&&d&&m.post(C+"deepLink/urls/create",a,{headers:{Authorization:`Bearer ${d}`}}).then(r=>{r.status===200?(h({type:p,payload:{status:!0,title:"Link Registration",message:"Link Registration Success",color:"success"}}),Me("/marketing/all")):r.status===400?h({type:p,payload:{status:!0,title:"Link Registration error",message:"Link Registration Failed",color:"info"}}):r.status===500&&h({type:p,payload:{status:!0,title:"Link Registration error",message:r.data.message}})}).catch(r=>{console.error("Error:",r)})}else alert("Please Check the Fields!")};return e.jsxs(ve,{children:[e.jsx(E,{style:{marginTop:"1%"},className:"bg-body-tertiary",children:e.jsxs(y,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[e.jsx(b,{style:{color:"white"},children:t}),e.jsxs(M,{children:[e.jsx(n,{onClick:()=>v("all"),children:"All"}),e.jsx(n,{onClick:()=>v("Product"),children:"Product"}),e.jsx(n,{onClick:()=>v("Market"),children:"Market"}),e.jsx(n,{onClick:()=>v("Market Group"),children:"Market Group"})]})]})}),t==="all"&&e.jsx("h1",{}),t==="Product"&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{style:{marginLeft:"57%"},color:"secondary",children:"Filter by"}),e.jsxs(y,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[e.jsx(b,{children:re}),e.jsxs(M,{children:[e.jsx(n,{onClick:()=>G("all"),children:"All"}),te.map((s,a)=>e.jsx(n,{onClick:()=>G(s.id,s.name),children:s.name},a))]})]}),e.jsxs(y,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[e.jsx(b,{children:z.length>15?`${z.substring(0,15)}...`:z}),e.jsxs(M,{children:[e.jsx(n,{onClick:()=>ge("all"),children:"Select the Chain"}),ce.map((s,a)=>e.jsx(n,{onClick:()=>ge(s._id,s.address),children:e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:s.address.substring(0,s.address.length/2)}),e.jsx("span",{children:s.address.substring(s.address.length/2)})]})},a))]})]}),e.jsx(E,{style:{marginTop:"1%"},className:"bg-body-tertiary",children:e.jsx(Ge,{type:"text",placeholder:"Search products by name, brand name and product id",style:{width:450,marginRight:"60%"},value:j,onChange:s=>H(s.target.value)})}),B?e.jsx(W,{}):e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsxs(P,{children:[e.jsx(o,{scope:"col",children:"#"}),e.jsx(o,{scope:"col",children:"Product Id"}),e.jsx(o,{scope:"col",children:"Photo"}),e.jsx(o,{scope:"col",children:"Name"}),e.jsx(o,{scope:"col",children:"Base Price"}),e.jsx(o,{scope:"col",children:"Tax"}),e.jsx(o,{scope:"col",children:"Markup Percentage "}),e.jsx(o,{scope:"col",children:"Markup"}),e.jsx(o,{scope:"col",children:"Total"}),e.jsx(o,{scope:"col",children:"Brand"}),e.jsx(o,{scope:"col",children:"Chain"}),e.jsx(o,{scope:"col",children:"Market Address"}),e.jsx(o,{scope:"col",children:"Add Link"})]})}),e.jsx(se,{children:me.map((s,a)=>{var r,$,V,c;return e.jsxs(P,{children:[e.jsx(i,{children:x+a+1}),e.jsx(i,{children:s.pid}),e.jsx(o,{children:e.jsx($e,{style:{width:"50px",height:"50px"},src:"https://api.zeuler.com/image/"+s.image})}),e.jsx(i,{children:s.name}),e.jsxs(i,{children:[(((r=s.price)==null?void 0:r.basePrice)??0).toFixed(2),"\\"]}),e.jsx(i,{children:((($=s.price)==null?void 0:$.tax)??0).toFixed(2)}),e.jsxs(i,{children:[s.price.percentage,"%"]}),e.jsx(i,{children:(((V=s.price)==null?void 0:V.markup)??0).toFixed(2)}),e.jsx(i,{children:(((c=s.price)==null?void 0:c.total)??0).toFixed(2)}),e.jsx(i,{children:s.brand}),e.jsx(i,{children:s.chainName}),e.jsx(i,{children:s.marketAddress}),e.jsx(i,{children:e.jsx(X,{size:"sm",style:{backgroundColor:"#ff4d4d",marginLeft:"5px",color:"white"},variant:"outline",onClick:()=>{O(s.productId)},children:"Add"})})]},a)})})]}),e.jsxs(ae,{"aria-label":"Page navigation example",children:[e.jsx(g,{disabled:x<=0,onClick:K,children:"Previous"}),ke(),e.jsx(g,{disabled:I===!0,onClick:J,children:"Next"})]})]}),t==="Market"&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{style:{marginLeft:"57%"},color:"secondary",children:"Filter by"}),e.jsxs(y,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[e.jsx(b,{style:{color:"white"},children:pe}),e.jsxs(M,{children:[e.jsx(n,{onClick:()=>k("all"),children:"All"}),e.jsx(n,{onClick:()=>k("Milano"),children:"Milano"}),e.jsx(n,{onClick:()=>k("Napoli"),children:"Napoli"})]})]}),e.jsxs(y,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[e.jsx(b,{style:{color:"white"},children:re}),e.jsxs(M,{children:[e.jsx(n,{onClick:()=>G("all"),children:"All"}),te.map((s,a)=>e.jsx(n,{onClick:()=>G(s.id,s.name),children:s.name},a))]})]}),e.jsx(E,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),B?e.jsx(W,{}):e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsxs(P,{children:[e.jsx(o,{scope:"col",children:"#"}),e.jsx(o,{scope:"col",children:"Name"}),e.jsx(o,{scope:"col",children:"Address"}),e.jsx(o,{scope:"col",children:"City"}),e.jsx(o,{scope:"col",children:"Scraped"}),e.jsx(o,{scope:"col",children:"Add Link"})]})}),e.jsx(se,{children:ce.map((s,a)=>{var r;return e.jsxs(P,{children:[e.jsx(i,{children:x+a+1}),e.jsx(i,{children:(r=s.chain)==null?void 0:r.name}),e.jsx(i,{children:s.address}),e.jsx(i,{children:s.city}),e.jsx(i,{children:s.scraped}),e.jsx(i,{children:e.jsx(X,{size:"sm",style:{backgroundColor:"#ff4d4d",marginLeft:"5px",color:"white"},variant:"outline",onClick:()=>{O(s._id)},children:"Add"})})]},a)})})]}),e.jsxs(ae,{"aria-label":"Page navigation example",children:[e.jsx(g,{disabled:x<=0,onClick:K,children:"Previous"}),ke(),e.jsx(g,{disabled:I===!0,onClick:J,children:"Next"})]})]}),t==="Market Group"&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{style:{marginLeft:"75%",marginTop:"2%"},color:"secondary",children:"Filter by"}),e.jsxs(y,{style:{marginLeft:"2%",width:"17%",marginRight:"5px",backgroundColor:"#ff4d4d"},children:[e.jsx(b,{style:{color:"white"},children:pe}),e.jsxs(M,{children:[e.jsx(n,{onClick:()=>k("all"),children:"All"}),e.jsx(n,{onClick:()=>k("Milano"),children:"Milano"}),e.jsx(n,{onClick:()=>k("Napoli"),children:"Napoli"})]})]}),e.jsx(E,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),B?e.jsx(W,{}):e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsxs(P,{children:[e.jsx(o,{scope:"col",children:"#"}),e.jsx(o,{scope:"col",children:"Name"}),e.jsx(o,{scope:"col",children:"City"}),e.jsx(o,{scope:"col",children:"Add Link"})]})}),e.jsx(se,{children:Ae.map((s,a)=>e.jsxs(P,{children:[e.jsx(i,{children:x+a+1}),e.jsx(i,{children:e.jsx("span",{children:s.name})}),e.jsx(i,{children:s.city}),e.jsx(i,{children:e.jsx(X,{onClick:()=>{O(s._id)},size:"sm",style:{backgroundColor:"#ff4d4d",marginLeft:"5px",color:"white"},children:"Add"})})]},a))})]}),e.jsxs(ae,{"aria-label":"Page navigation example",children:[e.jsx(g,{disabled:x<=0,onClick:K,children:"Previous"}),e.jsx(g,{disabled:I===!0,onClick:J,children:"Next"})]})]})]})};export{Ke as default};
