import{B as at,r,y as ot,A as c,j as e,h as ce,L as rt,m as ne}from"./index-B08OXeWv.js";import{B as f}from"./config-HOLfLxHr.js";import{a as j}from"./axios-Cm0UX6qg.js";/* empty css               */import{b as lt,a as y}from"./CContainer-Bcycrjrg.js";import{C as de}from"./CNavbar-CI1ooECg.js";import{C as I}from"./CFormInput-BdPiiS44.js";import{C as ie,a as ue,b as N,c as n,d as pe,e as i}from"./CTable-isbk2Vch.js";import{C as he}from"./CCardImage-BV2__KTV.js";import{c as ct}from"./cil-pencil-m516yCOw.js";import{c as nt}from"./cil-trash-CBbKHhHb.js";import{C as ge,a as b}from"./CPaginationItem-BtMnBLEs.js";import{C as _,a as Q,b as U,c as H}from"./CModalTitle-BEzJ5tl5.js";import{C as dt,a as it,b as ut,c as pt,d as me}from"./DefaultLayout-ZVM7TRL_.js";import{C as O}from"./CModalFooter-CT0DeHo_.js";import"./CFormLabel-SAczgcRM.js";const Nt=()=>{const{id:p}=at();r.useState([]);const[xe,P]=r.useState(!1),[{user:m,token:u},l]=ot(),[fe,M]=r.useState(!1),[je,C]=r.useState(!1);r.useState("All Cities");const[ye,q]=r.useState("All Markets");r.useState(""),r.useState(""),r.useState(""),r.useState("All Cities"),r.useState(""),r.useState("All Chains"),r.useState([]),r.useState([]),r.useState([]);const[Pe,Ce]=r.useState([{_id:"",name:""}]),[ke,G]=r.useState(!0),[B,D]=r.useState(0),[be,Se]=r.useState(0),[A,T]=r.useState(1),[Me,Ae]=r.useState(0),[v,z]=r.useState(1),[ve,J]=r.useState(!0),[S,E]=r.useState(0),[K,W]=r.useState([]),[we,Ie]=r.useState([]),[Ne,Be]=r.useState([]),[w,X]=r.useState(""),[g,De]=r.useState(""),[Te,Y]=r.useState(g),[$,Z]=r.useState(""),[ze,ee]=r.useState(!1),[Ee,F]=r.useState(!1),[$e,te]=r.useState(""),[L,se]=r.useState(""),[Fe,ae]=r.useState(""),[Le,R]=r.useState(!1),[V,oe]=r.useState(""),[ht,Re]=r.useState("");r.useEffect(()=>{console.log("id",p),x(p,0)},[Te]),r.useEffect(()=>{const t=setTimeout(()=>{(g.length>=3||g.length===0)&&Y(g)},500);return()=>{clearTimeout(t)}},[g]);const x=(t,a)=>{t?(console.log("id",t),m&&u?(P(!0),j.get(f+`promotion/products/${a}?promotionId=${t}&name=${g}`,{headers:{Authorization:`Bearer ${u}`}}).then(s=>{s.status===200?(console.log("products",s.data.list),W(s.data.list),Se(s.data.count),Be(s.data.list.map(o=>o.productId)),P(!1),s.data.list.length<50?(G(!0),console.log("ok")):s.data.list.length>49&&G(!1)):s.status===203?(console.log("products 203"),P(!1),l({type:c,payload:{status:!0,title:" Products loading error",message:s.data.message}})):s.status===204?(console.log("products 204"),P(!1),l({type:c,payload:{status:!0,title:" Products loading error",message:"No products found",color:"info"}})):s.status===500&&(console.log("products 500"),P(!1),l({type:c,payload:{status:!0,title:" Products loading error",message:s.data.message}}))})):(console.log("products non"),P(!1))):l({type:c,payload:{status:!0,title:" markets loading error",message:"No id found"}})},Ve=()=>{M(!0)},_e=(t,a)=>{if(console.log("promotionId",t,"pId",a),a&&t){const s={productId:a};u&&m&&u&&j.patch(f+"promotion/add/product/"+t,s,{headers:{Authorization:`Bearer ${u}`}}).then(o=>{o.status===200?(M(!1),x(t),l({type:c,payload:{status:!0,title:"Product Assign",message:"successfully Product assigned to the promotion",color:"success"}})):o.status===400?l({type:c,payload:{status:!0,title:"Product Assign error",message:o.data.message,color:"warning"}}):o.status===404?l({type:c,payload:{status:!0,title:"Product Assign error",message:o.data.message,color:"warning"}}):o.status===500&&l({type:c,payload:{status:!0,title:"Product Assign error",message:o.data.message,color:"warning"}})}).catch(o=>{console.error("Error:",o)})}else l({type:c,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},re=(t,a)=>{if(console.log("promotionId",t,"pid",a),a&&t){const s={productId:a};u&&m&&u&&j.patch(f+"promotion/remove/product/"+t,s,{headers:{Authorization:`Bearer ${u}`}}).then(o=>{o.status===200?(x(t),M(!1),l({type:c,payload:{status:!0,title:"Market Assign",message:"successfully Market removed from the promotion",color:"success"}})):o.status===204?l({type:c,payload:{status:!0,title:"Market remove error",message:o.data.message,color:"warning"}}):o.status===500&&l({type:c,payload:{status:!0,title:"Market remove error",message:o.data.message,color:"warning"}})}).catch(o=>{console.error("Error:",o)})}else l({type:c,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},Qe=()=>{T(A+1);const t=B+50;D(t),x(p,t)},Ue=()=>{T(A-1);const t=B-50;console.log(t),D(t),x(p,t)},He=t=>{T(t);const a=(t-1)*50;D(a),x(p,a)},Oe=()=>{const t=Math.ceil(be/50),a=[];for(let d=1;d<=t;d++)a.push(d);const s=Math.max(A-2,1),o=Math.min(s+4,t);return a.slice(s-1,o).map(d=>e.jsx(b,{active:A===d,onClick:()=>He(d),children:d},d))},qe=t=>{t?(console.log("id",t),m&&u?j.get(f+"promotion/all/markets/"+t,{headers:{Authorization:`Bearer ${u}`}}).then(a=>{a.status===200?(console.log("market",a.data.market),a.data.market.length===0&&(C(!1),l({type:c,payload:{status:!0,title:"Products loading",message:"No Market found",color:"info"}})),Ce(a.data.market.map(s=>({_id:s._id,name:s.address})))):a.status===203?l({type:c,payload:{status:!0,title:" markets loading error",message:a.data.message}}):a.status===500&&l({type:c,payload:{status:!0,title:" markets loading error",message:a.data.message}})}):l({type:c,payload:{status:!0,title:" markets loading error",message:"No user or token found"}})):l({type:c,payload:{status:!0,title:" markets loading error",message:"No id found"}})},le=(t,a)=>{a==="all"?(X(""),q("All Markets"),k(0,"",p),console.log("all")):(console.log("selected",t),X(t),q(a),k(0,t,p))};r.useEffect(()=>{ze&&k(0,w,p)},[$]);const k=(t,a,s)=>{m&&u?(C(!0),j.get(f+`promotion/all/markets/products/${t}?marketId=${a}&promoId=${s}&name=${$}`,{headers:{Authorization:`Bearer ${u}`}}).then(o=>{o.status===200?(Ie(o.data.list),Ae(o.data.count),C(!1),ee(!0),o.data.list.length<20?(J(!0),console.log("ok")):o.data.list.length>19&&J(!1)):o.status===203?(C(!1),l({type:c,payload:{status:!0,title:" Products loading error",message:o.data.message}})):o.status===500&&(C(!1),l({type:c,payload:{status:!0,title:" Products loading error",message:o.data.message}}))})):(C(!1),l({type:c,payload:{status:!0,title:" Products loading error",message:"No user or token found"}}))},Ge=()=>{z(v+1);const t=S+50;E(t),k(t,w,p)},Je=()=>{z(v-1);const t=S-50;console.log(t),E(t),k(t,w,p)},Ke=t=>{z(t);const a=(t-1)*50;E(a),loadData(a,!0)},We=()=>{const t=Math.ceil(Me/50),a=[];for(let d=1;d<=t;d++)a.push(d);const s=Math.max(v-2,1),o=Math.min(s+4,t);return a.slice(s-1,o).map(d=>e.jsx(b,{active:v===d,onClick:()=>Ke(d),children:d},d))},Xe=(t,a)=>{F(!0),te(t),ae(a)},Ye=()=>{console.log("called"),L==""?l({type:c,payload:{status:!0,title:"Alert",message:"Please enter the promotion price",color:"warning"}}):Ze($e)},Ze=t=>{if(console.log("product Id",t),t){const a={value:L};console.log("formData",a),u&&m&&u&&j.patch(f+"promotion/update/promo/value/"+t,a,{headers:{Authorization:`Bearer ${u}`}}).then(s=>{if(s.status===200){l({type:c,payload:{status:!0,title:"Product Details Update",message:"Product promotion price update Success",color:"success"}}),te(""),se(""),F(!1),ae("");const o=s.data,h=K.map(d=>(d.productId===o.productId&&(d.promo_value=o.promo_value),d));W([...h])}else s.status===400?l({type:c,payload:{status:!0,title:"Product update error",message:s.data.message,color:"warning"}}):s.status===404?l({type:c,payload:{status:!0,title:"Product update error",message:s.data.message,color:"warning"}}):s.status===500&&l({type:c,payload:{status:!0,title:"Product update error",message:s.data.message,color:"warning"}})}).catch(s=>{console.error("Error:",s)})}else l({type:c,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},et=()=>{R(!0)},tt=()=>{console.log("called"),V==""?l({type:c,payload:{status:!0,title:"Alert",message:"Please enter the promotion price",color:"warning"}}):st(p)},st=t=>{if(console.log("promotion Id",t),t){const a={value:V};console.log("formData",a),u&&m&&u&&j.patch(f+"promotion/update/promo/all/value/"+t,a,{headers:{Authorization:`Bearer ${u}`}}).then(s=>{s.status===200?(l({type:c,payload:{status:!0,title:"Product Details Update",message:"Product promotion price update Success",color:"success"}}),oe(""),R(!1),Re(""),x(t,0)):s.status===400?l({type:c,payload:{status:!0,title:"Product update error",message:s.data.message,color:"warning"}}):s.status===404?l({type:c,payload:{status:!0,title:"Product update error",message:s.data.message,color:"warning"}}):s.status===500&&l({type:c,payload:{status:!0,title:"Product update error",message:s.data.message,color:"warning"}})}).catch(s=>{console.error("Error:",s)})}else l({type:c,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})};return e.jsxs(lt,{children:[e.jsx(y,{onClick:()=>{Ve(),qe(p),k(0,w,p)},style:{marginLeft:"0%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Add Products"}),e.jsxs(de,{style:{justifyContent:"flex-start"},className:"bg-body-tertiary",children:[e.jsx(I,{type:"text",placeholder:"Search products by name",style:{width:450,marginRight:"0%"},value:g,onChange:t=>De(t.target.value)}),e.jsx(y,{onClick:()=>{et()},style:{marginLeft:"44%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Apply All"})]}),xe?e.jsx(ce,{}):e.jsxs(ie,{children:[e.jsx(ue,{children:e.jsxs(N,{children:[e.jsx(n,{scope:"col",children:"#"}),e.jsx(n,{scope:"col",children:"Product Id"}),e.jsx(n,{scope:"col",children:"Photo"}),e.jsx(n,{scope:"col",children:"Name"}),e.jsx(n,{scope:"col",children:"Base Price"}),e.jsx(n,{scope:"col",children:"Tax"}),e.jsx(n,{scope:"col",children:"Markup Percentage "}),e.jsx(n,{scope:"col",children:"Markup"}),e.jsx(n,{scope:"col",children:"Total"}),e.jsx(n,{scope:"col",children:"Promotion Value"}),e.jsx(n,{scope:"col",children:"Brand"}),e.jsx(n,{scope:"col",children:"Chain"}),e.jsx(n,{scope:"col",children:"Market Address"}),e.jsx(n,{scope:"col",children:"Remove"})]})}),e.jsx(pe,{children:K.map((t,a)=>{var s,o,h,d;return e.jsxs(N,{children:[e.jsx(i,{children:S+a+1}),e.jsx(i,{children:t.pid}),e.jsx(n,{onClick:()=>{},children:e.jsx(he,{style:{width:"50px",height:"50px"},src:"https://api.zeuler.com/image/"+t.image})}),e.jsx(i,{children:t.name}),e.jsxs(i,{children:[" ",(((s=t.price)==null?void 0:s.basePrice)??0).toFixed(2)," "]}),e.jsx(i,{children:(((o=t.price)==null?void 0:o.tax)??0).toFixed(2)}),e.jsxs(i,{children:[t.price.percentage,"%"]}),e.jsx(i,{children:(((h=t.price)==null?void 0:h.markup)??0).toFixed(2)}),e.jsx(i,{children:(((d=t.price)==null?void 0:d.total)??0).toFixed(2)}),e.jsxs(i,{children:[t.promo_value," €",e.jsx(rt,{to:"",children:e.jsx(ne,{icon:ct,size:"sm",onClick:()=>Xe(t.productId,t.promo_value)})})]}),e.jsx(i,{children:t.brand}),e.jsx(i,{children:t.chainName}),e.jsx(i,{children:t.marketAddress}),e.jsx(i,{children:e.jsx(y,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>{re(p,t.productId)},children:e.jsx(ne,{icon:nt,size:"lg",style:{color:"white"}})})})]},a)})})]}),e.jsxs(ge,{"aria-label":"Page navigation example",children:[e.jsx(b,{disabled:B<=0,onClick:Ue,children:"Previous"}),Oe(),e.jsx(b,{disabled:ke===!0,onClick:Qe,children:"Next"})]}),e.jsxs(_,{visible:fe,scrollable:!0,size:"xl",onClose:()=>{ee(!1),M(!1),Z("")},children:[e.jsx(Q,{closeButton:!0,children:e.jsx(U,{children:"Products assign view"})}),e.jsxs(H,{children:[e.jsx(dt,{style:{marginLeft:"64%"},color:"secondary",children:"Filter by"}),e.jsxs(it,{style:{marginLeft:"2%",width:"28%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(ut,{style:{color:"white"},children:ye}),e.jsxs(pt,{children:[e.jsx(me,{onClick:()=>le(null,"all"),children:"All"}),Pe.map((t,a)=>e.jsx(me,{onClick:()=>le(t._id,t.name),children:t.name},a))]})]}),e.jsx(de,{style:{marginTop:"1%"},className:"bg-body-tertiary",children:e.jsx(I,{type:"text",placeholder:"Search products by name",style:{width:450,marginRight:"60%"},value:$,onChange:t=>Z(t.target.value)})}),je?e.jsx(ce,{}):e.jsxs(ie,{children:[e.jsx(ue,{children:e.jsxs(N,{children:[e.jsx(n,{scope:"col",children:"#"}),e.jsx(n,{scope:"col",children:"Product Id"}),e.jsx(n,{scope:"col",children:"Photo"}),e.jsx(n,{scope:"col",children:"Name"}),e.jsx(n,{scope:"col",children:"Base Price"}),e.jsx(n,{scope:"col",children:"Tax"}),e.jsx(n,{scope:"col",children:"Markup Percentage "}),e.jsx(n,{scope:"col",children:"Markup"}),e.jsx(n,{scope:"col",children:"Total"}),e.jsx(n,{scope:"col",children:"Brand"}),e.jsx(n,{scope:"col",children:"Chain"}),e.jsx(n,{scope:"col",children:"Market Address"}),e.jsx(n,{scope:"col",children:"Action"})]})}),e.jsx(pe,{children:we.map((t,a)=>{var s,o,h,d;return e.jsxs(N,{children:[e.jsx(i,{children:S+a+1}),e.jsx(i,{children:t.pid}),e.jsx(n,{children:e.jsx(he,{style:{width:"50px",height:"50px"},src:"https://api.zeuler.com/image/"+t.image})}),e.jsx(i,{children:t.name}),e.jsxs(i,{children:[" ",(((s=t.price)==null?void 0:s.basePrice)??0).toFixed(2)," "]}),e.jsx(i,{children:(((o=t.price)==null?void 0:o.tax)??0).toFixed(2)}),e.jsxs(i,{children:[t.price.percentage,"%"]}),e.jsx(i,{children:(((h=t.price)==null?void 0:h.markup)??0).toFixed(2)}),e.jsx(i,{children:(((d=t.price)==null?void 0:d.total)??0).toFixed(2)}),e.jsx(i,{children:t.brand}),e.jsx(i,{children:t.chainName}),e.jsx(i,{children:t.marketAddress}),e.jsx(i,{children:Ne.includes(t.productId)?e.jsx(y,{size:"sm",onClick:()=>{re(p,t.productId)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Remove"}):e.jsx(y,{size:"sm",onClick:()=>{_e(p,t.productId)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Add"})})]},a)})})]}),e.jsx(O,{children:e.jsxs(ge,{"aria-label":"Page navigation example",children:[e.jsx(b,{disabled:S<=0,onClick:Je,children:"Previous"}),We(),e.jsx(b,{disabled:ve===!0,onClick:Ge,children:"Next"})]})})]})]}),e.jsxs(_,{alignment:"center",visible:Ee,scrollable:!0,size:"sm",onClose:()=>F(!1),children:[e.jsx(Q,{closeButton:!0,children:e.jsx(U,{children:"Change Promotion Value"})}),e.jsxs(H,{children:[e.jsx("a",{children:"Add Promotion Value"}),e.jsx("br",{}),e.jsx(I,{type:"text",placeholder:Fe,value:L,onChange:t=>se(t.target.value)})]}),e.jsx(O,{children:e.jsx(y,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>Ye(),children:"Save changes"})})]}),e.jsxs(_,{alignment:"center",visible:Le,scrollable:!0,size:"sm",onClose:()=>R(!1),children:[e.jsx(Q,{closeButton:!0,children:e.jsx(U,{children:"Add promotion value to all products"})}),e.jsxs(H,{children:[e.jsx("a",{children:"Add Promotion Value"}),e.jsx("br",{}),e.jsx(I,{type:"text",value:V,onChange:t=>oe(t.target.value)})]}),e.jsx(O,{children:e.jsx(y,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>tt(),children:"Save changes"})})]})]})};export{Nt as default};
