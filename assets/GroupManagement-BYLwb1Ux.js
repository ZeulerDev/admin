import{r as t,y as Me,l as De,A as c,j as s,i as X}from"./index-DeJ6Linw.js";import{a as p}from"./axios-Cm0UX6qg.js";import{B as g}from"./config-HOLfLxHr.js";import{b as Se,a as x}from"./CContainer-Nzx2apIi.js";import{d as A,C as j,a as C,b as y,c as u}from"./DefaultLayout-BHJQB6yd.js";import{C as Y}from"./CNavbar-DV7jkD--.js";import{C as Z,a as ee,b as k,c as i,d as se,e as d}from"./CTable-c-O0N-WI.js";import{C as Ae,a as be,b as Ge,c as ve}from"./CModalTitle-BT58mrqm.js";const Ie=()=>{const[b,m]=t.useState(!1),[{user:f,token:l},n]=Me(),[G,v]=t.useState([]),[ae,E]=t.useState(!1),[L,B]=t.useState(""),[T,N]=t.useState(""),[z,$]=t.useState("");t.useState(!1),t.useState(""),De();const[te,re]=t.useState(!1),[oe,P]=t.useState("All Cities"),[le,_]=t.useState("All Market Groups"),[ie,R]=t.useState("All Chains"),[ne,ce]=t.useState([]),[de,ue]=t.useState([]),[I,w]=t.useState(""),[he,M]=t.useState([]),[pe,F]=t.useState("All Cities"),[H,U]=t.useState(""),[ge,fe]=t.useState([]),[me,V]=t.useState(!1),[Ee,q]=t.useState(!0),[Le,D]=t.useState(0);t.useEffect(()=>{S(),xe()},[]);const S=()=>{l&&p.get(g+"market/groups/dropdown/fetch",{headers:{Authorization:`Bearer ${l}`}}).then(e=>{e.status===200?ce(e.data):e.status===500&&n({type:c,payload:{status:!0,title:"Market Group Loading error",message:e.data.message}})}).catch(e=>{console.error("Error: ",e)})},xe=()=>{l&&p.get(g+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${l}`}}).then(e=>{e.status===200?(ue(e.data),re(!1)):e.status===500&&n({type:c,payload:{status:!0,title:"Chain Loading error",message:e.data.message}})}).catch(e=>{console.error("Error: ",e)})};t.useEffect(()=>{je()},[L,T,z,te]);const je=()=>{f&&l&&(E(!0),p.get(g+`assistant/riders/:skip?city=${L}&group=${T}&chain=${z}`,{headers:{Authorization:`Bearer ${l}`}}).then(e=>{e.status===200?(v(e.data),E(!1)):e.status===500&&n({type:c,payload:{status:!0,title:"Error",message:e.data.message,color:"warning"}})}).catch(e=>{console.error("Error:",e)}))},h=(e,a)=>{a==="view"?e==="all"?(B(""),P("All Cities")):(B(e),P(e)):a==="modal"&&(e==="all"?(U(""),F("All Cities")):(U(e),F(e)))},J=(e,a)=>{e==="all"?(N(""),_("All Market Groups")):(N(e),_(a))},K=(e,a)=>{e==="all"?($(""),R("All Chains")):($(e),R(a))},O=(e,a)=>{m(!b),console.log("group",e,"driver ID",a),w(a),M(e)};t.useEffect(()=>{f&&l&&Ce(0,!0)},[f,H]);const Ce=(e,a)=>{V(!0),p.get(g+`market/groups/fetch/${e}?city=${H}`,{headers:{Authorization:`Bearer ${l}`}}).then(o=>{if(o.status===200)if(fe(o.data),V(!1),o.data.length<20?(q(!0),console.log("ok")):o.data.length>19&&q(!1),a){const r=e+o.data.length;D(r)}else{const r=e-o.data.length;e<0?D(0):D(r)}else o.status===500&&n({type:c,payload:{status:!0,title:"Makrket Group loading error",message:o.data.message}})}).catch(o=>{console.error("Error:",o)})},ye=(e,a)=>{if(console.log("driver id",e),console.log("group id",a),a&&e){const o={id:a,rider:e};l&&f&&l&&p.put(g+"assistant/groups/rider/assign",o,{headers:{Authorization:`Bearer ${l}`}}).then(r=>{if(r.status===200){m(!1),w(""),M([]),console.log(r.data),S();const Q=r.data,we=G.map(W=>W.id===Q._id?Q:W);v([...we]),n({type:c,payload:{status:!0,title:"Market Group Assign",message:"successfully Market Group assigned to the picker ",color:"success"}})}else r.status===204?n({type:c,payload:{status:!0,title:"Group Assign error",message:r.data.message,color:"warning"}}):r.status===500&&n({type:c,payload:{status:!0,title:"Group Assign error",message:r.data.message,color:"warning"}})}).catch(r=>{console.error("Error:",r)})}else n({type:c,payload:{status:!0,title:"Error!",message:"Driver group assign error",color:"warning"}})},ke=(e,a)=>{if(a&&e){const o={id:a,rider:e};l&&f&&l&&p.put(g+"assistant/groups/rider/remove",o,{headers:{Authorization:`Bearer ${l}`}}).then(r=>{r.status===200?(m(!1),w(""),M([]),S(),n({type:c,payload:{status:!0,title:"Market Group Remove",message:"successfully Market Group removed from the picker ",color:"success"}})):r.status===204?n({type:c,payload:{status:!0,title:"Group remove error",message:r.data.message,color:"warning"}}):r.status===500&&n({type:c,payload:{status:!0,title:"Group remove error",message:r.data.message,color:"warning"}})}).catch(r=>{console.error("Error:",r)})}else n({type:c,payload:{status:!0,title:"Error!",message:"Driver group assign error",color:"warning"}})};return s.jsxs(Se,{children:[s.jsx(A,{style:{marginLeft:"34%"},color:"secondary",children:"Filter by"}),s.jsxs(j,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[s.jsx(C,{style:{color:"white"},children:oe}),s.jsxs(y,{children:[s.jsx(u,{onClick:()=>h("all","view"),children:"All"}),s.jsx(u,{onClick:()=>h("Milan","view"),children:"Milan"}),s.jsx(u,{onClick:()=>h("Napoli","view"),children:"Napoli"})]})]}),s.jsxs(j,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[s.jsx(C,{style:{color:"white"},children:ie}),s.jsxs(y,{children:[s.jsx(u,{onClick:()=>K("all"),children:"All"}),de.map((e,a)=>s.jsx(u,{onClick:()=>K(e.id,e.name),children:e.name},a))]})]}),s.jsxs(j,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[s.jsx(C,{style:{color:"white"},children:le}),s.jsxs(y,{children:[s.jsx(u,{onClick:()=>J("all"),children:"All"}),ne.map((e,a)=>s.jsx(u,{onClick:()=>J(e._id,e.name),children:e.name},a))]})]}),s.jsx(Y,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),ae?s.jsx(X,{}):s.jsxs(Z,{children:[s.jsx(ee,{children:s.jsxs(k,{children:[s.jsx(i,{scope:"col",children:"First Name"}),s.jsx(i,{scope:"col",children:"Last Name"}),s.jsx(i,{scope:"col",children:"Email"}),s.jsx(i,{scope:"col",children:"Phone"}),s.jsx(i,{scope:"col",children:"Country"}),s.jsx(i,{scope:"col",children:"Employee ID"}),s.jsx(i,{scope:"col",children:"Language"}),s.jsx(i,{scope:"col",children:"Group"}),s.jsx(i,{scope:"col",children:"Status"})]})}),s.jsx(se,{children:G.map((e,a)=>s.jsxs(k,{children:[s.jsx(d,{children:e.name}),s.jsx(d,{children:e.surname}),s.jsx(d,{children:e.email}),s.jsx(d,{children:e.contact}),s.jsx(d,{children:e.country==="it"||e.country==="Italy"?"Italy":e.country}),s.jsx(d,{children:e.employeeId?e.employeeId:s.jsx(A,{color:"warning",children:"Not Provide"})}),s.jsx(d,{children:e.language==="en"?"English":e.language==="it"?"Italy":e.language==="es"?"Spanish":e.language}),s.jsx(d,{children:e.groups.map((o,r)=>s.jsx("div",{children:o.name},r))}),s.jsx(d,{children:e.groups.length>0?s.jsx(x,{size:"sm",onClick:()=>O(e.groups,e.id),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Assign"}):s.jsx(x,{size:"sm",onClick:()=>O(e.groups,e.id),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Add"})})]},a))})]}),s.jsxs(Ae,{alignment:"center",visible:b,scrollable:!0,size:"xl",onClose:()=>m(!1),children:[s.jsx(be,{closeButton:!0,children:s.jsx(Ge,{children:"Market Group Assign"})}),s.jsxs(ve,{children:[s.jsx(A,{style:{marginLeft:"74%"},color:"secondary",children:"Filter by"}),s.jsxs(j,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[s.jsx(C,{style:{color:"white"},children:pe}),s.jsxs(y,{children:[s.jsx(u,{onClick:()=>h("all","modal"),children:"All"}),s.jsx(u,{onClick:()=>h("Milano","modal"),children:"Milano"}),s.jsx(u,{onClick:()=>h("Napoli","modal"),children:"Napoli"})]})]}),s.jsx(Y,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),me?s.jsx(X,{}):s.jsxs(Z,{children:[s.jsx(ee,{children:s.jsxs(k,{children:[s.jsx(i,{scope:"col",children:"Name"}),s.jsx(i,{scope:"col",children:"City"}),s.jsx(i,{scope:"col",children:"Location"})]})}),s.jsx(se,{children:ge.map((e,a)=>s.jsxs(k,{children:[s.jsx(i,{scope:"row",children:e.name}),s.jsx(d,{children:e.city}),s.jsx(d,{children:he.map(o=>o.id).includes(e._id)?s.jsx(x,{size:"sm",onClick:()=>ke(I,e._id),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Remove"}):s.jsx(x,{size:"sm",onClick:()=>ye(I,e._id),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Add"})})]},a))})]})]})]})]})};export{Ie as default};
