import{y as ts,r as l,A as r,j as e,L as A,h as I,m as F}from"./index-1nLR5RGy.js";import{a as h}from"./axios-Cm0UX6qg.js";import{B as g}from"./config-HOLfLxHr.js";import{b as ls,a as u}from"./CContainer-DfgIIkA9.js";import{C as xe,a as V,b as H,c as U,d as m}from"./DefaultLayout-PY4GQLlg.js";import{C as je}from"./CNavbar-Cn5Tba6R.js";import{C as Y,a as q,b as x,c as n,d as J,e as c}from"./CTable-BbDDKHT4.js";import{c as os}from"./cil-pencil-m516yCOw.js";import{c as rs}from"./cil-trash-CBbKHhHb.js";import{C as ke,a as S}from"./CPaginationItem-p0LfWE13.js";import{C as v,a as D,b as P,c as L}from"./CModalTitle-H_mL68lj.js";import{C as is}from"./CFormInput-B-dT1a4O.js";import{C as K}from"./CModalFooter-BePzWYJy.js";import"./CFormLabel-DeTrB1R-.js";var ns=["512 512","<polygon fill='var(--ci-primary-color, currentColor)' points='440 240 272 240 272 72 240 72 240 240 72 240 72 272 240 272 240 440 272 440 272 272 440 272 440 240' class='ci-primary'/>"];const As=()=>{const[{user:p,token:d},o]=ts(),[O,j]=l.useState(""),[Ce,k]=l.useState("All Cities"),[N,Q]=l.useState([]),[C,W]=l.useState(0),[ye,X]=l.useState(!0),[Me,z]=l.useState(!1),[Z,y]=l.useState(!1),[be,we]=l.useState(""),[Ae,E]=l.useState(!1),[Se,ee]=l.useState(""),[M,se]=l.useState(""),[ve,ae]=l.useState(""),[De,T]=l.useState(!1),[te,f]=l.useState(""),[Pe,Le]=l.useState([]),[Ne,le]=l.useState(!1),[ze,B]=l.useState(!1),[Ee,Te]=l.useState([]),[oe,re]=l.useState(""),[Be,ie]=l.useState("All Cities"),[cs,ne]=l.useState(""),[ce,de]=l.useState(""),[Ge,ue]=l.useState("All Chains"),[ds,he]=l.useState("All Chains"),[$e,ge]=l.useState(!1),[Re,_e]=l.useState([]),[Ie,me]=l.useState(!0),[b,G]=l.useState(0);l.useState([]);const $=s=>{s==="all"?(j(""),k("All Cities")):(j(s),k(s))};l.useEffect(()=>{const s=setTimeout(()=>{o({type:r,payload:{status:!0,title:"Data Loading",message:"Data loading error: Timeout exceeded",color:"warning"}}),z(!1)},2e4);return p&&d&&w(0,s),()=>{clearTimeout(s)}},[p,O]);const w=(s,a)=>{z(!0),h.get(g+`market/groups/fetch/${s}?city=${O}`,{headers:{Authorization:`Bearer ${d}`}}).then(t=>{console.log(t.status),t.status===200?(Q(t.data),z(!1),clearTimeout(a),t.data.length<20?(X(!0),console.log("ok")):t.data.length>19&&X(!1)):t.status===500&&o({type:r,payload:{status:!0,title:"Makrket Group loading error",message:t.data.message}})}).catch(t=>{console.error("Error:",t)})},Fe=()=>{const s=C+20;W(s),w(s,!0)},Ve=()=>{const s=C-20;console.log(s),W(s),w(s,!1)},He=s=>{y(!Z),we(s)},Ue=s=>{console.log(s),h.delete(g+"marketgroup/"+s,{headers:{Authorization:`Bearer ${d}`}}).then(a=>{a.status===200?(o({type:r,payload:{status:!0,title:"Market Group Delete",message:"Market Group Delete Success",color:"success"}}),y(!1),w(0,!0),console.log("Remove Market Group")):a.status===203?o({type:r,payload:{status:!0,title:"Market Group Delete",message:a.data.message,color:"warning"}}):a.status===404?o({type:r,payload:{status:!0,title:"Market Group Delete",message:a.data.message,color:"warning"}}):a.status===500&&o({type:r,payload:{status:!0,title:"Market Group Delete",message:a.data.message,color:"warning"}})}).catch(a=>{console.error("Error:",a)})},Ye=(s,a)=>{E(!0),ee(s),ae(a),console.log(a)},qe=()=>{console.log("name",M),M==""?o({type:r,payload:{status:!0,title:"Alert",message:"Please Enter Name",color:"danger"}}):Je(Se)},Je=s=>{if(s){let a={name:M};console.log(a,s),p&&d&&h.put(g+"marketgroup/update/"+s,a,{headers:{Authorization:`Bearer ${d}`}}).then(t=>{if(t.status===200){const i=t.data,fe=N.find(as=>as.id===i.id);fe&&(fe.name=i.name),Q([...N]),o({type:r,payload:{status:!0,title:"Market Group Update",message:"Market group name updated successfully",color:"success"}}),ee(""),se(""),E(!1),ae("")}else t.status===204?o({type:r,payload:{status:!0,title:"Pick up area update  error",message:t.data.message,color:"danger"}}):t.status===500&&o({type:r,payload:{status:!0,title:"Pick up area update  error",message:t.data.message,color:"danger"}})}).catch(t=>{console.error("Error:",t)})}else alert("Please Check the Fields!")},Ke=s=>{console.log("markets",s),T(!0),f(s),Oe(s)},Oe=s=>{le(!0),h.get(g+`marketgroup/markets/${s}`,{headers:{Authorization:`Bearer ${d}`}}).then(a=>{a.status===200?(Le(a.data),console.log("data market",a.data),le(!1)):a.status===204?o({type:r,payload:{status:!0,title:"Market Loading error",message:a.data.message}}):a.status===500&&o({type:r,payload:{status:!0,title:"Market Loading error",message:a.data.message}})}).catch(a=>{console.error("Error: ",a)})},Qe=s=>{console.log("markets group",s),f(s),B(!0)},R=(s,a)=>{a==="view"?s==="all"?(j(""),k("All Cities")):(j(s),k(s)):a==="modal"&&(s==="all"?(re(""),ie("All Cities")):(re(s),ie(s)))},pe=(s,a,t)=>{t==="view"?s==="all"?(ne(""),he("All Chains")):(ne(s),he(a)):t==="modal"&&(s==="all"?(de(""),ue("All Chains")):(de(s),ue(a)))};l.useEffect(()=>{We()},[]);const We=()=>{d&&h.get(g+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${d}`}}).then(s=>{s.status===200?Te(s.data):s.status===500&&o({type:r,payload:{status:!0,title:"Chain Loading error",message:s.data.message}})}).catch(s=>{console.error("Error: ",s)})};l.useEffect(()=>{p&&d&&_(0)},[ce,oe,p]);const _=(s,a)=>{ge(!0),h.get(g+`assistant/market/locations/${s}?brand=${ce}&city=${oe}`,{headers:{Authorization:`Bearer ${d}`}}).then(t=>{t.status===200?(_e(t.data.data),console.log("data market"),ge(!1),t.data.data.length<20?(me(!0),console.log("ok")):t.data.data.length>19&&me(!1)):t.status===500&&o({type:r,payload:{status:!0,title:"Market Loading error",message:t.data.message}})}).catch(t=>{console.error("Error: ",t)})},Xe=()=>{const s=b+20;G(s),_(s)},Ze=()=>{const s=b-20;console.log(s),G(s),_(s)},es=(s,a)=>{if(a&&s){const t={marketId:a};d&&p&&d&&h.patch(g+"marketgroup/add/market/"+s,t,{headers:{Authorization:`Bearer ${d}`}}).then(i=>{i.status===200?(B(!1),f(""),o({type:r,payload:{status:!0,title:"Market Assign",message:"successfully Market assigned to the market group",color:"success"}})):i.status===400?o({type:r,payload:{status:!0,title:"Market Assign error",message:i.data.message,color:"warning"}}):i.status===404?o({type:r,payload:{status:!0,title:"Market Assign error",message:i.data.message,color:"warning"}}):i.status===500&&o({type:r,payload:{status:!0,title:"Market Assign error",message:i.data.message,color:"warning"}})}).catch(i=>{console.error("Error:",i)})}else o({type:r,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},ss=(s,a)=>{if(a&&s){const t={marketId:a};d&&p&&d&&h.patch(g+"marketgroup/remove/market/"+s,t,{headers:{Authorization:`Bearer ${d}`}}).then(i=>{i.status===200?(T(!1),f(""),o({type:r,payload:{status:!0,title:"Market Assign",message:"successfully Market remove from the market group",color:"success"}})):i.status===400?o({type:r,payload:{status:!0,title:"Market remove error",message:i.data.message,color:"warning"}}):i.status===404?o({type:r,payload:{status:!0,title:"Market remove error",message:i.data.message,color:"warning"}}):i.status===500&&o({type:r,payload:{status:!0,title:"Market remove error",message:i.data.message,color:"warning"}})}).catch(i=>{console.error("Error:",i)})}else o({type:r,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})};return e.jsxs(ls,{children:[e.jsx(A,{to:"/marketgroups/marketmap",children:e.jsx(u,{style:{marginLeft:"0%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Add Market"})}),e.jsx(A,{to:"/marketgroups/createmarketgroup",children:e.jsx(u,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Create Market Group"})}),e.jsx(xe,{style:{marginLeft:"39%"},color:"secondary",children:"Filter by"}),e.jsxs(V,{style:{marginLeft:"2%",width:"17%",marginRight:"5px",backgroundColor:"#ff4d4d"},children:[e.jsx(H,{style:{color:"white"},children:Ce}),e.jsxs(U,{children:[e.jsx(m,{onClick:()=>$("all"),children:"All"}),e.jsx(m,{onClick:()=>$("Milano"),children:"Milano"}),e.jsx(m,{onClick:()=>$("Napoli"),children:"Napoli"})]})]}),e.jsx(je,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),Me?e.jsx(I,{}):e.jsxs(Y,{children:[e.jsx(q,{children:e.jsxs(x,{children:[e.jsx(n,{scope:"col",children:"#"}),e.jsx(n,{scope:"col",children:"Name"}),e.jsx(n,{scope:"col",children:"City"}),e.jsx(n,{scope:"col",children:"Assigned Market"}),e.jsx(n,{scope:"col",children:"Location"}),e.jsx(n,{scope:"col",children:"Action"}),e.jsx(n,{scope:"col",children:"Add Markets"})]})}),e.jsx(J,{children:N.map((s,a)=>e.jsxs(x,{children:[e.jsx(c,{children:C+a+1}),e.jsxs(c,{children:[e.jsx("span",{children:s.name}),e.jsx(A,{to:"",children:e.jsx(F,{style:{marginLeft:20,float:"right"},icon:os,size:"sm",onClick:()=>Ye(s._id,s.name)})})]}),e.jsx(c,{children:s.city}),e.jsx(c,{children:e.jsx(u,{onClick:()=>{Ke(s._id)},size:"sm",style:{backgroundColor:"#ff4d4d",marginLeft:"5px",color:"white"},children:"view"})}),e.jsx(c,{children:e.jsx(A,{to:`/marketgroups/marketdistance/${s._id}`,children:e.jsx(u,{size:"sm",style:{backgroundColor:"#ff4d4d",marginLeft:"5px",color:"white"},children:"view"})})}),e.jsx(c,{children:e.jsx(u,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>He(s._id),children:e.jsx(F,{icon:rs,size:"lg",style:{color:"white"}})})}),e.jsx(c,{children:e.jsx(u,{onClick:()=>{Qe(s._id)},size:"sm",style:{backgroundColor:"#ff4d4d",color:"white"},variant:"outline",children:e.jsx(F,{icon:ns,size:"lg",style:{color:"white"}})})})]},a))})]}),e.jsxs(ke,{"aria-label":"Page navigation example",children:[e.jsx(S,{disabled:C<=0,onClick:Ve,children:"Previous"}),e.jsx(S,{disabled:ye===!0,onClick:Fe,children:"Next"})]}),e.jsxs(v,{alignment:"center",visible:Ae,scrollable:!0,size:"sm",onClose:()=>E(!1),children:[e.jsx(D,{closeButton:!0,children:e.jsx(P,{children:"Change Name"})}),e.jsxs(L,{children:[e.jsx("a",{children:"Enter New Name"}),e.jsx("br",{}),e.jsx(is,{type:"text",placeholder:ve,value:M,onChange:s=>se(s.target.value)})]}),e.jsx(K,{children:e.jsx(u,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>qe(),children:"Save changes"})})]}),e.jsxs(v,{alignment:"center",visible:Z,scrollable:!0,size:"sm",onClose:()=>y(!1),children:[e.jsx(D,{closeButton:!1,children:e.jsx(P,{children:"Confirmation"})}),e.jsxs(L,{children:[e.jsx("a",{children:"Are you sure you want to delete this market group?"}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[e.jsx(u,{onClick:()=>Ue(be),style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),e.jsx(u,{onClick:()=>y(!1),style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]}),e.jsxs(v,{alignment:"center",visible:De,scrollable:!0,size:"lg",onClose:()=>{T(!1),f("")},children:[e.jsx(D,{closeButton:!0,children:e.jsx(P,{children:"All Assign Markets details"})}),e.jsx(L,{children:Ne?e.jsx(I,{}):e.jsxs(Y,{children:[e.jsx(q,{children:e.jsxs(x,{children:[e.jsx(n,{scope:"col",children:"#"}),e.jsx(n,{scope:"col",children:"Chain Name"}),e.jsx(n,{scope:"col",children:"Address"}),e.jsx(n,{scope:"col",children:"City"}),e.jsx(n,{scope:"col",children:"Remove"})]})}),e.jsx(J,{children:Pe.map((s,a)=>e.jsxs(x,{children:[e.jsx(c,{children:a+1}),e.jsx(c,{children:s.chain.name}),e.jsx(c,{children:s.address}),e.jsx(c,{children:s.city}),e.jsx(c,{children:e.jsx(u,{size:"sm",onClick:()=>ss(te,s._id),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Remove"})})]},a))})]})}),e.jsx(K,{})]}),e.jsxs(v,{visible:ze,scrollable:!0,size:"xl",onClose:()=>{B(!1),G(0),f("")},children:[e.jsx(D,{closeButton:!0,children:e.jsx(P,{children:"Market assign view"})}),e.jsxs(L,{children:[e.jsx(xe,{style:{marginLeft:"54%"},color:"secondary",children:"Filter by"}),e.jsxs(V,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(H,{style:{color:"white"},children:Be}),e.jsxs(U,{children:[e.jsx(m,{onClick:()=>R("all","modal"),children:"All"}),e.jsx(m,{onClick:()=>R("Milano","modal"),children:"Milano"}),e.jsx(m,{onClick:()=>R("Napoli","modal"),children:"Napoli"})]})]}),e.jsxs(V,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(H,{style:{color:"white"},children:Ge}),e.jsxs(U,{children:[e.jsx(m,{onClick:()=>pe("all",null,"modal"),children:"All"}),Ee.map((s,a)=>e.jsx(m,{onClick:()=>pe(s.id,s.name,"modal"),children:s.name},a))]})]}),e.jsx(je,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),$e?e.jsx(I,{}):e.jsxs(Y,{children:[e.jsx(q,{children:e.jsxs(x,{children:[e.jsx(n,{scope:"col",children:"#"}),e.jsx(n,{scope:"col",children:"Name"}),e.jsx(n,{scope:"col",children:"Address"}),e.jsx(n,{scope:"col",children:"City"}),e.jsx(n,{scope:"col",children:"Measurement"}),e.jsx(n,{scope:"col"})]})}),e.jsx(J,{children:Re.map((s,a)=>e.jsxs(x,{children:[e.jsx(c,{children:b+a+1}),e.jsx(c,{children:s.chain.name}),e.jsx(c,{children:s.address}),e.jsx(c,{children:s.city}),e.jsx(c,{children:s.scraped}),e.jsx(c,{children:e.jsx(u,{size:"sm",onClick:()=>es(te,s._id),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Add"})})]},a))})]}),e.jsx(K,{children:e.jsxs(ke,{"aria-label":"Page navigation example",children:[e.jsx(S,{disabled:b<=0,onClick:Ze,children:"Previous"}),e.jsx(S,{disabled:Ie===!0,onClick:Xe,children:"Next"})]})})]})]})]})};export{As as default};
