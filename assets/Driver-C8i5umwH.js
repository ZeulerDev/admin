import{r as a,y as Je,l as Ke,A as o,j as e,L as xe,h as We,m as ye}from"./index-UGMi1yYD.js";import{a as g}from"./axios-Cm0UX6qg.js";/* empty css               */import{B as f}from"./config-HOLfLxHr.js";import{b as Xe,a as h}from"./CContainer-DyKYeaQQ.js";import{C as je,a as Ce,b as ve,d as we,e as C}from"./DefaultLayout-CzLgNllg.js";import{C as Ze}from"./CNavbar-CJm5RN47.js";import{C as p}from"./CFormInput-CxPGKAGO.js";import{C as Oe,a as et,b as G,c as d,d as tt,e as i}from"./CTable-Bh49LxGZ.js";import{c as st}from"./cil-pencil-m516yCOw.js";import{c as at}from"./cil-trash-CBbKHhHb.js";import{C as E,a as P,b as A,c as T}from"./CModalTitle-Cj2x-Lbp.js";import{C as c}from"./CCol-BiiKwAZ6.js";import{C as rt}from"./CModalFooter-iKJhetg6.js";import{C as lt}from"./CFormSelect-BtiEOrKG.js";import"./CFormLabel-CaVfy1Ba.js";const Dt=()=>{const[$,v]=a.useState(!1),[F,w]=a.useState(!1),[{user:b,token:n},l]=Je(),[D,N]=a.useState([]),[be,B]=a.useState(!1),[U,H]=a.useState(""),[_,Q]=a.useState(""),[Y,ot]=a.useState(""),[m,y]=a.useState(""),[De,q]=a.useState(m),[L,J]=a.useState(!1),[K,W]=a.useState("");Ke();const[ke,Se]=a.useState(!1),[Ee,X]=a.useState("All Cities"),[Pe,Z]=a.useState("All Market Groups");a.useState("All Chains");const[Ae,Te]=a.useState([]),[it,Ne]=a.useState([]),[O,j]=a.useState(!1),[u,Be]=a.useState([]),[ee,te]=a.useState(),[se,ae]=a.useState(),[re,le]=a.useState(),[oe,ie]=a.useState(),[ne,de]=a.useState(),[M,ce]=a.useState(),[Le,ue]=a.useState(),[he,pe]=a.useState(),[Me,ze]=a.useState(),[k,Ie]=a.useState(""),[z,Re]=a.useState(""),[Ve,I]=a.useState(!1);a.useEffect(()=>{Ge(),$e()},[]);const Ge=()=>{n&&g.get(f+"market/groups/dropdown/fetch",{headers:{Authorization:`Bearer ${n}`}}).then(t=>{t.status===200?Te(t.data):t.status===500&&l({type:o,payload:{status:!0,title:"Market Group Loading error",message:t.data.message}})}).catch(t=>{console.error("Error: ",t)})},$e=()=>{n&&g.get(f+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${n}`}}).then(t=>{t.status===200?(Ne(t.data),Se(!1)):t.status===500&&l({type:o,payload:{status:!0,title:"Chain Loading error",message:t.data.message}})}).catch(t=>{console.error("Error: ",t)})};a.useEffect(()=>{const t=setTimeout(()=>{l({type:o,payload:{status:!0,title:"Data Loading",message:"Data loading error: Timeout exceeded",color:"warning"}}),B(!1)},2e4);return R(t),()=>{clearTimeout(t)}},[U,_,Y,De,ke]),a.useEffect(()=>{const t=setTimeout(()=>{(m.length>=3||m.length===0)&&q(m)},500);return()=>{clearTimeout(t)}},[m]);const R=t=>{if(b&&n){B(!0);let s=f+`assistant/riders/main/0?city=${U}&group=${_}&chain=${Y}&code=${m}`;g.get(s,{headers:{Authorization:`Bearer ${n}`}}).then(r=>{r.status===200?(N(r.data),B(!1),clearTimeout(t)):r.status===500&&l({type:o,payload:{status:!0,title:"Error",message:r.data.message,color:"warning"}})}).catch(r=>{console.error("Error:",r)})}},V=t=>{t==="all"?(H(""),X("All Cities"),y("")):(H(t),X(t),y(""))},me=(t,s)=>{t==="all"?(Q(""),Z("All Market Groups"),y("")):(Q(t),Z(s),y(""))},ge=(t,s)=>{v(!$),J(s),W(t)},Fe=()=>{const t={status:L};console.log(L),console.log(K,t),b&&n&&g.patch(f+"assistant/rider/status/"+K,t,{headers:{Authorization:`Bearer ${n}`}}).then(s=>{if(s.status===200){console.log("updated",s.data),v(!1),J(""),W("");const r=s.data,x=D.map(S=>S.id===r.id?r:S);N([...x]),l({type:o,payload:{status:!0,title:"Driver status update",message:"Driver status updated successfully",color:"success"}})}else s.status===203?l({type:o,payload:{status:!0,title:"Driver status update error",message:s.data.message}}):s.status===204?l({type:o,payload:{status:!0,title:"Driver status update error",message:s.data.message}}):s.status===500&&l({type:o,payload:{status:!0,title:"Driver status update error",message:s.data.message}})}).catch(s=>{console.error(s)})},Ue=t=>{j(!O),Be(t),te(t.name),ae(t.surname),le(t.email),ie(t.contact),de(t.iban),ce(t.city),pe(t.address),ue(t.vat)},He=()=>{if(ee&&se&&re&&oe&&ne&&M&&he){const t={name:ee,surname:se,email:re,contact:oe,iban:ne,city:M,vat:Le,address:he},s=u.id;n&&b&&n&&g.patch(f+"assistant/rider/update/"+s,t,{headers:{Authorization:`Bearer ${n}`}}).then(r=>{if(r.status===200){j(!1);const x=r.data,S=D.map(fe=>fe.id===x.id?x:fe);N([...S]),R(),l({type:o,payload:{status:!0,title:"Driver update",message:"Driver updated successfully",color:"success"}})}else r.status===203?l({type:o,payload:{status:!0,title:"Driver update error",message:"Email already exist",color:"warning"}}):r.status===204?(console.log(r.message),l({type:o,payload:{status:!0,title:"Driver update error",message:"Something is missing",color:"warning"}})):r.status===404?(console.log(r.message),l({type:o,payload:{status:!0,title:"Driver update error",message:"Driver not found",color:"warning"}})):r.status===500&&l({type:o,payload:{status:!0,title:"Driver update error",message:r.data.message,color:"warning"}})}).catch(r=>{console.error("Error:",r)})}else l({type:o,payload:{status:!0,title:"Error!",message:"Picker update error, Please Check the input fields",color:"warning"}})},_e=t=>{w(!F),ze(t)},Qe=t=>{g.delete(f+"assistant/rider/delete/"+t,{headers:{Authorization:`Bearer ${n}`}}).then(s=>{s.status===200?(l({type:o,payload:{status:!0,title:"Driver Delete",message:"Driver deleted successfully",color:"success"}}),w(!1),R()):s.status===404?l({type:o,payload:{status:!0,title:"Driver remove error",message:s.data.message}}):s.status===500&&l({type:o,payload:{status:!0,title:"Driver remove error",message:s.data.message}})}).catch(s=>{console.error("Error:",s)})},Ye=()=>{j(!1),I(!0)},qe=t=>{if(k===""||z==="")l({type:o,payload:{status:!0,title:"Password update error",message:"Check the input fields",color:"warning"}});else if(k===z){const s={passcode:k};console.log(s,t),b&&n&&g.patch(f+"assistant/rider/update/"+t,s,{headers:{Authorization:`Bearer ${n}`}}).then(r=>{r.status===200?(I(!1),l({type:o,payload:{status:!0,title:"Password update",message:"Password updated successfully",color:"success"}}),j(!0)):r.status===204?l({type:o,payload:{status:!0,title:"Password update error",message:r.data.message}}):r.status===404?l({type:o,payload:{status:!0,title:"Password update error",message:r.data.message}}):r.status===500&&l({type:o,payload:{status:!0,title:"Password update error",message:r.data.message}})}).catch(r=>{console.error(r)})}else l(k!==z?{type:o,payload:{status:!0,title:"Password update error",message:"Password does not match",color:"warning"}}:{type:o,payload:{status:!0,title:"Password update error",message:"Password update error or check the input fields",color:"warning"}})};return e.jsxs(Xe,{children:[e.jsx(xe,{to:"/driver/adddriver",className:"picker-link",children:e.jsx(h,{style:{marginLeft:"0%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Add Driver"})}),e.jsx(je,{style:{marginLeft:"39%"},color:"secondary",children:"Filter by"}),e.jsxs(Ce,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(ve,{style:{color:"white"},children:Ee}),e.jsxs(we,{children:[e.jsx(C,{onClick:()=>V("all"),children:"All"}),e.jsx(C,{onClick:()=>V("Milan"),children:"Milan"}),e.jsx(C,{onClick:()=>V("Napoli"),children:"Napoli"})]})]}),e.jsxs(Ce,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(ve,{style:{color:"white"},children:Pe}),e.jsxs(we,{children:[e.jsx(C,{onClick:()=>me("all"),children:"All"}),Ae.map((t,s)=>e.jsx(C,{onClick:()=>me(t._id,t.name),children:t.name},s))]})]}),e.jsx(Ze,{style:{marginTop:"1%"},className:"bg-body-tertiary",children:e.jsx(p,{type:"text",placeholder:"Search by Driver id, name, surname, email and contact",style:{width:450,marginLeft:"0%"},value:m,onChange:t=>y(t.target.value)})}),be?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(We,{style:{marginTop:"15%"}})}):e.jsxs(Oe,{children:[e.jsx(et,{children:e.jsxs(G,{children:[e.jsx(d,{scope:"col",children:"#"}),e.jsx(d,{scope:"col",children:"Id"}),e.jsx(d,{scope:"col",children:"First Name"}),e.jsx(d,{scope:"col",children:"Last Name"}),e.jsx(d,{scope:"col",children:"Email"}),e.jsx(d,{scope:"col",children:"Phone"}),e.jsx(d,{scope:"col",children:"City"}),e.jsx(d,{scope:"col",children:"Country"}),e.jsx(d,{scope:"col",children:"Employee ID"}),e.jsx(d,{scope:"col",children:"Language"}),e.jsx(d,{scope:"col",children:"Group"}),e.jsx(d,{scope:"col",children:"Edit"}),e.jsx(d,{scope:"col",children:"Edit Status"}),e.jsx(d,{scope:"col",children:"Action"})]})}),e.jsx(tt,{children:D.length===0?e.jsx(G,{children:e.jsx(i,{colSpan:"14",style:{textAlign:"center",backgroundColor:"white"},children:e.jsx("h6",{style:{marginTop:"1%"},children:"No Data"})})}):D.map((t,s)=>e.jsxs(G,{children:[e.jsx(i,{children:s+1}),e.jsx(i,{children:t.code}),e.jsx(i,{children:t.name}),e.jsx(i,{children:t.surname}),e.jsx(i,{children:t.email}),e.jsx(i,{children:t.contact}),e.jsx(i,{children:t.city}),e.jsx(i,{children:t.country==="it"||t.country==="Italy"?"Italy":t.country}),e.jsx(i,{children:t.employeeId?t.employeeId:e.jsx(je,{color:"warning",children:"Not Provide"})}),e.jsx(i,{children:t.language==="en"?"English":t.language==="it"?"Italy":t.language==="es"?"Spanish":t.language}),e.jsx(i,{children:t.groups.map((r,x)=>e.jsx("div",{children:r.name},x))}),e.jsx(i,{children:e.jsx(xe,{children:e.jsx(ye,{icon:st,size:"xl",onClick:()=>Ue(t)})})}),e.jsx(i,{children:t.activate?e.jsx(h,{size:"sm",onClick:()=>ge(t.id,!1),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Deactivate"}):e.jsx(h,{size:"sm",onClick:()=>ge(t.id,!0),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Activate"})}),e.jsx(i,{children:e.jsx(h,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>_e(t.id),children:e.jsx(ye,{icon:at,size:"lg",style:{color:"white"}})})})]},s))})]}),e.jsxs(E,{alignment:"center",visible:Ve,scrollable:!0,size:"sm",onClose:()=>I(!1),children:[e.jsx(P,{closeButton:!0,children:e.jsx(A,{children:"Update Password"})}),e.jsxs(T,{children:[e.jsx(c,{md:12,children:e.jsx(p,{id:"password",label:"Enter New Password",type:"password",onChange:t=>Ie(t.target.value)})}),e.jsx("br",{}),e.jsx(c,{md:12,children:e.jsx(p,{id:"repassword",label:"Re Enter Password",type:"password",onChange:t=>Re(t.target.value)})})]}),e.jsx(rt,{children:e.jsx(h,{type:"submit",style:{marginBottom:"3%",backgroundColor:"#ff4d4d",color:"white"},onClick:()=>{qe(u.id)},children:"Update"})})]}),e.jsxs(E,{alignment:"center",visible:F,scrollable:!0,size:"sm",onClose:()=>w(!1),children:[e.jsx(P,{closeButton:!1,children:e.jsx(A,{children:"Confirmation"})}),e.jsxs(T,{children:[e.jsx("a",{children:"Are you sure you want to delete this driver?"}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[e.jsx(h,{onClick:()=>Qe(Me),style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),e.jsx(h,{onClick:()=>w(!1),style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]}),e.jsxs(E,{alignment:"center",visible:$,scrollable:!0,size:"sm",onClose:()=>v(!1),children:[e.jsx(P,{closeButton:!1,children:e.jsx(A,{children:"Confirmation"})}),e.jsxs(T,{children:[e.jsxs("a",{children:["Are you sure you want to ",L?"activate":"deactivate"," this driver?"]}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[e.jsx(h,{onClick:()=>Fe(),style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),e.jsx(h,{onClick:()=>v(!1),style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]}),e.jsxs(E,{visible:O,scrollable:!0,size:"lg",onClose:()=>j(!1),children:[e.jsx(P,{closeButton:!0,children:e.jsx(A,{children:"Edit Driver Information"})}),e.jsx(T,{children:e.jsxs("div",{className:"row g-3",children:[e.jsx(c,{md:6,children:e.jsx(p,{id:"name",label:"Firt Name",defaultValue:u.name,onChange:t=>te(t.target.value)})}),e.jsx(c,{md:6,children:e.jsx(p,{id:"surname",label:"LastName",defaultValue:u.surname,onChange:t=>ae(t.target.value)})}),e.jsx(c,{md:6,children:e.jsx(p,{id:"address",label:"Address",defaultValue:u.address,onChange:t=>pe(t.target.value)})}),e.jsx(c,{md:6,children:e.jsx(p,{id:"email",label:"Email",defaultValue:u.email,onChange:t=>le(t.target.value)})}),e.jsx(c,{md:6,children:e.jsx(p,{id:"phone",label:"Contact Number",defaultValue:u.contact,onChange:t=>ie(t.target.value)})}),e.jsx(c,{md:6,children:e.jsx(p,{id:"iban",label:"IBAN",defaultValue:u.iban,onChange:t=>de(t.target.value)})}),e.jsx(c,{md:6,children:e.jsx(p,{id:"vat",label:"Vat",defaultValue:u.vat,onChange:t=>ue(t.target.value)})}),e.jsx(c,{md:6,children:e.jsxs(lt,{id:"inputState",label:"City",value:M,onChange:t=>ce(t.target.value),children:[e.jsx("option",{children:u.city}),e.jsx("option",{children:"Milano"}),e.jsx("option",{children:"Napoli"})]})}),e.jsx(c,{xs:6,children:e.jsx(h,{style:{marginBottom:"3%",width:"200px",backgroundColor:"#ff4d4d",color:"white"},onClick:()=>He(),children:"Update Rider"})}),e.jsx(c,{xs:6,children:e.jsx("span",{style:{fontSize:15,color:"red",cursor:"pointer",marginLeft:"64%",marginTop:"10%"},onClick:()=>Ye(),children:"Change Password"})})]})})]})]})};export{Dt as default};
