import{r as i,y as R,l as z,A as o,j as e,m as D}from"./index-BWkgGQRa.js";import{M as L,T as G,a as _,P as H}from"./leaflet-DQ1ph0ip.js";import{a as d}from"./axios-Cm0UX6qg.js";import{B as p}from"./config-HOLfLxHr.js";import{b as P,a as k}from"./CContainer-n_XM2trt.js";import{C as I}from"./CNavbar-BwlLOQyI.js";import{C as F,a as O,b as U,c as M}from"./DefaultLayout-C-k2K-WS.js";import{c as V}from"./cil-info-CmGCY32x.js";import{C as W,a as Y,b as Z,c as q}from"./CModalTitle-CZnaKMAX.js";import{C as J,a as K,b,c as u,d as Q,e as h}from"./CTable-Bb3Q9-5y.js";import{C as X}from"./CModalFooter-BT_4nXdn.js";const pe=()=>{const[g,n]=i.useState(!1),[{user:c,token:l},r]=R(),[f,x]=i.useState("Napoli"),[w,C]=i.useState("Napoli"),[v,A]=i.useState([]),[T,S]=i.useState([]),[m,B]=i.useState();z();const y=(s,t)=>{n(!g),B(t),d.get(p+`market/groups/fetch/0?city=${s}`,{headers:{Authorization:`Bearer ${l}`}}).then(a=>{a.status===200?S(a.data):a.status===500&&r({type:o,payload:{status:!0,title:"City loading error",message:a.data.message}})}).catch(a=>{console.error("Error:",a)})},j=s=>{s==="all"?(x(""),C("Napoli")):(x(s),C(s))};i.useEffect(()=>{c&&l&&d.get(p+`assistant/markets/groups/locations/delivery/${f}`,{headers:{Authorization:`Bearer ${l}`}}).then(s=>{s.status===200?A(s.data):s.status===500&&r({type:o,payload:{status:!0,title:"Market Group loading error",message:s.data.message}})}).catch(s=>{console.error("Error:",s)})},[c,f]);const E=(s,t)=>{s&&t&&c&&l&&(console.log("one"),d.put(p+`market/groups/assign/${t}/${s}`,{},{headers:{Authorization:`Bearer ${l}`}}).then(a=>{a.status===200?(n(!1),r({type:o,payload:{status:!0,title:"Market Assign",message:"New Market Assign Successfully",color:"success"}})):a.status===204?r({type:o,payload:{status:!0,title:"Market Assign error",message:a.data.message}}):a.status===500&&r({type:o,payload:{status:!0,title:"Market Assign error",message:a.data.message}})}).catch(a=>{console.error("Error:",a)}))},N=(s,t)=>{s&&t&&c&&l&&d.put(p+`market/groups/remove/${t}/${s}`,{},{headers:{Authorization:`Bearer ${l}`}}).then(a=>{a.status===200?(n(!1),r({type:o,payload:{status:!0,title:"Market Remove",message:"Market removed Successfully",color:"success"}})):a.status===204?r({type:o,payload:{status:!0,title:"Market Remove error",message:a.data.message}}):a.status===500&&r({type:o,payload:{status:!0,title:"Market Remove error",message:a.data.message}})}).catch(a=>{console.error("Error:",a)})};return e.jsxs(P,{children:[e.jsx(I,{className:"bg-body-tertiary",children:e.jsxs(F,{style:{marginLeft:"90%",width:"17%",marginRight:"5px",backgroundColor:"#ff4d4d"},children:[e.jsx(O,{style:{color:"white"},children:w}),e.jsxs(U,{children:[e.jsx(M,{onClick:()=>j("Napoli"),children:"Napoli"}),e.jsx(M,{onClick:()=>j("Milano"),children:"Milano"})]})]})}),e.jsxs(L,{dragging:!0,center:[40.85631,14.24641],zoom:13,scrollWheelZoom:!0,style:{height:"500px",width:"100%"},children:[e.jsx(G,{attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),v.map((s,t)=>e.jsx(_,{position:[s.lat,s.lng],onClick:y,children:e.jsx(H,{children:e.jsxs("div",{onClick:()=>y(s.city,s._id),children:[e.jsx(D,{icon:V,size:"lg",style:{marginLeft:"10px"}})," ",e.jsx("span",{children:s.address})]})})},t))]}),e.jsxs(W,{visible:g,scrollable:!0,size:"xl",onClose:()=>n(!1),children:[e.jsx(Y,{closeButton:!0,children:e.jsx(Z,{children:"Map Information"})}),e.jsx(q,{style:{overflowY:"auto",maxHeight:"70vh"},children:e.jsxs(J,{children:[e.jsx(K,{children:e.jsxs(b,{children:[e.jsx(u,{scope:"col",children:"#"}),e.jsx(u,{scope:"col",children:"Name"}),e.jsx(u,{scope:"col",children:"Market"}),e.jsx(u,{scope:"col",children:"Action"})]})}),e.jsx(Q,{children:T.map((s,t)=>e.jsxs(b,{children:[e.jsx(h,{children:t+1}),e.jsx(h,{children:s.name}),e.jsx(h,{children:s.markets.map((a,$)=>e.jsxs("div",{children:[a.chain.name," - ",a.address," "]},$))}),e.jsx(h,{children:s.markets.some(a=>a.id===m)?e.jsx(k,{style:{backgroundColor:"#ff4d4d",width:"90px",color:"white"},onClick:()=>N(m,s._id),children:"Remove"}):e.jsx(k,{style:{backgroundColor:"#ff4d4d",width:"90px",color:"white"},onClick:()=>E(m,s._id),children:"Assign"})})]},t))})]})}),e.jsx(X,{})]})]})};export{pe as default};
