import{r as t,y as $e,A as d,j as a,h as ae}from"./index-B08OXeWv.js";import{a as f}from"./axios-Cm0UX6qg.js";import{B as m}from"./config-HOLfLxHr.js";import{b as ze,a as S}from"./CContainer-Bcycrjrg.js";import{C as se,a as j,b as k,c as y,d as h}from"./DefaultLayout-ZVM7TRL_.js";import{C as te}from"./CNavbar-CI1ooECg.js";import{C as le,a as re,b,c as o,d as oe,e as i}from"./CTable-isbk2Vch.js";import{C as Ge,a as Ne,b as Re,c as _e}from"./CModalTitle-BEzJ5tl5.js";import{C as Fe}from"./CModalFooter-CT0DeHo_.js";import{C as He,a as ie}from"./CPaginationItem-BtMnBLEs.js";const Ye=()=>{const[B,M]=t.useState(!1),[{user:x,token:n},c]=$e(),[D,P]=t.useState([]),[ne,E]=t.useState(!1),[ce,$]=t.useState(!1),[z,G]=t.useState(""),[N,R]=t.useState(""),[_,F]=t.useState("");t.useState(!1),t.useState("");const[de,he]=t.useState(!1),[ue,H]=t.useState("All Cities"),[pe,I]=t.useState("All Market Groups"),[ge,U]=t.useState("All Chains"),[fe,me]=t.useState([]),[xe,Ce]=t.useState([]),[je,V]=t.useState("All Cities"),[ke,q]=t.useState("All Chains"),[ye,Me]=t.useState([]),[J,K]=t.useState(""),[O,Q]=t.useState(""),[we,Ae]=t.useState([]),[w,W]=t.useState(0),[X,v]=t.useState(""),[Se,L]=t.useState(""),[be,Y]=t.useState(!0);t.useEffect(()=>{De(),Pe()},[]);const De=()=>{n&&f.get(m+"market/groups/dropdown/fetch",{headers:{Authorization:`Bearer ${n}`}}).then(e=>{e.status===200?me(e.data):e.status===500&&c({type:d,payload:{status:!0,title:"Market Group Loading error",message:e.data.message}})}).catch(e=>{console.error("Error: ",e)})},Pe=()=>{n&&f.get(m+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${n}`}}).then(e=>{e.status===200?(Ce(e.data),Me(e.data)):e.status===500&&c({type:d,payload:{status:!0,title:"Chain Loading error",message:e.data.message}})}).catch(e=>{console.error("Error: ",e)})};t.useEffect(()=>{const e=setTimeout(()=>{c({type:d,payload:{status:!0,title:"Data Loading",message:"Data loading error: Timeout exceeded",color:"warning"}}),E(!1)},2e4);return Ee(e),()=>{clearTimeout(e)}},[z,N,_,de]);const Ee=e=>{x&&n&&(E(!0),f.get(m+`assistant/shoppers/:skip?city=${z}&group=${N}&chain=${_}`,{headers:{Authorization:`Bearer ${n}`}}).then(s=>{s.status===200?(P(s.data),E(!1),he(!1),clearTimeout(e)):s.status===500&&c({type:d,payload:{status:!0,title:"Error",message:s.data.message,color:"warning"}})}).catch(s=>{console.error("Error:",s)}))},g=(e,s)=>{s==="view"?e==="all"?(G(""),H("All Cities")):(G(e),H(e)):s==="modal"&&(e==="all"?(K(""),V("All Cities")):(K(e),V(e)))},Z=(e,s)=>{e==="all"?(R(""),I("All Market Groups")):(R(e),I(s))},A=(e,s,r)=>{r==="view"?e==="all"?(F(""),U("All Chains")):(F(e),U(s)):r==="modal"&&(e==="all"?(Q(""),q("All Chains")):(Q(e),q(s)))},ee=(e,s)=>{M(!B),console.log(e,s),v(e),L(s)};t.useEffect(()=>{x&&n&&T(0)},[O,J,x]);const T=(e,s)=>{$(!0),f.get(m+`assistant/market/locations/${e}?brand=${O}&city=${J}`,{headers:{Authorization:`Bearer ${n}`}}).then(r=>{r.status===200?(Ae(r.data.data),console.log("data market"),$(!1),r.data.data.length<20?(Y(!0),console.log("ok")):r.data.data.length>19&&Y(!1)):r.status===500&&c({type:d,payload:{status:!0,title:"Market Loading error",message:r.data.message}})}).catch(r=>{console.error("Error: ",r)})},ve=()=>{const e=w+20;W(e),T(e)},Le=()=>{const e=w-20;console.log(e),W(e),T(e)},Te=(e,s)=>{if(s&&e){const r={market:s,shopper:e};n&&x&&n&&f.post(m+"assistant/picker/assign/market",r,{headers:{Authorization:`Bearer ${n}`}}).then(l=>{if(l.status===200){M(!1),v(""),L("");const p=l.data,u=D.map(C=>C.id===p.id?p:C);P([...u]),c({type:d,payload:{status:!0,title:"Market Assign",message:"successfully Market assigned to the picker ",color:"success"}})}else l.status===204?c({type:d,payload:{status:!0,title:"Market Assign error",message:l.data.message,color:"warning"}}):l.status===500&&c({type:d,payload:{status:!0,title:"Market Assign error",message:l.data.message,color:"warning"}})}).catch(l=>{console.error("Error:",l)})}else c({type:d,payload:{status:!0,title:"Error!",message:"Picker Registration error, Please Check the input fields",color:"warning"}})},Be=(e,s)=>{if(s&&e){const r={market:s,shopper:e};n&&x&&n&&f.post(m+"assistant/picker/remove/market",r,{headers:{Authorization:`Bearer ${n}`}}).then(l=>{if(l.status===200){M(!1),v(""),L("");const p=l.data,u=D.map(C=>C.id===p.id?p:C);P([...u]),c({type:d,payload:{status:!0,title:"Market Assign",message:"successfully Market removed from the picker ",color:"success"}})}else l.status===204?c({type:d,payload:{status:!0,title:"Market remove error",message:l.data.message,color:"warning"}}):l.status===500&&c({type:d,payload:{status:!0,title:"Market remove error",message:l.data.message,color:"warning"}})}).catch(l=>{console.error("Error:",l)})}else c({type:d,payload:{status:!0,title:"Error!",message:"Picker Registration error, Please Check the input fields",color:"warning"}})};return a.jsxs(ze,{children:[a.jsx(se,{style:{marginLeft:"34%"},color:"secondary",children:"Filter by"}),a.jsxs(j,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[a.jsx(k,{style:{color:"white"},children:ue}),a.jsxs(y,{children:[a.jsx(h,{onClick:()=>g("all","view"),children:"All"}),a.jsx(h,{onClick:()=>g("Milan","view"),children:"Milan"}),a.jsx(h,{onClick:()=>g("Napoli","view"),children:"Napoli"})]})]}),a.jsxs(j,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[a.jsx(k,{style:{color:"white"},children:ge}),a.jsxs(y,{children:[a.jsx(h,{onClick:()=>A("all",null,"view"),children:"All"}),xe.map((e,s)=>a.jsx(h,{onClick:()=>A(e.id,e.name,"view"),children:e.name},s))]})]}),a.jsxs(j,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[a.jsx(k,{style:{color:"white"},children:pe}),a.jsxs(y,{children:[a.jsx(h,{onClick:()=>Z("all"),children:"All"}),fe.map((e,s)=>a.jsx(h,{onClick:()=>Z(e._id,e.name),children:e.name},s))]})]}),a.jsx(te,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),ne?a.jsx(ae,{}):a.jsxs(le,{children:[a.jsx(re,{children:a.jsxs(b,{children:[a.jsx(o,{scope:"col",children:"#"}),a.jsx(o,{scope:"col",children:"First Name"}),a.jsx(o,{scope:"col",children:"Last Name"}),a.jsx(o,{scope:"col",children:"Email"}),a.jsx(o,{scope:"col",children:"Phone"}),a.jsx(o,{scope:"col",children:"Country"}),a.jsx(o,{scope:"col",children:"City"}),a.jsx(o,{scope:"col",children:"Language"}),a.jsx(o,{scope:"col",children:"Market"}),a.jsx(o,{scope:"col",children:"Add Market"})]})}),a.jsx(oe,{children:D.map((e,s)=>{var r,l,p;return a.jsxs(b,{children:[a.jsx(i,{children:s+1}),a.jsx(i,{children:e.name}),a.jsx(i,{children:e.surname}),a.jsx(i,{children:e.email}),a.jsx(i,{children:e.contact}),a.jsx(i,{children:e.country==="it"||e.country==="Italy"?"Italy":e.country}),a.jsx(i,{children:e.city}),a.jsx(i,{children:e.language==="en"?"English":e.language==="it"?"Italy":e.language==="es"?"Spanish":e.language}),a.jsxs(i,{children:[(l=(r=e.market)==null?void 0:r.chain)==null?void 0:l.name," - ",e.market.address]}),a.jsx(i,{children:(p=e.market)!=null&&p.id?a.jsx(S,{size:"sm",onClick:()=>{var u;return ee(e.id,(u=e.market)==null?void 0:u.id)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Assign"}):a.jsx(S,{size:"sm",onClick:()=>{var u;return ee(e.id,(u=e.market)==null?void 0:u.id)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Add"})})]},s)})})]}),a.jsxs(Ge,{visible:B,scrollable:!0,size:"xl",onClose:()=>M(!1),children:[a.jsx(Ne,{closeButton:!0,children:a.jsx(Re,{children:"Market assign view"})}),a.jsxs(_e,{children:[a.jsx(se,{style:{marginLeft:"54%"},color:"secondary",children:"Filter by"}),a.jsxs(j,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[a.jsx(k,{style:{color:"white"},children:je}),a.jsxs(y,{children:[a.jsx(h,{onClick:()=>g("all","modal"),children:"All"}),a.jsx(h,{onClick:()=>g("Milano","modal"),children:"Milano"}),a.jsx(h,{onClick:()=>g("Napoli","modal"),children:"Napoli"})]})]}),a.jsxs(j,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[a.jsx(k,{style:{color:"white"},children:ke}),a.jsxs(y,{children:[a.jsx(h,{onClick:()=>A("all",null,"modal"),children:"All"}),ye.map((e,s)=>a.jsx(h,{onClick:()=>A(e.id,e.name,"modal"),children:e.name},s))]})]}),a.jsx(te,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),ce?a.jsx(ae,{}):a.jsxs(le,{children:[a.jsx(re,{children:a.jsxs(b,{children:[a.jsx(o,{scope:"col",children:"#"}),a.jsx(o,{scope:"col",children:"Name"}),a.jsx(o,{scope:"col",children:"Address"}),a.jsx(o,{scope:"col",children:"City"}),a.jsx(o,{scope:"col",children:"Measurement"}),a.jsx(o,{scope:"col"})]})}),a.jsx(oe,{children:we.map((e,s)=>a.jsxs(b,{children:[a.jsx(i,{children:w+s+1}),a.jsx(i,{children:e.chain.name}),a.jsx(i,{children:e.address}),a.jsx(i,{children:e.city}),a.jsx(i,{children:e.scraped}),a.jsx(i,{children:Se===e._id?a.jsx(S,{size:"sm",onClick:()=>Be(X,e._id),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Remove"}):a.jsx(S,{size:"sm",onClick:()=>Te(X,e._id),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Add"})})]},s))})]}),a.jsx(Fe,{children:a.jsxs(He,{"aria-label":"Page navigation example",children:[a.jsx(ie,{disabled:w<=0,onClick:Le,children:"Previous"}),a.jsx(ie,{disabled:be===!0,onClick:ve,children:"Next"})]})})]})]})]})};export{Ye as default};
