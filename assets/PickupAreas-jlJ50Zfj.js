import{r as s,y as ge,A as l,j as e,h as fe,L as xe,m as z}from"./index-CJhmNy2g.js";import{a as b}from"./axios-Cm0UX6qg.js";import{E as Ce}from"./leaflet.draw-B1jXVoM3.js";import{M as je,T as ye}from"./leaflet-BXbVEXfC.js";import{B as P}from"./config-HOLfLxHr.js";import{b as ke,a as M}from"./CContainer-DiSFBEfd.js";import{d as I,C as F,a as R,b as _,c as d}from"./DefaultLayout-CAwAg_Gg.js";import{C as $}from"./CNavbar-EvOJOPJz.js";import{C as be,a as Pe,b as G,c as h,d as Me,e as m}from"./CTable-5XNdRfB0.js";import{c as Se}from"./cil-pencil-m516yCOw.js";import{C as we,a as V}from"./CPaginationItem-DKXqkl--.js";import{C as H,a as U,b as O,c as W}from"./CModalTitle-DRU8BoUK.js";import{M as Ne,P as Ae}from"./Popup-DMFaovKC.js";import{c as De}from"./cil-info-CmGCY32x.js";import{P as Te}from"./Polygon-CPsiPnMP.js";import{F as ve}from"./FeatureGroup-DN-bcbYo.js";import{C as Z}from"./CModalFooter-XB2GlyqN.js";import{C as Le}from"./CFormInput-BrBU0AXX.js";import"./index-BjwgarBj.js";import"./CFormLabel-D0xhR0jf.js";const Ye=()=>{const q=s.useRef(null),[{user:n,token:i},r]=ge(),[J,K]=s.useState([]),[S,w]=s.useState(""),[g,N]=s.useState(0),[Q,A]=s.useState("All Cities"),[X,D]=s.useState(!1),[Y,T]=s.useState(!0),[ee,f]=s.useState(!1),[ae,x]=s.useState(!1),[se,te]=s.useState([]),[C,oe]=s.useState("Napoli"),[v,re]=s.useState([]),[j,le]=s.useState([]),[y,k]=s.useState(""),[p,L]=s.useState(""),[ie,E]=s.useState("");s.useEffect(()=>{n&&i&&u(0)},[S,n]);const u=(a,t)=>{D(!0),b.get(P+`pickups/areas/${a}?city=${S}`,{headers:{Authorization:`Bearer ${i}`}}).then(o=>{o.status===200?(K(o.data),D(!1),o.data.length<20?(T(!0),console.log("ok")):o.data.length>19&&T(!1)):o.status===500&&r({type:l,payload:{status:!0,title:"Market Loading error",message:o.data.message}})}).catch(o=>{console.error("Error: ",o)})},ne=()=>{const a=g+20;N(a),u(a)},ce=()=>{const a=g-20;console.log(a),N(a),u(a)},c=a=>{a==="all"?(w(""),A("All Cities")):(w(a),A(a),oe(a))},de=(a,t)=>{f(!0),re(a),k(t),console.log(a)},pe=(a,t)=>{x(!0),k(a),E(t),console.log(t)};s.useEffect(()=>{n&&i&&b.get(P+`assistant/markets/groups/locations/pickup/${C}`,{headers:{Authorization:`Bearer ${i}`}}).then(a=>{a.status===200?te(a.data):a.status===500&&r({type:l,payload:{status:!0,title:"Market Group loading error",message:a.data.message}})}).catch(a=>{console.error("Error:",a)})},[n,C]);const ue=a=>{const t=a.layer;console.log("layer",t._latlngs),le(t._latlngs)},B=a=>{if(a){let t={};j&&(t={area:j}),p&&(t={name:p}),console.log(t,a),n&&i&&b.put(P+"pickup/area/update/"+a,t,{headers:{Authorization:`Bearer ${i}`}}).then(o=>{o.status===200?(r({type:l,payload:{status:!0,title:"Pickup Area Update",message:"Pick up area update Success",color:"success"}}),k(""),L(""),u(0),f(!1),x(!1),E("")):o.status===204?r({type:l,payload:{status:!0,title:"Pick up area update  error",message:o.data.message,color:"danger"}}):o.status===500&&r({type:l,payload:{status:!0,title:"Pick up area update  error",message:o.data.message,color:"danger"}})}).catch(o=>{console.error("Error:",o)})}else alert("Please Check the Fields!")},he=()=>{j==""?r({type:l,payload:{status:!0,title:"Alert",message:"Please select the area",color:"danger"}}):B(y)},me=()=>{p==""&&y==""?r({type:l,payload:{status:!0,title:"Alert",message:"Please Name",color:"danger"}}):B(y)};return e.jsxs(ke,{children:[e.jsx(I,{style:{marginLeft:"75.5%"},color:"secondary",children:"Filter by"}),e.jsxs(F,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[e.jsx(R,{style:{color:"white"},children:Q}),e.jsxs(_,{children:[e.jsx(d,{onClick:()=>c("all"),children:"All"}),e.jsx(d,{onClick:()=>c("Milano"),children:"Milano"}),e.jsx(d,{onClick:()=>c("Napoli"),children:"Napoli"})]})]}),e.jsx($,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),X?e.jsx(fe,{}):e.jsxs(be,{children:[e.jsx(Pe,{children:e.jsxs(G,{children:[e.jsx(h,{scope:"col",children:"Name"}),e.jsx(h,{scope:"col",children:"Type"}),e.jsx(h,{scope:"col",children:"City"}),e.jsx(h,{scope:"col",children:"View"})]})}),e.jsx(Me,{children:J.map((a,t)=>e.jsxs(G,{children:[e.jsxs(m,{children:[e.jsx("span",{children:a.name}),e.jsx(xe,{to:"",children:e.jsx(z,{style:{marginLeft:20,float:"right"},icon:Se,size:"sm",onClick:()=>pe(a._id,a.name)})})]}),e.jsx(m,{children:a.geometry.type}),e.jsx(m,{children:a.city}),e.jsx(m,{children:e.jsx(M,{size:"sm",style:{backgroundColor:"#ff4d4d",color:"white"},variant:"outline",onClick:()=>de(a.geometry.coordinate,a._id),children:"View map"})})]},t))})]}),e.jsxs(we,{"aria-label":"Page navigation example",children:[e.jsx(V,{disabled:g<=0,onClick:ce,children:"Previous"}),e.jsx(V,{disabled:Y===!0,onClick:ne,children:"Next"})]}),e.jsxs(H,{alignment:"center",visible:ee,scrollable:!0,size:"xl",onClose:()=>f(!1),children:[e.jsx(U,{closeButton:!0,children:e.jsx(O,{children:"Map View"})}),e.jsxs(W,{children:[e.jsx(I,{style:{marginLeft:"81.5%"},color:"secondary",children:"Filter by"}),e.jsxs(F,{style:{marginLeft:"2%",width:"10%",backgroundColor:"#ff4d4d"},children:[e.jsx(R,{style:{color:"white"},children:C}),e.jsxs(_,{children:[e.jsx(d,{onClick:()=>c("Milano"),children:"Milano"}),e.jsx(d,{onClick:()=>c("Napoli"),children:"Napoli"})]})]}),e.jsx($,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),e.jsxs(je,{dragging:!0,center:[40.85631,14.24641],zoom:13,scrollWheelZoom:!0,style:{height:"500px",width:"100%"},children:[e.jsx(ye,{attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),se.map((a,t)=>e.jsx(Ne,{position:[a.lat,a.lng],children:e.jsx(Ae,{children:e.jsxs("div",{children:[e.jsx(z,{icon:De,size:"lg",style:{marginLeft:"10px"}})," ",e.jsx("span",{children:a.address})]})})},t)),v.length>0&&e.jsx(Te,{positions:v}),e.jsx(ve,{ref:q,children:e.jsx(Ce,{position:"topright",onCreated:ue,draw:{polygon:!0,circle:!0,polyline:!0,marker:!1,circlemarker:!1}})})]})]}),e.jsx(Z,{children:e.jsx(M,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>he(),children:"Save updated area"})})]}),e.jsxs(H,{alignment:"center",visible:ae,scrollable:!0,size:"sm",onClose:()=>x(!1),children:[e.jsx(U,{closeButton:!0,children:e.jsx(O,{children:"Change Name"})}),e.jsxs(W,{children:[e.jsx("a",{children:"Enter New Name"}),e.jsx("br",{}),e.jsx(Le,{type:"text",placeholder:ie,value:p,onChange:a=>L(a.target.value)})]}),e.jsx(Z,{children:e.jsx(M,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>me(),children:"Save changes"})})]})]})};export{Ye as default};
