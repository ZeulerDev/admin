import{r as o,y as Cs,l as ys,A as n,j as e,h as E,L as k,m as S}from"./index-Bsn8dk4K.js";import{a as j}from"./axios-Cm0UX6qg.js";import{L as ze}from"./leaflet-BHB__4Ge.js";import{c as bs}from"./leaflet-routing-machine-B-slrAp6.js";import{B as g}from"./config-CAsDK75y.js";import{b as ks,a as p}from"./CContainer-AV4JspaL.js";import{C as I,a as H,b as _,d as Y,e as d,c as Ss}from"./DefaultLayout-FA2rmZWX.js";import{C as Re}from"./CNavbar-5ERL6Uil.js";import{C as W,a as q,b as C,c as a,d as J,e as l}from"./CTable-CwbSrcrF.js";import{c as ws}from"./cil-pencil-m516yCOw.js";import{c as Bs}from"./cil-info-CmGCY32x.js";import{c as As}from"./cil-map-dAArMthr.js";import{C as Ds,a as Me}from"./CPaginationItem-TLWytmzh.js";import{C as w,a as B,b as A,c as D}from"./CModalTitle-BnZCXL7j.js";import{C as T}from"./CModalFooter-ylOqhqYb.js";import{C as L}from"./CFormInput--iaGGot-.js";import{C as vs}from"./CRow-DDazsrmf.js";import{C as K}from"./CFormLabel-iOJk5yzm.js";import{C as Q}from"./CCol-S6pnG2SN.js";const Zs=()=>{var Se,we,Be,Ae;const[N,X]=o.useState(!1),[Z,v]=o.useState(!1),[Ee,P]=o.useState(!1),[Ie,Te]=o.useState(!1),[{user:f,token:c},i]=Cs();ys();const[m,z]=o.useState([]),[Le,$]=o.useState(!1),[Ne,ee]=o.useState(!1),[se,y]=o.useState(!1),[Pe,$e]=o.useState([]),[R,te]=o.useState(0),[ae,oe]=o.useState(""),[F,le]=o.useState(""),[Fe,Ge]=o.useState(""),[G,U]=o.useState(!1),[b,Ue]=o.useState([]),[re,V]=o.useState(!1),[Ve,Oe]=o.useState([]),[zs,He]=o.useState([]),[ie,ne]=o.useState(""),[ce,de]=o.useState(""),[he,Rs]=o.useState(""),[_e,ue]=o.useState("All Cities"),[Ye,xe]=o.useState("All Market Groups");o.useState("All Chains");const[We,qe]=o.useState([]),[pe,Je]=o.useState(""),[Ke,Qe]=o.useState(""),[je,ge]=o.useState(""),[Xe,fe]=o.useState("All Status"),[Ze,es]=o.useState(""),[Ms,ss]=o.useState(""),[Es,ts]=o.useState([]),[Is,as]=o.useState({duration:" ",distance:" "}),[os,me]=o.useState(!0);o.useEffect(()=>{const s=setTimeout(()=>{i({type:n,payload:{status:!0,title:"Data Loading",message:"Data loading timeout exceeded or no data to show",color:"warning"}}),$(!1)},2e4);return f&&c&&M(0,s),()=>{clearTimeout(s)}},[f,c,je]);const M=(s,t)=>{$(!0),j.get(g+"assistant/batches/"+s+"?status="+je,{headers:{Authorization:`Bearer ${c}`}}).then(r=>{r.status===200?(z(r.data),$(!1),clearTimeout(t),r.data.length<50?(me(!0),console.log("ok")):r.data.length>49&&me(!1)):r.status===204?i({type:n,payload:{status:!0,title:"Batches loading error",message:r.data.message}}):r.status===500&&i({type:n,payload:{status:!0,title:"Batches loading error",message:r.data.message}})}).catch(r=>{console.error("Error:",r)})},ls=()=>{const s=R+50;te(s),M(s,!0)},rs=()=>{const s=R-50;console.log(s),te(s),M(s,!1)},is=s=>{X(!N),console.log(s),Ce(s)},Ce=s=>{c&&f&&(y(!0),j.get(g+"assistant/batch/customers/"+s,{headers:{Authorization:`Bearer ${c}`}}).then(t=>{t.status===200?(console.log("done"),$e(t.data),y(!1)):t.status===500&&i({type:n,payload:{status:!0,title:"Batch details view error",message:t.data.message}})}).catch(t=>{console.error("Batch details view error:",t)}))},ns=(s,t=null)=>{P(!N),Ge(s),t!==null?oe(t):console.log("Bonus number not provided")},cs=()=>{const s={bonus:ae};f&&c&&j.put(g+"assistant/batch/bonus/"+Fe,s,{headers:{Authorization:`Bearer ${c}`}}).then(t=>{if(t.status===200){console.log("updated"),P(!1);const r=t.data,x=m.find(h=>h.id===r._id);x&&(x.bonus=r.bonus),z([...m]),i({type:n,payload:{status:!0,title:"Bonus Update",message:"Bonus Update Success",color:"success"}})}else t.status===203?(console.log("203"),i({type:n,payload:{status:!0,title:"Bonus Update error",message:t.data.message}})):t.status===204?(console.log("204"),i({type:n,payload:{status:!0,title:"Bonus Update error",message:t.data.message}})):t.status===500&&i({type:n,payload:{status:!0,title:"Bonus Update error",message:t.data.message}})}).catch(t=>{console.error(t)})},ds=(s,t)=>{U(!G),y(!0),le(t),c&&f&&(y(!0),j.get(g+"assistant/batch/"+s,{headers:{Authorization:`Bearer ${c}`}}).then(r=>{r.status===200?(Ue(r.data),y(!1)):r.status===500&&i({type:n,payload:{status:!0,title:"Order details view error",message:r.data.message}})}).catch(r=>{console.error("Order details view error:",r)}))},ye=(s,t,r)=>{V(!re),le(t),Je(r),Qe(s)};o.useEffect(()=>{hs(),us()},[]);const hs=()=>{c&&j.get(g+"market/groups/dropdown/fetch",{headers:{Authorization:`Bearer ${c}`}}).then(s=>{s.status===200?Oe(s.data):s.status===500&&i({type:n,payload:{status:!0,title:"Market Group Loading error",message:s.data.message}})}).catch(s=>{console.error("Error: ",s)})},us=()=>{c&&j.get(g+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${c}`}}).then(s=>{s.status===200?He(s.data):s.status===500&&i({type:n,payload:{status:!0,title:"Chain Loading error",message:s.data.message}})}).catch(s=>{console.error("Error: ",s)})};o.useEffect(()=>{xs()},[ie,ce,he]);const xs=()=>{f&&c&&(ee(!0),j.get(g+`assistant/riders/:skip?city=${ie}&group=${ce}&chain=${he}`,{headers:{Authorization:`Bearer ${c}`}}).then(s=>{s.status===200?(qe(s.data),ee(!1)):s.status===500&&i({type:n,payload:{status:!0,title:"Error",message:s.data.message,color:"warning"}})}).catch(s=>{console.error("Error:",s)}))},O=s=>{s==="all"?(ne(""),ue("All Cities")):(ne(s),ue(s))},be=(s,t)=>{s==="all"?(de(""),xe("All Market Groups")):(de(s),xe(t))},ke=(s,t,r)=>{console.log("bid",s,"rid",t,r);const x={riderId:t,status:r};f&&c&&j.put(g+"assistant/batch/assign/rider/"+s,x,{headers:{Authorization:`Bearer ${c}`}}).then(h=>{if(h.status===200){console.log("updated"),G&&U(!1),V(!1);const De=h.data,ve=m.find(ms=>ms.id===De._id);ve&&(ve.bonus=De.bonus),z([...m]),M(0,!0),i({type:n,payload:{status:!0,title:"Rider Assign",message:"Rider assign update success"}})}else h.status===203?(console.log("203"),i({type:n,payload:{status:!0,title:"Rider Assign error",message:h.data.message}})):h.status===204?(console.log("204"),i({type:n,payload:{status:!0,title:"Rider Assign error",message:h.data.message}})):h.status===500&&i({type:n,payload:{status:!0,title:"Rider Assign error",message:h.data.message}})}).catch(h=>{console.error(h)})},u=s=>{s==="all"?(ge(""),fe("All Status")):(ge(s),fe(s))},ps=s=>{v(!Z),es(s),console.log(s)},js=s=>{console.log("status",s),f&&c&&j.put(g+"assistant/batch/assign/status/"+s,{},{headers:{Authorization:`Bearer ${c}`}}).then(t=>{if(t.status===200){console.log("updated",t.data),v(!1);const r=t.data,x=m.find(h=>h.id===r._id);x&&(console.log("done",x),x.status=r.status),z([...m])}else t.status===203?(console.log("203"),i({type:n,payload:{status:!0,title:"Status update error",message:t.data.message}})):t.status===204?(console.log("204"),i({type:n,payload:{status:!0,title:"Status update error",message:t.data.message}})):t.status===500&&i({type:n,payload:{status:!0,title:"Status update error",message:t.data.message}})}).catch(t=>{console.error(t)})},gs=s=>{j.get(g+"assistant/batch/markets/"+s,{headers:{Authorization:`Bearer ${c}`}}).then(t=>{t.status===200?(ts(t.data),t.data):t.status===203?i({type:n,payload:{status:!0,title:"Batch markets loading error",message:t.data.message}}):t.status===204?i({type:n,payload:{status:!0,title:"Batch markets loading error",message:t.data.message}}):t.status===500&&i({type:n,payload:{status:!0,title:"Batch markets loading error",message:t.data.message}})}).catch(t=>{console.error("Error:",t)})},fs=(s,t,r)=>{console.log(s),ss(s),Te(!Ie),Ce(s),gs(s);const x=t/60;as({duration:x.toFixed(0),distance:r})};return new ze.Icon({iconUrl:"https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.1/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),new ze.Icon({iconUrl:"https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-orange.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.1/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),e.jsxs(ks,{children:[e.jsx(I,{style:{marginLeft:"75.5%"},color:"secondary",children:"Filter by"}),e.jsxs(H,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[e.jsx(_,{style:{color:"white"},children:Xe}),e.jsxs(Y,{children:[e.jsx(d,{onClick:()=>u("all"),children:"All Status"}),e.jsx(d,{onClick:()=>u("created"),children:"Created"}),e.jsx(d,{onClick:()=>u("ready"),children:"Ready"}),e.jsx(d,{onClick:()=>u("finalized"),children:"Finalized"}),e.jsx(d,{onClick:()=>u("freeze"),children:"Freeze"}),e.jsx(d,{onClick:()=>u("forced"),children:"Forced"}),e.jsx(d,{onClick:()=>u("open"),children:"Open"}),e.jsx(d,{onClick:()=>u("completed"),children:"Completed"}),e.jsx(d,{onClick:()=>u("waiting"),children:"Waiting"}),e.jsx(d,{onClick:()=>u("paid "),children:"Paid "}),e.jsx(d,{onClick:()=>u("coloring "),children:"Coloring "}),e.jsx(d,{onClick:()=>u("delivery "),children:"Delivery "})]})]}),e.jsx(Re,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),Le?e.jsx(E,{}):e.jsxs(W,{children:[e.jsx(q,{children:e.jsxs(C,{children:[e.jsx(a,{scope:"col",children:"#"}),e.jsx(a,{scope:"col",children:"No"}),e.jsx(a,{scope:"col",children:"Duration"}),e.jsx(a,{scope:"col",children:"Distance"}),e.jsx(a,{scope:"col",children:"Status"}),e.jsx(a,{scope:"col",children:"Bonus"}),e.jsx(a,{scope:"col",children:"Date"}),e.jsx(a,{scope:"col",children:"Hour"}),e.jsx(a,{scope:"col",children:"fee"}),e.jsx(a,{scope:"col",children:"Start"}),e.jsx(a,{scope:"col",children:"End"}),e.jsx(a,{scope:"col",children:"Rider"}),e.jsx(a,{scope:"col",children:"Customers"}),e.jsx(a,{scope:"col",children:"Market"}),e.jsx(a,{scope:"col",children:"Orders"}),e.jsx(a,{scope:"col",children:"Map"}),e.jsx(a,{scope:"col",children:"Batch"})]})}),e.jsx(J,{children:m.map((s,t)=>e.jsxs(C,{children:[e.jsx(l,{children:R+t+1}),e.jsx(a,{scope:"row",children:s.no}),e.jsx(a,{scope:"row",children:s.duration}),e.jsx(l,{children:s.distance}),e.jsx(l,{children:e.jsx(I,{style:{width:80},color:"info",children:s.status})}),e.jsxs(l,{children:[s.bonus!=null?s.bonus.toFixed(2):0," ",e.jsx(k,{to:"",children:e.jsx(S,{icon:ws,size:"sm",onClick:()=>ns(s.id,s.bonus)})})," "]}),e.jsx(l,{children:s.date}),e.jsx(l,{children:s.hour}),e.jsx(l,{children:s.fee}),e.jsx(l,{children:s.start}),e.jsx(l,{children:s.end}),e.jsx(l,{children:s.accepted?e.jsx(p,{onClick:()=>ds(s.id,s.status),size:"sm",style:{width:80,backgroundColor:"#ff4d4d",color:"white"},children:"View"}):e.jsx(p,{onClick:()=>ye(s.accepted,s.status,s.id),size:"sm",style:{width:80,backgroundColor:"#ff4d4d",color:"white"},children:"Add"})}),e.jsx(l,{children:e.jsx(k,{children:e.jsx(S,{icon:Bs,size:"xl",onClick:()=>is(s.id)})})}),e.jsx(l,{children:e.jsx(k,{to:`/order/batches/market/${s.id}`,children:e.jsx(S,{icon:Ss,size:"xl"})})}),e.jsx(l,{children:e.jsx(k,{to:`/order/batches/orders/${s.id}`,children:e.jsx(S,{icon:bs,size:"xl"})})}),e.jsx(l,{children:e.jsx(k,{children:e.jsx(S,{icon:As,size:"xl",onClick:()=>fs(s.id,s.duration,s.distance)})})}),e.jsx(l,{children:s.status==="complete"?e.jsx(p,{size:"sm",disabled:!0,style:{width:80},children:"Cancel"}):s.status==="canceled"?e.jsx(p,{size:"sm",disabled:!0,style:{width:80,backgroundColor:"#ff4d4d",color:"white"},color:"danger",children:"Cancel"}):e.jsx(p,{onClick:()=>ps(s.id),size:"sm",style:{width:80,backgroundColor:"#ff4d4d",color:"white"},children:"Cancel"})})]},t))})]}),e.jsxs(Ds,{"aria-label":"Page navigation example",children:[e.jsx(Me,{disabled:R<=0,onClick:rs,children:"Previous"}),e.jsx(Me,{disabled:os===!0,onClick:ls,children:"Next"})]}),e.jsxs(w,{visible:N,scrollable:!0,size:"xl",onClose:()=>X(!1),children:[e.jsx(B,{closeButton:!0,children:e.jsx(A,{children:"Customers Information"})}),e.jsx(D,{style:{overflowY:"auto",maxHeight:"70vh",display:"flex",justifyContent:"center"},children:se?e.jsx(E,{}):e.jsxs(W,{children:[e.jsx(q,{children:e.jsxs(C,{children:[e.jsx(a,{scope:"col",children:"#"}),e.jsx(a,{scope:"col",children:"Order No"}),e.jsx(a,{scope:"col",children:"Name"}),e.jsx(a,{scope:"col",children:"Address"}),e.jsx(a,{scope:"col",children:"Slot"}),e.jsx(a,{scope:"col",children:"Date"}),e.jsx(a,{scope:"col",children:"Total"}),e.jsx(a,{scope:"col",children:"Latitude"}),e.jsx(a,{scope:"col",children:"Longitude"})]})}),e.jsx(J,{children:(Se=Pe.customers)==null?void 0:Se.map((s,t)=>e.jsxs(C,{children:[e.jsx(l,{children:t+1}),e.jsx(l,{children:s.orderNo}),e.jsx(l,{children:s.name}),e.jsx(l,{children:s.address}),e.jsx(l,{children:s.orderSlot}),e.jsx(l,{children:s.orderDate}),e.jsx(l,{children:s.orderTotal}),e.jsx(l,{children:s.lat}),e.jsx(l,{children:s.lng})]},t))})]})}),e.jsx(T,{})]}),e.jsxs(w,{alignment:"center",visible:Ee,scrollable:!0,size:"sm",onClose:()=>P(!1),children:[e.jsx(B,{closeButton:!0,children:e.jsx(A,{children:"Confirmation"})}),e.jsxs(D,{children:[e.jsx("a",{children:"Enter Bonus Amount"}),e.jsx("br",{}),e.jsx(L,{type:"text",placeholder:"Bonus",value:ae,onChange:s=>oe(s.target.value)})]}),e.jsx(T,{children:e.jsx(p,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>cs(),children:"Save changes"})})]}),e.jsxs(w,{alignment:"center",visible:re,scrollable:!0,size:"xl",onClose:()=>V(!1),children:[e.jsx(B,{closeButton:!0,children:e.jsx(A,{children:"Rider Assign to the Batch"})}),e.jsxs(D,{children:[e.jsx(I,{style:{marginLeft:"57%"},color:"secondary",children:"Filter by"}),e.jsxs(H,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[e.jsx(_,{style:{color:"white"},children:_e}),e.jsxs(Y,{children:[e.jsx(d,{onClick:()=>O("all"),children:"All"}),e.jsx(d,{onClick:()=>O("Milan"),children:"Milan"}),e.jsx(d,{onClick:()=>O("Napoli"),children:"Napoli"})]})]}),e.jsxs(H,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[e.jsx(_,{style:{color:"white"},children:Ye}),e.jsxs(Y,{children:[e.jsx(d,{onClick:()=>be("all"),children:"All"}),Ve.map((s,t)=>e.jsx(d,{onClick:()=>be(s._id,s.name),children:s.name},t))]})]}),e.jsx(Re,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),Ne?e.jsx(E,{}):e.jsxs(W,{children:[e.jsx(q,{children:e.jsxs(C,{children:[e.jsx(a,{scope:"col",children:"#"}),e.jsx(a,{scope:"col",children:"First Name"}),e.jsx(a,{scope:"col",children:"Last Name"}),e.jsx(a,{scope:"col",children:"Email"}),e.jsx(a,{scope:"col",children:"Phone"}),e.jsx(a,{scope:"col",children:"Country"}),e.jsx(a,{scope:"col",children:"Employee ID"}),e.jsx(a,{scope:"col",children:"Language"}),e.jsx(a,{scope:"col",children:"Group"}),e.jsx(a,{scope:"col",children:"Add Rider"})]})}),e.jsx(J,{children:We.map((s,t)=>e.jsxs(C,{children:[e.jsx(l,{children:t+1}),e.jsx(l,{children:s.name}),e.jsx(l,{children:s.surname}),e.jsx(l,{children:s.email}),e.jsx(l,{children:s.contact}),e.jsx(l,{children:s.country==="it"||s.country==="Italy"?"Italy":s.country}),e.jsx(l,{children:s.employeeId?s.employeeId:e.jsx(I,{color:"warning",children:"Not Provide"})}),e.jsx(l,{children:s.language==="en"?"English":s.language==="it"?"Italy":s.language==="es"?"Spanish":s.language}),e.jsx(l,{children:s.groups.map((r,x)=>e.jsx("div",{children:r.name},x))}),e.jsx(l,{children:s.id===Ke?e.jsx(p,{size:"sm",onClick:()=>ke(pe,s.id,F),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Assigned"}):e.jsx(p,{size:"sm",onClick:()=>ke(pe,s.id,F),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Add"})})]},t))})]})]}),e.jsx(T,{})]}),e.jsxs(w,{alignment:"center",visible:G,scrollable:!0,size:"lg",onClose:()=>U(!1),children:[e.jsx(B,{closeButton:!0,children:e.jsx(A,{children:"Rider Information"})}),e.jsx(D,{style:{overflowY:"auto",maxHeight:"70vh",display:"flex",justifyContent:"center"},children:se?e.jsx(E,{}):e.jsx("div",{children:e.jsxs(vs,{className:"mb-3",children:[e.jsx(K,{htmlFor:"staticEmail",className:"col-sm-2 col-form-label",children:"Name"}),e.jsx(Q,{sm:10,children:e.jsx(L,{type:"text",defaultValue:(we=b.accepted)==null?void 0:we.name,readOnly:!0,plainText:!0})}),e.jsx(K,{htmlFor:"staticEmail",className:"col-sm-2 col-form-label",children:"Email"}),e.jsx(Q,{sm:10,children:e.jsx(L,{type:"text",defaultValue:(Be=b.accepted)==null?void 0:Be.email,readOnly:!0,plainText:!0})}),e.jsx(K,{htmlFor:"staticEmail",className:"col-sm-2 col-form-label",children:"Contact"}),e.jsx(Q,{sm:10,children:e.jsx(L,{type:"text",defaultValue:(Ae=b.accepted)==null?void 0:Ae.contact,readOnly:!0,plainText:!0})})]})})}),e.jsx(T,{children:e.jsx(p,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>{var s;return ye((s=b.accepted)==null?void 0:s.id,F,b.id)},children:"Change"})})]}),e.jsxs(w,{alignment:"center",visible:Z,scrollable:!0,size:"sm",onClose:()=>v(!1),children:[e.jsx(B,{closeButton:!0,children:e.jsx(A,{children:"Confirmation"})}),e.jsxs(D,{children:[e.jsx("a",{children:"Are you sure you want to cancel this batch order?"}),e.jsx("br",{}),e.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[e.jsx(p,{onClick:()=>js(Ze),style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),e.jsx(p,{onClick:()=>v(!1),style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]})]})};export{Zs as default};
