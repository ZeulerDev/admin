import{y as ne,r as o,l as ce,A as l,j as a,L as de,h as ue,m as he}from"./index-CWrNKnUn.js";import{a as p}from"./axios-Cm0UX6qg.js";import{B as m}from"./config-HOLfLxHr.js";import{b as pe,a as k}from"./CContainer-rLvsNxDy.js";import{C as me,a as H,b as F,c as V,d as g}from"./DefaultLayout-Dl-jL1Ob.js";import{C as ge}from"./CNavbar-DgcRwyXb.js";import{C as Ce,a as fe,b as Y,c as n,d as xe,e as c}from"./CTable-BefVuclu.js";import{C as y}from"./CFormCheck-jHzGk6t2.js";import{c as ke}from"./cil-trash-CBbKHhHb.js";import{C as ye,a as D}from"./CPaginationItem-Cuw6EKc4.js";import{C as je,a as be,b as ve,c as Me}from"./CModalTitle-KQ4EoNH0.js";import"./CFormLabel-DxUs0q6J.js";const _e=()=>{const[{user:S,token:d},r]=ne(),[q,G]=o.useState([]),[P,J]=o.useState([]),[A,w]=o.useState(""),[T,L]=o.useState(""),[C,j]=o.useState(0),[K,N]=o.useState("All Cities"),[O,B]=o.useState("All Chains");o.useState();const[Q,b]=o.useState(!1),[W,E]=o.useState(!0);ce();const[R,f]=o.useState(!1),[X,Z]=o.useState(""),[ee,ae]=o.useState(0),[x,v]=o.useState(1);o.useEffect(()=>{d&&p.get(m+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${d}`}}).then(e=>{e.status===200?G(e.data):e.status===500&&r({type:l,payload:{status:!0,title:"Chain Loading error",message:e.data.message}})}).catch(e=>{console.error("Error: ",e)})},[]),o.useEffect(()=>{const e=setTimeout(()=>{r({type:l,payload:{status:!0,title:"Data Loading",message:"Data loading error: Timeout exceeded",color:"warning"}}),b(!1)},2e4);return S&&d&&u(0,e),()=>{clearTimeout(e)}},[A,T,S]);const u=(e,t)=>{b(!0),p.get(m+`assistant/market/locations/${e}?brand=${A}&city=${T}`,{headers:{Authorization:`Bearer ${d}`}}).then(s=>{s.status===200?(J(s.data.data),ae(s.data.count),b(!1),clearTimeout(t),s.data.data.length<20?(E(!0),console.log("ok")):s.data.data.length>19&&E(!1)):s.status===500&&r({type:l,payload:{status:!0,title:"Market Loading error",message:s.data.message}})}).catch(s=>{console.error("Error: ",s)})},te=()=>{v(x+1);const e=C+20;j(e),u(e,!0)},se=()=>{v(x-1);const e=C-20;console.log(e),j(e),u(e,!0)},z=(e,t)=>{e==="all"?(w(""),B("All Chains")):(w(e),B(t))},M=e=>{e==="all"?(L(""),N("All Cities")):(L(e),N(e))},$=(e,t,s)=>{console.log(e),console.log(P),s==="delivery"?(I({market:e,service:s}),console.log("add delivery")):s==="pickup"&&(I({market:e,service:s}),console.log("add pickup"))},_=(e,t,s)=>{s==="delivery"?(U({market:e,service:s}),console.log("remove delivery")):s==="pickup"&&(U({market:e,service:s}),console.log("remove pickup"))},I=e=>{p.post(m+"assistant/markets/add/services",e,{headers:{Authorization:`Bearer ${d}`}}).then(t=>{t.status===200?console.log("Updated add service"):t.status===203?r({type:l,payload:{status:!0,title:"Market Updated error",message:t.data.message}}):t.status===204?r({type:l,payload:{status:!0,title:"Market Updated error",message:t.data.message}}):t.status===500&&r({type:l,payload:{status:!0,title:"Market Updated error",message:t.data.message}})}).catch(t=>{console.error("Error:",t)})},U=e=>{p.post(m+"assistant/markets/remove/services",e,{headers:{Authorization:`Bearer ${d}`}}).then(t=>{t.status===200?console.log("Updated remove service"):t.status===203?r({type:l,payload:{status:!0,title:"Market remove error",message:t.data.message}}):t.status===204?r({type:l,payload:{status:!0,title:"Market remove error",message:t.data.message}}):t.status===500&&r({type:l,payload:{status:!0,title:"Market remove error",message:t.data.message}})}).catch(t=>{console.error("Error:",t)})},oe=e=>{f(!R),Z(e)},re=e=>{console.log(e),p.delete(m+"market/"+e,{headers:{Authorization:`Bearer ${d}`}}).then(t=>{t.status===200?(r({type:l,payload:{status:!0,title:"Market Delete",message:"Market Remove Success",color:"success"}}),f(!1),u(0,!0),console.log("Remove Market")):t.status===404?r({type:l,payload:{status:!0,title:"Market remove error",message:t.data.message}}):t.status===500&&r({type:l,payload:{status:!0,title:"Market remove error",message:t.data.message}})}).catch(t=>{console.error("Error:",t)})},le=e=>{v(e);const t=(e-1)*20;j(t),u(t,!0)},ie=()=>{const e=Math.ceil(ee/20),t=[];for(let i=1;i<=e;i++)t.push(i);console.log(t,e);const s=Math.max(x-2,1),h=Math.min(s+4,e);return t.slice(s-1,h).map(i=>a.jsx(D,{active:x===i,onClick:()=>le(i),children:i},i))};return a.jsxs(pe,{children:[a.jsx(de,{to:"/markets/addmarket",children:a.jsx(k,{style:{marginLeft:"0%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Add New Market"})}),a.jsx(me,{style:{marginLeft:"39.5%"},color:"secondary",children:"Filter by"}),a.jsxs(H,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[a.jsx(F,{style:{color:"white"},children:K}),a.jsxs(V,{children:[a.jsx(g,{onClick:()=>M("all"),children:"All"}),a.jsx(g,{onClick:()=>M("Milano"),children:"Milano"}),a.jsx(g,{onClick:()=>M("Napoli"),children:"Napoli"})]})]}),a.jsxs(H,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d"},children:[a.jsx(F,{style:{color:"white"},children:O}),a.jsxs(V,{children:[a.jsx(g,{onClick:()=>z("all"),children:"All"}),q.map((e,t)=>a.jsx(g,{onClick:()=>z(e.id,e.name),children:e.name},t))]})]}),a.jsx(ge,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),Q?a.jsx(ue,{}):a.jsxs(Ce,{children:[a.jsx(fe,{children:a.jsxs(Y,{children:[a.jsx(n,{scope:"col",children:"#"}),a.jsx(n,{scope:"col",children:"Name"}),a.jsx(n,{scope:"col",children:"Address"}),a.jsx(n,{scope:"col",children:"City"}),a.jsx(n,{scope:"col",children:"Delivery"}),a.jsx(n,{scope:"col",children:"Pickup"}),a.jsx(n,{scope:"col",children:"Scraped"}),a.jsx(n,{scope:"col",children:"Remove"})]})}),a.jsx(xe,{children:P.map((e,t)=>a.jsxs(Y,{children:[a.jsx(c,{children:C+t+1}),a.jsx(c,{children:e.chain.name}),a.jsx(c,{children:e.address}),a.jsx(c,{children:e.city}),a.jsx(c,{children:e.services.includes("delivery")?a.jsx(y,{id:"flexCheckChecked",label:"",defaultChecked:!0,onChange:()=>_(e._id,!0,"delivery")}):a.jsx(y,{id:"flexCheckChecked",label:"",onChange:()=>$(e._id,!0,"delivery")})}),a.jsx(c,{children:e.services.includes("pickup")?a.jsx(y,{id:"flexCheckChecked",label:"",defaultChecked:!0,onChange:()=>_(e._id,!0,"pickup")}):a.jsx(y,{id:"flexCheckChecked",label:"",onChange:()=>$(e._id,!0,"pickup")})}),a.jsx(c,{children:e.scraped}),a.jsx(c,{children:a.jsx(k,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>oe(e._id),children:a.jsx(he,{icon:ke,size:"lg",style:{color:"white"}})})})]},t))})]}),a.jsxs(ye,{"aria-label":"Page navigation example",children:[a.jsx(D,{disabled:C<=0,onClick:se,children:"Previous"}),ie(),a.jsx(D,{disabled:W===!0,onClick:te,children:"Next"})]}),a.jsxs(je,{alignment:"center",visible:R,scrollable:!0,size:"sm",onClose:()=>f(!1),children:[a.jsx(be,{closeButton:!1,children:a.jsx(ve,{children:"Confirmation"})}),a.jsxs(Me,{children:[a.jsx("a",{children:"Are you sure you want to delete this market?"}),a.jsx("br",{}),a.jsx("br",{}),a.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[a.jsx(k,{onClick:()=>re(X),style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),a.jsx(k,{onClick:()=>f(!1),style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]})]})};export{_e as default};
