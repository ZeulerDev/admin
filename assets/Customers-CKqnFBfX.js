import{r as a,y as ts,l as as,A as i,j as e,h as je,L as E,m as D}from"./index-BPO4cydh.js";import{a as b}from"./axios-Cm0UX6qg.js";import{B as j}from"./config-HOLfLxHr.js";import{b as rs,a as J}from"./CContainer-CzrymXOH.js";import{C as os}from"./CNavbar-BFoBctN0.js";import{C as m}from"./CFormInput-LNlkVcKE.js";import{C as fe,a as Ce,b as f,c as l,d as ye,e as n}from"./CTable-C0lRWiFj.js";import{C as be}from"./CCardImage-CHgbI3Qg.js";import{c as ls}from"./cil-pencil-m516yCOw.js";import{c as ns}from"./cil-info-CmGCY32x.js";import{c as cs}from"./DefaultLayout-BjLm7xgN.js";import{C as Pe,a as C}from"./CPaginationItem-68gnEGM1.js";import{C as M,a as U,b as B,c as L}from"./CModalTitle-D7OB1RAV.js";import{C as K}from"./CModalFooter-MHlU5bj7.js";import{C as p}from"./CCol-CjBfKh0q.js";import"./CFormLabel-CaOASrRa.js";var is=["512 512","<rect width='288' height='32' x='112' y='152' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='288' height='32' x='112' y='240' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='152' height='32' x='112' y='328' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M480,48H32V464H480ZM448,432H64V80H448Z' class='ci-primary'/>"];const vs=()=>{const[W,X]=a.useState(!1),[{user:y,token:u},c]=ts();as();const[z,O]=a.useState([]),[ee,we]=a.useState([]);a.useState(!1);const[Se,se]=a.useState(!1),[Ie,R]=a.useState(!1),[P,V]=a.useState(0),[te,w]=a.useState(!1),[g,ve]=a.useState([]),[ae,re]=a.useState(),[oe,le]=a.useState(),[ne,ce]=a.useState(),[ie,de]=a.useState(),[h,Ae]=a.useState(""),[Ne,ue]=a.useState(h),[ke,he]=a.useState(!0),[Te,Ee]=a.useState(0),[S,H]=a.useState(1),[I,v]=a.useState(0),[A,N]=a.useState(1),[De,Me]=a.useState(0),[Ue,_]=a.useState(!0),[$,F]=a.useState(""),[k,Be]=a.useState(""),[Q,Le]=a.useState(""),[ze,Z]=a.useState(!1),[pe,Y]=a.useState(!1),[Re,me]=a.useState("");a.useEffect(()=>{const s=setTimeout(()=>{c({type:i,payload:{status:!0,title:"Data Loading",message:"Data loading error: Timeout exceeded",color:"warning"}}),R(!1)},2e4);return y&&u&&x(0,s),()=>{clearTimeout(s)}},[y,u,Ne]),a.useEffect(()=>{const s=setTimeout(()=>{(h.length>=3||h.length===0)&&ue(h)},500);return()=>{clearTimeout(s)}},[h]);const x=(s,r)=>{R(!0),b.get(j+"assistant/customers/"+s+"?email="+h,{headers:{Authorization:`Bearer ${u}`}}).then(t=>{t.status===200?(O(t.data.list),Ee(t.data.count),R(!1),clearTimeout(r),console.log(j),t.data.list.length<50?(he(!0),console.log("ok")):t.data.list.length>49&&he(!1)):t.status===500&&c({type:i,payload:{status:!0,title:"Customers loading error",message:t.data.message}})}).catch(t=>{console.error("Error:",t)})},Ve=()=>{H(S+1);const s=P+50;V(s),x(s,!0)},He=()=>{H(S-1);const s=P-50;console.log(s),V(s),x(s,!1)},_e=()=>{N(A+1);const s=I+20;v(s),T($,s)},$e=()=>{N(A-1);const s=I-20;console.log(s),v(s),T($,s)},Fe=s=>{X(!W),F(s),T(s,0)},T=(s,r)=>{F(s),u&&(se(!0),b.get(j+`assistant/addresses/customer/${r}/`+s,{headers:{Authorization:`Bearer ${u}`}}).then(t=>{t.status===200?(console.log(t.data.count),we(t.data.list),Me(t.data.count),t.data.list.length<20?(_(!0),console.log("ok")):t.data.list.length>19&&_(!1),se(!1)):t.status===500&&c({type:i,payload:{status:!0,title:"Customers address error",message:t.data.message}})}).catch(t=>{console.error("Customers address:",t)}))},Qe=s=>{console.log(s),w(!te),ve(s),re(s.name),le(s.surname),ce(s.email),de(s.contact)},Ze=()=>{if(ae&&oe&&ne&&ie){const s={name:ae,surname:oe,email:ne,contact:ie},r=g._id;console.log("id",r),u&&y&&u&&b.patch(j+"assistant/customers/update/"+r,s,{headers:{Authorization:`Bearer ${u}`}}).then(t=>{if(t.status===200){w(!1),x(0,!0);const d=t.data,G=z.map(o=>o.id===d.id?d:o);O([...G]),c({type:i,payload:{status:!0,title:"Customer update",message:"Customer updated successfully",color:"success"}})}else t.status===203?c({type:i,payload:{status:!0,title:"Customer update error",message:"203",color:"warning"}}):t.status===204?c({type:i,payload:{status:!0,title:"Customer update error",message:"204",color:"warning"}}):t.status===500&&c({type:i,payload:{status:!0,title:"Customer update error",message:"500",color:"warning"}})}).catch(t=>{console.error("Error:",t)})}else c({type:i,payload:{status:!0,title:"Error!",message:"Customer update error, Please Check the input fields",color:"warning"}})},Ye=s=>{H(s);const r=(s-1)*50;V(r),x(r,!0)},qe=()=>{const s=Math.ceil(Te/50),r=[];for(let o=1;o<=s;o++)r.push(o);const t=Math.max(S-2,1),d=Math.min(t+4,s);return r.slice(t-1,d).map(o=>e.jsx(C,{active:S===o,onClick:()=>Ye(o),children:o},o))},Ge=s=>{N(s);const r=(s-1)*20;v(r),T($,r)},Je=()=>{const s=Math.ceil(De/20),r=[];for(let o=1;o<=s;o++)r.push(o);const t=Math.max(A-2,1),d=Math.min(t+4,s);return r.slice(t-1,d).map(o=>e.jsx(C,{active:A===o,onClick:()=>Ge(o),children:o},o))},Ke=()=>{w(!1),Z(!0)},We=s=>{if(k===""||Q==="")c({type:i,payload:{status:!0,title:"Password update error",message:"Check the input fields",color:"warning"}});else if(k===Q){const r={password:k};console.log(r,s),y&&u&&b.patch(j+"assistant/customers/update/"+s,r,{headers:{Authorization:`Bearer ${u}`}}).then(t=>{t.status===200?(Z(!1),c({type:i,payload:{status:!0,title:"Password update",message:"Password updated successfully",color:"success"}}),setVisiblePicker(!0)):t.status===203?c({type:i,payload:{status:!0,title:"Password update error",message:t.data.message}}):t.status===204?c({type:i,payload:{status:!0,title:"Password update error",message:t.data.message}}):t.status===500&&c({type:i,payload:{status:!0,title:"Password update error",message:t.data.message}})}).catch(t=>{console.error(t)})}else c(k!==Q?{type:i,payload:{status:!0,title:"Password update error",message:"Password does not match",color:"warning"}}:{type:i,payload:{status:!0,title:"Password update error",message:"Password update error or check the input fields",color:"warning"}})},Xe=s=>{Y(!pe),me(s)},[Oe,q]=a.useState(null),[ge,xe]=a.useState(null),es=s=>{console.log(s),xe(URL.createObjectURL(s)),q(s)},ss=async(s,r)=>{if(console.log(s,r),y&&u){const t=new FormData;t.append("image",r),t.append("id",s),b.post(j+"test/customer/image/update",t,{headers:{Authorization:`Bearer ${u}`}}).then(d=>{d.status===200?(Y(!1),me(""),q(null),console.log("response",d.data),c({type:i,payload:{status:!0,title:"Image upload ",message:"Image upload success",color:"success"}}),x(0,!0)):d.status===500&&c({type:i,payload:{status:!0,title:"Image upload error",message:d.data.message,color:"danger"}})}).catch(d=>{console.error("Error:",d)})}};return e.jsxs(rs,{children:[e.jsx(os,{className:"bg-body-tertiary",children:e.jsx(m,{type:"text",placeholder:"Search by customer name, surname, email and contact",style:{width:450,marginLeft:"0%"},value:h,onChange:s=>Ae(s.target.value)})}),Ie?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(je,{style:{marginTop:"15%"}})}):e.jsxs(fe,{children:[e.jsx(Ce,{children:e.jsxs(f,{children:[e.jsx(l,{scope:"col",children:"#"}),e.jsx(l,{scope:"col",children:"Photo"}),e.jsx(l,{scope:"col",children:"Name"}),e.jsx(l,{scope:"col",children:"Surname"}),e.jsx(l,{scope:"col",children:"email"}),e.jsx(l,{scope:"col",children:"Contact"}),e.jsx(l,{scope:"col",children:"Country"}),e.jsx(l,{scope:"col",children:"Language"}),e.jsx(l,{scope:"col",children:"Edit"}),e.jsx(l,{scope:"col",children:"Address"}),e.jsx(l,{scope:"col",children:"List"}),e.jsx(l,{scope:"col",children:"Order"})]})}),e.jsx(ye,{children:z.length===0?e.jsx(f,{children:e.jsx(n,{colSpan:"12",style:{textAlign:"center",backgroundColor:"white"},children:e.jsx("h6",{style:{marginTop:"1%"},children:"No Data"})})}):z.map((s,r)=>e.jsxs(f,{children:[e.jsx(n,{children:P+r+1}),e.jsx(l,{onClick:()=>{Xe(s._id)},children:e.jsx(be,{style:{width:50,height:50,borderRadius:10},src:"https://api.zeuler.com/image/"+s.photo})}),e.jsx(n,{children:s.name}),e.jsx(n,{children:s.surname}),e.jsx(n,{children:s.email}),e.jsx(n,{children:s.contact}),e.jsx(n,{children:s.country==="it"||s.country==="Italy"?"Italy":s.country}),e.jsx(n,{children:s.language==="en"?"English":s.language==="it"?"Italy":s.language}),e.jsx(n,{children:e.jsx(E,{children:e.jsx(D,{icon:ls,size:"xl",onClick:()=>Qe(s)})})}),e.jsx(n,{children:e.jsx(E,{children:e.jsx(D,{icon:ns,size:"xl",onClick:()=>Fe(s._id)})})}),e.jsx(n,{children:e.jsx(E,{to:`/customers/list/${s._id}`,children:e.jsx(D,{icon:is,size:"xl"})})}),e.jsx(n,{children:e.jsx(E,{to:`/customers/items/${s._id}`,children:e.jsx(D,{icon:cs,size:"xl"})})})]},r))})]}),e.jsxs(Pe,{"aria-label":"Page navigation example",children:[e.jsx(C,{disabled:P<=0,onClick:He,children:"Previous"}),qe(),e.jsx(C,{disabled:ke===!0,onClick:Ve,children:"Next"})]}),e.jsxs(M,{alignment:"center",visible:pe,scrollable:!0,size:"lg",onClose:()=>{Y(!1),q(null),xe(null)},children:[e.jsx(U,{closeButton:!0,children:e.jsx(B,{children:"Image Uploader"})}),e.jsxs(L,{children:[ge&&e.jsx(be,{style:{width:"100px",height:"100px"},src:ge,alt:"Uploaded Image"}),e.jsx("input",{style:{marginLeft:"5%"},type:"file",accept:".jpg, .jpeg, .png",onChange:s=>es(s.target.files[0])})]}),e.jsx(K,{children:e.jsx(J,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>{ss(Re,Oe)},children:"Upload Image"})})]}),e.jsxs(M,{alignment:"center",visible:ze,scrollable:!0,size:"sm",onClose:()=>Z(!1),children:[e.jsx(U,{closeButton:!0,children:e.jsx(B,{children:"Update Password"})}),e.jsxs(L,{children:[e.jsx(p,{md:12,children:e.jsx(m,{id:"password",label:"Enter New Password",type:"password",onChange:s=>Be(s.target.value)})}),e.jsx("br",{}),e.jsx(p,{md:12,children:e.jsx(m,{id:"repassword",label:"Re Enter Password",type:"password",onChange:s=>Le(s.target.value)})})]}),e.jsx(K,{children:e.jsx(J,{type:"submit",style:{marginBottom:"3%",backgroundColor:"#ff4d4d",color:"white"},onClick:()=>{We(g._id)},children:"Update"})})]}),e.jsxs(M,{visible:W,scrollable:!0,size:"xl",onClose:()=>{X(!1),v(0),N(1),_(!0),F("")},children:[e.jsx(U,{closeButton:!0,children:e.jsx(B,{children:"Used Addresses"})}),e.jsx(L,{style:{overflowY:"auto",maxHeight:"70vh",display:"flex",justifyContent:"center"},children:Se?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(je,{style:{marginTop:"15%"}})}):e.jsxs(fe,{children:[e.jsx(Ce,{children:e.jsxs(f,{children:[e.jsx(l,{scope:"col",children:"#"}),e.jsx(l,{scope:"col",children:"Name"}),e.jsx(l,{scope:"col",children:"Intercom"}),e.jsx(l,{scope:"col",children:"Flat"}),e.jsx(l,{scope:"col",children:"Street"}),e.jsx(l,{scope:"col",children:"House Number"})]})}),e.jsx(ye,{children:ee.length===0?e.jsx(f,{children:e.jsx(n,{colSpan:"6",style:{textAlign:"center",backgroundColor:"white"},children:e.jsx("h6",{style:{marginTop:"1%"},children:"No Data"})})}):ee.map((s,r)=>e.jsxs(f,{children:[e.jsx(n,{children:I+r+1}),e.jsx(n,{children:s.name}),e.jsx(n,{children:s.intercom}),e.jsx(n,{children:s.flat}),e.jsx(n,{children:s.street}),e.jsx(n,{children:s.houseNumber})]},r))})]})}),e.jsx(K,{children:e.jsxs(Pe,{"aria-label":"Page navigation example",children:[e.jsx(C,{disabled:I<=0,onClick:$e,children:"Previous"}),Je(),e.jsx(C,{disabled:Ue===!0,onClick:_e,children:"Next"})]})})]}),e.jsxs(M,{visible:te,scrollable:!0,size:"lg",onClose:()=>w(!1),children:[e.jsx(U,{closeButton:!0,children:e.jsx(B,{children:"Edit Customer Information"})}),e.jsx(L,{children:e.jsxs("div",{className:"row g-3",children:[e.jsx(p,{md:6,children:e.jsx(m,{id:"name",label:"Firt Name",defaultValue:g.name,onChange:s=>re(s.target.value)})}),e.jsx(p,{md:6,children:e.jsx(m,{id:"surname",label:"LastName",defaultValue:g.surname,onChange:s=>le(s.target.value)})}),e.jsx(p,{md:6,children:e.jsx(m,{id:"email",label:"Email",defaultValue:g.email,onChange:s=>ce(s.target.value)})}),e.jsx(p,{md:6,children:e.jsx(m,{id:"phone",label:"Contact Number",defaultValue:g.contact,onChange:s=>de(s.target.value)})}),e.jsx(p,{xs:6,children:e.jsx(J,{type:"submit",style:{marginBottom:"3%",width:"200px",backgroundColor:"#ff4d4d",color:"white"},onClick:()=>Ze(),children:"Update Customer"})}),e.jsx(p,{xs:6,children:e.jsx("span",{style:{fontSize:15,color:"red",cursor:"pointer",marginLeft:"64%",marginTop:"10%"},onClick:()=>Ke(),children:"Change Password"})})]})})]})]})};export{vs as default};
