import{y as hs,r as a,A as n,j as e,h as z,m as L}from"./index-BbIMGn6I.js";import{a as x}from"./axios-Cm0UX6qg.js";import{B as f}from"./config-HOLfLxHr.js";import{b as gs,a as d}from"./CContainer-DW1l_mtt.js";import{C as ge}from"./CNavbar-CaFAFoGR.js";import{C as xs}from"./CFormInput-CYaLtnDR.js";import{C,a as k,b as u,c as r,d as M,e as o}from"./CTable-Bo3KO6JA.js";import{e as Q,d as fs,C as xe,a as fe,b as je,c as b}from"./DefaultLayout-DAj23qfB.js";import{c as js}from"./cil-view-module-CSS15w8m.js";import{C as ys,a as O}from"./CPaginationItem-Cm1VX4Uo.js";import{C as S,a as w,b as P,c as A}from"./CModalTitle-BlxPdlJz.js";import{C as I}from"./CModalFooter-Bw9Pc4Sk.js";import{C as ps}from"./CCardImage-D6kN_Ugx.js";import"./CFormLabel-0HkVgzW6.js";const Os=()=>{const[{user:j,token:c},i]=hs(),[ye,y]=a.useState(!1),[Y,T]=a.useState(0),[N,ms]=a.useState(0),[pe,v]=a.useState(!0),[h,me]=a.useState(""),[Ce,U]=a.useState(h),[ke,Me]=a.useState(0),[D,B]=a.useState(1),[E,Cs]=a.useState(),[be,Se]=a.useState([]),[we,$]=a.useState(!1);a.useState(!1);const[Pe,p]=a.useState(!1);a.useState("");const[ks,Ae]=a.useState("");a.useState("");const[ve,De]=a.useState([]),[_,Fe]=a.useState([]),[ze,q]=a.useState(!1),[Le,R]=a.useState(!1),[Ie,F]=a.useState(!1),[G,J]=a.useState(!1),[K,W]=a.useState(""),[Te,X]=a.useState("All Cities"),[Ne,Z]=a.useState("All Chains"),[Ms,ee]=a.useState(""),[bs,se]=a.useState("All Cities"),[te,ae]=a.useState(""),[le,re]=a.useState(""),[Ss,oe]=a.useState("All Chains"),[ws,ie]=a.useState("");a.useState([]);const[Ps,Be]=a.useState([]),[Ee,$e]=a.useState([]),[_e,ne]=a.useState(!1),[Re,Ve]=a.useState([]),[He,Qe]=a.useState(""),[As,Oe]=a.useState(""),[ce,Ye]=a.useState({flayerId:""}),[Ue,de]=a.useState(!1),[vs,qe]=a.useState(""),[Ge,Je]=a.useState([]),[Ke,V]=a.useState(!1);a.useEffect(()=>{const s=setTimeout(()=>{i({type:n,payload:{status:!0,title:"Data Loading",message:"Data loading error: Timeout exceeded",color:"warning"}}),$(!1)},2e4);return j&&c&&m(0,s),()=>{clearTimeout(s)}},[j,c,Ce]),a.useEffect(()=>{const s=setTimeout(()=>{(h.length>=3||h.length===0)&&U(h)},500);return()=>{clearTimeout(s)}},[h]);const m=(s,t)=>{$(!0),x.get(f+`flayers/all/${s}?search=${h}`,{headers:{Authorization:`Bearer ${c}`}}).then(l=>{l.status===200?(Se(l.data.list),Me(l.data.count),console.log(l.data.list.length),$(!1),clearTimeout(t),l.data.list.length<20?(v(!0),console.log("ok")):l.data.list.length>19&&v(!1),console.log(l.data.list.length)):l.status===500&&i({type:n,payload:{status:!0,title:"Category loading error",message:l.data.message}})}).catch(l=>{console.error("Error:",l)})},We=()=>{B(D+1);const s=N+20;T(s),m(s,E)},Xe=()=>{B(D-1);const s=N-20;console.log(s),T(s),m(s,E)},Ze=s=>{B(s);const t=(s-1)*20;T(t),m(t,E)},es=()=>{const s=Math.ceil(ke/20),t=[];for(let g=1;g<=s;g++)t.push(g);const l=Math.max(D-2,1),us=Math.min(l+4,s);return t.slice(l-1,us).map(g=>e.jsx(O,{active:D===g,onClick:()=>Ze(g),children:g},g))},ss=(s,t)=>{p(!0),De(s),Oe(t)},ts=s=>{s?(q(!0),as(s)):i({type:n,payload:{status:!0,title:"Error!",message:"Flayers Product Loading error, Please Check the input fields",color:"warning"}})},as=s=>{s?(console.log("id",s),c&&(y(!0),x.get(f+"flayer/products/"+s,{headers:{Authorization:`Bearer ${c}`}}).then(t=>{t.status===200?(Fe(t.data),y(!1)):t.status===204?(i({type:n,payload:{status:!0,title:"Flayers Product Loading error",message:"Flayers Product Loading error",color:"warning"}}),y(!1)):t.status===404?(i({type:n,payload:{status:!0,title:"Flayers Product Loading error",message:"Flayers Product Loading error",color:"warning"}}),y(!1)):t.status===500&&(i({type:n,payload:{status:!0,title:"Flayers Product Loading error",message:"Flayers Product Loading error",color:"warning"}}),y(!1))}).catch(t=>{console.error("Error:",t),y(!1)}))):i({type:n,payload:{status:!0,title:"Missing!",message:"Flayers Product Loading error",color:"warning"}})},ue=(s,t)=>{F(!0),J(t),W(s)},ls=()=>{const s={status:G};console.log(K,s),j&&c&&x.patch(f+"assistant/flayer/status/"+K,s,{headers:{Authorization:`Bearer ${c}`}}).then(t=>{t.status===200?(console.log("updated"),F(!1),J(""),W(""),m(0,null),i({type:n,payload:{status:!0,title:"Flayer status update",message:"Flayer status updated successfully",color:"success"}})):t.status===203?i({type:n,payload:{status:!0,title:"Flayer status update error",message:t.data.message}}):t.status===204?i({type:n,payload:{status:!0,title:"Flayer status update error",message:t.data.message}}):t.status===500&&i({type:n,payload:{status:!0,title:"Flayer status update error",message:t.data.message}})}).catch(t=>{console.error(t)})},he=(s,t,l)=>{l==="view"?s==="all"?(ie(""),oe("All Chains")):(ie(s),oe(t)):l==="modal"&&(s==="all"?(re(""),Z("All Chains")):(re(s),Z(t)))},H=(s,t)=>{t==="view"?s==="all"?(ee(""),se("All Cities")):(ee(s),se(s)):t==="modal"&&(s==="all"?(ae(""),X("All Cities")):(ae(s),X(s)))},rs=()=>{c&&x.get(f+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${c}`}}).then(s=>{s.status===200?(Be(s.data),$e(s.data)):s.status===500&&i({type:n,payload:{status:!0,title:"Chain Loading error",message:s.data.message}})}).catch(s=>{console.error("Error: ",s)})};a.useEffect(()=>{j&&c&&os(0)},[le,te,j]);const os=(s,t)=>{ne(!0),x.get(f+`assistant/market/locations/${s}?brand=${le}&city=${te}`,{headers:{Authorization:`Bearer ${c}`}}).then(l=>{l.status===200?(Ve(l.data.data),console.log("data market"),ne(!1),l.data.data.length<20?(v(!0),console.log("ok")):l.data.data.length>19&&v(!1)):l.status===500&&i({type:n,payload:{status:!0,title:"Market Loading error",message:l.data.message}})}).catch(l=>{console.error("Error: ",l)})},is=(s,t)=>{p(!1),R(!0),Qe(t),rs(),console.log(s),Ye({flayerId:s})},ns=s=>{const t=ce;s&&ce!==null?j&&c&&(console.log("data",t),x.patch(f+"flayer/market/update/"+s,t,{headers:{Authorization:`Bearer ${c}`}}).then(l=>{l.status===200?(console.log("updated"),i({type:n,payload:{status:!0,title:"Flayer market update",message:"Flayer market updated successfully",color:"success"}}),R(!1),p(!0)):l.status===203?i({type:n,payload:{status:!0,title:"Flayer market update error",message:l.data.message}}):l.status===204?i({type:n,payload:{status:!0,title:"Flayer market update error",message:l.data.message}}):l.status===500&&i({type:n,payload:{status:!0,title:"Flayer market update error",message:l.data.message}})}).catch(l=>{console.error(l)})):i({type:n,payload:{status:!0,title:"Missing!",message:"Flayers Loading error",color:"warning"}})},cs=s=>{console.log("id",s),de(!0),qe(s),ds(s)},ds=s=>{V(!0),x.get(f+`flayer/market/assign/${s}`,{headers:{Authorization:`Bearer ${c}`}}).then(t=>{t.status===200?t.data.length!==0?(Je(t.data),console.log("data market"),V(!1)):(V(!1),i({type:n,payload:{status:!0,title:"Market Loading",message:"No market assigned to this flayer",color:"info"}})):t.status===500&&i({type:n,payload:{status:!0,title:"Market Loading error",message:t.data.message}})}).catch(t=>{console.error("Error: ",t)})};return e.jsxs(gs,{children:[e.jsx(ge,{style:{marginTop:"1%"},className:"bg-body-tertiary",children:e.jsx(xs,{type:"text",placeholder:"Search by Id, end date and retailer ",style:{width:450,marginRight:"30%"},value:h,onChange:s=>me(s.target.value)})}),we?e.jsx(z,{}):e.jsxs(C,{children:[e.jsx(k,{children:e.jsxs(u,{children:[e.jsx(r,{scope:"col",children:"#"}),e.jsx(r,{scope:"col",children:"Id"}),e.jsx(r,{scope:"col",children:"End Date"}),e.jsx(r,{scope:"col",children:"Retailer"}),e.jsx(r,{scope:"col",children:"Status"}),e.jsx(r,{scope:"col",children:"Markets"}),e.jsx(r,{scope:"col",children:"Products"}),e.jsx(r,{scope:"col",children:"Assigned Market"})]})}),e.jsx(M,{children:be.map((s,t)=>e.jsxs(u,{children:[e.jsx(o,{children:Y+t+1}),e.jsx(o,{children:s.flayer_id}),e.jsx(o,{children:s.endDate}),e.jsx(o,{children:s.retailer}),e.jsx(o,{children:s.status===!0?e.jsx(d,{size:"sm",onClick:()=>{ue(s._id,!1)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Deactivate"}):e.jsx(d,{size:"sm",onClick:()=>{ue(s._id,!0)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Activate"})}),e.jsx(o,{children:e.jsx(d,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>{ss(s.stores,s._id)},children:e.jsx(L,{icon:Q,size:"lg",style:{color:"white"}})})}),e.jsx(o,{children:e.jsx(d,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>{ts(s._id)},children:e.jsx(L,{icon:js,size:"lg",style:{color:"white"}})})}),e.jsx(o,{children:e.jsx(d,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>{cs(s._id)},children:e.jsx(L,{icon:Q,size:"lg",style:{color:"white"}})})})]},t))})]}),e.jsxs(ys,{"aria-label":"Page navigation example",children:[e.jsx(O,{disabled:Y<=0,onClick:Xe,children:"Previous"}),es(),e.jsx(O,{disabled:pe===!0,onClick:We,children:"Next"})]}),e.jsxs(S,{alignment:"center",visible:Ue,scrollable:!0,size:"lg",onClose:()=>de(!1),children:[e.jsx(w,{closeButton:!0,children:e.jsx(P,{children:"All Assign Markets details"})}),e.jsx(A,{children:Ke?e.jsx(z,{}):e.jsxs(C,{children:[e.jsx(k,{children:e.jsxs(u,{children:[e.jsx(r,{scope:"col",children:"#"}),e.jsx(r,{scope:"col",children:"Chain Name"}),e.jsx(r,{scope:"col",children:"Address"}),e.jsx(r,{scope:"col",children:"City"})]})}),e.jsx(M,{children:Ge.map((s,t)=>e.jsxs(u,{children:[e.jsx(o,{children:t+1}),e.jsx(o,{children:s.chain.name}),e.jsx(o,{children:s.address}),e.jsx(o,{children:s.city})]},t))})]})}),e.jsx(I,{})]}),e.jsxs(S,{alignment:"center",visible:Pe,scrollable:!0,size:"lg",onClose:()=>{p(!1),Ae("")},children:[e.jsx(w,{closeButton:!0,children:e.jsx(P,{children:"Markets"})}),e.jsx(A,{children:e.jsxs(C,{children:[e.jsx(k,{children:e.jsxs(u,{children:[e.jsx(r,{scope:"col",children:"#"}),e.jsx(r,{scope:"col",children:"Name"}),e.jsx(r,{scope:"col",children:"Market"})]})}),e.jsx(M,{children:ve.map((s,t)=>e.jsxs(u,{children:[e.jsx(o,{children:t+1}),e.jsx(o,{children:s.address}),e.jsx(o,{children:e.jsx(d,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>{is(s._id,s.market)},children:e.jsx(L,{icon:Q,size:"lg",style:{color:"white"}})})})]},t))})]})}),e.jsx(I,{})]}),e.jsxs(S,{visible:ze,scrollable:!0,size:"xl",onClose:()=>q(!1),children:[e.jsx(w,{closeButton:!0,children:e.jsx(P,{children:"Flayers Products Information"})}),e.jsx(A,{style:{overflowY:"auto",maxHeight:"70vh",display:"flex",justifyContent:"center"},children:ye?e.jsx(z,{}):e.jsxs(C,{children:[e.jsx(k,{children:e.jsxs(u,{children:[e.jsx(r,{scope:"col",children:"#"}),e.jsx(r,{scope:"col",children:"Photo"}),e.jsx(r,{scope:"col",children:"Name"}),e.jsx(r,{scope:"col",children:"Price"}),e.jsx(r,{scope:"col",children:"Description"})]})}),e.jsx(M,{children:_==null?void 0:_.map((s,t)=>e.jsxs(u,{children:[e.jsx(o,{children:t+1}),e.jsx(o,{children:e.jsx(ps,{style:{width:50,height:50,borderRadius:10},src:"https://api.zeuler.com/image/"+s.image})}),e.jsx(o,{children:s.name}),e.jsx(o,{children:s.price}),e.jsx(o,{children:s.description})]},t))})]})}),e.jsx(I,{})]}),e.jsxs(S,{alignment:"center",visible:Ie,scrollable:!0,size:"sm",onClose:()=>F(!1),children:[e.jsx(w,{closeButton:!1,children:e.jsx(P,{children:"Confirmation"})}),e.jsxs(A,{children:[e.jsxs("a",{children:["Are you sure you want to ",G?"activate":"deactivate"," this flayer?"]}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[e.jsx(d,{onClick:()=>{ls()},style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),e.jsx(d,{onClick:()=>{F(!1)},style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]}),e.jsxs(S,{visible:Le,scrollable:!0,size:"xl",onClose:()=>{R(!1),p(!0)},children:[e.jsx(w,{closeButton:!0,children:e.jsx(P,{children:"Market assign view"})}),e.jsxs(A,{children:[e.jsx(fs,{style:{marginLeft:"54%"},color:"secondary",children:"Filter by"}),e.jsxs(xe,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(fe,{style:{color:"white"},children:Te}),e.jsxs(je,{children:[e.jsx(b,{onClick:()=>H("all","modal"),children:"All"}),e.jsx(b,{onClick:()=>H("Milano","modal"),children:"Milano"}),e.jsx(b,{onClick:()=>H("Napoli","modal"),children:"Napoli"})]})]}),e.jsxs(xe,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(fe,{style:{color:"white"},children:Ne}),e.jsxs(je,{children:[e.jsx(b,{onClick:()=>he("all",null,"modal"),children:"All"}),Ee.map((s,t)=>e.jsx(b,{onClick:()=>he(s.id,s.name,"modal"),children:s.name},t))]})]}),e.jsx(ge,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),_e?e.jsx(z,{}):e.jsxs(C,{children:[e.jsx(k,{children:e.jsxs(u,{children:[e.jsx(r,{scope:"col",children:"#"}),e.jsx(r,{scope:"col",children:"Name"}),e.jsx(r,{scope:"col",children:"Address"}),e.jsx(r,{scope:"col",children:"City"}),e.jsx(r,{scope:"col",children:"Assign Market"})]})}),e.jsx(M,{children:Re.map((s,t)=>e.jsxs(u,{children:[e.jsx(o,{children:N+t+1}),e.jsx(o,{children:s.chain.name}),e.jsx(o,{children:s.address}),e.jsx(o,{children:s.city}),e.jsx(o,{children:He===s._id?e.jsx(d,{size:"sm",onClick:()=>{},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Assigned"}):e.jsx(d,{size:"sm",onClick:()=>{ns(s._id)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Add"})})]},t))})]}),e.jsx(I,{})]})]})]})};export{Os as default};
