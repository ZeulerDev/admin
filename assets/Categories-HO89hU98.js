import{y as Ke,r as s,A as n,j as a,h as We,L as Xe,m as Ye}from"./index-HuPlWL3O.js";import{a as m}from"./axios-Cm0UX6qg.js";import{B as C}from"./config-HOLfLxHr.js";import{b as Ze,a as ce}from"./CContainer-CEyMh38M.js";import{C as ea,a as P,b as D,d as I,e as g}from"./DefaultLayout-DaRxHJhP.js";import{C as aa}from"./CNavbar-CEL_iAib.js";import{C as ie}from"./CFormInput-CS7nD6N-.js";import{C as ta,a as sa,b as V,c as i,d as ra,e as p}from"./CTable-Bbt1Gt8e.js";import{C as de}from"./CCardImage-DvBW877X.js";import{c as oa}from"./cil-pencil-m516yCOw.js";import{C as la,a as _}from"./CPaginationItem-DbvxjRQn.js";import{C as ue,a as he,b as ge,c as pe}from"./CModalTitle-uHuXCtFq.js";import{C as me}from"./CModalFooter--x-yC4vX.js";import"./CFormLabel-BBga1K7Q.js";const ka=()=>{const[{user:y,token:o},l]=Ke(),[Ce,f]=s.useState(!1),[O,fe]=s.useState([]),[j,A]=s.useState(0),[xe,S]=s.useState(!0),[ye,je]=s.useState([]),[Se,w]=s.useState("All Chains"),[E,b]=s.useState("All market"),[q,L]=s.useState(""),[G,k]=s.useState(""),[be,J]=s.useState([]),[d,c]=s.useState(""),[ke,K]=s.useState(d),[Me,N]=s.useState(!1),[Pe,W]=s.useState(""),[T,X]=s.useState(""),[De,Y]=s.useState(""),[Ie,Ae]=s.useState(0),[M,U]=s.useState(1);s.useState("NAME");const[Z,v]=s.useState(!1),[we,ee]=s.useState(""),[Ee,B]=s.useState("All Main Categories"),[na,$]=s.useState(""),[Le,Ne]=s.useState([]),[Te,z]=s.useState(""),[Ue,R]=s.useState("Select Main Categories"),[ae,F]=s.useState(""),[ve,Q]=s.useState([]);s.useEffect(()=>{y&&o&&x(0)},[y,o,G,ke,ae,q]),s.useEffect(()=>{const e=setTimeout(()=>{(d.length>=3||d.length===0)&&K(d)},500);return()=>{clearTimeout(e)}},[d]),s.useEffect(()=>{o&&m.get(C+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${o}`}}).then(e=>{e.status===200?je(e.data):e.status===500&&l({type:n,payload:{status:!0,title:"Chain Loading error",message:e.data.message}})}).catch(e=>{console.error("Error: ",e)})},[]),s.useEffect(()=>{o&&m.get(C+"product/categories",{headers:{Authorization:`Bearer ${o}`}}).then(e=>{e.status===200?(console.log(e.data[1]),Ne(e.data)):e.status===500&&l({type:n,payload:{status:!0,title:"Main Category Loading error",message:"Main Category loading error"}})}).catch(e=>{console.error("Error: ",e)})},[]);const Be=e=>{m.get(C+`assistant/market/locations?brand=${e}`,{headers:{Authorization:`Bearer ${o}`}}).then(t=>{t.status===200?(J(t.data.data),t.data.data.length<20?(S(!0),console.log("ok")):t.data.data.length>19&&S(!1)):t.status===500&&l({type:n,payload:{status:!0,title:"Market Loading error",message:t.data.message}})}).catch(t=>{console.error("Error: ",t)})},x=(e,t)=>{f(!0),m.get(C+`product/category/all/${e}?marketId=${G}&name=${d}&category=${ae}&mainCategory=${Te}&chainId=${q}`,{headers:{Authorization:`Bearer ${o}`}}).then(r=>{r.status===200?(fe(r.data.list),Ae(r.data.count),f(!1),r.data.list.length<20?(S(!0),console.log("ok")):r.data.list.length>19&&S(!1)):r.status===203?(f(!1),l({type:n,payload:{status:!0,title:"product loading error error",message:r.data.message}})):r.status===204?f(!1):r.status===500&&(f(!1),l({type:n,payload:{status:!0,title:"product loading error error",message:r.data.message}}))}).catch(r=>{f(!1),console.error("Error:",r)})},te=(e,t)=>{e==="all"?($(""),B("All Main Categories"),F(""),R("Select Main Categories"),z(""),c(""),Q([])):($(e),$e(e),B(t),z(e),c(""))},$e=e=>{o&&m.get(C+"product/categories/sub/"+e,{headers:{Authorization:`Bearer ${o}`}}).then(t=>{t.status===200?Q(t.data):t.status===500&&l({type:n,payload:{status:!0,title:"Sub Category Loading",message:"Sub Category loading error"}})}).catch(t=>{console.error("Error: ",t)})},se=(e,t)=>{e==="all"?(F(""),R("Select Main Categories"),$(""),B("All Main Categories"),Q([]),z(""),c("")):(console.log("index",e),F(e),R(t),c(""))},re=(e,t)=>{e==="all"?(L(""),w("All Chains"),k(""),b("All Markets"),c("")):(L(e),Be(e),w(t),k(""),b("All Markets"),c(""))},oe=(e,t)=>{e==="all"?(k(""),b("All Markets"),L(""),w("All Chains"),J([]),c("")):(k(e),b(t),c(""))},ze=()=>{U(M+1);const e=j+50;A(e),x(e)},Re=()=>{U(M-1);const e=j-50;console.log(e),A(e),x(e)},Fe=(e,t)=>{N(!0),W(e),Y(t)},Qe=()=>{console.log("called"),T==""?l({type:n,payload:{status:!0,title:"Alert",message:"Please enter the price",color:"warning"}}):_e(Pe)},He=e=>{U(e);const t=(e-1)*50;A(t),x(t)},Ve=()=>{const e=Math.ceil(Ie/50),t=[];for(let h=1;h<=e;h++)t.push(h);const r=Math.max(M-2,1),u=Math.min(r+4,e);return t.slice(r-1,u).map(h=>a.jsx(_,{active:M===h,onClick:()=>He(h),children:h},h))},_e=e=>{if(e){let t={price:T+" â‚¬"};y&&o&&m.put(C+"product/update/price/"+e,t,{headers:{Authorization:`Bearer ${o}`}}).then(r=>{r.status===200?(l({type:n,payload:{status:!0,title:"Product Details Update",message:"Product price update Success",color:"success"}}),W(""),X(""),x(0),N(!1),Y("")):r.status===204?l({type:n,payload:{status:!0,title:"Product Details Update error",message:r.data.message,color:"danger"}}):r.status===500&&l({type:n,payload:{status:!0,title:"Product Details Update error",message:r.data.message,color:"danger"}})}).catch(r=>{console.error("Error:",r)})}else alert("Please Check the Fields!")},Oe=e=>{v(!Z),ee(e)},[qe,H]=s.useState(null),[le,ne]=s.useState(null),Ge=e=>{console.log(e),ne(URL.createObjectURL(e)),H(e)},Je=async(e,t)=>{if(console.log(e,t),y&&o){const r=new FormData;r.append("image",t),r.append("id",e),m.post(C+"test/product/image/update",r,{headers:{Authorization:`Bearer ${o}`}}).then(u=>{u.status===200?(v(!1),ee(""),H(null),console.log("response",u.data),l({type:n,payload:{status:!0,title:"Image upload ",message:"Image upload success",color:"success"}}),x(0)):u.status===500&&l({type:n,payload:{status:!0,title:"Image upload error",message:u.data.message,color:"danger"}})}).catch(u=>{console.error("Error:",u)})}};return a.jsxs(Ze,{children:[a.jsx(ea,{style:{marginLeft:"14%"},color:"secondary",children:"Filter by"}),a.jsxs(P,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d"},children:[a.jsx(D,{style:{color:"white"},children:Se}),a.jsxs(I,{children:[a.jsx(g,{onClick:()=>re("all"),children:"All"}),ye.map((e,t)=>a.jsx(g,{onClick:()=>re(e.id,e.name),children:e.name},t))]})]}),a.jsxs(P,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d"},children:[a.jsx(D,{style:{color:"white"},children:E.length>15?`${E.substring(0,15)}...`:E}),a.jsxs(I,{children:[a.jsx(g,{onClick:()=>oe("all"),children:"Select the Chain"}),be.map((e,t)=>a.jsx(g,{onClick:()=>oe(e._id,e.address),children:a.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[a.jsx("span",{children:e.address.substring(0,e.address.length/2)}),a.jsx("span",{children:e.address.substring(e.address.length/2)})]})},t))]})]}),a.jsxs(P,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d"},children:[a.jsx(D,{style:{color:"white"},children:Ee}),a.jsxs(I,{children:[a.jsx(g,{onClick:()=>te("all"),children:"All Main Category"}),Le.map((e,t)=>a.jsx(g,{onClick:()=>te(t,e),children:e},t))]})]}),a.jsxs(P,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d"},children:[a.jsx(D,{style:{color:"white"},children:Ue}),a.jsxs(I,{children:[a.jsx(g,{onClick:()=>se("all"),children:"Clear Category"}),ve.map((e,t)=>a.jsx(g,{onClick:()=>se(t,e),children:e},t))]})]}),a.jsx(aa,{style:{marginTop:"1%"},className:"bg-body-tertiary",children:a.jsx(ie,{type:"text",placeholder:"Search products by name, brand name and product id",style:{width:450,marginRight:"50%"},value:d,onChange:e=>c(e.target.value)})}),Ce?a.jsx("div",{className:"d-flex justify-content-center",children:a.jsx(We,{style:{marginTop:"15%"}})}):a.jsxs(ta,{children:[a.jsx(sa,{children:a.jsxs(V,{children:[a.jsx(i,{scope:"col",children:"#"}),a.jsx(i,{scope:"col",children:"Product Id"}),a.jsx(i,{scope:"col",children:"Photo"}),a.jsx(i,{scope:"col",children:"Name"}),a.jsx(i,{scope:"col",children:"Price"}),a.jsx(i,{scope:"col",children:"Brand"}),a.jsx(i,{scope:"col",children:"Chain"}),a.jsx(i,{scope:"col",children:"Market Address"})]})}),a.jsx(ra,{children:O.length===0?a.jsx(V,{children:a.jsx(p,{colSpan:"8",style:{textAlign:"center",backgroundColor:"white"},children:a.jsx("h6",{style:{marginTop:"1%"},children:"No Data"})})}):O.map((e,t)=>a.jsxs(V,{children:[a.jsx(p,{children:j+t+1}),a.jsx(p,{children:e.pid}),a.jsx(i,{onClick:()=>{Oe(e.productId)},children:a.jsx(de,{style:{width:"50px",height:"50px"},src:"https://api.zeuler.com/image/"+e.image})}),a.jsx(p,{children:e.name}),a.jsxs(p,{children:[e.price,a.jsx(Xe,{to:"",children:a.jsx(Ye,{icon:oa,size:"sm",onClick:()=>Fe(e.productId,e.price)})})]}),a.jsx(p,{children:e.brand}),a.jsx(p,{children:e.chainName}),a.jsx(p,{children:e.marketAddress})]},t))})]}),a.jsxs(la,{"aria-label":"Page navigation example",children:[a.jsx(_,{disabled:j<=0,onClick:Re,children:"Previous"}),Ve(),a.jsx(_,{disabled:xe===!0,onClick:ze,children:"Next"})]}),a.jsxs(ue,{alignment:"center",visible:Me,scrollable:!0,size:"sm",onClose:()=>N(!1),children:[a.jsx(he,{closeButton:!0,children:a.jsx(ge,{children:"Change Price"})}),a.jsxs(pe,{children:[a.jsx("a",{children:"Enter New Name"}),a.jsx("br",{}),a.jsx(ie,{type:"text",placeholder:De,value:T,onChange:e=>X(e.target.value)})]}),a.jsx(me,{children:a.jsx(ce,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>Qe(),children:"Save changes"})})]}),a.jsxs(ue,{alignment:"center",visible:Z,scrollable:!0,size:"lg",onClose:()=>{v(!1),H(null),ne(null)},children:[a.jsx(he,{closeButton:!0,children:a.jsx(ge,{children:"Image Uploader"})}),a.jsxs(pe,{children:[le&&a.jsx(de,{style:{width:"100px",height:"100px"},src:le,alt:"Uploaded Image"}),a.jsx("input",{style:{marginLeft:"5%"},type:"file",accept:".jpg, .jpeg, .png",onChange:e=>Ge(e.target.files[0])})]}),a.jsx(me,{children:a.jsx(ce,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>{Je(we,qe)},children:"Upload Image"})})]})]})};export{ka as default};
