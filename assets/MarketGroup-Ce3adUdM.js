import{y as jt,r as l,A as r,j as e,L as E,h as q,m as N}from"./index-BLq9IGGh.js";import{a as h}from"./axios-Cm0UX6qg.js";import{B as g}from"./config-HOLfLxHr.js";import{b as Ct,a as u}from"./CContainer-Bm_zxevC.js";import{C as Ae,a as J,b as K,c as O,d as p}from"./DefaultLayout-M8tVtSf7.js";import{C as ve}from"./CNavbar-BfXdO2OZ.js";import{C as Q,a as W,b as C,c,d as X,e as d}from"./CTable-B__h2VZV.js";import{c as kt}from"./cil-pencil-m516yCOw.js";import{c as yt}from"./cil-trash-CBbKHhHb.js";import{C as Se,a as B}from"./CPaginationItem-BpsAQI8q.js";import{C as k,a as y,b as M,c as b}from"./CModalTitle-BX8CLHZF.js";import{C as Z}from"./CFormInput-C-WC_959.js";import{C as ee}from"./CModalFooter-D0M-wwHe.js";import{C as Pe}from"./CCol-BtzSgNQB.js";import"./CFormLabel-CjV9U-Jd.js";var De=["512 512","<polygon fill='var(--ci-primary-color, currentColor)' points='440 240 272 240 272 72 240 72 240 240 72 240 72 272 240 272 240 440 272 440 272 272 440 272 440 240' class='ci-primary'/>"];const It=()=>{const[{user:m,token:n},o]=jt(),[te,w]=l.useState(""),[Le,A]=l.useState("All Cities"),[v,T]=l.useState([]),[S,se]=l.useState(0),[ze,ae]=l.useState(!0),[Ee,G]=l.useState(!1),[le,P]=l.useState(!1),[Ne,Be]=l.useState(""),[Te,$]=l.useState(!1),[Ge,oe]=l.useState(""),[D,re]=l.useState(""),[$e,ie]=l.useState(""),[_e,_]=l.useState(!1),[ne,x]=l.useState(""),[Ie,Re]=l.useState([]),[Ve,ce]=l.useState(!1),[Fe,I]=l.useState(!1),[He,Ue]=l.useState([]),[de,ue]=l.useState(""),[Ye,he]=l.useState("All Cities"),[Mt,ge]=l.useState(""),[me,pe]=l.useState(""),[qe,fe]=l.useState("All Chains"),[bt,xe]=l.useState("All Chains"),[Je,je]=l.useState(!1),[Ke,Oe]=l.useState([]),[Qe,Ce]=l.useState(!0),[L,R]=l.useState(0),[ke,ye]=l.useState(""),[j,Me]=l.useState([]),[We,V]=l.useState(!1),[F,Xe]=l.useState(""),[be,Ze]=l.useState(""),H=t=>{t==="all"?(w(""),A("All Cities")):(w(t),A(t))};l.useEffect(()=>{const t=setTimeout(()=>{o({type:r,payload:{status:!0,title:"Data Loading",message:"Data loading error: Timeout exceeded",color:"warning"}}),G(!1)},2e4);return m&&n&&z(0,t),()=>{clearTimeout(t)}},[m,te]);const z=(t,s)=>{G(!0),h.get(g+`market/groups/fetch/${t}?city=${te}`,{headers:{Authorization:`Bearer ${n}`}}).then(a=>{console.log(a.status),a.status===200?(T(a.data),G(!1),clearTimeout(s),a.data.length<20?(ae(!0),console.log("ok")):a.data.length>19&&ae(!1)):a.status===500&&o({type:r,payload:{status:!0,title:"Makrket Group loading error",message:a.data.message}})}).catch(a=>{console.error("Error:",a)})},et=()=>{const t=S+20;se(t),z(t,!0)},tt=()=>{const t=S-20;console.log(t),se(t),z(t,!1)},st=t=>{P(!le),Be(t)},at=t=>{console.log(t),h.delete(g+"marketgroup/"+t,{headers:{Authorization:`Bearer ${n}`}}).then(s=>{s.status===200?(o({type:r,payload:{status:!0,title:"Market Group Delete",message:"Market Group Delete Success",color:"success"}}),P(!1),z(0,!0),console.log("Remove Market Group")):s.status===203?o({type:r,payload:{status:!0,title:"Market Group Delete",message:s.data.message,color:"warning"}}):s.status===404?o({type:r,payload:{status:!0,title:"Market Group Delete",message:s.data.message,color:"warning"}}):s.status===500&&o({type:r,payload:{status:!0,title:"Market Group Delete",message:s.data.message,color:"warning"}})}).catch(s=>{console.error("Error:",s)})},lt=(t,s)=>{$(!0),oe(t),ie(s),console.log(s)},ot=()=>{console.log("name",D),D==""?o({type:r,payload:{status:!0,title:"Alert",message:"Please Enter Name",color:"danger"}}):rt(Ge)},rt=t=>{if(t){let s={name:D};console.log(s,t),m&&n&&h.put(g+"marketgroup/update/"+t,s,{headers:{Authorization:`Bearer ${n}`}}).then(a=>{if(a.status===200){const i=a.data,f=v.find(xt=>xt.id===i.id);f&&(f.name=i.name),T([...v]),o({type:r,payload:{status:!0,title:"Market Group Update",message:"Market group name updated successfully",color:"success"}}),oe(""),re(""),$(!1),ie("")}else a.status===204?o({type:r,payload:{status:!0,title:"Pick up area update  error",message:a.data.message,color:"danger"}}):a.status===500&&o({type:r,payload:{status:!0,title:"Pick up area update  error",message:a.data.message,color:"danger"}})}).catch(a=>{console.error("Error:",a)})}else alert("Please Check the Fields!")},it=t=>{console.log("markets",t),_(!0),x(t),nt(t)},nt=t=>{ce(!0),h.get(g+`marketgroup/markets/${t}`,{headers:{Authorization:`Bearer ${n}`}}).then(s=>{s.status===200?(Re(s.data),console.log("data market",s.data),ce(!1)):s.status===204?o({type:r,payload:{status:!0,title:"Market Loading error",message:s.data.message}}):s.status===500&&o({type:r,payload:{status:!0,title:"Market Loading error",message:s.data.message}})}).catch(s=>{console.error("Error: ",s)})},ct=t=>{console.log("markets group",t),x(t),I(!0)},U=(t,s)=>{s==="view"?t==="all"?(w(""),A("All Cities")):(w(t),A(t)):s==="modal"&&(t==="all"?(ue(""),he("All Cities")):(ue(t),he(t)))},we=(t,s,a)=>{a==="view"?t==="all"?(ge(""),xe("All Chains")):(ge(t),xe(s)):a==="modal"&&(t==="all"?(pe(""),fe("All Chains")):(pe(t),fe(s)))};l.useEffect(()=>{dt()},[]);const dt=()=>{n&&h.get(g+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${n}`}}).then(t=>{t.status===200?Ue(t.data):t.status===500&&o({type:r,payload:{status:!0,title:"Chain Loading error",message:t.data.message}})}).catch(t=>{console.error("Error: ",t)})};l.useEffect(()=>{m&&n&&Y(0)},[me,de,m]);const Y=(t,s)=>{je(!0),h.get(g+`assistant/market/locations/${t}?brand=${me}&city=${de}`,{headers:{Authorization:`Bearer ${n}`}}).then(a=>{a.status===200?(Oe(a.data.data),console.log("data market"),je(!1),a.data.data.length<20?(Ce(!0),console.log("ok")):a.data.data.length>19&&Ce(!1)):a.status===500&&o({type:r,payload:{status:!0,title:"Market Loading error",message:a.data.message}})}).catch(a=>{console.error("Error: ",a)})},ut=()=>{const t=L+20;R(t),Y(t)},ht=()=>{const t=L-20;console.log(t),R(t),Y(t)},gt=(t,s)=>{if(s&&t){const a={marketId:s};n&&m&&n&&h.patch(g+"marketgroup/add/market/"+t,a,{headers:{Authorization:`Bearer ${n}`}}).then(i=>{i.status===200?(I(!1),x(""),o({type:r,payload:{status:!0,title:"Market Assign",message:"successfully Market assigned to the market group",color:"success"}})):i.status===400?o({type:r,payload:{status:!0,title:"Market Assign error",message:i.data.message,color:"warning"}}):i.status===404?o({type:r,payload:{status:!0,title:"Market Assign error",message:i.data.message,color:"warning"}}):i.status===500&&o({type:r,payload:{status:!0,title:"Market Assign error",message:i.data.message,color:"warning"}})}).catch(i=>{console.error("Error:",i)})}else o({type:r,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},mt=(t,s)=>{if(s&&t){const a={marketId:s};n&&m&&n&&h.patch(g+"marketgroup/remove/market/"+t,a,{headers:{Authorization:`Bearer ${n}`}}).then(i=>{i.status===200?(_(!1),x(""),o({type:r,payload:{status:!0,title:"Market Assign",message:"successfully Market remove from the market group",color:"success"}})):i.status===400?o({type:r,payload:{status:!0,title:"Market remove error",message:i.data.message,color:"warning"}}):i.status===404?o({type:r,payload:{status:!0,title:"Market remove error",message:i.data.message,color:"warning"}}):i.status===500&&o({type:r,payload:{status:!0,title:"Market remove error",message:i.data.message,color:"warning"}})}).catch(i=>{console.error("Error:",i)})}else o({type:r,payload:{status:!0,title:"Error!",message:"check again",color:"warning"}})},pt=(t,s)=>{s&&(V(!0),Me(t),ye(s))},ft=()=>{if(F){console.log("center",ke,be,F);const t={lat:be,lng:F};n&&m&&n&&h.patch(g+"marketgroup/update/center/"+ke,t,{headers:{Authorization:`Bearer ${n}`}}).then(s=>{if(s.status===200){V(!1),ye(""),Me([]);const a=s.data,i=v.map(f=>(f._id===a._id&&(f.center=a.center),f));T([...i]),o({type:r,payload:{status:!0,title:"Manage Center Point",message:"successfully center point assigned to the market group",color:"success"}})}else s.status===400?o({type:r,payload:{status:!0,title:"Manage Center Point",message:s.data.message,color:"warning"}}):s.status===404?o({type:r,payload:{status:!0,title:"Manage Center Point",message:s.data.message,color:"warning"}}):s.status===500&&o({type:r,payload:{status:!0,title:"Manage Center Point",message:s.data.message,color:"warning"}})}).catch(s=>{console.error("Error:",s)})}else o({type:r,payload:{status:!0,title:"Error!",message:"check fields again",color:"warning"}})};return e.jsxs(Ct,{children:[e.jsx(E,{to:"/marketgroups/marketmap",children:e.jsx(u,{style:{marginLeft:"0%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Add Market"})}),e.jsx(E,{to:"/marketgroups/createmarketgroup",children:e.jsx(u,{style:{marginLeft:"2%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Create Market Group"})}),e.jsx(Ae,{style:{marginLeft:"39%"},color:"secondary",children:"Filter by"}),e.jsxs(J,{style:{marginLeft:"2%",width:"17%",marginRight:"5px",backgroundColor:"#ff4d4d"},children:[e.jsx(K,{style:{color:"white"},children:Le}),e.jsxs(O,{children:[e.jsx(p,{onClick:()=>H("all"),children:"All"}),e.jsx(p,{onClick:()=>H("Milano"),children:"Milano"}),e.jsx(p,{onClick:()=>H("Napoli"),children:"Napoli"})]})]}),e.jsx(ve,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),Ee?e.jsx(q,{}):e.jsxs(Q,{children:[e.jsx(W,{children:e.jsxs(C,{children:[e.jsx(c,{scope:"col",children:"#"}),e.jsx(c,{scope:"col",children:"Name"}),e.jsx(c,{scope:"col",children:"City"}),e.jsx(c,{scope:"col",children:"Assigned Market"}),e.jsx(c,{scope:"col",children:"Location"}),e.jsx(c,{scope:"col",children:"Action"}),e.jsx(c,{scope:"col",children:"Add Markets"}),e.jsx(c,{scope:"col",children:"Add Center Point"})]})}),e.jsx(X,{children:v.map((t,s)=>e.jsxs(C,{children:[e.jsx(d,{children:S+s+1}),e.jsxs(d,{children:[e.jsx("span",{children:t.name}),e.jsx(E,{to:"",children:e.jsx(N,{style:{marginLeft:20,float:"right"},icon:kt,size:"sm",onClick:()=>lt(t._id,t.name)})})]}),e.jsx(d,{children:t.city}),e.jsx(d,{children:e.jsx(u,{onClick:()=>{it(t._id)},size:"sm",style:{backgroundColor:"#ff4d4d",marginLeft:"5px",color:"white"},children:"view"})}),e.jsx(d,{children:e.jsx(E,{to:`/marketgroups/marketdistance/${t._id}`,children:e.jsx(u,{size:"sm",style:{backgroundColor:"#ff4d4d",marginLeft:"5px",color:"white"},children:"view"})})}),e.jsx(d,{children:e.jsx(u,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>st(t._id),children:e.jsx(N,{icon:yt,size:"lg",style:{color:"white"}})})}),e.jsx(d,{children:e.jsx(u,{onClick:()=>{ct(t._id)},size:"sm",style:{backgroundColor:"#ff4d4d",color:"white"},variant:"outline",children:e.jsx(N,{icon:De,size:"lg",style:{color:"white"}})})}),e.jsx(d,{children:e.jsx(u,{onClick:()=>{pt(t.center,t._id)},size:"sm",style:{backgroundColor:"#ff4d4d",color:"white"},variant:"outline",children:e.jsx(N,{icon:De,size:"lg",style:{color:"white"}})})})]},s))})]}),e.jsxs(Se,{"aria-label":"Page navigation example",children:[e.jsx(B,{disabled:S<=0,onClick:tt,children:"Previous"}),e.jsx(B,{disabled:ze===!0,onClick:et,children:"Next"})]}),e.jsxs(k,{alignment:"center",visible:Te,scrollable:!0,size:"sm",onClose:()=>$(!1),children:[e.jsx(y,{closeButton:!0,children:e.jsx(M,{children:"Change Name"})}),e.jsxs(b,{children:[e.jsx("a",{children:"Enter New Name"}),e.jsx("br",{}),e.jsx(Z,{type:"text",placeholder:$e,value:D,onChange:t=>re(t.target.value)})]}),e.jsx(ee,{children:e.jsx(u,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>ot(),children:"Save changes"})})]}),e.jsxs(k,{alignment:"center",visible:le,scrollable:!0,size:"sm",onClose:()=>P(!1),children:[e.jsx(y,{closeButton:!1,children:e.jsx(M,{children:"Confirmation"})}),e.jsxs(b,{children:[e.jsx("a",{children:"Are you sure you want to delete this market group?"}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[e.jsx(u,{onClick:()=>at(Ne),style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),e.jsx(u,{onClick:()=>P(!1),style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]}),e.jsxs(k,{alignment:"center",visible:_e,scrollable:!0,size:"lg",onClose:()=>{_(!1),x("")},children:[e.jsx(y,{closeButton:!0,children:e.jsx(M,{children:"All Assign Markets details"})}),e.jsx(b,{children:Ve?e.jsx(q,{}):e.jsxs(Q,{children:[e.jsx(W,{children:e.jsxs(C,{children:[e.jsx(c,{scope:"col",children:"#"}),e.jsx(c,{scope:"col",children:"Chain Name"}),e.jsx(c,{scope:"col",children:"Address"}),e.jsx(c,{scope:"col",children:"City"}),e.jsx(c,{scope:"col",children:"Remove"})]})}),e.jsx(X,{children:Ie.map((t,s)=>e.jsxs(C,{children:[e.jsx(d,{children:s+1}),e.jsx(d,{children:t.chain.name}),e.jsx(d,{children:t.address}),e.jsx(d,{children:t.city}),e.jsx(d,{children:e.jsx(u,{size:"sm",onClick:()=>mt(ne,t._id),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Remove"})})]},s))})]})}),e.jsx(ee,{})]}),e.jsxs(k,{visible:Fe,scrollable:!0,size:"xl",onClose:()=>{I(!1),R(0),x("")},children:[e.jsx(y,{closeButton:!0,children:e.jsx(M,{children:"Market assign view"})}),e.jsxs(b,{children:[e.jsx(Ae,{style:{marginLeft:"54%"},color:"secondary",children:"Filter by"}),e.jsxs(J,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(K,{style:{color:"white"},children:Ye}),e.jsxs(O,{children:[e.jsx(p,{onClick:()=>U("all","modal"),children:"All"}),e.jsx(p,{onClick:()=>U("Milano","modal"),children:"Milano"}),e.jsx(p,{onClick:()=>U("Napoli","modal"),children:"Napoli"})]})]}),e.jsxs(J,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(K,{style:{color:"white"},children:qe}),e.jsxs(O,{children:[e.jsx(p,{onClick:()=>we("all",null,"modal"),children:"All"}),He.map((t,s)=>e.jsx(p,{onClick:()=>we(t.id,t.name,"modal"),children:t.name},s))]})]}),e.jsx(ve,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),Je?e.jsx(q,{}):e.jsxs(Q,{children:[e.jsx(W,{children:e.jsxs(C,{children:[e.jsx(c,{scope:"col",children:"#"}),e.jsx(c,{scope:"col",children:"Name"}),e.jsx(c,{scope:"col",children:"Address"}),e.jsx(c,{scope:"col",children:"City"}),e.jsx(c,{scope:"col",children:"Measurement"}),e.jsx(c,{scope:"col"})]})}),e.jsx(X,{children:Ke.map((t,s)=>e.jsxs(C,{children:[e.jsx(d,{children:L+s+1}),e.jsx(d,{children:t.chain.name}),e.jsx(d,{children:t.address}),e.jsx(d,{children:t.city}),e.jsx(d,{children:t.scraped}),e.jsx(d,{children:e.jsx(u,{size:"sm",onClick:()=>gt(ne,t._id),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Add"})})]},s))})]}),e.jsx(ee,{children:e.jsxs(Se,{"aria-label":"Page navigation example",children:[e.jsx(B,{disabled:L<=0,onClick:ht,children:"Previous"}),e.jsx(B,{disabled:Qe===!0,onClick:ut,children:"Next"})]})})]})]}),e.jsxs(k,{visible:We,scrollable:!0,size:"lg",onClose:()=>V(!1),children:[e.jsx(y,{closeButton:!0,children:e.jsx(M,{children:"Manage Center Point"})}),e.jsx(b,{children:e.jsxs("div",{className:"row g-3",children:[e.jsx(Pe,{md:6,children:e.jsx(Z,{id:"lat",label:"Latitude",defaultValue:j==null?void 0:j.lat,onChange:t=>Ze(t.target.value)})}),e.jsx(Pe,{md:6,children:e.jsx(Z,{id:"lng",label:"Longitude",defaultValue:j==null?void 0:j.lng,onChange:t=>Xe(t.target.value)})}),e.jsx(u,{type:"submit",style:{marginBottom:"3%",width:"200px",backgroundColor:"#ff4d4d",color:"white"},onClick:()=>ft(),children:"Add Center Point"})]})})]})]})};export{It as default};
