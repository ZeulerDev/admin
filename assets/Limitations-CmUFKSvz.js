import{x as tt,r as s,z as i,j as e,h as at}from"./index-DY5Equgr.js";import{a as C}from"./axios-B4uVmeYG.js";import{B as x}from"./config-HOLfLxHr.js";import{b as st,a as y}from"./CContainer-_Gzt09pj.js";import{C as ye,a as b,b as S,d as k,e as c}from"./DefaultLayout-DEOfvUp4.js";import{C as lt}from"./CNavbar-CMesnh0F.js";import{C as J}from"./CFormInput-VEhd6s08.js";import{C as ot,a as rt,b as K,c as d,d as nt,e as u}from"./CTable-CB8lfHH6.js";import{C as be}from"./CCardImage-BijonMni.js";import{C as it}from"./CFormCheck-B4kmGUdP.js";import{C as ct,a as W}from"./CPaginationItem-CXS2fp0b.js";import{C as X,a as Y,b as Z,c as ee}from"./CModalTitle-D62UeRY4.js";import{C as te}from"./CModalFooter-gOE1ccD7.js";import"./CFormLabel-BwmqzSOX.js";const Dt=()=>{const[{user:M,token:o},n]=tt(),[Se,f]=s.useState(!1),[B,ae]=s.useState([]),[P,E]=s.useState(0),[ke,se]=s.useState(!0),[Me,Pe]=s.useState([]),[De,T]=s.useState("All Chains"),[N,D]=s.useState("All market"),[le,U]=s.useState(""),[oe,I]=s.useState(""),[Ie,re]=s.useState([]),[g,h]=s.useState(""),[we,ne]=s.useState(g),[Ae,ve]=s.useState(!1),[Le,$]=s.useState(!1);s.useState("");const[Be,Ee]=s.useState(""),[Te,dt]=s.useState(""),[Ne,Ue]=s.useState(0),[w,z]=s.useState(1);s.useState("NAME");const[ie,R]=s.useState(!1),[$e,ce]=s.useState(""),[ze,F]=s.useState("All Main Categories"),[ut,Q]=s.useState(""),[Re,Fe]=s.useState([]),[Qe,V]=s.useState(""),[Ve,q]=s.useState("Select Main Categories"),[de,H]=s.useState(""),[qe,_]=s.useState([]),[m,A]=s.useState([]),[v,ue]=s.useState(1),[L,O]=s.useState("none");s.useEffect(()=>{M&&o&&j(0)},[M,o,oe,we,de,le,L]),s.useEffect(()=>{const t=setTimeout(()=>{(g.length>=3||g.length===0)&&ne(g)},500);return()=>{clearTimeout(t)}},[g]),s.useEffect(()=>{o&&C.get(x+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${o}`}}).then(t=>{t.status===200?Pe(t.data):t.status===500&&n({type:i,payload:{status:!0,title:"Chain Loading error",message:t.data.message}})}).catch(t=>{console.error("Error: ",t)})},[]),s.useEffect(()=>{o&&C.get(x+"product/categories",{headers:{Authorization:`Bearer ${o}`}}).then(t=>{t.status===200?(console.log(t.data[1]),Fe(t.data)):t.status===500&&n({type:i,payload:{status:!0,title:"Main Category Loading error",message:"Main Category loading error"}})}).catch(t=>{console.error("Error: ",t)})},[]);const He=t=>{C.get(x+`assistant/market/locations?brand=${t}`,{headers:{Authorization:`Bearer ${o}`}}).then(a=>{a.status===200?(re(a.data.data),a.data.data.length<20?console.log("ok"):a.data.data.length>19):a.status===500&&n({type:i,payload:{status:!0,title:"Market Loading error",message:a.data.message}})}).catch(a=>{console.error("Error: ",a)})},j=(t,a)=>{f(!0),C.get(x+`product/limitations/all/${t}?marketId=${oe}&name=${g}&category=${de}&mainCategory=${Qe}&chainId=${le}&prop=${L}`,{headers:{Authorization:`Bearer ${o}`}}).then(l=>{l.status===200?(ae(l.data.list),Ue(l.data.count),f(!1),l.data.list.length<50?se(!0):l.data.list.length>49&&se(!1)):l.status===203?(f(!1),n({type:i,payload:{status:!0,title:"product loading error error",message:l.data.message}})):l.status===204?f(!1):l.status===500&&(f(!1),n({type:i,payload:{status:!0,title:"product loading error error",message:l.data.message}}))}).catch(l=>{f(!1),console.error("Error:",l)})},he=(t,a)=>{t==="all"?(Q(""),F("All Main Categories"),H(""),q("Select Main Categories"),V(""),h(""),_([])):(Q(t),_e(t),F(a),V(t),h(""))},_e=t=>{o&&C.get(x+"product/categories/sub/"+t,{headers:{Authorization:`Bearer ${o}`}}).then(a=>{a.status===200?_(a.data):a.status===500&&n({type:i,payload:{status:!0,title:"Sub Category Loading",message:"Sub Category loading error"}})}).catch(a=>{console.error("Error: ",a)})},ge=(t,a)=>{t==="all"?(H(""),q("Select Main Categories"),Q(""),F("All Main Categories"),_([]),V(""),h("")):(console.log("index",t),H(t),q(a),h(""))},pe=(t,a)=>{t==="all"?(U(""),T("All Chains"),I(""),D("All Markets"),h("")):(U(t),He(t),T(a),I(""),D("All Markets"),h(""))},me=(t,a)=>{t==="all"?(I(""),D("All Markets"),U(""),T("All Chains"),re([]),h("")):(I(t),D(a),h(""))},Oe=()=>{z(w+1);const t=P+50;E(t),j(t)},Ge=()=>{z(w-1);const t=P-50;console.log(t),E(t),j(t)},Ce=()=>{console.log("called"),v?We():n({type:i,payload:{status:!0,title:"Alert",message:"Please enter the quantity",color:"warning"}})},Je=t=>{z(t);const a=(t-1)*50;E(a),j(a)},Ke=()=>{const t=Math.ceil(Ne/50),a=[];for(let p=1;p<=t;p++)a.push(p);const l=Math.max(w-2,1),r=Math.min(l+4,t);return a.slice(l-1,r).map(p=>e.jsx(W,{active:w===p,onClick:()=>Je(p),children:p},p))},We=()=>{if(m.length>0){let t={quantity:v,ids:m};M&&o&&C.put(x+"product/limitation/max",t,{headers:{Authorization:`Bearer ${o}`}}).then(a=>{if(a.status===200){n({type:i,payload:{status:!0,title:"Product Details Update",message:"Product price update Success",color:"success"}});const l=B.map(r=>(m.find(je=>je===r.productId)!==void 0&&(r.max=v),r));ae(l),A([]),$(!1),ue(1)}else a.status===204?n({type:i,payload:{status:!0,title:"Product Details Update error",message:a.data.message,color:"danger"}}):a.status===500&&n({type:i,payload:{status:!0,title:"Product Details Update error",message:a.data.message,color:"danger"}})}).catch(a=>{console.error("Error:",a)})}else alert("Please Check the Fields!")},Xe=t=>{R(!ie),ce(t)},[Ye,G]=s.useState(null),[xe,fe]=s.useState(null),Ze=t=>{console.log(t),fe(URL.createObjectURL(t)),G(t)},et=async(t,a)=>{if(console.log(t,a),M&&o){const l=new FormData;l.append("image",a),l.append("id",t),C.post(x+"test/product/image/update",l,{headers:{Authorization:`Bearer ${o}`}}).then(r=>{r.status===200?(R(!1),ce(""),G(null),console.log("response",r.data),n({type:i,payload:{status:!0,title:"Image upload ",message:"Image upload success",color:"success"}}),j(0)):r.status===500&&n({type:i,payload:{status:!0,title:"Image upload error",message:r.data.message,color:"danger"}})}).catch(r=>{console.error("Error:",r)})}};return e.jsxs(st,{children:[e.jsx(ye,{style:{marginLeft:"14%"},color:"secondary",children:"Filter by"}),e.jsxs(b,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d"},children:[e.jsx(S,{style:{color:"white"},children:De}),e.jsxs(k,{children:[e.jsx(c,{onClick:()=>pe("all"),children:"All"}),Me.map((t,a)=>e.jsx(c,{onClick:()=>pe(t.id,t.name),children:t.name},a))]})]}),e.jsxs(b,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d"},children:[e.jsx(S,{style:{color:"white"},children:N.length>15?`${N.substring(0,15)}...`:N}),e.jsxs(k,{children:[e.jsx(c,{onClick:()=>me("all"),children:"Select the Chain"}),Ie.map((t,a)=>e.jsx(c,{onClick:()=>me(t._id,t.address),children:e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:t.address.substring(0,t.address.length/2)}),e.jsx("span",{children:t.address.substring(t.address.length/2)})]})},a))]})]}),e.jsxs(b,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d"},children:[e.jsx(S,{style:{color:"white"},children:ze}),e.jsxs(k,{children:[e.jsx(c,{onClick:()=>he("all"),children:"All Main Category"}),Re.map((t,a)=>e.jsx(c,{onClick:()=>he(a,t),children:t},a))]})]}),e.jsxs(b,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d"},children:[e.jsx(S,{style:{color:"white"},children:Ve}),e.jsxs(k,{children:[e.jsx(c,{onClick:()=>ge("all"),children:"Clear Category"}),qe.map((t,a)=>e.jsx(c,{onClick:()=>ge(a,t),children:t},a))]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",marginTop:20,marginBottom:20},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsxs(ye,{style:{color:"black"},children:["Selected Products : ",m.length]}),e.jsx(y,{style:{backgroundColor:"#ff4d4d",color:"white"},frameBorder:1,size:"sm",onClick:()=>{A([])},children:"Clear"})]}),e.jsxs("div",{children:[e.jsxs(b,{style:{backgroundColor:"#ff4d4d",marginRight:20},children:[e.jsx(S,{style:{color:"white"},children:L==="none"?"None":L}),e.jsxs(k,{children:[e.jsx(c,{onClick:()=>O("none"),children:"None"}),e.jsx(c,{onClick:()=>O("limited"),children:"Limited"}),e.jsx(c,{onClick:()=>O("unlimited"),children:"Unlimited"})]})]}),e.jsx(y,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>{$(!0)},children:"Apply Limit"})]})]}),e.jsx(lt,{style:{marginTop:"1%"},className:"bg-body-tertiary",children:e.jsx(J,{type:"text",placeholder:"Search products by name, brand name and product id",style:{width:450,marginRight:"50%"},value:g,onChange:t=>h(t.target.value)})}),Se?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(at,{style:{marginTop:"15%"}})}):e.jsxs(ot,{children:[e.jsx(rt,{children:e.jsxs(K,{children:[e.jsx(d,{scope:"col",children:"#"}),e.jsx(d,{scope:"col",children:"Product Id"}),e.jsx(d,{scope:"col",children:"Photo"}),e.jsx(d,{scope:"col",children:"Name"}),e.jsx(d,{scope:"col",children:"Price"}),e.jsx(d,{scope:"col",children:"Brand"}),e.jsx(d,{scope:"col",children:"Chain"}),e.jsx(d,{scope:"col",children:"Max Qty"}),e.jsx(d,{scope:"col",children:"Market Address"}),e.jsx(d,{scope:"col",children:"Action"})]})}),e.jsx(nt,{children:B.length===0?e.jsx(K,{children:e.jsx(u,{colSpan:"8",style:{textAlign:"center",backgroundColor:"white"},children:e.jsx("h6",{style:{marginTop:"1%"},children:"No Data"})})}):B.map((t,a)=>e.jsxs(K,{children:[e.jsx(u,{children:P+a+1}),e.jsx(u,{children:t.pid}),e.jsx(d,{onClick:()=>{Xe(t.productId)},children:e.jsx(be,{style:{width:"50px",height:"50px"},src:"https://api.zeuler.com/image/"+t.image})}),e.jsx(u,{children:t.name}),e.jsx(u,{children:t.price}),e.jsx(u,{children:t.brand}),e.jsx(u,{children:t.chainName}),e.jsx(u,{children:t.max}),e.jsx(u,{children:t.marketAddress}),e.jsx(u,{children:e.jsx(it,{checked:m.find(l=>l===t.productId)!==void 0,onChange:l=>{l.target.checked?A([...m,t.productId]):A(m.filter(r=>r!==t.productId))}})})]},a))})]}),e.jsxs(ct,{"aria-label":"Page navigation example",children:[e.jsx(W,{disabled:P<=0,onClick:Ge,children:"Previous"}),Ke(),e.jsx(W,{disabled:ke===!0,onClick:Oe,children:"Next"})]}),e.jsxs(X,{alignment:"center",visible:Ae,scrollable:!0,size:"sm",onClose:()=>ve(!1),children:[e.jsx(Y,{closeButton:!0,children:e.jsx(Z,{children:"Change Price"})}),e.jsxs(ee,{children:[e.jsx("a",{children:"Enter New Name"}),e.jsx("br",{}),e.jsx(J,{type:"text",placeholder:Te,value:Be,onChange:t=>Ee(t.target.value)})]}),e.jsx(te,{children:e.jsx(y,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>Ce(),children:"Save changes"})})]}),e.jsxs(X,{alignment:"center",visible:Le,scrollable:!0,size:"lg",onClose:()=>$(!1),children:[e.jsx(Y,{closeButton:!0,children:e.jsx(Z,{children:"Apply the limitation for selected product(s)"})}),e.jsxs(ee,{children:[e.jsx("span",{children:"The maximum quantity"}),e.jsx(J,{style:{marginTop:10},type:"number",placeholder:"Eg : 5",value:v,onChange:t=>ue(t.target.value)})]}),e.jsx(te,{children:e.jsx(y,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>Ce(),children:"Save changes"})})]}),e.jsxs(X,{alignment:"center",visible:ie,scrollable:!0,size:"lg",onClose:()=>{R(!1),G(null),fe(null)},children:[e.jsx(Y,{closeButton:!0,children:e.jsx(Z,{children:"Image Uploader"})}),e.jsxs(ee,{children:[xe&&e.jsx(be,{style:{width:"100px",height:"100px"},src:xe,alt:"Uploaded Image"}),e.jsx("input",{style:{marginLeft:"5%"},type:"file",accept:".jpg, .jpeg, .png",onChange:t=>Ze(t.target.files[0])})]}),e.jsx(te,{children:e.jsx(y,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>{et($e,Ye)},children:"Upload Image"})})]})]})};export{Dt as default};
