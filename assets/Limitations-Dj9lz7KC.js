import{x as tt,r as s,z as i,j as e,h as at}from"./index-BzIi4H5T.js";import{a as C}from"./axios-B4uVmeYG.js";import{B as x}from"./config-HOLfLxHr.js";import{b as st,a as y}from"./CContainer-B_5lyMll.js";import{C as ye,a as b,b as S,d as k,e as c}from"./DefaultLayout-DahFU_Q2.js";import{C as lt}from"./CNavbar-nRmbgC54.js";import{C as K}from"./CFormInput-CU6CLSn_.js";import{C as ot,a as rt,b as W,c as d,d as nt,e as u}from"./CTable-DraPgbcK.js";import{C as be}from"./CCardImage-aelRjN4_.js";import{C as it}from"./CFormCheck-DtQmeo0C.js";import{C as ct,a as X}from"./CPaginationItem-5n5TbMMd.js";import{C as Y,a as Z,b as ee,c as te}from"./CModalTitle-Bvn1-2Di.js";import{C as ae}from"./CModalFooter-Br03FyMU.js";import"./CFormLabel-upk5IM6e.js";const Dt=()=>{const[{user:M,token:o},n]=tt(),[Se,f]=s.useState(!1),[E,se]=s.useState([]),[P,T]=s.useState(0),[ke,D]=s.useState(!0),[Me,Pe]=s.useState([]),[De,N]=s.useState("All Chains"),[U,I]=s.useState("All market"),[le,$]=s.useState(""),[oe,w]=s.useState(""),[Ie,re]=s.useState([]),[g,h]=s.useState(""),[we,ne]=s.useState(g),[Ae,ve]=s.useState(!1),[Le,z]=s.useState(!1);s.useState("");const[Be,Ee]=s.useState(""),[Te,dt]=s.useState(""),[Ne,Ue]=s.useState(0),[A,R]=s.useState(1);s.useState("NAME");const[ie,F]=s.useState(!1),[$e,ce]=s.useState(""),[ze,Q]=s.useState("All Main Categories"),[ut,V]=s.useState(""),[Re,Fe]=s.useState([]),[Qe,q]=s.useState(""),[Ve,H]=s.useState("Select Main Categories"),[de,_]=s.useState(""),[qe,O]=s.useState([]),[m,v]=s.useState([]),[L,ue]=s.useState(1),[B,G]=s.useState("none");s.useEffect(()=>{M&&o&&j(0)},[M,o,oe,we,de,le,B]),s.useEffect(()=>{const t=setTimeout(()=>{(g.length>=3||g.length===0)&&ne(g)},500);return()=>{clearTimeout(t)}},[g]),s.useEffect(()=>{o&&C.get(x+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${o}`}}).then(t=>{t.status===200?Pe(t.data):t.status===500&&n({type:i,payload:{status:!0,title:"Chain Loading error",message:t.data.message}})}).catch(t=>{console.error("Error: ",t)})},[]),s.useEffect(()=>{o&&C.get(x+"product/categories",{headers:{Authorization:`Bearer ${o}`}}).then(t=>{t.status===200?(console.log(t.data[1]),Fe(t.data)):t.status===500&&n({type:i,payload:{status:!0,title:"Main Category Loading error",message:"Main Category loading error"}})}).catch(t=>{console.error("Error: ",t)})},[]);const He=t=>{C.get(x+`assistant/market/locations?brand=${t}`,{headers:{Authorization:`Bearer ${o}`}}).then(a=>{a.status===200?(re(a.data.data),a.data.data.length<20?(D(!0),console.log("ok")):a.data.data.length>19&&D(!1)):a.status===500&&n({type:i,payload:{status:!0,title:"Market Loading error",message:a.data.message}})}).catch(a=>{console.error("Error: ",a)})},j=(t,a)=>{f(!0),C.get(x+`product/limitations/all/${t}?marketId=${oe}&name=${g}&category=${de}&mainCategory=${Qe}&chainId=${le}&prop=${B}`,{headers:{Authorization:`Bearer ${o}`}}).then(l=>{l.status===200?(se(l.data.list),Ue(l.data.count),f(!1),l.data.list.length<20?(D(!0),console.log("ok")):l.data.list.length>19&&D(!1)):l.status===203?(f(!1),n({type:i,payload:{status:!0,title:"product loading error error",message:l.data.message}})):l.status===204?f(!1):l.status===500&&(f(!1),n({type:i,payload:{status:!0,title:"product loading error error",message:l.data.message}}))}).catch(l=>{f(!1),console.error("Error:",l)})},he=(t,a)=>{t==="all"?(V(""),Q("All Main Categories"),_(""),H("Select Main Categories"),q(""),h(""),O([])):(V(t),_e(t),Q(a),q(t),h(""))},_e=t=>{o&&C.get(x+"product/categories/sub/"+t,{headers:{Authorization:`Bearer ${o}`}}).then(a=>{a.status===200?O(a.data):a.status===500&&n({type:i,payload:{status:!0,title:"Sub Category Loading",message:"Sub Category loading error"}})}).catch(a=>{console.error("Error: ",a)})},ge=(t,a)=>{t==="all"?(_(""),H("Select Main Categories"),V(""),Q("All Main Categories"),O([]),q(""),h("")):(console.log("index",t),_(t),H(a),h(""))},pe=(t,a)=>{t==="all"?($(""),N("All Chains"),w(""),I("All Markets"),h("")):($(t),He(t),N(a),w(""),I("All Markets"),h(""))},me=(t,a)=>{t==="all"?(w(""),I("All Markets"),$(""),N("All Chains"),re([]),h("")):(w(t),I(a),h(""))},Oe=()=>{R(A+1);const t=P+50;T(t),j(t)},Ge=()=>{R(A-1);const t=P-50;console.log(t),T(t),j(t)},Ce=()=>{console.log("called"),L?We():n({type:i,payload:{status:!0,title:"Alert",message:"Please enter the quantity",color:"warning"}})},Je=t=>{R(t);const a=(t-1)*50;T(a),j(a)},Ke=()=>{const t=Math.ceil(Ne/50),a=[];for(let p=1;p<=t;p++)a.push(p);const l=Math.max(A-2,1),r=Math.min(l+4,t);return a.slice(l-1,r).map(p=>e.jsx(X,{active:A===p,onClick:()=>Je(p),children:p},p))},We=()=>{if(m.length>0){let t={quantity:L,ids:m};M&&o&&C.put(x+"product/limitation/max",t,{headers:{Authorization:`Bearer ${o}`}}).then(a=>{if(a.status===200){n({type:i,payload:{status:!0,title:"Product Details Update",message:"Product price update Success",color:"success"}});const l=E.map(r=>(m.find(je=>je===r.productId)!==void 0&&(r.max=L),r));se(l),v([]),z(!1),ue(1)}else a.status===204?n({type:i,payload:{status:!0,title:"Product Details Update error",message:a.data.message,color:"danger"}}):a.status===500&&n({type:i,payload:{status:!0,title:"Product Details Update error",message:a.data.message,color:"danger"}})}).catch(a=>{console.error("Error:",a)})}else alert("Please Check the Fields!")},Xe=t=>{F(!ie),ce(t)},[Ye,J]=s.useState(null),[xe,fe]=s.useState(null),Ze=t=>{console.log(t),fe(URL.createObjectURL(t)),J(t)},et=async(t,a)=>{if(console.log(t,a),M&&o){const l=new FormData;l.append("image",a),l.append("id",t),C.post(x+"test/product/image/update",l,{headers:{Authorization:`Bearer ${o}`}}).then(r=>{r.status===200?(F(!1),ce(""),J(null),console.log("response",r.data),n({type:i,payload:{status:!0,title:"Image upload ",message:"Image upload success",color:"success"}}),j(0)):r.status===500&&n({type:i,payload:{status:!0,title:"Image upload error",message:r.data.message,color:"danger"}})}).catch(r=>{console.error("Error:",r)})}};return e.jsxs(st,{children:[e.jsx(ye,{style:{marginLeft:"14%"},color:"secondary",children:"Filter by"}),e.jsxs(b,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d"},children:[e.jsx(S,{style:{color:"white"},children:De}),e.jsxs(k,{children:[e.jsx(c,{onClick:()=>pe("all"),children:"All"}),Me.map((t,a)=>e.jsx(c,{onClick:()=>pe(t.id,t.name),children:t.name},a))]})]}),e.jsxs(b,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d"},children:[e.jsx(S,{style:{color:"white"},children:U.length>15?`${U.substring(0,15)}...`:U}),e.jsxs(k,{children:[e.jsx(c,{onClick:()=>me("all"),children:"Select the Chain"}),Ie.map((t,a)=>e.jsx(c,{onClick:()=>me(t._id,t.address),children:e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:t.address.substring(0,t.address.length/2)}),e.jsx("span",{children:t.address.substring(t.address.length/2)})]})},a))]})]}),e.jsxs(b,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d"},children:[e.jsx(S,{style:{color:"white"},children:ze}),e.jsxs(k,{children:[e.jsx(c,{onClick:()=>he("all"),children:"All Main Category"}),Re.map((t,a)=>e.jsx(c,{onClick:()=>he(a,t),children:t},a))]})]}),e.jsxs(b,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d"},children:[e.jsx(S,{style:{color:"white"},children:Ve}),e.jsxs(k,{children:[e.jsx(c,{onClick:()=>ge("all"),children:"Clear Category"}),qe.map((t,a)=>e.jsx(c,{onClick:()=>ge(a,t),children:t},a))]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",marginTop:20,marginBottom:20},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsxs(ye,{style:{color:"black"},children:["Selected Products : ",m.length]}),e.jsx(y,{style:{backgroundColor:"#ff4d4d",color:"white"},frameBorder:1,size:"sm",onClick:()=>{v([])},children:"Clear"})]}),e.jsxs("div",{children:[e.jsxs(b,{style:{backgroundColor:"#ff4d4d",marginRight:20},children:[e.jsx(S,{style:{color:"white"},children:B==="none"?"None":B}),e.jsxs(k,{children:[e.jsx(c,{onClick:()=>G("none"),children:"None"}),e.jsx(c,{onClick:()=>G("limited"),children:"Limited"}),e.jsx(c,{onClick:()=>G("unlimited"),children:"Unlimited"})]})]}),e.jsx(y,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>{z(!0)},children:"Apply Limit"})]})]}),e.jsx(lt,{style:{marginTop:"1%"},className:"bg-body-tertiary",children:e.jsx(K,{type:"text",placeholder:"Search products by name, brand name and product id",style:{width:450,marginRight:"50%"},value:g,onChange:t=>h(t.target.value)})}),Se?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(at,{style:{marginTop:"15%"}})}):e.jsxs(ot,{children:[e.jsx(rt,{children:e.jsxs(W,{children:[e.jsx(d,{scope:"col",children:"#"}),e.jsx(d,{scope:"col",children:"Product Id"}),e.jsx(d,{scope:"col",children:"Photo"}),e.jsx(d,{scope:"col",children:"Name"}),e.jsx(d,{scope:"col",children:"Price"}),e.jsx(d,{scope:"col",children:"Brand"}),e.jsx(d,{scope:"col",children:"Chain"}),e.jsx(d,{scope:"col",children:"Max Qty"}),e.jsx(d,{scope:"col",children:"Market Address"}),e.jsx(d,{scope:"col",children:"Action"})]})}),e.jsx(nt,{children:E.length===0?e.jsx(W,{children:e.jsx(u,{colSpan:"8",style:{textAlign:"center",backgroundColor:"white"},children:e.jsx("h6",{style:{marginTop:"1%"},children:"No Data"})})}):E.map((t,a)=>e.jsxs(W,{children:[e.jsx(u,{children:P+a+1}),e.jsx(u,{children:t.pid}),e.jsx(d,{onClick:()=>{Xe(t.productId)},children:e.jsx(be,{style:{width:"50px",height:"50px"},src:"https://api.zeuler.com/image/"+t.image})}),e.jsx(u,{children:t.name}),e.jsx(u,{children:t.price}),e.jsx(u,{children:t.brand}),e.jsx(u,{children:t.chainName}),e.jsx(u,{children:t.max}),e.jsx(u,{children:t.marketAddress}),e.jsx(u,{children:e.jsx(it,{checked:m.find(l=>l===t.productId)!==void 0,onChange:l=>{l.target.checked?v([...m,t.productId]):v(m.filter(r=>r!==t.productId))}})})]},a))})]}),e.jsxs(ct,{"aria-label":"Page navigation example",children:[e.jsx(X,{disabled:P<=0,onClick:Ge,children:"Previous"}),Ke(),e.jsx(X,{disabled:ke===!0,onClick:Oe,children:"Next"})]}),e.jsxs(Y,{alignment:"center",visible:Ae,scrollable:!0,size:"sm",onClose:()=>ve(!1),children:[e.jsx(Z,{closeButton:!0,children:e.jsx(ee,{children:"Change Price"})}),e.jsxs(te,{children:[e.jsx("a",{children:"Enter New Name"}),e.jsx("br",{}),e.jsx(K,{type:"text",placeholder:Te,value:Be,onChange:t=>Ee(t.target.value)})]}),e.jsx(ae,{children:e.jsx(y,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>Ce(),children:"Save changes"})})]}),e.jsxs(Y,{alignment:"center",visible:Le,scrollable:!0,size:"lg",onClose:()=>z(!1),children:[e.jsx(Z,{closeButton:!0,children:e.jsx(ee,{children:"Apply the limitation for selected product(s)"})}),e.jsxs(te,{children:[e.jsx("span",{children:"The maximum quantity"}),e.jsx(K,{style:{marginTop:10},type:"number",placeholder:"Eg : 5",value:L,onChange:t=>ue(t.target.value)})]}),e.jsx(ae,{children:e.jsx(y,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>Ce(),children:"Save changes"})})]}),e.jsxs(Y,{alignment:"center",visible:ie,scrollable:!0,size:"lg",onClose:()=>{F(!1),J(null),fe(null)},children:[e.jsx(Z,{closeButton:!0,children:e.jsx(ee,{children:"Image Uploader"})}),e.jsxs(te,{children:[xe&&e.jsx(be,{style:{width:"100px",height:"100px"},src:xe,alt:"Uploaded Image"}),e.jsx("input",{style:{marginLeft:"5%"},type:"file",accept:".jpg, .jpeg, .png",onChange:t=>Ze(t.target.files[0])})]}),e.jsx(ae,{children:e.jsx(y,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>{et($e,Ye)},children:"Upload Image"})})]})]})};export{Dt as default};
