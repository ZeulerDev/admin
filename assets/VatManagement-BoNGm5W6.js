import{r as o,y as J,A as c,j as e,h as K}from"./index-vIOSoMUu.js";import{a as k}from"./axios-Cm0UX6qg.js";import{B as N}from"./config-HOLfLxHr.js";import{b as O,a as T}from"./CContainer-DQqje6Yb.js";import{C as W}from"./CNavbar-CKkucrSO.js";import{C as B}from"./CFormInput-D-Eh3JXR.js";import{C as X,a as Z,b as M,c as l,d as ee,e as n}from"./CTable-CA_T2BdW.js";import{C as h}from"./DefaultLayout-CKhc0dtY.js";import{C as se,a as D}from"./CPaginationItem-4rDKfmAB.js";import{C as te,a as ae,b as oe,c as re}from"./CModalTitle-UWL2UZXd.js";import{C as le}from"./CModalFooter-CdxMNKJi.js";import"./CFormLabel-B9P4EuKI.js";const Ce=()=>{const[I,x]=o.useState(!1),[{user:m,token:u},i]=J(),[f,P]=o.useState([]),[z,j]=o.useState(!1),[L,R]=o.useState(""),[S,A]=o.useState(""),[C,H]=o.useState(""),[$,F]=o.useState(0),[g,v]=o.useState(1),[y,b]=o.useState(0),[Q,V]=o.useState(!0);o.useEffect(()=>{const s=setTimeout(()=>{i({type:c,payload:{status:!0,title:"Data Loading",message:"Data loading error: Timeout exceeded",color:"warning"}}),j(!1)},2e4);return m&&u&&p(0,s),()=>{clearTimeout(s)}},[C]);const p=(s,t)=>{m&&u&&(j(!0),k.get(N+`assistant/vat/riders/${s}?search=`+C,{headers:{Authorization:`Bearer ${u}`}}).then(a=>{a.status===200?(P(a.data.list),F(a.data.count),j(!1),console.log("done"),clearTimeout(t),a.data.list.length<50?(V(!0),console.log("ok")):a.data.list.length>49&&V(!1)):a.status===204?i({type:c,payload:{status:!0,title:"Error",message:a.data.message,color:"warning"}}):a.status===500&&i({type:c,payload:{status:!0,title:"Error",message:a.data.message,color:"warning"}})}).catch(a=>{console.error("Error:",a)}))},U=()=>{v(g+1);const s=y+50;b(s),p(s,!0)},Y=()=>{v(g-1);const s=y-50;console.log(s),b(s),p(s,!1)},w=(s,t=null)=>{x(!I),R(s),t!==null?A(t):console.log("VAT DID not provided"),console.log(s)},_=()=>{const s={vat:S};m&&u&&k.patch(N+"assistant/rider/vat/"+L,s,{headers:{Authorization:`Bearer ${u}`}}).then(t=>{if(t.status===200){console.log("updated"),x(!1);const a=t.data,d=f.find(E=>E.id===a.id);d&&(d.vat=a.vat),P([...f]),i({type:c,payload:{status:!0,title:"Driver VAT Id ",message:"VAT Id updated successfully"}})}else t.status===203?(console.log("203"),i({type:c,payload:{status:!0,title:"Driver VAT Id error",message:t.data.message}})):t.status===204?(console.log("204"),i({type:c,payload:{status:!0,title:"Driver VAT Id error",message:t.data.message}})):t.status===500&&i({type:c,payload:{status:!0,title:"Driver VAT Id update error",message:t.data.message}})}).catch(t=>{console.error(t)})},G=s=>{v(s);const t=(s-1)*50;b(t),p(t,!0)},q=()=>{const s=Math.ceil($/50),t=[];for(let r=1;r<=s;r++)t.push(r);const a=Math.max(g-2,1),d=Math.min(a+4,s);return t.slice(a-1,d).map(r=>e.jsx(D,{active:g===r,onClick:()=>G(r),children:r},r))};return e.jsxs(O,{children:[e.jsx(W,{className:"bg-body-tertiary",children:e.jsx(B,{type:"text",placeholder:"Search",style:{width:450,marginLeft:"0%"},value:C,onChange:s=>H(s.target.value)})}),z?e.jsx(K,{}):e.jsxs(X,{children:[e.jsx(Z,{children:e.jsxs(M,{children:[e.jsx(l,{scope:"col",children:"#"}),e.jsx(l,{scope:"col",children:"Name"}),e.jsx(l,{scope:"col",children:"City"}),e.jsx(l,{scope:"col",children:"Vat"}),e.jsx(l,{scope:"col",children:"Activate"}),e.jsx(l,{scope:"col",children:"Disabled"}),e.jsx(l,{scope:"col",children:"Groups"}),e.jsx(l,{scope:"col",children:"Action"})]})}),e.jsx(ee,{children:f.map((s,t)=>e.jsxs(M,{children:[e.jsx(n,{children:t+1}),e.jsx(n,{children:s.name}),e.jsx(n,{children:s.city}),e.jsx(n,{children:s.vat?s.vat:e.jsx(h,{color:"warning",children:"Null"})}),e.jsx(n,{children:s.activate?e.jsx(h,{color:"success",children:"Yes"}):e.jsx(h,{color:"warning",children:"No"})}),e.jsx(n,{children:s.disabled?e.jsx(h,{color:"success",children:"No"}):e.jsx(h,{color:"warning",children:"Yes"})}),e.jsx(n,{children:s.groups.map((a,d)=>e.jsx("div",{children:a.name},d))}),e.jsx(n,{children:s.vat===""?e.jsx(T,{size:"sm",style:{backgroundColor:"#ff4d4d",width:70,color:"white"},onClick:()=>w(s.id,s.vat),children:"Insert "}):e.jsx(T,{size:"sm",style:{backgroundColor:"#ff4d4d",width:70,color:"white"},onClick:()=>w(s.id,s.vat),children:"Edit "})})]},t))})]}),e.jsxs(se,{"aria-label":"Page navigation example",children:[e.jsx(D,{disabled:y<=0,onClick:Y,children:"Previous"}),q(),e.jsx(D,{disabled:Q===!0,onClick:U,children:"Next"})]}),e.jsxs(te,{alignment:"center",visible:I,scrollable:!0,size:"sm",onClose:()=>x(!1),children:[e.jsx(ae,{closeButton:!0,children:e.jsx(oe,{children:"Confirmation"})}),e.jsxs(re,{children:[e.jsx("a",{children:"Enter Driver's VAT id here"}),e.jsx("br",{}),e.jsx(B,{type:"text",placeholder:"Vat id",value:S,onChange:s=>A(s.target.value)})]}),e.jsx(le,{children:e.jsx(T,{style:{backgroundColor:"#ff4d4d",color:"white"},onClick:()=>_(),children:"Save changes"})})]})]})};export{Ce as default};
