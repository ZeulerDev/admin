import{y as Es,r as a,A as n,j as e,h as $,m as A}from"./index-D2Q_T69k.js";import{a as x}from"./axios-Cm0UX6qg.js";import{B as f}from"./config-CAsDK75y.js";import{b as Rs,a as h}from"./CContainer-B1RJImIA.js";import{C as Le,a as ee,b as se,d as te,e as y,c as ae}from"./DefaultLayout-mKkUbqwN.js";import{C as Ie}from"./CNavbar-B0gsUfYk.js";import{C as _s}from"./CFormInput-Dd1r_NAb.js";import{C as w,a as v,b as u,c as o,d as D,e as r}from"./CTable-DUaDDRgJ.js";import{c as Vs}from"./cil-view-module-CSS15w8m.js";import{C as Be,a as m}from"./CPaginationItem-CocKQ4po.js";import{C,a as k,b,c as M}from"./CModalTitle-BPG5V7aQ.js";import{C as E}from"./CModalFooter-CLXaxoDC.js";import{C as Hs}from"./CCardImage-DVFFENW9.js";import{c as Ys}from"./cil-trash-CBbKHhHb.js";import"./CFormLabel-DVQIl4BV.js";const ft=()=>{const[{user:j,token:d},i]=Es(),[$e,p]=a.useState(!1),[le,R]=a.useState(0),[re,Qs]=a.useState(0),[Ee,oe]=a.useState(!0),[g,Re]=a.useState(""),[_e,ie]=a.useState(g),[Ve,He]=a.useState(0),[F,_]=a.useState(1),[V,Os]=a.useState(),[ne,Ye]=a.useState([]),[Qe,H]=a.useState(!1);a.useState(!1);const[Oe,P]=a.useState(!1);a.useState("");const[Us,Ue]=a.useState("");a.useState("");const[qe,Ge]=a.useState([]),[N,Je]=a.useState([]),[Ke,ce]=a.useState(!1),[We,Y]=a.useState(!1),[Xe,z]=a.useState(!1),[de,ue]=a.useState(!1),[he,ge]=a.useState(""),[Ze,Q]=a.useState("All Cities"),[es,O]=a.useState("All Chains"),[qs,xe]=a.useState(""),[Gs,fe]=a.useState("All Cities"),[ye,U]=a.useState(""),[je,q]=a.useState(""),[Js,pe]=a.useState("All Chains"),[Ks,me]=a.useState("");a.useState([]);const[Ws,ss]=a.useState([]),[ts,as]=a.useState([]),[ls,Ce]=a.useState(!1),[ke,rs]=a.useState([]),[os,is]=a.useState(""),[Xs,ns]=a.useState(""),[be,cs]=a.useState({flayerId:""}),[ds,Me]=a.useState(!1),[Zs,us]=a.useState(""),[Pe,Se]=a.useState([]),[hs,G]=a.useState(!1),[gs,Ae]=a.useState(!0),[T,J]=a.useState(0),[xs,fs]=a.useState(0),[L,K]=a.useState(1),[ys,I]=a.useState(!1),[js,we]=a.useState({flayer:"",fPid:""}),[ps,ve]=a.useState("All"),[De,Fe]=a.useState("");a.useEffect(()=>{const s=setTimeout(()=>{i({type:n,payload:{status:!0,title:"Data Loading",message:"Data loading error: Timeout exceeded",color:"warning"}}),H(!1)},2e4);return j&&d&&S(0,s),()=>{clearTimeout(s)}},[j,d,_e,De]),a.useEffect(()=>{const s=setTimeout(()=>{(g.length>=3||g.length===0)&&ie(g)},500);return()=>{clearTimeout(s)}},[g]);const S=(s,t)=>{H(!0),x.get(f+`flayers/all/${s}?search=${g}&available=${De}`,{headers:{Authorization:`Bearer ${d}`}}).then(l=>{l.status===200?(Ye(l.data.list),He(l.data.count),H(!1),clearTimeout(t),l.data.list.length<20?oe(!0):l.data.list.length>19&&oe(!1),console.log(l.data.list.length)):l.status===500&&i({type:n,payload:{status:!0,title:"Category loading error",message:l.data.message}})}).catch(l=>{console.error("Error:",l)})},ms=()=>{_(F+1);const s=re+20;R(s),S(s,V)},Cs=()=>{_(F-1);const s=re-20;console.log(s),R(s),S(s,V)},ks=s=>{_(s);const t=(s-1)*20;R(t),S(t,V)},bs=()=>{const s=Math.ceil(Ve/20),t=[];for(let c=1;c<=s;c++)t.push(c);const l=Math.max(F-2,1),Z=Math.min(l+4,s);return t.slice(l-1,Z).map(c=>e.jsx(m,{active:F===c,onClick:()=>ks(c),children:c},c))},Ms=(s,t)=>{P(!0),Ge(s),ns(t)},Ps=s=>{s?(ce(!0),Ne(s)):i({type:n,payload:{status:!0,title:"Error!",message:"Flayers Product Loading error, Please Check the input fields",color:"warning"}})},Ne=s=>{s?(console.log("id",s),d&&(p(!0),x.get(f+"flayer/products/"+s,{headers:{Authorization:`Bearer ${d}`}}).then(t=>{t.status===200?(Je(t.data),p(!1)):t.status===204?(i({type:n,payload:{status:!0,title:"Flayers Product Loading error",message:"Flayers Product Loading error",color:"warning"}}),p(!1)):t.status===404?(i({type:n,payload:{status:!0,title:"Flayers Product Loading error",message:"Flayers Product Loading error",color:"warning"}}),p(!1)):t.status===500&&(i({type:n,payload:{status:!0,title:"Flayers Product Loading error",message:"Flayers Product Loading error",color:"warning"}}),p(!1))}).catch(t=>{console.error("Error:",t),p(!1)}))):i({type:n,payload:{status:!0,title:"Missing!",message:"Flayers Product Loading error",color:"warning"}})},ze=(s,t)=>{z(!0),ue(t),ge(s)},Ss=()=>{const s={status:de};console.log(he,s),j&&d&&x.patch(f+"assistant/flayer/status/"+he,s,{headers:{Authorization:`Bearer ${d}`}}).then(t=>{t.status===200?(console.log("updated"),z(!1),ue(""),ge(""),S(0,null),i({type:n,payload:{status:!0,title:"Flayer status update",message:"Flayer status updated successfully",color:"success"}})):t.status===203?i({type:n,payload:{status:!0,title:"Flayer status update error",message:t.data.message}}):t.status===204?i({type:n,payload:{status:!0,title:"Flayer status update error",message:t.data.message}}):t.status===500&&i({type:n,payload:{status:!0,title:"Flayer status update error",message:t.data.message}})}).catch(t=>{console.error(t)})},Te=(s,t,l)=>{l==="view"?s==="all"?(me(""),pe("All Chains")):(me(s),pe(t)):l==="modal"&&(s==="all"?(q(""),O("All Chains")):(q(s),O(t)))},W=(s,t)=>{t==="view"?s==="all"?(xe(""),fe("All Cities")):(xe(s),fe(s)):t==="modal"&&(s==="all"?(U(""),Q("All Cities")):(U(s),Q(s)))},As=()=>{d&&x.get(f+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${d}`}}).then(s=>{s.status===200?(ss(s.data),as(s.data)):s.status===500&&i({type:n,payload:{status:!0,title:"Chain Loading error",message:s.data.message}})}).catch(s=>{console.error("Error: ",s)})};a.useEffect(()=>{j&&d&&B(0)},[je,ye,j]);const B=(s,t)=>{Ce(!0),x.get(f+`assistant/market/locations/${s}?brand=${je}&city=${ye}`,{headers:{Authorization:`Bearer ${d}`}}).then(l=>{l.status===200?(rs(l.data.data),fs(l.data.count),Ce(!1),l.data.data.length<20?Ae(!0):l.data.data.length>19&&Ae(!1)):l.status===500&&i({type:n,payload:{status:!0,title:"Market Loading error",message:l.data.message}})}).catch(l=>{console.error("Error: ",l)})},ws=()=>{K(L+1);const s=T+20;J(s),B(s)},vs=()=>{K(L-1);const s=T-20;console.log(s),J(s),B(s)},Ds=s=>{K(s);const t=(s-1)*20;J(t),B(t)},Fs=()=>{const s=Math.ceil(xs/20),t=[];for(let c=1;c<=s;c++)t.push(c);const l=Math.max(L-2,1),Z=Math.min(l+4,s);return t.slice(l-1,Z).map(c=>e.jsx(m,{active:L===c,onClick:()=>Ds(c),children:c},c))},Ns=(s,t)=>{P(!1),Y(!0),is(t),As(),console.log(s),cs({flayerId:s})},zs=s=>{const t=be;s&&be!==null?j&&d&&(console.log("data",t),x.patch(f+"flayer/market/update/"+s,t,{headers:{Authorization:`Bearer ${d}`}}).then(l=>{l.status===200?(console.log("updated"),i({type:n,payload:{status:!0,title:"Flayer market update",message:"Flayer market updated successfully",color:"success"}}),Y(!1),P(!0)):l.status===203?i({type:n,payload:{status:!0,title:"Flayer market update error",message:l.data.message}}):l.status===204?i({type:n,payload:{status:!0,title:"Flayer market update error",message:l.data.message}}):l.status===500&&i({type:n,payload:{status:!0,title:"Flayer market update error",message:l.data.message}})}).catch(l=>{console.error(l)})):i({type:n,payload:{status:!0,title:"Missing!",message:"Flayers Loading error",color:"warning"}})},Ts=s=>{console.log("id",s),Me(!0),us(s),Ls(s)},Ls=s=>{G(!0),x.get(f+`flayer/market/assign/${s}`,{headers:{Authorization:`Bearer ${d}`}}).then(t=>{t.status===200?(t.data.length!==0&&(Se(t.data),console.log("data market")),G(!1)):t.status===500&&i({type:n,payload:{status:!0,title:"Market Loading error",message:t.data.message}})}).catch(t=>{console.error("Error: ",t)})},Is=(s,t)=>{I(!0),we({flayer:s,fPid:t})},Bs=s=>{console.log("data",s),s?j&&d&&x.delete(f+`assistant/flayer/product/${s.fPid}?fid=${s.flayer}`,{headers:{Authorization:`Bearer ${d}`}}).then(t=>{t.status===200?(i({type:n,payload:{status:!0,title:"Flayer Product delete",message:"Flayer Product delete success",color:"success"}}),I(!1),Ne(s.flayer),we({flayer:"",fPid:""})):t.status===204?i({type:n,payload:{status:!0,title:"Flayer Product delete error",message:t.data.message,color:"warning"}}):t.status===500&&i({type:n,payload:{status:!0,title:"Flayer Product delete error",message:t.data.message,color:"warning"}})}).catch(t=>{i({type:n,payload:{status:!0,title:"Flayer Product delete error",message:res.data.message,color:"warning"}})}):i({type:n,payload:{status:!0,title:"Flayer Product delete error",message:"Flayer Product delete error",color:"warning"}})},X=s=>{s==="all"?(Fe(""),ve("All")):(Fe(s),ve(s))};return e.jsxs(Rs,{children:[e.jsx(Le,{style:{marginLeft:"75%"},color:"secondary",children:"Filter by"}),e.jsxs(ee,{style:{marginLeft:"2%",width:"17%",marginRight:"5px",backgroundColor:"#ff4d4d"},children:[e.jsx(se,{style:{color:"white"},children:ps}),e.jsxs(te,{children:[e.jsx(y,{onClick:()=>X("all"),children:"All"}),e.jsx(y,{onClick:()=>X("yes"),children:"Yes"}),e.jsx(y,{onClick:()=>X("no"),children:"No"})]})]}),e.jsx(Ie,{style:{marginTop:"1%"},className:"bg-body-tertiary",children:e.jsx(_s,{type:"text",placeholder:"Search by Id, end date and retailer ",style:{width:450,marginRight:"30%"},value:g,onChange:s=>Re(s.target.value)})}),Qe?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx($,{style:{marginTop:"15%"}})}):e.jsxs(w,{children:[e.jsx(v,{children:e.jsxs(u,{children:[e.jsx(o,{scope:"col",children:"#"}),e.jsx(o,{scope:"col",children:"Id"}),e.jsx(o,{scope:"col",children:"End Date"}),e.jsx(o,{scope:"col",children:"Retailer"}),e.jsx(o,{scope:"col",children:"Market(s) Availability"}),e.jsx(o,{scope:"col",children:"Markets"}),e.jsx(o,{scope:"col",children:"Products"}),e.jsx(o,{scope:"col",children:"Assigned Market"}),e.jsx(o,{scope:"col",children:"Status"})]})}),e.jsx(D,{children:ne.length===0?e.jsx(u,{children:e.jsx(r,{colSpan:"8",style:{textAlign:"center",backgroundColor:"white"},children:e.jsx("h6",{style:{marginTop:"1%"},children:"No Data"})})}):ne.map((s,t)=>e.jsxs(u,{children:[e.jsx(r,{children:le+t+1}),e.jsx(r,{children:s.flayer_id}),e.jsx(r,{children:s.endDate}),e.jsx(r,{children:s.retailer}),e.jsxs(r,{children:["  ",s.stores.some(l=>l.isLinked)?"Yes":"No"]}),e.jsx(r,{children:e.jsx(h,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>{Ms(s.stores,s._id)},children:e.jsx(A,{icon:ae,size:"lg",style:{color:"white"}})})}),e.jsx(r,{children:e.jsx(h,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>{Ps(s._id)},children:e.jsx(A,{icon:Vs,size:"lg",style:{color:"white"}})})}),e.jsx(r,{children:e.jsx(h,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>{Ts(s._id)},children:e.jsx(A,{icon:ae,size:"lg",style:{color:"white"}})})}),e.jsx(r,{children:s.status===!0?e.jsx(h,{size:"sm",onClick:()=>{ze(s._id,!1)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Deactivate"}):e.jsx(h,{size:"sm",onClick:()=>{ze(s._id,!0)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Activate"})})]},t))})]}),e.jsxs(Be,{"aria-label":"Page navigation example",children:[e.jsx(m,{disabled:le<=0,onClick:Cs,children:"Previous"}),bs(),e.jsx(m,{disabled:Ee===!0,onClick:ms,children:"Next"})]}),e.jsxs(C,{alignment:"center",visible:ys,scrollable:!0,size:"sm",onClose:()=>I(!1),children:[e.jsx(k,{closeButton:!1,children:e.jsx(b,{children:"Confirmation"})}),e.jsxs(M,{children:[e.jsx("a",{children:"Are you sure you want to delete this flayer product?"}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[e.jsx(h,{onClick:()=>Bs(js),style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),e.jsx(h,{onClick:()=>I(!1),style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]}),e.jsxs(C,{alignment:"center",visible:ds,scrollable:!0,size:"lg",onClose:()=>{Se([]),Me(!1)},children:[e.jsx(k,{closeButton:!0,children:e.jsx(b,{children:"All Assign Markets details"})}),e.jsx(M,{children:hs?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx($,{style:{marginTop:"15%"}})}):e.jsxs(w,{children:[e.jsx(v,{children:e.jsxs(u,{children:[e.jsx(o,{scope:"col",children:"#"}),e.jsx(o,{scope:"col",children:"Chain Name"}),e.jsx(o,{scope:"col",children:"Address"}),e.jsx(o,{scope:"col",children:"City"})]})}),e.jsx(D,{children:Pe.length===0?e.jsx(u,{children:e.jsx(r,{colSpan:"4",style:{textAlign:"center",backgroundColor:"white"},children:e.jsx("h6",{style:{marginTop:"1%"},children:"No Data"})})}):Pe.map((s,t)=>e.jsxs(u,{children:[e.jsx(r,{children:t+1}),e.jsx(r,{children:s.chain.name}),e.jsx(r,{children:s.address}),e.jsx(r,{children:s.city})]},t))})]})}),e.jsx(E,{})]}),e.jsxs(C,{alignment:"center",visible:Oe,scrollable:!0,size:"lg",onClose:()=>{P(!1),Ue("")},children:[e.jsx(k,{closeButton:!0,children:e.jsx(b,{children:"Markets"})}),e.jsx(M,{children:e.jsxs(w,{children:[e.jsx(v,{children:e.jsxs(u,{children:[e.jsx(o,{scope:"col",children:"#"}),e.jsx(o,{scope:"col",children:"Name"}),e.jsx(o,{scope:"col",children:"Market"})]})}),e.jsx(D,{children:qe.map((s,t)=>e.jsxs(u,{children:[e.jsx(r,{children:t+1}),e.jsx(r,{children:s.address}),e.jsx(r,{children:e.jsx(h,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>{Ns(s._id,s.market)},children:e.jsx(A,{icon:ae,size:"lg",style:{color:"white"}})})})]},t))})]})}),e.jsx(E,{})]}),e.jsxs(C,{visible:Ke,scrollable:!0,size:"xl",onClose:()=>ce(!1),children:[e.jsx(k,{closeButton:!0,children:e.jsx(b,{children:"Flayers Products Information"})}),e.jsx(M,{style:{overflowY:"auto",maxHeight:"70vh",display:"flex",justifyContent:"center"},children:$e?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx($,{style:{marginTop:"15%"}})}):e.jsxs(w,{children:[e.jsx(v,{children:e.jsxs(u,{children:[e.jsx(o,{scope:"col",children:"#"}),e.jsx(o,{scope:"col",children:"Photo"}),e.jsx(o,{scope:"col",children:"Name"}),e.jsx(o,{scope:"col",children:"Price"}),e.jsx(o,{scope:"col",children:"Description"}),e.jsx(o,{scope:"col",children:"Action"})]})}),e.jsx(D,{children:N.length===0?e.jsx(u,{children:e.jsx(r,{colSpan:"5",style:{textAlign:"center",backgroundColor:"white"},children:e.jsx("h6",{style:{marginTop:"1%"},children:"No Data"})})}):N==null?void 0:N.map((s,t)=>e.jsxs(u,{children:[e.jsx(r,{children:t+1}),e.jsx(r,{children:e.jsx(Hs,{style:{width:50,height:50,borderRadius:10},src:"https://api.zeuler.com/image/"+s.image})}),e.jsx(r,{children:s.name}),e.jsx(r,{children:s.price}),e.jsx(r,{children:s.description}),e.jsx(r,{children:e.jsx(h,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>{Is(s.flayer,s._id)},children:e.jsx(A,{icon:Ys,size:"lg",style:{color:"white"}})})})]},t))})]})}),e.jsx(E,{})]}),e.jsxs(C,{alignment:"center",visible:Xe,scrollable:!0,size:"sm",onClose:()=>z(!1),children:[e.jsx(k,{closeButton:!1,children:e.jsx(b,{children:"Confirmation"})}),e.jsxs(M,{children:[e.jsxs("a",{children:["Are you sure you want to ",de?"activate":"deactivate"," this flayer?"]}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[e.jsx(h,{onClick:()=>{Ss()},style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),e.jsx(h,{onClick:()=>{z(!1)},style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]}),e.jsxs(C,{visible:We,scrollable:!0,size:"xl",onClose:()=>{Y(!1),P(!0),O("All Chains"),Q("All Cities"),q(""),U("")},children:[e.jsx(k,{closeButton:!0,children:e.jsx(b,{children:"Market assign view"})}),e.jsxs(M,{children:[e.jsx(Le,{style:{marginLeft:"54%"},color:"secondary",children:"Filter by"}),e.jsxs(ee,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(se,{style:{color:"white"},children:Ze}),e.jsxs(te,{children:[e.jsx(y,{onClick:()=>W("all","modal"),children:"All"}),e.jsx(y,{onClick:()=>W("Milano","modal"),children:"Milano"}),e.jsx(y,{onClick:()=>W("Napoli","modal"),children:"Napoli"})]})]}),e.jsxs(ee,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(se,{style:{color:"white"},children:es}),e.jsxs(te,{children:[e.jsx(y,{onClick:()=>Te("all",null,"modal"),children:"All"}),ts.map((s,t)=>e.jsx(y,{onClick:()=>Te(s.id,s.name,"modal"),children:s.name},t))]})]}),e.jsx(Ie,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),ls?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx($,{style:{marginTop:"15%"}})}):e.jsxs(w,{children:[e.jsx(v,{children:e.jsxs(u,{children:[e.jsx(o,{scope:"col",children:"#"}),e.jsx(o,{scope:"col",children:"Name"}),e.jsx(o,{scope:"col",children:"Address"}),e.jsx(o,{scope:"col",children:"City"}),e.jsx(o,{scope:"col",children:"Assign Market"})]})}),e.jsx(D,{children:ke.length===0?e.jsx(u,{children:e.jsx(r,{colSpan:"5",style:{textAlign:"center",backgroundColor:"white"},children:e.jsx("h6",{style:{marginTop:"1%"},children:"No Data"})})}):ke.map((s,t)=>e.jsxs(u,{children:[e.jsx(r,{children:T+t+1}),e.jsx(r,{children:s.chain.name}),e.jsx(r,{children:s.address}),e.jsx(r,{children:s.city}),e.jsx(r,{children:os===s._id?e.jsx(h,{size:"sm",onClick:()=>{},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Assigned"}):e.jsx(h,{size:"sm",onClick:()=>{zs(s._id)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Add"})})]},t))})]}),e.jsx(E,{children:e.jsxs(Be,{"aria-label":"Page navigation example",children:[e.jsx(m,{disabled:T<=0,onClick:vs,children:"Previous"}),Fs(),e.jsx(m,{disabled:gs===!0,onClick:ws,children:"Next"})]})})]})]})]})};export{ft as default};
