import{y as ws,r as a,A as n,j as e,h as N,m as T}from"./index-D8W7eoM5.js";import{a as x}from"./axios-Cm0UX6qg.js";import{B as f}from"./config-HOLfLxHr.js";import{b as As,a as u}from"./CContainer-EQGOw-z2.js";import{C as Ce}from"./CNavbar-bbh6w27I.js";import{C as vs}from"./CFormInput-uSeXsJ0R.js";import{C as k,a as M,b as h,c as r,d as b,e as o}from"./CTable-jf2tizix.js";import{c as X,C as Ds,a as ke,b as Me,d as be,e as S}from"./DefaultLayout-CwPF-zRq.js";import{c as Fs}from"./cil-view-module-CSS15w8m.js";import{C as Se,a as p}from"./CPaginationItem-D4fVq3gA.js";import{C as P,a as w,b as A,c as v}from"./CModalTitle-DXUyO86j.js";import{C as B}from"./CModalFooter-VrnOxKGp.js";import{C as zs}from"./CCardImage-DACW3cOe.js";import"./CFormLabel-Dh9Dcp0z.js";const tt=()=>{const[{user:j,token:d},i]=ws(),[Pe,y]=a.useState(!1),[Z,E]=a.useState(0),[ee,Is]=a.useState(0),[we,se]=a.useState(!0),[g,Ae]=a.useState(""),[ve,te]=a.useState(g),[De,Fe]=a.useState(0),[D,$]=a.useState(1),[_,Ls]=a.useState(),[ze,Ie]=a.useState([]),[Le,R]=a.useState(!1);a.useState(!1);const[Ne,m]=a.useState(!1);a.useState("");const[Ns,Te]=a.useState("");a.useState("");const[Be,Ee]=a.useState([]),[V,$e]=a.useState([]),[_e,ae]=a.useState(!1),[Re,H]=a.useState(!1),[Ve,F]=a.useState(!1),[le,re]=a.useState(!1),[oe,ie]=a.useState(""),[He,Q]=a.useState("All Cities"),[Qe,O]=a.useState("All Chains"),[Ts,ne]=a.useState(""),[Bs,ce]=a.useState("All Cities"),[de,Y]=a.useState(""),[ue,U]=a.useState(""),[Es,he]=a.useState("All Chains"),[$s,ge]=a.useState("");a.useState([]);const[_s,Oe]=a.useState([]),[Ye,Ue]=a.useState([]),[qe,xe]=a.useState(!1),[Ge,Je]=a.useState([]),[Ke,We]=a.useState(""),[Rs,Xe]=a.useState(""),[fe,Ze]=a.useState({flayerId:""}),[es,je]=a.useState(!1),[Vs,ss]=a.useState(""),[ts,as]=a.useState([]),[ls,q]=a.useState(!1),[rs,ye]=a.useState(!0),[z,G]=a.useState(0),[os,is]=a.useState(0),[I,J]=a.useState(1);a.useEffect(()=>{const s=setTimeout(()=>{i({type:n,payload:{status:!0,title:"Data Loading",message:"Data loading error: Timeout exceeded",color:"warning"}}),R(!1)},2e4);return j&&d&&C(0,s),()=>{clearTimeout(s)}},[j,d,ve]),a.useEffect(()=>{const s=setTimeout(()=>{(g.length>=3||g.length===0)&&te(g)},500);return()=>{clearTimeout(s)}},[g]);const C=(s,t)=>{R(!0),x.get(f+`flayers/all/${s}?search=${g}`,{headers:{Authorization:`Bearer ${d}`}}).then(l=>{l.status===200?(Ie(l.data.list),Fe(l.data.count),R(!1),clearTimeout(t),l.data.list.length<20?se(!0):l.data.list.length>19&&se(!1),console.log(l.data.list.length)):l.status===500&&i({type:n,payload:{status:!0,title:"Category loading error",message:l.data.message}})}).catch(l=>{console.error("Error:",l)})},ns=()=>{$(D+1);const s=ee+20;E(s),C(s,_)},cs=()=>{$(D-1);const s=ee-20;console.log(s),E(s),C(s,_)},ds=s=>{$(s);const t=(s-1)*20;E(t),C(t,_)},us=()=>{const s=Math.ceil(De/20),t=[];for(let c=1;c<=s;c++)t.push(c);const l=Math.max(D-2,1),W=Math.min(l+4,s);return t.slice(l-1,W).map(c=>e.jsx(p,{active:D===c,onClick:()=>ds(c),children:c},c))},hs=(s,t)=>{m(!0),Ee(s),Xe(t)},gs=s=>{s?(ae(!0),xs(s)):i({type:n,payload:{status:!0,title:"Error!",message:"Flayers Product Loading error, Please Check the input fields",color:"warning"}})},xs=s=>{s?(console.log("id",s),d&&(y(!0),x.get(f+"flayer/products/"+s,{headers:{Authorization:`Bearer ${d}`}}).then(t=>{t.status===200?($e(t.data),y(!1)):t.status===204?(i({type:n,payload:{status:!0,title:"Flayers Product Loading error",message:"Flayers Product Loading error",color:"warning"}}),y(!1)):t.status===404?(i({type:n,payload:{status:!0,title:"Flayers Product Loading error",message:"Flayers Product Loading error",color:"warning"}}),y(!1)):t.status===500&&(i({type:n,payload:{status:!0,title:"Flayers Product Loading error",message:"Flayers Product Loading error",color:"warning"}}),y(!1))}).catch(t=>{console.error("Error:",t),y(!1)}))):i({type:n,payload:{status:!0,title:"Missing!",message:"Flayers Product Loading error",color:"warning"}})},pe=(s,t)=>{F(!0),re(t),ie(s)},fs=()=>{const s={status:le};console.log(oe,s),j&&d&&x.patch(f+"assistant/flayer/status/"+oe,s,{headers:{Authorization:`Bearer ${d}`}}).then(t=>{t.status===200?(console.log("updated"),F(!1),re(""),ie(""),C(0,null),i({type:n,payload:{status:!0,title:"Flayer status update",message:"Flayer status updated successfully",color:"success"}})):t.status===203?i({type:n,payload:{status:!0,title:"Flayer status update error",message:t.data.message}}):t.status===204?i({type:n,payload:{status:!0,title:"Flayer status update error",message:t.data.message}}):t.status===500&&i({type:n,payload:{status:!0,title:"Flayer status update error",message:t.data.message}})}).catch(t=>{console.error(t)})},me=(s,t,l)=>{l==="view"?s==="all"?(ge(""),he("All Chains")):(ge(s),he(t)):l==="modal"&&(s==="all"?(U(""),O("All Chains")):(U(s),O(t)))},K=(s,t)=>{t==="view"?s==="all"?(ne(""),ce("All Cities")):(ne(s),ce(s)):t==="modal"&&(s==="all"?(Y(""),Q("All Cities")):(Y(s),Q(s)))},js=()=>{d&&x.get(f+"assistant/market/chains/all",{headers:{Authorization:`Bearer ${d}`}}).then(s=>{s.status===200?(Oe(s.data),Ue(s.data)):s.status===500&&i({type:n,payload:{status:!0,title:"Chain Loading error",message:s.data.message}})}).catch(s=>{console.error("Error: ",s)})};a.useEffect(()=>{j&&d&&L(0)},[ue,de,j]);const L=(s,t)=>{xe(!0),x.get(f+`assistant/market/locations/${s}?brand=${ue}&city=${de}`,{headers:{Authorization:`Bearer ${d}`}}).then(l=>{l.status===200?(Je(l.data.data),is(l.data.count),xe(!1),l.data.data.length<20?ye(!0):l.data.data.length>19&&ye(!1)):l.status===500&&i({type:n,payload:{status:!0,title:"Market Loading error",message:l.data.message}})}).catch(l=>{console.error("Error: ",l)})},ys=()=>{J(I+1);const s=z+20;G(s),L(s)},ps=()=>{J(I-1);const s=z-20;console.log(s),G(s),L(s)},ms=s=>{J(s);const t=(s-1)*20;G(t),L(t)},Cs=()=>{const s=Math.ceil(os/20),t=[];for(let c=1;c<=s;c++)t.push(c);const l=Math.max(I-2,1),W=Math.min(l+4,s);return t.slice(l-1,W).map(c=>e.jsx(p,{active:I===c,onClick:()=>ms(c),children:c},c))},ks=(s,t)=>{m(!1),H(!0),We(t),js(),console.log(s),Ze({flayerId:s})},Ms=s=>{const t=fe;s&&fe!==null?j&&d&&(console.log("data",t),x.patch(f+"flayer/market/update/"+s,t,{headers:{Authorization:`Bearer ${d}`}}).then(l=>{l.status===200?(console.log("updated"),i({type:n,payload:{status:!0,title:"Flayer market update",message:"Flayer market updated successfully",color:"success"}}),H(!1),m(!0)):l.status===203?i({type:n,payload:{status:!0,title:"Flayer market update error",message:l.data.message}}):l.status===204?i({type:n,payload:{status:!0,title:"Flayer market update error",message:l.data.message}}):l.status===500&&i({type:n,payload:{status:!0,title:"Flayer market update error",message:l.data.message}})}).catch(l=>{console.error(l)})):i({type:n,payload:{status:!0,title:"Missing!",message:"Flayers Loading error",color:"warning"}})},bs=s=>{console.log("id",s),je(!0),ss(s),Ss(s)},Ss=s=>{q(!0),x.get(f+`flayer/market/assign/${s}`,{headers:{Authorization:`Bearer ${d}`}}).then(t=>{t.status===200?t.data.length!==0?(as(t.data),console.log("data market"),q(!1)):(q(!1),i({type:n,payload:{status:!0,title:"Market Loading",message:"No market assigned to this flayer",color:"info"}})):t.status===500&&i({type:n,payload:{status:!0,title:"Market Loading error",message:t.data.message}})}).catch(t=>{console.error("Error: ",t)})};return e.jsxs(As,{children:[e.jsx(Ce,{style:{marginTop:"1%"},className:"bg-body-tertiary",children:e.jsx(vs,{type:"text",placeholder:"Search by Id, end date and retailer ",style:{width:450,marginRight:"30%"},value:g,onChange:s=>Ae(s.target.value)})}),Le?e.jsx(N,{}):e.jsxs(k,{children:[e.jsx(M,{children:e.jsxs(h,{children:[e.jsx(r,{scope:"col",children:"#"}),e.jsx(r,{scope:"col",children:"Id"}),e.jsx(r,{scope:"col",children:"End Date"}),e.jsx(r,{scope:"col",children:"Retailer"}),e.jsx(r,{scope:"col",children:"Status"}),e.jsx(r,{scope:"col",children:"Markets"}),e.jsx(r,{scope:"col",children:"Products"}),e.jsx(r,{scope:"col",children:"Assigned Market"})]})}),e.jsx(b,{children:ze.map((s,t)=>e.jsxs(h,{children:[e.jsx(o,{children:Z+t+1}),e.jsx(o,{children:s.flayer_id}),e.jsx(o,{children:s.endDate}),e.jsx(o,{children:s.retailer}),e.jsx(o,{children:s.status===!0?e.jsx(u,{size:"sm",onClick:()=>{pe(s._id,!1)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Deactivate"}):e.jsx(u,{size:"sm",onClick:()=>{pe(s._id,!0)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Activate"})}),e.jsx(o,{children:e.jsx(u,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>{hs(s.stores,s._id)},children:e.jsx(T,{icon:X,size:"lg",style:{color:"white"}})})}),e.jsx(o,{children:e.jsx(u,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>{gs(s._id)},children:e.jsx(T,{icon:Fs,size:"lg",style:{color:"white"}})})}),e.jsx(o,{children:e.jsx(u,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>{bs(s._id)},children:e.jsx(T,{icon:X,size:"lg",style:{color:"white"}})})})]},t))})]}),e.jsxs(Se,{"aria-label":"Page navigation example",children:[e.jsx(p,{disabled:Z<=0,onClick:cs,children:"Previous"}),us(),e.jsx(p,{disabled:we===!0,onClick:ns,children:"Next"})]}),e.jsxs(P,{alignment:"center",visible:es,scrollable:!0,size:"lg",onClose:()=>je(!1),children:[e.jsx(w,{closeButton:!0,children:e.jsx(A,{children:"All Assign Markets details"})}),e.jsx(v,{children:ls?e.jsx(N,{}):e.jsxs(k,{children:[e.jsx(M,{children:e.jsxs(h,{children:[e.jsx(r,{scope:"col",children:"#"}),e.jsx(r,{scope:"col",children:"Chain Name"}),e.jsx(r,{scope:"col",children:"Address"}),e.jsx(r,{scope:"col",children:"City"})]})}),e.jsx(b,{children:ts.map((s,t)=>e.jsxs(h,{children:[e.jsx(o,{children:t+1}),e.jsx(o,{children:s.chain.name}),e.jsx(o,{children:s.address}),e.jsx(o,{children:s.city})]},t))})]})}),e.jsx(B,{})]}),e.jsxs(P,{alignment:"center",visible:Ne,scrollable:!0,size:"lg",onClose:()=>{m(!1),Te("")},children:[e.jsx(w,{closeButton:!0,children:e.jsx(A,{children:"Markets"})}),e.jsx(v,{children:e.jsxs(k,{children:[e.jsx(M,{children:e.jsxs(h,{children:[e.jsx(r,{scope:"col",children:"#"}),e.jsx(r,{scope:"col",children:"Name"}),e.jsx(r,{scope:"col",children:"Market"})]})}),e.jsx(b,{children:Be.map((s,t)=>e.jsxs(h,{children:[e.jsx(o,{children:t+1}),e.jsx(o,{children:s.address}),e.jsx(o,{children:e.jsx(u,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>{ks(s._id,s.market)},children:e.jsx(T,{icon:X,size:"lg",style:{color:"white"}})})})]},t))})]})}),e.jsx(B,{})]}),e.jsxs(P,{visible:_e,scrollable:!0,size:"xl",onClose:()=>ae(!1),children:[e.jsx(w,{closeButton:!0,children:e.jsx(A,{children:"Flayers Products Information"})}),e.jsx(v,{style:{overflowY:"auto",maxHeight:"70vh",display:"flex",justifyContent:"center"},children:Pe?e.jsx(N,{}):e.jsxs(k,{children:[e.jsx(M,{children:e.jsxs(h,{children:[e.jsx(r,{scope:"col",children:"#"}),e.jsx(r,{scope:"col",children:"Photo"}),e.jsx(r,{scope:"col",children:"Name"}),e.jsx(r,{scope:"col",children:"Price"}),e.jsx(r,{scope:"col",children:"Description"})]})}),e.jsx(b,{children:V==null?void 0:V.map((s,t)=>e.jsxs(h,{children:[e.jsx(o,{children:t+1}),e.jsx(o,{children:e.jsx(zs,{style:{width:50,height:50,borderRadius:10},src:"https://api.zeuler.com/image/"+s.image})}),e.jsx(o,{children:s.name}),e.jsx(o,{children:s.price}),e.jsx(o,{children:s.description})]},t))})]})}),e.jsx(B,{})]}),e.jsxs(P,{alignment:"center",visible:Ve,scrollable:!0,size:"sm",onClose:()=>F(!1),children:[e.jsx(w,{closeButton:!1,children:e.jsx(A,{children:"Confirmation"})}),e.jsxs(v,{children:[e.jsxs("a",{children:["Are you sure you want to ",le?"activate":"deactivate"," this flayer?"]}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[e.jsx(u,{onClick:()=>{fs()},style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),e.jsx(u,{onClick:()=>{F(!1)},style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]}),e.jsxs(P,{visible:Re,scrollable:!0,size:"xl",onClose:()=>{H(!1),m(!0),O("All Chains"),Q("All Cities"),U(""),Y("")},children:[e.jsx(w,{closeButton:!0,children:e.jsx(A,{children:"Market assign view"})}),e.jsxs(v,{children:[e.jsx(Ds,{style:{marginLeft:"54%"},color:"secondary",children:"Filter by"}),e.jsxs(ke,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(Me,{style:{color:"white"},children:He}),e.jsxs(be,{children:[e.jsx(S,{onClick:()=>K("all","modal"),children:"All"}),e.jsx(S,{onClick:()=>K("Milano","modal"),children:"Milano"}),e.jsx(S,{onClick:()=>K("Napoli","modal"),children:"Napoli"})]})]}),e.jsxs(ke,{style:{marginLeft:"2%",width:"18%",backgroundColor:"#ff4d4d",color:"white"},children:[e.jsx(Me,{style:{color:"white"},children:Qe}),e.jsxs(be,{children:[e.jsx(S,{onClick:()=>me("all",null,"modal"),children:"All"}),Ye.map((s,t)=>e.jsx(S,{onClick:()=>me(s.id,s.name,"modal"),children:s.name},t))]})]}),e.jsx(Ce,{style:{marginTop:"1%"},className:"bg-body-tertiary"}),qe?e.jsx(N,{}):e.jsxs(k,{children:[e.jsx(M,{children:e.jsxs(h,{children:[e.jsx(r,{scope:"col",children:"#"}),e.jsx(r,{scope:"col",children:"Name"}),e.jsx(r,{scope:"col",children:"Address"}),e.jsx(r,{scope:"col",children:"City"}),e.jsx(r,{scope:"col",children:"Assign Market"})]})}),e.jsx(b,{children:Ge.map((s,t)=>e.jsxs(h,{children:[e.jsx(o,{children:z+t+1}),e.jsx(o,{children:s.chain.name}),e.jsx(o,{children:s.address}),e.jsx(o,{children:s.city}),e.jsx(o,{children:Ke===s._id?e.jsx(u,{size:"sm",onClick:()=>{},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Assigned"}):e.jsx(u,{size:"sm",onClick:()=>{Ms(s._id)},style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Add"})})]},t))})]}),e.jsx(B,{children:e.jsxs(Se,{"aria-label":"Page navigation example",children:[e.jsx(p,{disabled:z<=0,onClick:ps,children:"Previous"}),Cs(),e.jsx(p,{disabled:rs===!0,onClick:ys,children:"Next"})]})})]})]})]})};export{tt as default};
