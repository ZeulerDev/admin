import{r as s,y as Pe,A as i,j as e,L as b,h as Se,m as P}from"./index-CGFmEmA4.js";import{a as S}from"./axios-Cm0UX6qg.js";/* empty css               */import{B as k}from"./config-HOLfLxHr.js";import{b as ke,a as c}from"./CContainer-r0pJjvK6.js";import{C as De}from"./CNavbar-C3RG89Yj.js";import{C as g}from"./CFormInput-8jlSQpBZ.js";import{C as ve,a as we,b as le,c as d,d as Ae,e as u}from"./CTable-BQRWKKju.js";import{c as Le}from"./cil-pencil-m516yCOw.js";import{c as Ee}from"./cil-trash-CBbKHhHb.js";import{C as Te,a as z}from"./CPaginationItem-Cdou-5-K.js";import{C as N,a as M,b as B,c as I}from"./CModalTitle-CY-uduHD.js";import{C as D}from"./CCol-CfBi78X7.js";import"./CFormLabel-ChXi7o7q.js";import"./DefaultLayout-c2mwkARU.js";var re=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M245.151,168a88,88,0,1,0,88,88A88.1,88.1,0,0,0,245.151,168Zm0,144a56,56,0,1,1,56-56A56.063,56.063,0,0,1,245.151,312Z' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M464.7,322.319l-31.77-26.153a193.081,193.081,0,0,0,0-80.332l31.77-26.153a19.941,19.941,0,0,0,4.606-25.439l-32.612-56.483a19.936,19.936,0,0,0-24.337-8.73l-38.561,14.447a192.038,192.038,0,0,0-69.54-40.192L297.49,32.713A19.936,19.936,0,0,0,277.762,16H212.54a19.937,19.937,0,0,0-19.728,16.712L186.05,73.284a192.03,192.03,0,0,0-69.54,40.192L77.945,99.027a19.937,19.937,0,0,0-24.334,8.731L21,164.245a19.94,19.94,0,0,0,4.61,25.438l31.767,26.151a193.081,193.081,0,0,0,0,80.332l-31.77,26.153A19.942,19.942,0,0,0,21,347.758l32.612,56.483a19.937,19.937,0,0,0,24.337,8.73l38.562-14.447a192.03,192.03,0,0,0,69.54,40.192l6.762,40.571A19.937,19.937,0,0,0,212.54,496h65.222a19.936,19.936,0,0,0,19.728-16.712l6.763-40.572a192.038,192.038,0,0,0,69.54-40.192l38.564,14.449a19.938,19.938,0,0,0,24.334-8.731L469.3,347.755A19.939,19.939,0,0,0,464.7,322.319Zm-50.636,57.12-48.109-18.024-7.285,7.334a159.955,159.955,0,0,1-72.625,41.973l-10,2.636L267.6,464h-44.89l-8.442-50.642-10-2.636a159.955,159.955,0,0,1-72.625-41.973l-7.285-7.334L76.241,379.439,53.8,340.562l39.629-32.624-2.7-9.973a160.9,160.9,0,0,1,0-83.93l2.7-9.972L53.8,171.439l22.446-38.878,48.109,18.024,7.285-7.334a159.955,159.955,0,0,1,72.625-41.973l10-2.636L222.706,48H267.6l8.442,50.642,10,2.636a159.955,159.955,0,0,1,72.625,41.973l7.285,7.334,48.109-18.024,22.447,38.877-39.629,32.625,2.7,9.972a160.9,160.9,0,0,1,0,83.93l-2.7,9.973,39.629,32.623Z' class='ci-primary'/>"];const Fe=()=>{var ae,oe;const[_,f]=s.useState(!1),[$,x]=s.useState(!1),[{user:j,token:m},r]=Pe(),[v,w]=s.useState([]),[ie,A]=s.useState(!1);s.useState(""),s.useState(""),s.useState("");const[L,ne]=s.useState(""),[R,V]=s.useState(!1),[H,Z]=s.useState("");s.useState("All Cities"),s.useState("All Market Groups"),s.useState("All Chains"),s.useState([]),s.useState([]);const[U,E]=s.useState(!1),[h,ce]=s.useState([]),[Q,Y]=s.useState(),[q,F]=s.useState(),[G,J]=s.useState(),[K,W]=s.useState();s.useState(""),s.useState(""),s.useState(!1);const[de,X]=s.useState(!0),[ue,me]=s.useState(0),[y,O]=s.useState(1),[T,ee]=s.useState(0),[he,te]=s.useState("");s.useEffect(()=>{const t=setTimeout(()=>{r({type:i,payload:{status:!0,title:"Data Loading",message:"Data loading error: Timeout exceeded",color:"warning"}}),A(!1)},2e4);return C(0,t),()=>{clearTimeout(t)}},[L]);const C=(t,o)=>{if(j&&m){A(!0);let a=k+`promotion/all/${t}?name=${L}`;S.get(a,{headers:{Authorization:`Bearer ${m}`}}).then(l=>{l.status===200?(w(l.data.list),console.log("result",l.data.list),me(l.data.count),A(!1),clearTimeout(o),l.data.list.length<20?(X(!0),console.log("ok")):l.data.list.length>19&&X(!1)):l.status===500&&r({type:i,payload:{status:!0,title:"Error",message:l.data.message,color:"warning"}})}).catch(l=>{console.error("Error:",l)})}},pe=()=>{O(y+1);const t=T+50;ee(t),C(t,!0)},ge=()=>{O(y-1);const t=T-50;console.log(t),ee(t),C(t,!1)},fe=()=>{const t=Math.ceil(ue/20),o=[];for(let n=1;n<=t;n++)o.push(n);const a=Math.max(y-2,1),l=Math.min(a+4,t);return o.slice(a-1,l).map(n=>e.jsx(z,{active:y===n,onClick:()=>handlePages(n),children:n},n))},se=(t,o)=>{f(!_),V(o),Z(t)},xe=()=>{const t={status:R};console.log(H,t),j&&m&&S.patch(k+"promotion/update/status/"+H,t,{headers:{Authorization:`Bearer ${m}`}}).then(o=>{if(o.status===200){console.log("updated"),f(!1),V(""),Z("");const a=o.data,l=v.map(p=>p.id===a.id?(console.log("update obj"),a):p);w([...l]),r({type:i,payload:{status:!0,title:"Promotion status update",message:"Promotion status updated successfully",color:"success"}})}else o.status===404?r({type:i,payload:{status:!0,title:"Promotion status update error",message:o.data.message}}):o.status===400?r({type:i,payload:{status:!0,title:"Promotion status update error",message:o.data.message}}):o.status===500&&r({type:i,payload:{status:!0,title:"Picker status update error",message:o.data.message}})}).catch(o=>{console.error(o)})},je=t=>{console.log(t),ce(t),E(!U),Y(t.name),F(t.startDate),J(t.endDate),W(t.promo_id)},ye=()=>{if(Q&&q&&G&&K){const t={name:Q,startDate:q,endDate:G,promo_id:K},o=h._id;console.log(t,o),m&&j&&m&&S.put(k+"promotion/update/"+o,t,{headers:{Authorization:`Bearer ${m}`}}).then(a=>{if(a.status===200){console.log(a.data),E(!1);const l=a.data,p=v.map(n=>n.id===l.id?(console.log("update obj"),l):n);w([...p]),r({type:i,payload:{status:!0,title:"Promotion update",message:"Promotion details updated successfully",color:"success"}})}else a.status===404?r({type:i,payload:{status:!0,title:"Promotion update error",message:"Missing required fields",color:"warning"}}):a.status===400?r({type:i,payload:{status:!0,title:"Promotion update error",message:a.data.message,color:"warning"}}):a.status===500&&r({type:i,payload:{status:!0,title:"Promotion update error",message:a.data.message,color:"warning"}})}).catch(a=>{console.error("Error:",a)})}else r({type:i,payload:{status:!0,title:"Error!",message:"Picker update error, Please Check the input fields",color:"warning"}})},Ce=t=>{x(!$),te(t)},be=t=>{const o={disabled:!0};console.log(t,o),j&&m&&S.patch(k+"promotion/delete/"+t,o,{headers:{Authorization:`Bearer ${m}`}}).then(a=>{a.status===200?(console.log("updated"),x(!1),te(""),C(),r({type:i,payload:{status:!0,title:"Promotion Delete",message:"Promotion delete successfully",color:"success"}})):a.status===404?r({type:i,payload:{status:!0,title:"Promotion delete error",message:a.data.message}}):a.status===400?r({type:i,payload:{status:!0,title:"Promotion delete error",message:a.data.message}}):a.status===500&&r({type:i,payload:{status:!0,title:"Picker delete error",message:a.data.message}})}).catch(a=>{console.error(a)})};return e.jsxs(ke,{children:[e.jsx(b,{to:"/promotions/add/promotion",className:"picker-link",children:e.jsx(c,{style:{marginLeft:"0%",width:"17%",backgroundColor:"#ff4d4d",color:"white"},children:"Add Promotion"})}),e.jsx(De,{style:{marginTop:"1%"},className:"bg-body-tertiary",children:e.jsx(g,{type:"text",placeholder:"Search by Promotion by name",className:"picker-input",value:L,style:{width:480,marginLeft:"0%"},onChange:t=>ne(t.target.value)})}),ie?e.jsx(Se,{}):e.jsxs(ve,{children:[e.jsx(we,{children:e.jsxs(le,{children:[e.jsx(d,{scope:"col",children:"#"}),e.jsx(d,{scope:"col",children:"Promotion Id"}),e.jsx(d,{scope:"col",children:"Name"}),e.jsx(d,{scope:"col",children:"Start Date"}),e.jsx(d,{scope:"col",children:"End Date"}),e.jsx(d,{scope:"col",children:"Status"}),e.jsx(d,{scope:"col",children:"Manage Markets"}),e.jsx(d,{scope:"col",children:"Manage Products"}),e.jsx(d,{scope:"col",children:"Edit"}),e.jsx(d,{scope:"col",children:"Edit Status"}),e.jsx(d,{scope:"col",children:"Action"})]})}),e.jsx(Ae,{children:v.map((t,o)=>e.jsxs(le,{children:[e.jsx(u,{children:o+1}),e.jsx(u,{children:t.promo_id}),e.jsx(u,{children:t.name}),e.jsx(u,{children:new Date(t.startDate).toLocaleDateString()}),e.jsx(u,{children:new Date(t.endDate).toLocaleDateString()}),e.jsx(u,{children:t.status===!0?"Active":"De active"}),e.jsx(u,{children:e.jsx(b,{to:`/promotions/market/${t._id}`,children:e.jsx(c,{size:"sm",style:{backgroundColor:"#ff4d4d",color:"white"},variant:"outline",children:e.jsx(P,{icon:re,size:"lg",style:{color:"white"}})})})}),e.jsx(u,{children:e.jsx(b,{to:`/promotions/products/${t._id}`,children:e.jsx(c,{size:"sm",style:{backgroundColor:"#ff4d4d",color:"white"},variant:"outline",children:e.jsx(P,{icon:re,size:"lg",style:{color:"white"}})})})}),e.jsx(u,{children:e.jsx(b,{children:e.jsx(P,{icon:Le,size:"xl",onClick:()=>je(t)})})}),e.jsx(u,{children:t.status?e.jsx(c,{size:"sm",onClick:()=>se(t._id,!1),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Deactivate"}):e.jsx(c,{size:"sm",onClick:()=>se(t._id,!0),style:{backgroundColor:"#ff4d4d",width:90,color:"white"},children:"Activate"})}),e.jsx(u,{children:e.jsx(c,{size:"sm",style:{backgroundColor:"#ff4d4d"},variant:"outline",onClick:()=>Ce(t._id),children:e.jsx(P,{icon:Ee,size:"lg",style:{color:"white"}})})})]},o))})]}),e.jsxs(Te,{"aria-label":"Page navigation example",children:[e.jsx(z,{disabled:T<=0,onClick:ge,children:"Previous"}),fe(),e.jsx(z,{disabled:de===!0,onClick:pe,children:"Next"})]}),e.jsxs(N,{alignment:"center",visible:$,scrollable:!0,size:"sm",onClose:()=>x(!1),children:[e.jsx(M,{closeButton:!1,children:e.jsx(B,{children:"Confirmation"})}),e.jsxs(I,{children:[e.jsx("a",{children:"Are you sure you want to delete this promotion?"}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[e.jsx(c,{onClick:()=>be(he),style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),e.jsx(c,{onClick:()=>x(!1),style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]}),e.jsxs(N,{alignment:"center",visible:_,scrollable:!0,size:"sm",onClose:()=>f(!1),children:[e.jsx(M,{closeButton:!1,children:e.jsx(B,{children:"Confirmation"})}),e.jsxs(I,{children:[e.jsxs("a",{children:["Are you sure you want to ",R?"activate":"deactivate"," this promotion?"]}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[e.jsx(c,{onClick:()=>xe(),style:{backgroundColor:"#ff4d4d",color:"white",marginRight:"10px"},children:"Yes"}),e.jsx(c,{onClick:()=>f(!1),style:{backgroundColor:"#ff4d4d",color:"white",marginLeft:"10px"},children:"No"})]})]})]}),e.jsxs(N,{visible:U,scrollable:!0,size:"lg",onClose:()=>E(!1),children:[e.jsx(M,{closeButton:!0,children:e.jsx(B,{children:"Edit Promotion Information"})}),e.jsx(I,{children:e.jsxs("div",{className:"row g-3",children:[e.jsx(D,{md:6,children:e.jsx(g,{id:"name",label:"Promotion Name",defaultValue:h.name,onChange:t=>Y(t.target.value)})}),e.jsx(D,{md:6,children:e.jsx(g,{id:"startDate",label:"Start Date",type:"date",defaultValue:((ae=h.startDate)==null?void 0:ae.split("T")[0])||"",onChange:t=>F(t.target.value)})}),e.jsx(D,{md:6,children:e.jsx(g,{id:"endDate",label:"End Date",type:"date",defaultValue:((oe=h.endDate)==null?void 0:oe.split("T")[0])||"",onChange:t=>J(t.target.value)})}),e.jsx(D,{md:6,children:e.jsx(g,{id:"promotionid",label:"Promotion ID",readOnly:!0,defaultValue:h.promo_id,onChange:t=>W(t.target.value)})}),e.jsx(c,{type:"submit",style:{marginBottom:"3%",width:"200px",backgroundColor:"#ff4d4d",color:"white"},onClick:()=>ye(),children:"Update Promotion"})]})})]})]})};export{Fe as default};
